!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define("CoronaBundle",[],e):"object"==typeof exports?exports.CoronaBundle=e():t.CoronaBundle=e()}(window,(function(){return function(t){var e={};function n(i){if(e[i])return e[i].exports;var r=e[i]={i:i,l:!1,exports:{}};return t[i].call(r.exports,r,r.exports,n),r.l=!0,r.exports}return n.m=t,n.c=e,n.d=function(t,e,i){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var r in t)n.d(i,r,function(e){return t[e]}.bind(null,r));return i},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=23)}([function(t,e,n){"use strict";n.d(e,"b",(function(){return i})),n.d(e,"a",(function(){return r})),n.d(e,"d",(function(){return o})),n.d(e,"i",(function(){return s})),n.d(e,"f",(function(){return l})),n.d(e,"g",(function(){return u})),n.d(e,"e",(function(){return h})),n.d(e,"h",(function(){return c})),n.d(e,"c",(function(){return d}));const i=36e5,r=24*i;var a=new Map;function o(t){return`${new Intl.DateTimeFormat("en",{year:"numeric"}).format(t)}-${new Intl.DateTimeFormat("en",{month:"2-digit"}).format(t)}-${new Intl.DateTimeFormat("en",{day:"2-digit"}).format(t)}`}function s(t){return`${new Intl.DateTimeFormat("en",{month:"short"}).format(t)} ${new Intl.DateTimeFormat("en",{day:"numeric"}).format(t)}`}function l(t){return t.toLocaleDateString("en-US",{month:"long",day:"numeric",year:"numeric"})}function u(t){let e=t.getTime(),n=a.get(e);if(void 0===n){let i=e+6e4*t.getTimezoneOffset();n=new Date(i),a.set(e,n)}return n}function h(t){return new Date(t.getTime()-6e4*t.getTimezoneOffset())}function c(t,e,n=!0){let i=(e.getTime()-t.getTime())/r;return n&&(i=Math.round(i)),i}function d(t){let e=new Date(t);return e=u(e),e}},,,function(t,e,n){"use strict";n.d(e,"c",(function(){return Z})),n.d(e,"a",(function(){return $}));var i=n(9),r=n(14),a=n(15),o=function(t){return new Array(t.length)};function s(t,e){this.ownerDocument=t.ownerDocument,this.namespaceURI=t.namespaceURI,this._next=null,this._parent=t,this.__data__=e}s.prototype={constructor:s,appendChild:function(t){return this._parent.insertBefore(t,this._next)},insertBefore:function(t,e){return this._parent.insertBefore(t,e)},querySelector:function(t){return this._parent.querySelector(t)},querySelectorAll:function(t){return this._parent.querySelectorAll(t)}};function l(t,e,n,i,r,a){for(var o,l=0,u=e.length,h=a.length;l<h;++l)(o=e[l])?(o.__data__=a[l],i[l]=o):n[l]=new s(t,a[l]);for(;l<u;++l)(o=e[l])&&(r[l]=o)}function u(t,e,n,i,r,a,o){var l,u,h,c={},d=e.length,f=a.length,p=new Array(d);for(l=0;l<d;++l)(u=e[l])&&(p[l]=h="$"+o.call(u,u.__data__,l,e),h in c?r[l]=u:c[h]=u);for(l=0;l<f;++l)(u=c[h="$"+o.call(t,a[l],l,a)])?(i[l]=u,u.__data__=a[l],c[h]=null):n[l]=new s(t,a[l]);for(l=0;l<d;++l)(u=e[l])&&c[p[l]]===u&&(r[l]=u)}function h(t,e){return t<e?-1:t>e?1:t>=e?0:NaN}var c=n(10);function d(t){return function(){this.removeAttribute(t)}}function f(t){return function(){this.removeAttributeNS(t.space,t.local)}}function p(t,e){return function(){this.setAttribute(t,e)}}function g(t,e){return function(){this.setAttributeNS(t.space,t.local,e)}}function m(t,e){return function(){var n=e.apply(this,arguments);null==n?this.removeAttribute(t):this.setAttribute(t,n)}}function v(t,e){return function(){var n=e.apply(this,arguments);null==n?this.removeAttributeNS(t.space,t.local):this.setAttributeNS(t.space,t.local,n)}}var y=n(16);function _(t){return function(){delete this[t]}}function D(t,e){return function(){this[t]=e}}function w(t,e){return function(){var n=e.apply(this,arguments);null==n?delete this[t]:this[t]=n}}function b(t){return t.trim().split(/^|\s+/)}function S(t){return t.classList||new x(t)}function x(t){this._node=t,this._names=b(t.getAttribute("class")||"")}function F(t,e){for(var n=S(t),i=-1,r=e.length;++i<r;)n.add(e[i])}function C(t,e){for(var n=S(t),i=-1,r=e.length;++i<r;)n.remove(e[i])}function R(t){return function(){F(this,t)}}function T(t){return function(){C(this,t)}}function I(t,e){return function(){(e.apply(this,arguments)?F:C)(this,t)}}x.prototype={add:function(t){this._names.indexOf(t)<0&&(this._names.push(t),this._node.setAttribute("class",this._names.join(" ")))},remove:function(t){var e=this._names.indexOf(t);e>=0&&(this._names.splice(e,1),this._node.setAttribute("class",this._names.join(" ")))},contains:function(t){return this._names.indexOf(t)>=0}};function M(){this.textContent=""}function k(t){return function(){this.textContent=t}}function E(t){return function(){var e=t.apply(this,arguments);this.textContent=null==e?"":e}}function N(){this.innerHTML=""}function A(t){return function(){this.innerHTML=t}}function B(t){return function(){var e=t.apply(this,arguments);this.innerHTML=null==e?"":e}}function O(){this.nextSibling&&this.parentNode.appendChild(this)}function P(){this.previousSibling&&this.parentNode.insertBefore(this,this.parentNode.firstChild)}var H=n(6);function L(t){return function(){var e=this.ownerDocument,n=this.namespaceURI;return n===H.b&&e.documentElement.namespaceURI===H.b?e.createElement(t):e.createElementNS(n,t)}}function j(t){return function(){return this.ownerDocument.createElementNS(t.space,t.local)}}var z=function(t){var e=Object(c.a)(t);return(e.local?j:L)(e)};function V(){return null}function W(){var t=this.parentNode;t&&t.removeChild(this)}function U(){var t=this.cloneNode(!1),e=this.parentNode;return e?e.insertBefore(t,this.nextSibling):t}function Y(){var t=this.cloneNode(!0),e=this.parentNode;return e?e.insertBefore(t,this.nextSibling):t}var q=n(12),G=n(11);function Q(t,e,n){var i=Object(G.a)(t),r=i.CustomEvent;"function"==typeof r?r=new r(e,n):(r=i.document.createEvent("Event"),n?(r.initEvent(e,n.bubbles,n.cancelable),r.detail=n.detail):r.initEvent(e,!1,!1)),t.dispatchEvent(r)}function X(t,e){return function(){return Q(this,t,e)}}function J(t,e){return function(){return Q(this,t,e.apply(this,arguments))}}var Z=[null];function $(t,e){this._groups=t,this._parents=e}function K(){return new $([[document.documentElement]],Z)}$.prototype=K.prototype={constructor:$,select:function(t){"function"!=typeof t&&(t=Object(i.a)(t));for(var e=this._groups,n=e.length,r=new Array(n),a=0;a<n;++a)for(var o,s,l=e[a],u=l.length,h=r[a]=new Array(u),c=0;c<u;++c)(o=l[c])&&(s=t.call(o,o.__data__,c,l))&&("__data__"in o&&(s.__data__=o.__data__),h[c]=s);return new $(r,this._parents)},selectAll:function(t){"function"!=typeof t&&(t=Object(r.a)(t));for(var e=this._groups,n=e.length,i=[],a=[],o=0;o<n;++o)for(var s,l=e[o],u=l.length,h=0;h<u;++h)(s=l[h])&&(i.push(t.call(s,s.__data__,h,l)),a.push(s));return new $(i,a)},filter:function(t){"function"!=typeof t&&(t=Object(a.a)(t));for(var e=this._groups,n=e.length,i=new Array(n),r=0;r<n;++r)for(var o,s=e[r],l=s.length,u=i[r]=[],h=0;h<l;++h)(o=s[h])&&t.call(o,o.__data__,h,s)&&u.push(o);return new $(i,this._parents)},data:function(t,e){if(!t)return m=new Array(this.size()),d=-1,this.each((function(t){m[++d]=t})),m;var n,i=e?u:l,r=this._parents,a=this._groups;"function"!=typeof t&&(n=t,t=function(){return n});for(var o=a.length,s=new Array(o),h=new Array(o),c=new Array(o),d=0;d<o;++d){var f=r[d],p=a[d],g=p.length,m=t.call(f,f&&f.__data__,d,r),v=m.length,y=h[d]=new Array(v),_=s[d]=new Array(v);i(f,p,y,_,c[d]=new Array(g),m,e);for(var D,w,b=0,S=0;b<v;++b)if(D=y[b]){for(b>=S&&(S=b+1);!(w=_[S])&&++S<v;);D._next=w||null}}return(s=new $(s,r))._enter=h,s._exit=c,s},enter:function(){return new $(this._enter||this._groups.map(o),this._parents)},exit:function(){return new $(this._exit||this._groups.map(o),this._parents)},join:function(t,e,n){var i=this.enter(),r=this,a=this.exit();return i="function"==typeof t?t(i):i.append(t+""),null!=e&&(r=e(r)),null==n?a.remove():n(a),i&&r?i.merge(r).order():r},merge:function(t){for(var e=this._groups,n=t._groups,i=e.length,r=n.length,a=Math.min(i,r),o=new Array(i),s=0;s<a;++s)for(var l,u=e[s],h=n[s],c=u.length,d=o[s]=new Array(c),f=0;f<c;++f)(l=u[f]||h[f])&&(d[f]=l);for(;s<i;++s)o[s]=e[s];return new $(o,this._parents)},order:function(){for(var t=this._groups,e=-1,n=t.length;++e<n;)for(var i,r=t[e],a=r.length-1,o=r[a];--a>=0;)(i=r[a])&&(o&&4^i.compareDocumentPosition(o)&&o.parentNode.insertBefore(i,o),o=i);return this},sort:function(t){function e(e,n){return e&&n?t(e.__data__,n.__data__):!e-!n}t||(t=h);for(var n=this._groups,i=n.length,r=new Array(i),a=0;a<i;++a){for(var o,s=n[a],l=s.length,u=r[a]=new Array(l),c=0;c<l;++c)(o=s[c])&&(u[c]=o);u.sort(e)}return new $(r,this._parents).order()},call:function(){var t=arguments[0];return arguments[0]=this,t.apply(null,arguments),this},nodes:function(){var t=new Array(this.size()),e=-1;return this.each((function(){t[++e]=this})),t},node:function(){for(var t=this._groups,e=0,n=t.length;e<n;++e)for(var i=t[e],r=0,a=i.length;r<a;++r){var o=i[r];if(o)return o}return null},size:function(){var t=0;return this.each((function(){++t})),t},empty:function(){return!this.node()},each:function(t){for(var e=this._groups,n=0,i=e.length;n<i;++n)for(var r,a=e[n],o=0,s=a.length;o<s;++o)(r=a[o])&&t.call(r,r.__data__,o,a);return this},attr:function(t,e){var n=Object(c.a)(t);if(arguments.length<2){var i=this.node();return n.local?i.getAttributeNS(n.space,n.local):i.getAttribute(n)}return this.each((null==e?n.local?f:d:"function"==typeof e?n.local?v:m:n.local?g:p)(n,e))},style:y.a,property:function(t,e){return arguments.length>1?this.each((null==e?_:"function"==typeof e?w:D)(t,e)):this.node()[t]},classed:function(t,e){var n=b(t+"");if(arguments.length<2){for(var i=S(this.node()),r=-1,a=n.length;++r<a;)if(!i.contains(n[r]))return!1;return!0}return this.each(("function"==typeof e?I:e?R:T)(n,e))},text:function(t){return arguments.length?this.each(null==t?M:("function"==typeof t?E:k)(t)):this.node().textContent},html:function(t){return arguments.length?this.each(null==t?N:("function"==typeof t?B:A)(t)):this.node().innerHTML},raise:function(){return this.each(O)},lower:function(){return this.each(P)},append:function(t){var e="function"==typeof t?t:z(t);return this.select((function(){return this.appendChild(e.apply(this,arguments))}))},insert:function(t,e){var n="function"==typeof t?t:z(t),r=null==e?V:"function"==typeof e?e:Object(i.a)(e);return this.select((function(){return this.insertBefore(n.apply(this,arguments),r.apply(this,arguments)||null)}))},remove:function(){return this.each(W)},clone:function(t){return this.select(t?Y:U)},datum:function(t){return arguments.length?this.property("__data__",t):this.node().__data__},on:q.b,dispatch:function(t,e){return this.each(("function"==typeof e?J:X)(t,e))}};e.b=K},,,function(t,e,n){"use strict";n.d(e,"b",(function(){return i}));var i="http://www.w3.org/1999/xhtml";e.a={svg:"http://www.w3.org/2000/svg",xhtml:i,xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"}},function(t,e,n){"use strict";n.r(e),n.d(e,"HashString",(function(){return r}));var i=n(0);function r(t){var e=0,n=t.length,i=0;if(n>0)for(;i<n;)e=(e<<5)-e+t.charCodeAt(i++)|0;return"hash"+e.toString()}String.prototype.capitalize=function(){return this.charAt(0).toUpperCase()+this.slice(1)},Date.prototype.addHours=function(t){return Object(i.g)(new Date(this.getTime()+t*i.b))},Date.prototype.addDays=function(t){return Object(i.g)(new Date(this.getTime()+t*i.a))},Array.prototype.last=function(){return this[this.length-1]},Array.prototype.first=function(){return this[0]}},,function(t,e,n){"use strict";function i(){}e.a=function(t){return null==t?i:function(){return this.querySelector(t)}}},function(t,e,n){"use strict";var i=n(6);e.a=function(t){var e=t+="",n=e.indexOf(":");return n>=0&&"xmlns"!==(e=t.slice(0,n))&&(t=t.slice(n+1)),i.a.hasOwnProperty(e)?{space:i.a[e],local:t}:t}},function(t,e,n){"use strict";e.a=function(t){return t.ownerDocument&&t.ownerDocument.defaultView||t.document&&t||t.defaultView}},function(t,e,n){"use strict";n.d(e,"c",(function(){return r})),n.d(e,"a",(function(){return h}));var i={},r=null;"undefined"!=typeof document&&("onmouseenter"in document.documentElement||(i={mouseenter:"mouseover",mouseleave:"mouseout"}));function a(t,e,n){return t=o(t,e,n),function(e){var n=e.relatedTarget;n&&(n===this||8&n.compareDocumentPosition(this))||t.call(this,e)}}function o(t,e,n){return function(i){var a=r;r=i;try{t.call(this,this.__data__,e,n)}finally{r=a}}}function s(t){return t.trim().split(/^|\s+/).map((function(t){var e="",n=t.indexOf(".");return n>=0&&(e=t.slice(n+1),t=t.slice(0,n)),{type:t,name:e}}))}function l(t){return function(){var e=this.__on;if(e){for(var n,i=0,r=-1,a=e.length;i<a;++i)n=e[i],t.type&&n.type!==t.type||n.name!==t.name?e[++r]=n:this.removeEventListener(n.type,n.listener,n.capture);++r?e.length=r:delete this.__on}}}function u(t,e,n){var r=i.hasOwnProperty(t.type)?a:o;return function(i,a,o){var s,l=this.__on,u=r(e,a,o);if(l)for(var h=0,c=l.length;h<c;++h)if((s=l[h]).type===t.type&&s.name===t.name)return this.removeEventListener(s.type,s.listener,s.capture),this.addEventListener(s.type,s.listener=u,s.capture=n),void(s.value=e);this.addEventListener(t.type,u,n),s={type:t.type,name:t.name,value:e,listener:u,capture:n},l?l.push(s):this.__on=[s]}}function h(t,e,n,i){var a=r;t.sourceEvent=r,r=t;try{return e.apply(n,i)}finally{r=a}}e.b=function(t,e,n){var i,r,a=s(t+""),o=a.length;if(!(arguments.length<2)){for(h=e?u:l,null==n&&(n=!1),i=0;i<o;++i)this.each(h(a[i],e,n));return this}var h=this.node().__on;if(h)for(var c,d=0,f=h.length;d<f;++d)for(i=0,c=h[d];i<o;++i)if((r=a[i]).type===c.type&&r.name===c.name)return c.value}},,function(t,e,n){"use strict";function i(){return[]}e.a=function(t){return null==t?i:function(){return this.querySelectorAll(t)}}},function(t,e,n){"use strict";e.a=function(t){return function(){return this.matches(t)}}},function(t,e,n){"use strict";n.d(e,"b",(function(){return s}));var i=n(11);function r(t){return function(){this.style.removeProperty(t)}}function a(t,e,n){return function(){this.style.setProperty(t,e,n)}}function o(t,e,n){return function(){var i=e.apply(this,arguments);null==i?this.style.removeProperty(t):this.style.setProperty(t,i,n)}}function s(t,e){return t.style.getPropertyValue(e)||Object(i.a)(t).getComputedStyle(t,null).getPropertyValue(e)}e.a=function(t,e,n){return arguments.length>1?this.each((null==e?r:"function"==typeof e?o:a)(t,e,null==n?"":n)):s(this.node(),t)}},function(t,e,n){"use strict";var i=n(3);e.a=function(t){return"string"==typeof t?new i.a([[document.querySelector(t)]],[document.documentElement]):new i.a([[t]],i.c)}},,,,,,function(t,e,n){n(7),n(24),t.exports=n(25)},function(t,e,n){"use strict";n.r(e);var i=n(3),r=n(17);i.b.prototype.moveToFront=function(){return this.each((function(){this.parentNode.appendChild(this)}))},i.b.prototype.moveToBack=function(){return this.each((function(){let t=this.parentNode.firstChild;t&&this.parentNode.insertBefore(this,t)}))},i.b.prototype.first=function(){return Object(r.a)(this._groups[0][0])},i.b.prototype.last=function(){let t=this.size()-1;return Object(r.a)(this._groups[0][t])}},function(t,e,n){"use strict";function i(t){if(!t.ok)throw new Error(t.status+" "+t.statusText);if(204!==t.status&&205!==t.status)return t.json()}n.r(e);var r=function(t,e){return fetch(t,e).then(i)},a=n(17);const o=0,s=1,l=2,u=3;class h{constructor(t,e,n,i){this.ID=e,this.population=n,this.type=i,this.name=t,this.article=null,this.shortName=null,this.preposition="in",this.plainEnglishNameFormatter=null,this.fullyQualifiedNameFormatter=null,this.parentRegion=null,this.subregionIDs=null}fullyQualifiedName(){return this.fullyQualifiedNameFormatter?this.fullyQualifiedNameFormatter(this.name,this.parentRegion):this.name}plainEnglishName(){return this.plainEnglishNameFormatter?this.plainEnglishNameFormatter(this.name,this.parentRegion):this.name}articleString(){return null===this.article?"":this.article+" "}qualifiedNameWithArticle(){return this.articleString()+this.fullyQualifiedName()}plainEnglishNameWithArticle(){return this.articleString()+this.plainEnglishName()}prepositionString(){return null===this.preposition?"":this.preposition+" "}topParent(){let t=this.parentRegion;for(;null!==t.parentRegion;)t=t.parentRegion;return t}static fromRegion(t){let e=new h(t.name,t.ID,t.population,t.type);return e.article=t.article,e.shortName=t.shortName,e.preposition=t.preposition,e.plainEnglishNameFormatter=t.plainEnglishNameFormatter,e.fullyQualifiedNameFormatter=t.fullyQualifiedNameFormatter,e.parentRegion=t.parentRegion,e.subregionIDs=Array.from(t.subregionIDs),e}static metroCountyNames(){return new Set(["New York City","Los Angeles","San Francisco","Philadelphia","Denver","San Diego","Dallas","East Baton Rouge","Sacramento","Alameda","San Bernardino"])}static fromJSONObject(t,e,n){let i=h.RegionTypeFromString(e),r=new h(t.name,t.ID,t.population,i);switch(void 0!==t.preposition&&(r.preposition=t.preposition),void 0!==t.shortName&&(r.shortName=t.shortName),void 0!==t.parentRegionID&&null!==n&&(r.parentRegion=n.regionWithID(t.parentRegionID)),void 0!==t.subregionIDs&&(r.subregionIDs=Array.from(t.subregionIDs)),i){case o:r.article="the",r.fullyQualifiedNameFormatter=function(t,e){return"United States"},r.plainEnglishNameFormatter=function(t,e){return"United States"};break;case s:r.article="the";break;case l:break;case u:r.fullyQualifiedNameFormatter=function(t,e){let n=" County, ";return h.metroCountyNames().has(t)&&(n=", "),t+n+e.shortName},r.plainEnglishNameFormatter=function(t,e){let n=" County";return h.metroCountyNames().has(t)&&(n=""),t+n}}return r}static RegionTypeFromString(t){switch(t){case"Nation":return o;case"Coalition":return s;case"State":return l;case"County":return u}return null}}class c{constructor(){this._regionsByID=new Map,this._regionsByName=new Map,this._regionIDAliases=new Map,this._aliasesByTargetID=new Map}static fromJSONObject(t,e){let n=new c,i=t.regionType;for(const r in t.regionsByID){let a=h.fromJSONObject(t.regionsByID[r],i,e);n.registerRegion(a)}for(const e in t.regionIDAliases){let i=t.regionIDAliases[e];n.registerIDAlias(e,i)}return n}registerRegion(t){this._regionsByID.set(t.ID,t),this._regionsByName.set(c.normalizeRegionName(t.name),t)}registerIDAlias(t,e){this._regionIDAliases.set(t,e);let n=this._aliasesByTargetID.get(e);void 0===n&&(n=[]),n.push(t),this._aliasesByTargetID.set(e,n)}aliasesForRegion(t){return this._aliasesByTargetID.get(t)}regionWithID(t){let e=this._regionsByID.get(t);return void 0===e&&this._regionIDAliases.has(t)&&(e=this.regionWithID(this._regionIDAliases.get(t))),e}has(t){return this._regionIDAliases.has(t)&&(t=this._regionIDAliases.get(t)),void 0!==this.regionWithID(t)}hasRegionWithName(t){return void 0!==this.regionWithName(t)}regionWithName(t){return this._regionsByName.get(c.normalizeRegionName(t))}static normalizeRegionName(t){return t.toLowerCase()}addAll(t){this._regionsByID=new Map([...this._regionsByID,...t._regionsByID])}}const d=0,f=1,p=3,g=5;var m=Array.prototype;Object.defineProperty(m,"rawdata",{get:function(){return this},set:function(t){}}),Object.defineProperty(m,"value",{get:function(){return this[v.FilterIndexToUsedIndices(d)]},set:function(t){this[v.FilterIndexToUsedIndices(d)]=t}}),Object.defineProperty(m,"change",{get:function(){return this[v.FilterIndexToUsedIndices(f)]},set:function(t){this[v.FilterIndexToUsedIndices(f)]=t}});class v{constructor(t){null!==t&&((Number.isNaN(t)||void 0===t)&&(t=0),this.rawdata=new Array(13).fill(0),this.value=t)}get value(){return this.rawdata[v.FilterIndexToUsedIndices(d)]}set value(t){this.rawdata[v.FilterIndexToUsedIndices(d)]=t}get change(){return this.rawdata[v.FilterIndexToUsedIndices(f)]}set change(t){this.rawdata[v.FilterIndexToUsedIndices(f)]=t}static FilterIndexToUsedIndices(t){switch(t){case d:return 0;case f:return 1;case p:return 2;case g:return 3}return-1}static ChangeIndexForIndex(t){return this.FilterIndexToUsedIndices(t+1)}static AverageIndexForIndex(t){const e=t===d?g-d:p-f;return this.FilterIndexToUsedIndices(t+e)}static fromJSONObject(t){return void 0===t||void 0===t.d?null:t.d}}class y{constructor(t,e){null===t&&null===e||(this.cases=new v(parseInt(t)),this.deaths=new v(parseInt(e)),this.hospitalized=new v(0),this.ventilated=null,this.totalTests=new v(0),this.testedNegative=new v(0),this.testedPositive=new v(0))}percentPositive(){if(null===this.totalTests||0===this.totalTests.value)return"N/A";let t=this.testedPositive.value/this.totalTests.value*100;return Math.round(10*t)/10+"%"}static NullInfection(){return new y(0,0)}static fromJSONObject(t){let e=new y(null,null);return e.cases=v.fromJSONObject(t.C),e.deaths=v.fromJSONObject(t.D),e.hospitalized=v.fromJSONObject(t.H),e.totalTests=v.fromJSONObject(t.TT),e.testedNegative=v.fromJSONObject(t.TN),e.testedPositive=v.fromJSONObject(t.TP),e}}var _=n(0);const D=new Map;class w{constructor(t,e,n,i=null){this.dateString=t,this.date=w.dateForString(t),this.region=e,this.infection=n,this.mobilityData=null,this.timeSeries=i}monthString(){return this.dateString.split("-")[1]}yearString(){return this.dateString.split("-")[0]}normalizedDate(){return Object(_.g)(this.date)}dateOnlyDiffersInDay(t){return this.monthString()===t.monthString()&&this.yearString()===t.yearString()}static dateForString(t){let e=D.get(t);return void 0===e&&(e=new Date(t),D.set(t,e)),e}}const b=0,S=1,x=2,F=3,C=4,R=5;class T{static fromJSONObject(t){let e=new T;return e.retailAndRecreation=v.fromJSONObject(t.rr),e.workplace=v.fromJSONObject(t.w),e.parks=v.fromJSONObject(t.p),e.transit=v.fromJSONObject(t.t),e.residential=v.fromJSONObject(t.res),e}}var I=function(t,e){if((n=(t=e?t.toExponential(e-1):t.toExponential()).indexOf("e"))<0)return null;var n,i=t.slice(0,n);return[i.length>1?i[0]+i.slice(2):i,+t.slice(n+1)]},M=function(t){return(t=I(Math.abs(t)))?t[1]:NaN},k=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function E(t){if(!(e=k.exec(t)))throw new Error("invalid format: "+t);var e;return new N({fill:e[1],align:e[2],sign:e[3],symbol:e[4],zero:e[5],width:e[6],comma:e[7],precision:e[8]&&e[8].slice(1),trim:e[9],type:e[10]})}function N(t){this.fill=void 0===t.fill?" ":t.fill+"",this.align=void 0===t.align?">":t.align+"",this.sign=void 0===t.sign?"-":t.sign+"",this.symbol=void 0===t.symbol?"":t.symbol+"",this.zero=!!t.zero,this.width=void 0===t.width?void 0:+t.width,this.comma=!!t.comma,this.precision=void 0===t.precision?void 0:+t.precision,this.trim=!!t.trim,this.type=void 0===t.type?"":t.type+""}E.prototype=N.prototype,N.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(void 0===this.width?"":Math.max(1,0|this.width))+(this.comma?",":"")+(void 0===this.precision?"":"."+Math.max(0,0|this.precision))+(this.trim?"~":"")+this.type};var A,B,O,P,H=function(t,e){var n=I(t,e);if(!n)return t+"";var i=n[0],r=n[1];return r<0?"0."+new Array(-r).join("0")+i:i.length>r+1?i.slice(0,r+1)+"."+i.slice(r+1):i+new Array(r-i.length+2).join("0")},L={"%":function(t,e){return(100*t).toFixed(e)},b:function(t){return Math.round(t).toString(2)},c:function(t){return t+""},d:function(t){return Math.round(t).toString(10)},e:function(t,e){return t.toExponential(e)},f:function(t,e){return t.toFixed(e)},g:function(t,e){return t.toPrecision(e)},o:function(t){return Math.round(t).toString(8)},p:function(t,e){return H(100*t,e)},r:H,s:function(t,e){var n=I(t,e);if(!n)return t+"";var i=n[0],r=n[1],a=r-(A=3*Math.max(-8,Math.min(8,Math.floor(r/3))))+1,o=i.length;return a===o?i:a>o?i+new Array(a-o+1).join("0"):a>0?i.slice(0,a)+"."+i.slice(a):"0."+new Array(1-a).join("0")+I(t,Math.max(0,e+a-1))[0]},X:function(t){return Math.round(t).toString(16).toUpperCase()},x:function(t){return Math.round(t).toString(16)}},j=function(t){return t},z=Array.prototype.map,V=["y","z","a","f","p","n","Âµ","m","","k","M","G","T","P","E","Z","Y"];B=function(t){var e,n,i=void 0===t.grouping||void 0===t.thousands?j:(e=z.call(t.grouping,Number),n=t.thousands+"",function(t,i){for(var r=t.length,a=[],o=0,s=e[0],l=0;r>0&&s>0&&(l+s+1>i&&(s=Math.max(1,i-l)),a.push(t.substring(r-=s,r+s)),!((l+=s+1)>i));)s=e[o=(o+1)%e.length];return a.reverse().join(n)}),r=void 0===t.currency?"":t.currency[0]+"",a=void 0===t.currency?"":t.currency[1]+"",o=void 0===t.decimal?".":t.decimal+"",s=void 0===t.numerals?j:function(t){return function(e){return e.replace(/[0-9]/g,(function(e){return t[+e]}))}}(z.call(t.numerals,String)),l=void 0===t.percent?"%":t.percent+"",u=void 0===t.minus?"-":t.minus+"",h=void 0===t.nan?"NaN":t.nan+"";function c(t){var e=(t=E(t)).fill,n=t.align,c=t.sign,d=t.symbol,f=t.zero,p=t.width,g=t.comma,m=t.precision,v=t.trim,y=t.type;"n"===y?(g=!0,y="g"):L[y]||(void 0===m&&(m=12),v=!0,y="g"),(f||"0"===e&&"="===n)&&(f=!0,e="0",n="=");var _="$"===d?r:"#"===d&&/[boxX]/.test(y)?"0"+y.toLowerCase():"",D="$"===d?a:/[%p]/.test(y)?l:"",w=L[y],b=/[defgprs%]/.test(y);function S(t){var r,a,l,d=_,S=D;if("c"===y)S=w(t)+S,t="";else{var x=(t=+t)<0||1/t<0;if(t=isNaN(t)?h:w(Math.abs(t),m),v&&(t=function(t){t:for(var e,n=t.length,i=1,r=-1;i<n;++i)switch(t[i]){case".":r=e=i;break;case"0":0===r&&(r=i),e=i;break;default:if(!+t[i])break t;r>0&&(r=0)}return r>0?t.slice(0,r)+t.slice(e+1):t}(t)),x&&0==+t&&"+"!==c&&(x=!1),d=(x?"("===c?c:u:"-"===c||"("===c?"":c)+d,S=("s"===y?V[8+A/3]:"")+S+(x&&"("===c?")":""),b)for(r=-1,a=t.length;++r<a;)if(48>(l=t.charCodeAt(r))||l>57){S=(46===l?o+t.slice(r+1):t.slice(r))+S,t=t.slice(0,r);break}}g&&!f&&(t=i(t,1/0));var F=d.length+t.length+S.length,C=F<p?new Array(p-F+1).join(e):"";switch(g&&f&&(t=i(C+t,C.length?p-S.length:1/0),C=""),n){case"<":t=d+t+S+C;break;case"=":t=d+C+t+S;break;case"^":t=C.slice(0,F=C.length>>1)+d+t+S+C.slice(F);break;default:t=C+d+t+S}return s(t)}return m=void 0===m?6:/[gprs]/.test(y)?Math.max(1,Math.min(21,m)):Math.max(0,Math.min(20,m)),S.toString=function(){return t+""},S}return{format:c,formatPrefix:function(t,e){var n=c(((t=E(t)).type="f",t)),i=3*Math.max(-8,Math.min(8,Math.floor(M(e)/3))),r=Math.pow(10,-i),a=V[8+i/3];return function(t){return n(r*t)+a}}}}({decimal:".",thousands:",",grouping:[3],currency:["$",""],minus:"-"}),O=B.format,P=B.formatPrefix;var W=n(7),U=Array.prototype.slice,Y=function(t){return t};function q(t){return"translate("+(t+.5)+",0)"}function G(t){return"translate(0,"+(t+.5)+")"}function Q(t){return function(e){return+t(e)}}function X(t){var e=Math.max(0,t.bandwidth()-1)/2;return t.round()&&(e=Math.round(e)),function(n){return+t(n)+e}}function J(){return!this.__axis}function Z(t,e){var n=[],i=null,r=null,a=6,o=6,s=3,l=1===t||4===t?-1:1,u=4===t||2===t?"x":"y",h=1===t||3===t?q:G;function c(c){var d=null==i?e.ticks?e.ticks.apply(e,n):e.domain():i,f=null==r?e.tickFormat?e.tickFormat.apply(e,n):Y:r,p=Math.max(a,0)+s,g=e.range(),m=+g[0]+.5,v=+g[g.length-1]+.5,y=(e.bandwidth?X:Q)(e.copy()),_=c.selection?c.selection():c,D=_.selectAll(".domain").data([null]),w=_.selectAll(".tick").data(d,e).order(),b=w.exit(),S=w.enter().append("g").attr("class","tick"),x=w.select("line"),F=w.select("text");D=D.merge(D.enter().insert("path",".tick").attr("class","domain").attr("stroke","currentColor")),w=w.merge(S),x=x.merge(S.append("line").attr("stroke","currentColor").attr(u+"2",l*a)),F=F.merge(S.append("text").attr("fill","currentColor").attr(u,l*p).attr("dy",1===t?"0em":3===t?"0.71em":"0.32em")),c!==_&&(D=D.transition(c),w=w.transition(c),x=x.transition(c),F=F.transition(c),b=b.transition(c).attr("opacity",1e-6).attr("transform",(function(t){return isFinite(t=y(t))?h(t):this.getAttribute("transform")})),S.attr("opacity",1e-6).attr("transform",(function(t){var e=this.parentNode.__axis;return h(e&&isFinite(e=e(t))?e:y(t))}))),b.remove(),D.attr("d",4===t||2==t?o?"M"+l*o+","+m+"H0.5V"+v+"H"+l*o:"M0.5,"+m+"V"+v:o?"M"+m+","+l*o+"V0.5H"+v+"V"+l*o:"M"+m+",0.5H"+v),w.attr("opacity",1).attr("transform",(function(t){return h(y(t))})),x.attr(u+"2",l*a),F.attr(u,l*p).text(f),_.filter(J).attr("fill","none").attr("font-size",10).attr("font-family","sans-serif").attr("text-anchor",2===t?"start":4===t?"end":"middle"),_.each((function(){this.__axis=y}))}return c.scale=function(t){return arguments.length?(e=t,c):e},c.ticks=function(){return n=U.call(arguments),c},c.tickArguments=function(t){return arguments.length?(n=null==t?[]:U.call(t),c):n.slice()},c.tickValues=function(t){return arguments.length?(i=null==t?null:U.call(t),c):i&&i.slice()},c.tickFormat=function(t){return arguments.length?(r=t,c):r},c.tickSize=function(t){return arguments.length?(a=o=+t,c):a},c.tickSizeInner=function(t){return arguments.length?(a=+t,c):a},c.tickSizeOuter=function(t){return arguments.length?(o=+t,c):o},c.tickPadding=function(t){return arguments.length?(s=+t,c):s},c}function $(t){return Z(4,t)}var K=Math.PI,tt=2*K,et=tt-1e-6;function nt(){this._x0=this._y0=this._x1=this._y1=null,this._=""}function it(){return new nt}nt.prototype=it.prototype={constructor:nt,moveTo:function(t,e){this._+="M"+(this._x0=this._x1=+t)+","+(this._y0=this._y1=+e)},closePath:function(){null!==this._x1&&(this._x1=this._x0,this._y1=this._y0,this._+="Z")},lineTo:function(t,e){this._+="L"+(this._x1=+t)+","+(this._y1=+e)},quadraticCurveTo:function(t,e,n,i){this._+="Q"+ +t+","+ +e+","+(this._x1=+n)+","+(this._y1=+i)},bezierCurveTo:function(t,e,n,i,r,a){this._+="C"+ +t+","+ +e+","+ +n+","+ +i+","+(this._x1=+r)+","+(this._y1=+a)},arcTo:function(t,e,n,i,r){t=+t,e=+e,n=+n,i=+i,r=+r;var a=this._x1,o=this._y1,s=n-t,l=i-e,u=a-t,h=o-e,c=u*u+h*h;if(r<0)throw new Error("negative radius: "+r);if(null===this._x1)this._+="M"+(this._x1=t)+","+(this._y1=e);else if(c>1e-6)if(Math.abs(h*s-l*u)>1e-6&&r){var d=n-a,f=i-o,p=s*s+l*l,g=d*d+f*f,m=Math.sqrt(p),v=Math.sqrt(c),y=r*Math.tan((K-Math.acos((p+c-g)/(2*m*v)))/2),_=y/v,D=y/m;Math.abs(_-1)>1e-6&&(this._+="L"+(t+_*u)+","+(e+_*h)),this._+="A"+r+","+r+",0,0,"+ +(h*d>u*f)+","+(this._x1=t+D*s)+","+(this._y1=e+D*l)}else this._+="L"+(this._x1=t)+","+(this._y1=e);else;},arc:function(t,e,n,i,r,a){t=+t,e=+e,a=!!a;var o=(n=+n)*Math.cos(i),s=n*Math.sin(i),l=t+o,u=e+s,h=1^a,c=a?i-r:r-i;if(n<0)throw new Error("negative radius: "+n);null===this._x1?this._+="M"+l+","+u:(Math.abs(this._x1-l)>1e-6||Math.abs(this._y1-u)>1e-6)&&(this._+="L"+l+","+u),n&&(c<0&&(c=c%tt+tt),c>et?this._+="A"+n+","+n+",0,1,"+h+","+(t-o)+","+(e-s)+"A"+n+","+n+",0,1,"+h+","+(this._x1=l)+","+(this._y1=u):c>1e-6&&(this._+="A"+n+","+n+",0,"+ +(c>=K)+","+h+","+(this._x1=t+n*Math.cos(r))+","+(this._y1=e+n*Math.sin(r))))},rect:function(t,e,n,i){this._+="M"+(this._x0=this._x1=+t)+","+(this._y0=this._y1=+e)+"h"+ +n+"v"+ +i+"h"+-n+"Z"},toString:function(){return this._}};var rt=it,at=function(t){return function(){return t}};function ot(t){this._context=t}ot.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._point=0},lineEnd:function(){(this._line||0!==this._line&&1===this._point)&&this._context.closePath(),this._line=1-this._line},point:function(t,e){switch(t=+t,e=+e,this._point){case 0:this._point=1,this._line?this._context.lineTo(t,e):this._context.moveTo(t,e);break;case 1:this._point=2;default:this._context.lineTo(t,e)}}};var st=function(t){return new ot(t)};function lt(t){return t[0]}function ut(t){return t[1]}function ht(t,e){let n;if(void 0===e)for(const e of t)null!=e&&(n<e||void 0===n&&e>=e)&&(n=e);else{let i=-1;for(let r of t)null!=(r=e(r,++i,t))&&(n<r||void 0===n&&r>=r)&&(n=r)}return n}function ct(t,e){let n;if(void 0===e)for(const e of t)null!=e&&(n>e||void 0===n&&e>=e)&&(n=e);else{let i=-1;for(let r of t)null!=(r=e(r,++i,t))&&(n>r||void 0===n&&r>=r)&&(n=r)}return n}var dt=Math.sqrt(50),ft=Math.sqrt(10),pt=Math.sqrt(2);function gt(t,e,n){var i=(e-t)/Math.max(0,n),r=Math.floor(Math.log(i)/Math.LN10),a=i/Math.pow(10,r);return r>=0?(a>=dt?10:a>=ft?5:a>=pt?2:1)*Math.pow(10,r):-Math.pow(10,-r)/(a>=dt?10:a>=ft?5:a>=pt?2:1)}function mt(t,e,n){var i=Math.abs(e-t)/Math.max(0,n),r=Math.pow(10,Math.floor(Math.log(i)/Math.LN10)),a=i/r;return a>=dt?r*=10:a>=ft?r*=5:a>=pt&&(r*=2),e<t?-r:r}var vt=function(t,e){return t<e?-1:t>e?1:t>=e?0:NaN},yt=function(t){var e;return 1===t.length&&(e=t,t=function(t,n){return vt(e(t),n)}),{left:function(e,n,i,r){for(null==i&&(i=0),null==r&&(r=e.length);i<r;){var a=i+r>>>1;t(e[a],n)<0?i=a+1:r=a}return i},right:function(e,n,i,r){for(null==i&&(i=0),null==r&&(r=e.length);i<r;){var a=i+r>>>1;t(e[a],n)>0?r=a:i=a+1}return i}}};var _t=yt(vt),Dt=_t.right,wt=(_t.left,Dt),bt=function(t,e,n){t.prototype=e.prototype=n,n.constructor=t};function St(t,e){var n=Object.create(t.prototype);for(var i in e)n[i]=e[i];return n}function xt(){}var Ft="\\s*([+-]?\\d+)\\s*",Ct="\\s*([+-]?\\d*\\.?\\d+(?:[eE][+-]?\\d+)?)\\s*",Rt="\\s*([+-]?\\d*\\.?\\d+(?:[eE][+-]?\\d+)?)%\\s*",Tt=/^#([0-9a-f]{3,8})$/,It=new RegExp("^rgb\\("+[Ft,Ft,Ft]+"\\)$"),Mt=new RegExp("^rgb\\("+[Rt,Rt,Rt]+"\\)$"),kt=new RegExp("^rgba\\("+[Ft,Ft,Ft,Ct]+"\\)$"),Et=new RegExp("^rgba\\("+[Rt,Rt,Rt,Ct]+"\\)$"),Nt=new RegExp("^hsl\\("+[Ct,Rt,Rt]+"\\)$"),At=new RegExp("^hsla\\("+[Ct,Rt,Rt,Ct]+"\\)$"),Bt={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};function Ot(){return this.rgb().formatHex()}function Pt(){return this.rgb().formatRgb()}function Ht(t){var e,n;return t=(t+"").trim().toLowerCase(),(e=Tt.exec(t))?(n=e[1].length,e=parseInt(e[1],16),6===n?Lt(e):3===n?new Wt(e>>8&15|e>>4&240,e>>4&15|240&e,(15&e)<<4|15&e,1):8===n?jt(e>>24&255,e>>16&255,e>>8&255,(255&e)/255):4===n?jt(e>>12&15|e>>8&240,e>>8&15|e>>4&240,e>>4&15|240&e,((15&e)<<4|15&e)/255):null):(e=It.exec(t))?new Wt(e[1],e[2],e[3],1):(e=Mt.exec(t))?new Wt(255*e[1]/100,255*e[2]/100,255*e[3]/100,1):(e=kt.exec(t))?jt(e[1],e[2],e[3],e[4]):(e=Et.exec(t))?jt(255*e[1]/100,255*e[2]/100,255*e[3]/100,e[4]):(e=Nt.exec(t))?Gt(e[1],e[2]/100,e[3]/100,1):(e=At.exec(t))?Gt(e[1],e[2]/100,e[3]/100,e[4]):Bt.hasOwnProperty(t)?Lt(Bt[t]):"transparent"===t?new Wt(NaN,NaN,NaN,0):null}function Lt(t){return new Wt(t>>16&255,t>>8&255,255&t,1)}function jt(t,e,n,i){return i<=0&&(t=e=n=NaN),new Wt(t,e,n,i)}function zt(t){return t instanceof xt||(t=Ht(t)),t?new Wt((t=t.rgb()).r,t.g,t.b,t.opacity):new Wt}function Vt(t,e,n,i){return 1===arguments.length?zt(t):new Wt(t,e,n,null==i?1:i)}function Wt(t,e,n,i){this.r=+t,this.g=+e,this.b=+n,this.opacity=+i}function Ut(){return"#"+qt(this.r)+qt(this.g)+qt(this.b)}function Yt(){var t=this.opacity;return(1===(t=isNaN(t)?1:Math.max(0,Math.min(1,t)))?"rgb(":"rgba(")+Math.max(0,Math.min(255,Math.round(this.r)||0))+", "+Math.max(0,Math.min(255,Math.round(this.g)||0))+", "+Math.max(0,Math.min(255,Math.round(this.b)||0))+(1===t?")":", "+t+")")}function qt(t){return((t=Math.max(0,Math.min(255,Math.round(t)||0)))<16?"0":"")+t.toString(16)}function Gt(t,e,n,i){return i<=0?t=e=n=NaN:n<=0||n>=1?t=e=NaN:e<=0&&(t=NaN),new Xt(t,e,n,i)}function Qt(t){if(t instanceof Xt)return new Xt(t.h,t.s,t.l,t.opacity);if(t instanceof xt||(t=Ht(t)),!t)return new Xt;if(t instanceof Xt)return t;var e=(t=t.rgb()).r/255,n=t.g/255,i=t.b/255,r=Math.min(e,n,i),a=Math.max(e,n,i),o=NaN,s=a-r,l=(a+r)/2;return s?(o=e===a?(n-i)/s+6*(n<i):n===a?(i-e)/s+2:(e-n)/s+4,s/=l<.5?a+r:2-a-r,o*=60):s=l>0&&l<1?0:o,new Xt(o,s,l,t.opacity)}function Xt(t,e,n,i){this.h=+t,this.s=+e,this.l=+n,this.opacity=+i}function Jt(t,e,n){return 255*(t<60?e+(n-e)*t/60:t<180?n:t<240?e+(n-e)*(240-t)/60:e)}function Zt(t,e,n,i,r){var a=t*t,o=a*t;return((1-3*t+3*a-o)*e+(4-6*a+3*o)*n+(1+3*t+3*a-3*o)*i+o*r)/6}bt(xt,Ht,{copy:function(t){return Object.assign(new this.constructor,this,t)},displayable:function(){return this.rgb().displayable()},hex:Ot,formatHex:Ot,formatHsl:function(){return Qt(this).formatHsl()},formatRgb:Pt,toString:Pt}),bt(Wt,Vt,St(xt,{brighter:function(t){return t=null==t?1/.7:Math.pow(1/.7,t),new Wt(this.r*t,this.g*t,this.b*t,this.opacity)},darker:function(t){return t=null==t?.7:Math.pow(.7,t),new Wt(this.r*t,this.g*t,this.b*t,this.opacity)},rgb:function(){return this},displayable:function(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:Ut,formatHex:Ut,formatRgb:Yt,toString:Yt})),bt(Xt,(function(t,e,n,i){return 1===arguments.length?Qt(t):new Xt(t,e,n,null==i?1:i)}),St(xt,{brighter:function(t){return t=null==t?1/.7:Math.pow(1/.7,t),new Xt(this.h,this.s,this.l*t,this.opacity)},darker:function(t){return t=null==t?.7:Math.pow(.7,t),new Xt(this.h,this.s,this.l*t,this.opacity)},rgb:function(){var t=this.h%360+360*(this.h<0),e=isNaN(t)||isNaN(this.s)?0:this.s,n=this.l,i=n+(n<.5?n:1-n)*e,r=2*n-i;return new Wt(Jt(t>=240?t-240:t+120,r,i),Jt(t,r,i),Jt(t<120?t+240:t-120,r,i),this.opacity)},displayable:function(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl:function(){var t=this.opacity;return(1===(t=isNaN(t)?1:Math.max(0,Math.min(1,t)))?"hsl(":"hsla(")+(this.h||0)+", "+100*(this.s||0)+"%, "+100*(this.l||0)+"%"+(1===t?")":", "+t+")")}}));var $t=function(t){return function(){return t}};function Kt(t,e){return function(n){return t+n*e}}function te(t){return 1==(t=+t)?ee:function(e,n){return n-e?function(t,e,n){return t=Math.pow(t,n),e=Math.pow(e,n)-t,n=1/n,function(i){return Math.pow(t+i*e,n)}}(e,n,t):$t(isNaN(e)?n:e)}}function ee(t,e){var n=e-t;return n?Kt(t,n):$t(isNaN(t)?e:t)}var ne=function t(e){var n=te(e);function i(t,e){var i=n((t=Vt(t)).r,(e=Vt(e)).r),r=n(t.g,e.g),a=n(t.b,e.b),o=ee(t.opacity,e.opacity);return function(e){return t.r=i(e),t.g=r(e),t.b=a(e),t.opacity=o(e),t+""}}return i.gamma=t,i}(1);function ie(t){return function(e){var n,i,r=e.length,a=new Array(r),o=new Array(r),s=new Array(r);for(n=0;n<r;++n)i=Vt(e[n]),a[n]=i.r||0,o[n]=i.g||0,s[n]=i.b||0;return a=t(a),o=t(o),s=t(s),i.opacity=1,function(t){return i.r=a(t),i.g=o(t),i.b=s(t),i+""}}}ie((function(t){var e=t.length-1;return function(n){var i=n<=0?n=0:n>=1?(n=1,e-1):Math.floor(n*e),r=t[i],a=t[i+1],o=i>0?t[i-1]:2*r-a,s=i<e-1?t[i+2]:2*a-r;return Zt((n-i/e)*e,o,r,a,s)}})),ie((function(t){var e=t.length;return function(n){var i=Math.floor(((n%=1)<0?++n:n)*e),r=t[(i+e-1)%e],a=t[i%e],o=t[(i+1)%e],s=t[(i+2)%e];return Zt((n-i/e)*e,r,a,o,s)}}));var re=function(t,e){e||(e=[]);var n,i=t?Math.min(e.length,t.length):0,r=e.slice();return function(a){for(n=0;n<i;++n)r[n]=t[n]*(1-a)+e[n]*a;return r}};function ae(t){return ArrayBuffer.isView(t)&&!(t instanceof DataView)}function oe(t,e){var n,i=e?e.length:0,r=t?Math.min(i,t.length):0,a=new Array(r),o=new Array(i);for(n=0;n<r;++n)a[n]=fe(t[n],e[n]);for(;n<i;++n)o[n]=e[n];return function(t){for(n=0;n<r;++n)o[n]=a[n](t);return o}}var se=function(t,e){var n=new Date;return t=+t,e=+e,function(i){return n.setTime(t*(1-i)+e*i),n}},le=function(t,e){return t=+t,e=+e,function(n){return t*(1-n)+e*n}},ue=function(t,e){var n,i={},r={};for(n in null!==t&&"object"==typeof t||(t={}),null!==e&&"object"==typeof e||(e={}),e)n in t?i[n]=fe(t[n],e[n]):r[n]=e[n];return function(t){for(n in i)r[n]=i[n](t);return r}},he=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,ce=new RegExp(he.source,"g");var de=function(t,e){var n,i,r,a=he.lastIndex=ce.lastIndex=0,o=-1,s=[],l=[];for(t+="",e+="";(n=he.exec(t))&&(i=ce.exec(e));)(r=i.index)>a&&(r=e.slice(a,r),s[o]?s[o]+=r:s[++o]=r),(n=n[0])===(i=i[0])?s[o]?s[o]+=i:s[++o]=i:(s[++o]=null,l.push({i:o,x:le(n,i)})),a=ce.lastIndex;return a<e.length&&(r=e.slice(a),s[o]?s[o]+=r:s[++o]=r),s.length<2?l[0]?function(t){return function(e){return t(e)+""}}(l[0].x):function(t){return function(){return t}}(e):(e=l.length,function(t){for(var n,i=0;i<e;++i)s[(n=l[i]).i]=n.x(t);return s.join("")})},fe=function(t,e){var n,i=typeof e;return null==e||"boolean"===i?$t(e):("number"===i?le:"string"===i?(n=Ht(e))?(e=n,ne):de:e instanceof Ht?ne:e instanceof Date?se:ae(e)?re:Array.isArray(e)?oe:"function"!=typeof e.valueOf&&"function"!=typeof e.toString||isNaN(e)?ue:le)(t,e)},pe=function(t,e){return t=+t,e=+e,function(n){return Math.round(t*(1-n)+e*n)}},ge=function(t){return+t},me=[0,1];function ve(t){return t}function ye(t,e){return(e-=t=+t)?function(n){return(n-t)/e}:(n=isNaN(e)?NaN:.5,function(){return n});var n}function _e(t,e,n){var i=t[0],r=t[1],a=e[0],o=e[1];return r<i?(i=ye(r,i),a=n(o,a)):(i=ye(i,r),a=n(a,o)),function(t){return a(i(t))}}function De(t,e,n){var i=Math.min(t.length,e.length)-1,r=new Array(i),a=new Array(i),o=-1;for(t[i]<t[0]&&(t=t.slice().reverse(),e=e.slice().reverse());++o<i;)r[o]=ye(t[o],t[o+1]),a[o]=n(e[o],e[o+1]);return function(e){var n=wt(t,e,1,i)-1;return a[n](r[n](e))}}function we(t,e){return e.domain(t.domain()).range(t.range()).interpolate(t.interpolate()).clamp(t.clamp()).unknown(t.unknown())}function be(){var t,e,n,i,r,a,o=me,s=me,l=fe,u=ve;function h(){var t,e,n,l=Math.min(o.length,s.length);return u!==ve&&(t=o[0],e=o[l-1],t>e&&(n=t,t=e,e=n),u=function(n){return Math.max(t,Math.min(e,n))}),i=l>2?De:_e,r=a=null,c}function c(e){return isNaN(e=+e)?n:(r||(r=i(o.map(t),s,l)))(t(u(e)))}return c.invert=function(n){return u(e((a||(a=i(s,o.map(t),le)))(n)))},c.domain=function(t){return arguments.length?(o=Array.from(t,ge),h()):o.slice()},c.range=function(t){return arguments.length?(s=Array.from(t),h()):s.slice()},c.rangeRound=function(t){return s=Array.from(t),l=pe,h()},c.clamp=function(t){return arguments.length?(u=!!t||ve,h()):u!==ve},c.interpolate=function(t){return arguments.length?(l=t,h()):l},c.unknown=function(t){return arguments.length?(n=t,c):n},function(n,i){return t=n,e=i,h()}}function Se(){return be()(ve,ve)}function xe(t,e){switch(arguments.length){case 0:break;case 1:this.range(t);break;default:this.range(e).domain(t)}return this}var Fe=function(t,e,n,i){var r,a=mt(t,e,n);switch((i=E(null==i?",f":i)).type){case"s":var o=Math.max(Math.abs(t),Math.abs(e));return null!=i.precision||isNaN(r=function(t,e){return Math.max(0,3*Math.max(-8,Math.min(8,Math.floor(M(e)/3)))-M(Math.abs(t)))}(a,o))||(i.precision=r),P(i,o);case"":case"e":case"g":case"p":case"r":null!=i.precision||isNaN(r=function(t,e){return t=Math.abs(t),e=Math.abs(e)-t,Math.max(0,M(e)-M(t))+1}(a,Math.max(Math.abs(t),Math.abs(e))))||(i.precision=r-("e"===i.type));break;case"f":case"%":null!=i.precision||isNaN(r=function(t){return Math.max(0,-M(Math.abs(t)))}(a))||(i.precision=r-2*("%"===i.type))}return O(i)};function Ce(t){var e=t.domain;return t.ticks=function(t){var n=e();return function(t,e,n){var i,r,a,o,s=-1;if(n=+n,(t=+t)===(e=+e)&&n>0)return[t];if((i=e<t)&&(r=t,t=e,e=r),0===(o=gt(t,e,n))||!isFinite(o))return[];if(o>0)for(t=Math.ceil(t/o),e=Math.floor(e/o),a=new Array(r=Math.ceil(e-t+1));++s<r;)a[s]=(t+s)*o;else for(t=Math.floor(t*o),e=Math.ceil(e*o),a=new Array(r=Math.ceil(t-e+1));++s<r;)a[s]=(t-s)/o;return i&&a.reverse(),a}(n[0],n[n.length-1],null==t?10:t)},t.tickFormat=function(t,n){var i=e();return Fe(i[0],i[i.length-1],null==t?10:t,n)},t.nice=function(n){null==n&&(n=10);var i,r=e(),a=0,o=r.length-1,s=r[a],l=r[o];return l<s&&(i=s,s=l,l=i,i=a,a=o,o=i),(i=gt(s,l,n))>0?i=gt(s=Math.floor(s/i)*i,l=Math.ceil(l/i)*i,n):i<0&&(i=gt(s=Math.ceil(s*i)/i,l=Math.floor(l*i)/i,n)),i>0?(r[a]=Math.floor(s/i)*i,r[o]=Math.ceil(l/i)*i,e(r)):i<0&&(r[a]=Math.ceil(s*i)/i,r[o]=Math.floor(l*i)/i,e(r)),t},t}function Re(){var t=Se();return t.copy=function(){return we(t,Re())},xe.apply(t,arguments),Ce(t)}var Te=new Date,Ie=new Date;function Me(t,e,n,i){function r(e){return t(e=0===arguments.length?new Date:new Date(+e)),e}return r.floor=function(e){return t(e=new Date(+e)),e},r.ceil=function(n){return t(n=new Date(n-1)),e(n,1),t(n),n},r.round=function(t){var e=r(t),n=r.ceil(t);return t-e<n-t?e:n},r.offset=function(t,n){return e(t=new Date(+t),null==n?1:Math.floor(n)),t},r.range=function(n,i,a){var o,s=[];if(n=r.ceil(n),a=null==a?1:Math.floor(a),!(n<i&&a>0))return s;do{s.push(o=new Date(+n)),e(n,a),t(n)}while(o<n&&n<i);return s},r.filter=function(n){return Me((function(e){if(e>=e)for(;t(e),!n(e);)e.setTime(e-1)}),(function(t,i){if(t>=t)if(i<0)for(;++i<=0;)for(;e(t,-1),!n(t););else for(;--i>=0;)for(;e(t,1),!n(t););}))},n&&(r.count=function(e,i){return Te.setTime(+e),Ie.setTime(+i),t(Te),t(Ie),Math.floor(n(Te,Ie))},r.every=function(t){return t=Math.floor(t),isFinite(t)&&t>0?t>1?r.filter(i?function(e){return i(e)%t==0}:function(e){return r.count(0,e)%t==0}):r:null}),r}var ke=Me((function(t){t.setMonth(0,1),t.setHours(0,0,0,0)}),(function(t,e){t.setFullYear(t.getFullYear()+e)}),(function(t,e){return e.getFullYear()-t.getFullYear()}),(function(t){return t.getFullYear()}));ke.every=function(t){return isFinite(t=Math.floor(t))&&t>0?Me((function(e){e.setFullYear(Math.floor(e.getFullYear()/t)*t),e.setMonth(0,1),e.setHours(0,0,0,0)}),(function(e,n){e.setFullYear(e.getFullYear()+n*t)})):null};var Ee=ke,Ne=(ke.range,Me((function(t){t.setDate(1),t.setHours(0,0,0,0)}),(function(t,e){t.setMonth(t.getMonth()+e)}),(function(t,e){return e.getMonth()-t.getMonth()+12*(e.getFullYear()-t.getFullYear())}),(function(t){return t.getMonth()}))),Ae=Ne;Ne.range;function Be(t){return Me((function(e){e.setDate(e.getDate()-(e.getDay()+7-t)%7),e.setHours(0,0,0,0)}),(function(t,e){t.setDate(t.getDate()+7*e)}),(function(t,e){return(e-t-6e4*(e.getTimezoneOffset()-t.getTimezoneOffset()))/6048e5}))}var Oe=Be(0),Pe=Be(1),He=Be(2),Le=Be(3),je=Be(4),ze=Be(5),Ve=Be(6),We=(Oe.range,Pe.range,He.range,Le.range,je.range,ze.range,Ve.range,Me((function(t){t.setHours(0,0,0,0)}),(function(t,e){t.setDate(t.getDate()+e)}),(function(t,e){return(e-t-6e4*(e.getTimezoneOffset()-t.getTimezoneOffset()))/864e5}),(function(t){return t.getDate()-1}))),Ue=We,Ye=(We.range,Me((function(t){t.setTime(t-t.getMilliseconds()-1e3*t.getSeconds()-6e4*t.getMinutes())}),(function(t,e){t.setTime(+t+36e5*e)}),(function(t,e){return(e-t)/36e5}),(function(t){return t.getHours()}))),qe=Ye,Ge=(Ye.range,Me((function(t){t.setTime(t-t.getMilliseconds()-1e3*t.getSeconds())}),(function(t,e){t.setTime(+t+6e4*e)}),(function(t,e){return(e-t)/6e4}),(function(t){return t.getMinutes()}))),Qe=Ge,Xe=(Ge.range,Me((function(t){t.setTime(t-t.getMilliseconds())}),(function(t,e){t.setTime(+t+1e3*e)}),(function(t,e){return(e-t)/1e3}),(function(t){return t.getUTCSeconds()}))),Je=Xe,Ze=(Xe.range,Me((function(){}),(function(t,e){t.setTime(+t+e)}),(function(t,e){return e-t})));Ze.every=function(t){return t=Math.floor(t),isFinite(t)&&t>0?t>1?Me((function(e){e.setTime(Math.floor(e/t)*t)}),(function(e,n){e.setTime(+e+n*t)}),(function(e,n){return(n-e)/t})):Ze:null};var $e=Ze;Ze.range;function Ke(t){return Me((function(e){e.setUTCDate(e.getUTCDate()-(e.getUTCDay()+7-t)%7),e.setUTCHours(0,0,0,0)}),(function(t,e){t.setUTCDate(t.getUTCDate()+7*e)}),(function(t,e){return(e-t)/6048e5}))}var tn=Ke(0),en=Ke(1),nn=Ke(2),rn=Ke(3),an=Ke(4),on=Ke(5),sn=Ke(6),ln=(tn.range,en.range,nn.range,rn.range,an.range,on.range,sn.range,Me((function(t){t.setUTCHours(0,0,0,0)}),(function(t,e){t.setUTCDate(t.getUTCDate()+e)}),(function(t,e){return(e-t)/864e5}),(function(t){return t.getUTCDate()-1}))),un=ln,hn=(ln.range,Me((function(t){t.setUTCMonth(0,1),t.setUTCHours(0,0,0,0)}),(function(t,e){t.setUTCFullYear(t.getUTCFullYear()+e)}),(function(t,e){return e.getUTCFullYear()-t.getUTCFullYear()}),(function(t){return t.getUTCFullYear()})));hn.every=function(t){return isFinite(t=Math.floor(t))&&t>0?Me((function(e){e.setUTCFullYear(Math.floor(e.getUTCFullYear()/t)*t),e.setUTCMonth(0,1),e.setUTCHours(0,0,0,0)}),(function(e,n){e.setUTCFullYear(e.getUTCFullYear()+n*t)})):null};var cn=hn;hn.range;function dn(t){if(0<=t.y&&t.y<100){var e=new Date(-1,t.m,t.d,t.H,t.M,t.S,t.L);return e.setFullYear(t.y),e}return new Date(t.y,t.m,t.d,t.H,t.M,t.S,t.L)}function fn(t){if(0<=t.y&&t.y<100){var e=new Date(Date.UTC(-1,t.m,t.d,t.H,t.M,t.S,t.L));return e.setUTCFullYear(t.y),e}return new Date(Date.UTC(t.y,t.m,t.d,t.H,t.M,t.S,t.L))}function pn(t,e,n){return{y:t,m:e,d:n,H:0,M:0,S:0,L:0}}var gn,mn,vn={"-":"",_:" ",0:"0"},yn=/^\s*\d+/,_n=/^%/,Dn=/[\\^$*+?|[\]().{}]/g;function wn(t,e,n){var i=t<0?"-":"",r=(i?-t:t)+"",a=r.length;return i+(a<n?new Array(n-a+1).join(e)+r:r)}function bn(t){return t.replace(Dn,"\\$&")}function Sn(t){return new RegExp("^(?:"+t.map(bn).join("|")+")","i")}function xn(t){for(var e={},n=-1,i=t.length;++n<i;)e[t[n].toLowerCase()]=n;return e}function Fn(t,e,n){var i=yn.exec(e.slice(n,n+1));return i?(t.w=+i[0],n+i[0].length):-1}function Cn(t,e,n){var i=yn.exec(e.slice(n,n+1));return i?(t.u=+i[0],n+i[0].length):-1}function Rn(t,e,n){var i=yn.exec(e.slice(n,n+2));return i?(t.U=+i[0],n+i[0].length):-1}function Tn(t,e,n){var i=yn.exec(e.slice(n,n+2));return i?(t.V=+i[0],n+i[0].length):-1}function In(t,e,n){var i=yn.exec(e.slice(n,n+2));return i?(t.W=+i[0],n+i[0].length):-1}function Mn(t,e,n){var i=yn.exec(e.slice(n,n+4));return i?(t.y=+i[0],n+i[0].length):-1}function kn(t,e,n){var i=yn.exec(e.slice(n,n+2));return i?(t.y=+i[0]+(+i[0]>68?1900:2e3),n+i[0].length):-1}function En(t,e,n){var i=/^(Z)|([+-]\d\d)(?::?(\d\d))?/.exec(e.slice(n,n+6));return i?(t.Z=i[1]?0:-(i[2]+(i[3]||"00")),n+i[0].length):-1}function Nn(t,e,n){var i=yn.exec(e.slice(n,n+1));return i?(t.q=3*i[0]-3,n+i[0].length):-1}function An(t,e,n){var i=yn.exec(e.slice(n,n+2));return i?(t.m=i[0]-1,n+i[0].length):-1}function Bn(t,e,n){var i=yn.exec(e.slice(n,n+2));return i?(t.d=+i[0],n+i[0].length):-1}function On(t,e,n){var i=yn.exec(e.slice(n,n+3));return i?(t.m=0,t.d=+i[0],n+i[0].length):-1}function Pn(t,e,n){var i=yn.exec(e.slice(n,n+2));return i?(t.H=+i[0],n+i[0].length):-1}function Hn(t,e,n){var i=yn.exec(e.slice(n,n+2));return i?(t.M=+i[0],n+i[0].length):-1}function Ln(t,e,n){var i=yn.exec(e.slice(n,n+2));return i?(t.S=+i[0],n+i[0].length):-1}function jn(t,e,n){var i=yn.exec(e.slice(n,n+3));return i?(t.L=+i[0],n+i[0].length):-1}function zn(t,e,n){var i=yn.exec(e.slice(n,n+6));return i?(t.L=Math.floor(i[0]/1e3),n+i[0].length):-1}function Vn(t,e,n){var i=_n.exec(e.slice(n,n+1));return i?n+i[0].length:-1}function Wn(t,e,n){var i=yn.exec(e.slice(n));return i?(t.Q=+i[0],n+i[0].length):-1}function Un(t,e,n){var i=yn.exec(e.slice(n));return i?(t.s=+i[0],n+i[0].length):-1}function Yn(t,e){return wn(t.getDate(),e,2)}function qn(t,e){return wn(t.getHours(),e,2)}function Gn(t,e){return wn(t.getHours()%12||12,e,2)}function Qn(t,e){return wn(1+Ue.count(Ee(t),t),e,3)}function Xn(t,e){return wn(t.getMilliseconds(),e,3)}function Jn(t,e){return Xn(t,e)+"000"}function Zn(t,e){return wn(t.getMonth()+1,e,2)}function $n(t,e){return wn(t.getMinutes(),e,2)}function Kn(t,e){return wn(t.getSeconds(),e,2)}function ti(t){var e=t.getDay();return 0===e?7:e}function ei(t,e){return wn(Oe.count(Ee(t)-1,t),e,2)}function ni(t,e){var n=t.getDay();return t=n>=4||0===n?je(t):je.ceil(t),wn(je.count(Ee(t),t)+(4===Ee(t).getDay()),e,2)}function ii(t){return t.getDay()}function ri(t,e){return wn(Pe.count(Ee(t)-1,t),e,2)}function ai(t,e){return wn(t.getFullYear()%100,e,2)}function oi(t,e){return wn(t.getFullYear()%1e4,e,4)}function si(t){var e=t.getTimezoneOffset();return(e>0?"-":(e*=-1,"+"))+wn(e/60|0,"0",2)+wn(e%60,"0",2)}function li(t,e){return wn(t.getUTCDate(),e,2)}function ui(t,e){return wn(t.getUTCHours(),e,2)}function hi(t,e){return wn(t.getUTCHours()%12||12,e,2)}function ci(t,e){return wn(1+un.count(cn(t),t),e,3)}function di(t,e){return wn(t.getUTCMilliseconds(),e,3)}function fi(t,e){return di(t,e)+"000"}function pi(t,e){return wn(t.getUTCMonth()+1,e,2)}function gi(t,e){return wn(t.getUTCMinutes(),e,2)}function mi(t,e){return wn(t.getUTCSeconds(),e,2)}function vi(t){var e=t.getUTCDay();return 0===e?7:e}function yi(t,e){return wn(tn.count(cn(t)-1,t),e,2)}function _i(t,e){var n=t.getUTCDay();return t=n>=4||0===n?an(t):an.ceil(t),wn(an.count(cn(t),t)+(4===cn(t).getUTCDay()),e,2)}function Di(t){return t.getUTCDay()}function wi(t,e){return wn(en.count(cn(t)-1,t),e,2)}function bi(t,e){return wn(t.getUTCFullYear()%100,e,2)}function Si(t,e){return wn(t.getUTCFullYear()%1e4,e,4)}function xi(){return"+0000"}function Fi(){return"%"}function Ci(t){return+t}function Ri(t){return Math.floor(+t/1e3)}!function(t){gn=function(t){var e=t.dateTime,n=t.date,i=t.time,r=t.periods,a=t.days,o=t.shortDays,s=t.months,l=t.shortMonths,u=Sn(r),h=xn(r),c=Sn(a),d=xn(a),f=Sn(o),p=xn(o),g=Sn(s),m=xn(s),v=Sn(l),y=xn(l),_={a:function(t){return o[t.getDay()]},A:function(t){return a[t.getDay()]},b:function(t){return l[t.getMonth()]},B:function(t){return s[t.getMonth()]},c:null,d:Yn,e:Yn,f:Jn,H:qn,I:Gn,j:Qn,L:Xn,m:Zn,M:$n,p:function(t){return r[+(t.getHours()>=12)]},q:function(t){return 1+~~(t.getMonth()/3)},Q:Ci,s:Ri,S:Kn,u:ti,U:ei,V:ni,w:ii,W:ri,x:null,X:null,y:ai,Y:oi,Z:si,"%":Fi},D={a:function(t){return o[t.getUTCDay()]},A:function(t){return a[t.getUTCDay()]},b:function(t){return l[t.getUTCMonth()]},B:function(t){return s[t.getUTCMonth()]},c:null,d:li,e:li,f:fi,H:ui,I:hi,j:ci,L:di,m:pi,M:gi,p:function(t){return r[+(t.getUTCHours()>=12)]},q:function(t){return 1+~~(t.getUTCMonth()/3)},Q:Ci,s:Ri,S:mi,u:vi,U:yi,V:_i,w:Di,W:wi,x:null,X:null,y:bi,Y:Si,Z:xi,"%":Fi},w={a:function(t,e,n){var i=f.exec(e.slice(n));return i?(t.w=p[i[0].toLowerCase()],n+i[0].length):-1},A:function(t,e,n){var i=c.exec(e.slice(n));return i?(t.w=d[i[0].toLowerCase()],n+i[0].length):-1},b:function(t,e,n){var i=v.exec(e.slice(n));return i?(t.m=y[i[0].toLowerCase()],n+i[0].length):-1},B:function(t,e,n){var i=g.exec(e.slice(n));return i?(t.m=m[i[0].toLowerCase()],n+i[0].length):-1},c:function(t,n,i){return x(t,e,n,i)},d:Bn,e:Bn,f:zn,H:Pn,I:Pn,j:On,L:jn,m:An,M:Hn,p:function(t,e,n){var i=u.exec(e.slice(n));return i?(t.p=h[i[0].toLowerCase()],n+i[0].length):-1},q:Nn,Q:Wn,s:Un,S:Ln,u:Cn,U:Rn,V:Tn,w:Fn,W:In,x:function(t,e,i){return x(t,n,e,i)},X:function(t,e,n){return x(t,i,e,n)},y:kn,Y:Mn,Z:En,"%":Vn};function b(t,e){return function(n){var i,r,a,o=[],s=-1,l=0,u=t.length;for(n instanceof Date||(n=new Date(+n));++s<u;)37===t.charCodeAt(s)&&(o.push(t.slice(l,s)),null!=(r=vn[i=t.charAt(++s)])?i=t.charAt(++s):r="e"===i?" ":"0",(a=e[i])&&(i=a(n,r)),o.push(i),l=s+1);return o.push(t.slice(l,s)),o.join("")}}function S(t,e){return function(n){var i,r,a=pn(1900,void 0,1);if(x(a,t,n+="",0)!=n.length)return null;if("Q"in a)return new Date(a.Q);if("s"in a)return new Date(1e3*a.s+("L"in a?a.L:0));if(e&&!("Z"in a)&&(a.Z=0),"p"in a&&(a.H=a.H%12+12*a.p),void 0===a.m&&(a.m="q"in a?a.q:0),"V"in a){if(a.V<1||a.V>53)return null;"w"in a||(a.w=1),"Z"in a?(r=(i=fn(pn(a.y,0,1))).getUTCDay(),i=r>4||0===r?en.ceil(i):en(i),i=un.offset(i,7*(a.V-1)),a.y=i.getUTCFullYear(),a.m=i.getUTCMonth(),a.d=i.getUTCDate()+(a.w+6)%7):(r=(i=dn(pn(a.y,0,1))).getDay(),i=r>4||0===r?Pe.ceil(i):Pe(i),i=Ue.offset(i,7*(a.V-1)),a.y=i.getFullYear(),a.m=i.getMonth(),a.d=i.getDate()+(a.w+6)%7)}else("W"in a||"U"in a)&&("w"in a||(a.w="u"in a?a.u%7:"W"in a?1:0),r="Z"in a?fn(pn(a.y,0,1)).getUTCDay():dn(pn(a.y,0,1)).getDay(),a.m=0,a.d="W"in a?(a.w+6)%7+7*a.W-(r+5)%7:a.w+7*a.U-(r+6)%7);return"Z"in a?(a.H+=a.Z/100|0,a.M+=a.Z%100,fn(a)):dn(a)}}function x(t,e,n,i){for(var r,a,o=0,s=e.length,l=n.length;o<s;){if(i>=l)return-1;if(37===(r=e.charCodeAt(o++))){if(r=e.charAt(o++),!(a=w[r in vn?e.charAt(o++):r])||(i=a(t,n,i))<0)return-1}else if(r!=n.charCodeAt(i++))return-1}return i}return _.x=b(n,_),_.X=b(i,_),_.c=b(e,_),D.x=b(n,D),D.X=b(i,D),D.c=b(e,D),{format:function(t){var e=b(t+="",_);return e.toString=function(){return t},e},parse:function(t){var e=S(t+="",!1);return e.toString=function(){return t},e},utcFormat:function(t){var e=b(t+="",D);return e.toString=function(){return t},e},utcParse:function(t){var e=S(t+="",!0);return e.toString=function(){return t},e}}}(t),mn=gn.format,gn.parse,gn.utcFormat,gn.utcParse}({dateTime:"%x, %X",date:"%-m/%-d/%Y",time:"%-I:%M:%S %p",periods:["AM","PM"],days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],shortDays:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],shortMonths:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]});function Ti(t){return new Date(t)}function Ii(t){return t instanceof Date?+t:+new Date(+t)}function Mi(t,e,n,i,r,a,o,s,l){var u=Se(),h=u.invert,c=u.domain,d=l(".%L"),f=l(":%S"),p=l("%I:%M"),g=l("%I %p"),m=l("%a %d"),v=l("%b %d"),y=l("%B"),_=l("%Y"),D=[[o,1,1e3],[o,5,5e3],[o,15,15e3],[o,30,3e4],[a,1,6e4],[a,5,3e5],[a,15,9e5],[a,30,18e5],[r,1,36e5],[r,3,108e5],[r,6,216e5],[r,12,432e5],[i,1,864e5],[i,2,1728e5],[n,1,6048e5],[e,1,2592e6],[e,3,7776e6],[t,1,31536e6]];function w(s){return(o(s)<s?d:a(s)<s?f:r(s)<s?p:i(s)<s?g:e(s)<s?n(s)<s?m:v:t(s)<s?y:_)(s)}function b(e,n,i){if(null==e&&(e=10),"number"==typeof e){var r,a=Math.abs(i-n)/e,o=yt((function(t){return t[2]})).right(D,a);return o===D.length?(r=mt(n/31536e6,i/31536e6,e),e=t):o?(r=(o=D[a/D[o-1][2]<D[o][2]/a?o-1:o])[1],e=o[0]):(r=Math.max(mt(n,i,e),1),e=s),e.every(r)}return e}return u.invert=function(t){return new Date(h(t))},u.domain=function(t){return arguments.length?c(Array.from(t,Ii)):c().map(Ti)},u.ticks=function(t){var e,n=c(),i=n[0],r=n[n.length-1],a=r<i;return a&&(e=i,i=r,r=e),e=(e=b(t,i,r))?e.range(i,r+1):[],a?e.reverse():e},u.tickFormat=function(t,e){return null==e?w:l(e)},u.nice=function(t){var e=c();return(t=b(t,e[0],e[e.length-1]))?c(function(t,e){var n,i=0,r=(t=t.slice()).length-1,a=t[i],o=t[r];return o<a&&(n=i,i=r,r=n,n=a,a=o,o=n),t[i]=e.floor(a),t[r]=e.ceil(o),t}(e,t)):u},u.copy=function(){return we(u,Mi(t,e,n,i,r,a,o,s,l))},u}const ki=0,Ei=1,Ni=2,Ai=3;class Bi{constructor(t,e,n,i){this.beginIndex=t,this.endIndex=e,this.drawMode=n,this.chartRange=i}contains(t){let e=t===this.chartRange[0]||t===this.chartRange[1],n=this.drawMode!==Ai||e,i=n?t>=this.beginIndex:t>this.beginIndex,r=n?t<=this.endIndex:t<this.endIndex;return i&&r}static baseSegmentForData(t){return new Bi(0,t.length,ki,[0,t.length-1])}static colorForEvaluator(t,e=ki,n=1){let i="0,0,0";switch(e){case ki:return t.baseColor(n);case Ei:i=da;break;case Ni:i=pa;break;case Ai:i=fa,n*=.4}return"rgba("+i+","+n+")"}}class Oi{constructor(t,e){if(this.series=t,this.maxJump=e,null===t||0===t.length)return;let n=t.length-1,i=Math.round(n/2),r=Math.round(n/4),a=Math.round(3/4*n);this.min=t[0][1],this.max=t[n][1],this.bottomQuartile=t[r][1],this.median=t[i][1],this.topQuartile=t[a][1]}maxValueBelowValue(t){let e=-1,n=this.series.length;for(;1+e<n;){let i=e+(n-e>>1);this.series[i][1]>t?n=i:e=i}return this.series[n][1]}}class Pi{constructor(t,e,n){this.yMin=t,this.yMax=e,this.yDataMin=t,this.yDataMax=e,this.useOvershoot=n}}var Hi=Array.prototype.slice,Li=function(t,e){if((r=t.length)>1)for(var n,i,r,a=1,o=t[e[0]],s=o.length;a<r;++a)for(i=o,o=t[e[a]],n=0;n<s;++n)o[n][1]+=o[n][0]=isNaN(i[n][1])?i[n][0]:i[n][1]},ji=function(t){for(var e=t.length,n=new Array(e);--e>=0;)n[e]=e;return n};function zi(t,e){return t[e]}var Vi=function(t,e){if((i=t.length)>0){for(var n,i,r,a=0,o=t[0].length;a<o;++a){for(r=n=0;n<i;++n)r+=t[n][a][1]||0;if(r)for(n=0;n<i;++n)t[n][a][1]/=r}Li(t,e)}},Wi=n(12),Ui=function(){for(var t,e=Wi.c;t=e.sourceEvent;)e=t;return e},Yi=function(t,e){var n=t.ownerSVGElement||t;if(n.createSVGPoint){var i=n.createSVGPoint();return i.x=e.clientX,i.y=e.clientY,[(i=i.matrixTransform(t.getScreenCTM().inverse())).x,i.y]}var r=t.getBoundingClientRect();return[e.clientX-r.left-t.clientLeft,e.clientY-r.top-t.clientTop]},qi=function(t,e){null==e&&(e=Ui().touches);for(var n=0,i=e?e.length:0,r=new Array(i);n<i;++n)r[n]=Yi(t,e[n]);return r};function Gi(t){var e=t.getBoundingClientRect();return{width:e.width,height:e.height,top:e.top,right:e.right,bottom:e.bottom,left:e.left,x:e.left,y:e.top}}function Qi(t){if("[object Window]"!==t.toString()){var e=t.ownerDocument;return e?e.defaultView:window}return t}function Xi(t){var e=Qi(t);return{scrollLeft:e.pageXOffset,scrollTop:e.pageYOffset}}function Ji(t){return t instanceof Qi(t).Element||t instanceof Element}function Zi(t){return t instanceof Qi(t).HTMLElement||t instanceof HTMLElement}function $i(t){return t?(t.nodeName||"").toLowerCase():null}function Ki(t){return(Ji(t)?t.ownerDocument:t.document).documentElement}function tr(t){return Gi(Ki(t)).left+Xi(t).scrollLeft}function er(t){return Qi(t).getComputedStyle(t)}function nr(t){var e=er(t),n=e.overflow,i=e.overflowX,r=e.overflowY;return/auto|scroll|overlay|hidden/.test(n+r+i)}function ir(t,e,n){void 0===n&&(n=!1);var i,r,a=Ki(e),o=Gi(t),s=Zi(e),l={scrollLeft:0,scrollTop:0},u={x:0,y:0};return(s||!s&&!n)&&(("body"!==$i(e)||nr(a))&&(l=(i=e)!==Qi(i)&&Zi(i)?{scrollLeft:(r=i).scrollLeft,scrollTop:r.scrollTop}:Xi(i)),Zi(e)?((u=Gi(e)).x+=e.clientLeft,u.y+=e.clientTop):a&&(u.x=tr(a))),{x:o.left+l.scrollLeft-u.x,y:o.top+l.scrollTop-u.y,width:o.width,height:o.height}}function rr(t){return{x:t.offsetLeft,y:t.offsetTop,width:t.offsetWidth,height:t.offsetHeight}}function ar(t){return"html"===$i(t)?t:t.assignedSlot||t.parentNode||t.host||Ki(t)}function or(t,e){void 0===e&&(e=[]);var n=function t(e){return["html","body","#document"].indexOf($i(e))>=0?e.ownerDocument.body:Zi(e)&&nr(e)?e:t(ar(e))}(t),i="body"===$i(n),r=Qi(n),a=i?[r].concat(r.visualViewport||[],nr(n)?n:[]):n,o=e.concat(a);return i?o:o.concat(or(ar(a)))}function sr(t){return["table","td","th"].indexOf($i(t))>=0}function lr(t){if(!Zi(t)||"fixed"===er(t).position)return null;var e=t.offsetParent;if(e){var n=Ki(e);if("body"===$i(e)&&"static"===er(e).position&&"static"!==er(n).position)return n}return e}function ur(t){for(var e=Qi(t),n=lr(t);n&&sr(n)&&"static"===er(n).position;)n=lr(n);return n&&"body"===$i(n)&&"static"===er(n).position?e:n||function(t){for(var e=ar(t);Zi(e)&&["html","body"].indexOf($i(e))<0;){var n=er(e);if("none"!==n.transform||"none"!==n.perspective||n.willChange&&"auto"!==n.willChange)return e;e=e.parentNode}return null}(t)||e}var hr="top",cr="bottom",dr="right",fr="left",pr=[hr,cr,dr,fr],gr=pr.reduce((function(t,e){return t.concat([e+"-start",e+"-end"])}),[]),mr=[].concat(pr,["auto"]).reduce((function(t,e){return t.concat([e,e+"-start",e+"-end"])}),[]),vr=["beforeRead","read","afterRead","beforeMain","main","afterMain","beforeWrite","write","afterWrite"];function yr(t){var e=new Map,n=new Set,i=[];return t.forEach((function(t){e.set(t.name,t)})),t.forEach((function(t){n.has(t.name)||function t(r){n.add(r.name),[].concat(r.requires||[],r.requiresIfExists||[]).forEach((function(i){if(!n.has(i)){var r=e.get(i);r&&t(r)}})),i.push(r)}(t)})),i}var _r={placement:"bottom",modifiers:[],strategy:"absolute"};function Dr(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];return!e.some((function(t){return!(t&&"function"==typeof t.getBoundingClientRect)}))}function wr(t){void 0===t&&(t={});var e=t,n=e.defaultModifiers,i=void 0===n?[]:n,r=e.defaultOptions,a=void 0===r?_r:r;return function(t,e,n){void 0===n&&(n=a);var r,o,s={placement:"bottom",orderedModifiers:[],options:Object.assign(Object.assign({},_r),a),modifiersData:{},elements:{reference:t,popper:e},attributes:{},styles:{}},l=[],u=!1,h={state:s,setOptions:function(n){c(),s.options=Object.assign(Object.assign(Object.assign({},a),s.options),n),s.scrollParents={reference:Ji(t)?or(t):t.contextElement?or(t.contextElement):[],popper:or(e)};var r=function(t){var e=yr(t);return vr.reduce((function(t,n){return t.concat(e.filter((function(t){return t.phase===n})))}),[])}(function(t){var e=t.reduce((function(t,e){var n=t[e.name];return t[e.name]=n?Object.assign(Object.assign(Object.assign({},n),e),{},{options:Object.assign(Object.assign({},n.options),e.options),data:Object.assign(Object.assign({},n.data),e.data)}):e,t}),{});return Object.keys(e).map((function(t){return e[t]}))}([].concat(i,s.options.modifiers)));return s.orderedModifiers=r.filter((function(t){return t.enabled})),s.orderedModifiers.forEach((function(t){var e=t.name,n=t.options,i=void 0===n?{}:n,r=t.effect;if("function"==typeof r){var a=r({state:s,name:e,instance:h,options:i});l.push(a||function(){})}})),h.update()},forceUpdate:function(){if(!u){var t=s.elements,e=t.reference,n=t.popper;if(Dr(e,n)){s.rects={reference:ir(e,ur(n),"fixed"===s.options.strategy),popper:rr(n)},s.reset=!1,s.placement=s.options.placement,s.orderedModifiers.forEach((function(t){return s.modifiersData[t.name]=Object.assign({},t.data)}));for(var i=0;i<s.orderedModifiers.length;i++)if(!0!==s.reset){var r=s.orderedModifiers[i],a=r.fn,o=r.options,l=void 0===o?{}:o,c=r.name;"function"==typeof a&&(s=a({state:s,options:l,name:c,instance:h})||s)}else s.reset=!1,i=-1}}},update:(r=function(){return new Promise((function(t){h.forceUpdate(),t(s)}))},function(){return o||(o=new Promise((function(t){Promise.resolve().then((function(){o=void 0,t(r())}))}))),o}),destroy:function(){c(),u=!0}};if(!Dr(t,e))return h;function c(){l.forEach((function(t){return t()})),l=[]}return h.setOptions(n).then((function(t){!u&&n.onFirstUpdate&&n.onFirstUpdate(t)})),h}}var br={passive:!0};function Sr(t){return t.split("-")[0]}function xr(t){return t.split("-")[1]}function Fr(t){return["top","bottom"].indexOf(t)>=0?"x":"y"}function Cr(t){var e,n=t.reference,i=t.element,r=t.placement,a=r?Sr(r):null,o=r?xr(r):null,s=n.x+n.width/2-i.width/2,l=n.y+n.height/2-i.height/2;switch(a){case hr:e={x:s,y:n.y-i.height};break;case cr:e={x:s,y:n.y+n.height};break;case dr:e={x:n.x+n.width,y:l};break;case fr:e={x:n.x-i.width,y:l};break;default:e={x:n.x,y:n.y}}var u=a?Fr(a):null;if(null!=u){var h="y"===u?"height":"width";switch(o){case"start":e[u]=Math.floor(e[u])-Math.floor(n[h]/2-i[h]/2);break;case"end":e[u]=Math.floor(e[u])+Math.ceil(n[h]/2-i[h]/2)}}return e}var Rr={top:"auto",right:"auto",bottom:"auto",left:"auto"};function Tr(t){var e,n=t.popper,i=t.popperRect,r=t.placement,a=t.offsets,o=t.position,s=t.gpuAcceleration,l=t.adaptive,u=function(t){var e=t.x,n=t.y,i=window.devicePixelRatio||1;return{x:Math.round(e*i)/i||0,y:Math.round(n*i)/i||0}}(a),h=u.x,c=u.y,d=a.hasOwnProperty("x"),f=a.hasOwnProperty("y"),p=fr,g=hr,m=window;if(l){var v=ur(n);v===Qi(n)&&(v=Ki(n)),r===hr&&(g=cr,c-=v.clientHeight-i.height,c*=s?1:-1),r===fr&&(p=dr,h-=v.clientWidth-i.width,h*=s?1:-1)}var y,_=Object.assign({position:o},l&&Rr);return s?Object.assign(Object.assign({},_),{},((y={})[g]=f?"0":"",y[p]=d?"0":"",y.transform=(m.devicePixelRatio||1)<2?"translate("+h+"px, "+c+"px)":"translate3d("+h+"px, "+c+"px, 0)",y)):Object.assign(Object.assign({},_),{},((e={})[g]=f?c+"px":"",e[p]=d?h+"px":"",e.transform="",e))}var Ir={left:"right",right:"left",bottom:"top",top:"bottom"};function Mr(t){return t.replace(/left|right|bottom|top/g,(function(t){return Ir[t]}))}var kr={start:"end",end:"start"};function Er(t){return t.replace(/start|end/g,(function(t){return kr[t]}))}function Nr(t,e){var n=Boolean(e.getRootNode&&e.getRootNode().host);if(t.contains(e))return!0;if(n){var i=e;do{if(i&&t.isSameNode(i))return!0;i=i.parentNode||i.host}while(i)}return!1}function Ar(t){return Object.assign(Object.assign({},t),{},{left:t.x,top:t.y,right:t.x+t.width,bottom:t.y+t.height})}function Br(t,e){return"viewport"===e?Ar(function(t){var e=Qi(t),n=Ki(t),i=e.visualViewport,r=n.clientWidth,a=n.clientHeight,o=0,s=0;return i&&(r=i.width,a=i.height,/^((?!chrome|android).)*safari/i.test(navigator.userAgent)||(o=i.offsetLeft,s=i.offsetTop)),{width:r,height:a,x:o+tr(t),y:s}}(t)):Zi(e)?function(t){var e=Gi(t);return e.top=e.top+t.clientTop,e.left=e.left+t.clientLeft,e.bottom=e.top+t.clientHeight,e.right=e.left+t.clientWidth,e.width=t.clientWidth,e.height=t.clientHeight,e.x=e.left,e.y=e.top,e}(e):Ar(function(t){var e=Ki(t),n=Xi(t),i=t.ownerDocument.body,r=Math.max(e.scrollWidth,e.clientWidth,i?i.scrollWidth:0,i?i.clientWidth:0),a=Math.max(e.scrollHeight,e.clientHeight,i?i.scrollHeight:0,i?i.clientHeight:0),o=-n.scrollLeft+tr(t),s=-n.scrollTop;return"rtl"===er(i||e).direction&&(o+=Math.max(e.clientWidth,i?i.clientWidth:0)-r),{width:r,height:a,x:o,y:s}}(Ki(t)))}function Or(t,e,n){var i="clippingParents"===e?function(t){var e=or(ar(t)),n=["absolute","fixed"].indexOf(er(t).position)>=0&&Zi(t)?ur(t):t;return Ji(n)?e.filter((function(t){return Ji(t)&&Nr(t,n)&&"body"!==$i(t)})):[]}(t):[].concat(e),r=[].concat(i,[n]),a=r[0],o=r.reduce((function(e,n){var i=Br(t,n);return e.top=Math.max(i.top,e.top),e.right=Math.min(i.right,e.right),e.bottom=Math.min(i.bottom,e.bottom),e.left=Math.max(i.left,e.left),e}),Br(t,a));return o.width=o.right-o.left,o.height=o.bottom-o.top,o.x=o.left,o.y=o.top,o}function Pr(t){return Object.assign(Object.assign({},{top:0,right:0,bottom:0,left:0}),t)}function Hr(t,e){return e.reduce((function(e,n){return e[n]=t,e}),{})}function Lr(t,e){void 0===e&&(e={});var n=e,i=n.placement,r=void 0===i?t.placement:i,a=n.boundary,o=void 0===a?"clippingParents":a,s=n.rootBoundary,l=void 0===s?"viewport":s,u=n.elementContext,h=void 0===u?"popper":u,c=n.altBoundary,d=void 0!==c&&c,f=n.padding,p=void 0===f?0:f,g=Pr("number"!=typeof p?p:Hr(p,pr)),m="popper"===h?"reference":"popper",v=t.elements.reference,y=t.rects.popper,_=t.elements[d?m:h],D=Or(Ji(_)?_:_.contextElement||Ki(t.elements.popper),o,l),w=Gi(v),b=Cr({reference:w,element:y,strategy:"absolute",placement:r}),S=Ar(Object.assign(Object.assign({},y),b)),x="popper"===h?S:w,F={top:D.top-x.top+g.top,bottom:x.bottom-D.bottom+g.bottom,left:D.left-x.left+g.left,right:x.right-D.right+g.right},C=t.modifiersData.offset;if("popper"===h&&C){var R=C[r];Object.keys(F).forEach((function(t){var e=[dr,cr].indexOf(t)>=0?1:-1,n=[hr,cr].indexOf(t)>=0?"y":"x";F[t]+=R[n]*e}))}return F}function jr(t,e,n){return Math.max(t,Math.min(e,n))}function zr(t,e,n){return void 0===n&&(n={x:0,y:0}),{top:t.top-e.height-n.y,right:t.right-e.width+n.x,bottom:t.bottom-e.height+n.y,left:t.left-e.width-n.x}}function Vr(t){return[hr,dr,cr,fr].some((function(e){return t[e]>=0}))}var Wr=wr({defaultModifiers:[{name:"eventListeners",enabled:!0,phase:"write",fn:function(){},effect:function(t){var e=t.state,n=t.instance,i=t.options,r=i.scroll,a=void 0===r||r,o=i.resize,s=void 0===o||o,l=Qi(e.elements.popper),u=[].concat(e.scrollParents.reference,e.scrollParents.popper);return a&&u.forEach((function(t){t.addEventListener("scroll",n.update,br)})),s&&l.addEventListener("resize",n.update,br),function(){a&&u.forEach((function(t){t.removeEventListener("scroll",n.update,br)})),s&&l.removeEventListener("resize",n.update,br)}},data:{}},{name:"popperOffsets",enabled:!0,phase:"read",fn:function(t){var e=t.state,n=t.name;e.modifiersData[n]=Cr({reference:e.rects.reference,element:e.rects.popper,strategy:"absolute",placement:e.placement})},data:{}},{name:"computeStyles",enabled:!0,phase:"beforeWrite",fn:function(t){var e=t.state,n=t.options,i=n.gpuAcceleration,r=void 0===i||i,a=n.adaptive,o=void 0===a||a,s={placement:Sr(e.placement),popper:e.elements.popper,popperRect:e.rects.popper,gpuAcceleration:r};null!=e.modifiersData.popperOffsets&&(e.styles.popper=Object.assign(Object.assign({},e.styles.popper),Tr(Object.assign(Object.assign({},s),{},{offsets:e.modifiersData.popperOffsets,position:e.options.strategy,adaptive:o})))),null!=e.modifiersData.arrow&&(e.styles.arrow=Object.assign(Object.assign({},e.styles.arrow),Tr(Object.assign(Object.assign({},s),{},{offsets:e.modifiersData.arrow,position:"absolute",adaptive:!1})))),e.attributes.popper=Object.assign(Object.assign({},e.attributes.popper),{},{"data-popper-placement":e.placement})},data:{}},{name:"applyStyles",enabled:!0,phase:"write",fn:function(t){var e=t.state;Object.keys(e.elements).forEach((function(t){var n=e.styles[t]||{},i=e.attributes[t]||{},r=e.elements[t];Zi(r)&&$i(r)&&(Object.assign(r.style,n),Object.keys(i).forEach((function(t){var e=i[t];!1===e?r.removeAttribute(t):r.setAttribute(t,!0===e?"":e)})))}))},effect:function(t){var e=t.state,n={popper:{position:e.options.strategy,left:"0",top:"0",margin:"0"},arrow:{position:"absolute"},reference:{}};return Object.assign(e.elements.popper.style,n.popper),e.elements.arrow&&Object.assign(e.elements.arrow.style,n.arrow),function(){Object.keys(e.elements).forEach((function(t){var i=e.elements[t],r=e.attributes[t]||{},a=Object.keys(e.styles.hasOwnProperty(t)?e.styles[t]:n[t]).reduce((function(t,e){return t[e]="",t}),{});Zi(i)&&$i(i)&&(Object.assign(i.style,a),Object.keys(r).forEach((function(t){i.removeAttribute(t)})))}))}},requires:["computeStyles"]},{name:"offset",enabled:!0,phase:"main",requires:["popperOffsets"],fn:function(t){var e=t.state,n=t.options,i=t.name,r=n.offset,a=void 0===r?[0,0]:r,o=mr.reduce((function(t,n){return t[n]=function(t,e,n){var i=Sr(t),r=[fr,hr].indexOf(i)>=0?-1:1,a="function"==typeof n?n(Object.assign(Object.assign({},e),{},{placement:t})):n,o=a[0],s=a[1];return o=o||0,s=(s||0)*r,[fr,dr].indexOf(i)>=0?{x:s,y:o}:{x:o,y:s}}(n,e.rects,a),t}),{}),s=o[e.placement],l=s.x,u=s.y;null!=e.modifiersData.popperOffsets&&(e.modifiersData.popperOffsets.x+=l,e.modifiersData.popperOffsets.y+=u),e.modifiersData[i]=o}},{name:"flip",enabled:!0,phase:"main",fn:function(t){var e=t.state,n=t.options,i=t.name;if(!e.modifiersData[i]._skip){for(var r=n.mainAxis,a=void 0===r||r,o=n.altAxis,s=void 0===o||o,l=n.fallbackPlacements,u=n.padding,h=n.boundary,c=n.rootBoundary,d=n.altBoundary,f=n.flipVariations,p=void 0===f||f,g=n.allowedAutoPlacements,m=e.options.placement,v=Sr(m),y=l||(v===m||!p?[Mr(m)]:function(t){if("auto"===Sr(t))return[];var e=Mr(t);return[Er(t),e,Er(e)]}(m)),_=[m].concat(y).reduce((function(t,n){return t.concat("auto"===Sr(n)?function(t,e){void 0===e&&(e={});var n=e,i=n.placement,r=n.boundary,a=n.rootBoundary,o=n.padding,s=n.flipVariations,l=n.allowedAutoPlacements,u=void 0===l?mr:l,h=xr(i),c=h?s?gr:gr.filter((function(t){return xr(t)===h})):pr,d=c.filter((function(t){return u.indexOf(t)>=0}));0===d.length&&(d=c);var f=d.reduce((function(e,n){return e[n]=Lr(t,{placement:n,boundary:r,rootBoundary:a,padding:o})[Sr(n)],e}),{});return Object.keys(f).sort((function(t,e){return f[t]-f[e]}))}(e,{placement:n,boundary:h,rootBoundary:c,padding:u,flipVariations:p,allowedAutoPlacements:g}):n)}),[]),D=e.rects.reference,w=e.rects.popper,b=new Map,S=!0,x=_[0],F=0;F<_.length;F++){var C=_[F],R=Sr(C),T="start"===xr(C),I=[hr,cr].indexOf(R)>=0,M=I?"width":"height",k=Lr(e,{placement:C,boundary:h,rootBoundary:c,altBoundary:d,padding:u}),E=I?T?dr:fr:T?cr:hr;D[M]>w[M]&&(E=Mr(E));var N=Mr(E),A=[];if(a&&A.push(k[R]<=0),s&&A.push(k[E]<=0,k[N]<=0),A.every((function(t){return t}))){x=C,S=!1;break}b.set(C,A)}if(S)for(var B=function(t){var e=_.find((function(e){var n=b.get(e);if(n)return n.slice(0,t).every((function(t){return t}))}));if(e)return x=e,"break"},O=p?3:1;O>0;O--){if("break"===B(O))break}e.placement!==x&&(e.modifiersData[i]._skip=!0,e.placement=x,e.reset=!0)}},requiresIfExists:["offset"],data:{_skip:!1}},{name:"preventOverflow",enabled:!0,phase:"main",fn:function(t){var e=t.state,n=t.options,i=t.name,r=n.mainAxis,a=void 0===r||r,o=n.altAxis,s=void 0!==o&&o,l=n.boundary,u=n.rootBoundary,h=n.altBoundary,c=n.padding,d=n.tether,f=void 0===d||d,p=n.tetherOffset,g=void 0===p?0:p,m=Lr(e,{boundary:l,rootBoundary:u,padding:c,altBoundary:h}),v=Sr(e.placement),y=xr(e.placement),_=!y,D=Fr(v),w="x"===D?"y":"x",b=e.modifiersData.popperOffsets,S=e.rects.reference,x=e.rects.popper,F="function"==typeof g?g(Object.assign(Object.assign({},e.rects),{},{placement:e.placement})):g,C={x:0,y:0};if(b){if(a){var R="y"===D?hr:fr,T="y"===D?cr:dr,I="y"===D?"height":"width",M=b[D],k=b[D]+m[R],E=b[D]-m[T],N=f?-x[I]/2:0,A="start"===y?S[I]:x[I],B="start"===y?-x[I]:-S[I],O=e.elements.arrow,P=f&&O?rr(O):{width:0,height:0},H=e.modifiersData["arrow#persistent"]?e.modifiersData["arrow#persistent"].padding:{top:0,right:0,bottom:0,left:0},L=H[R],j=H[T],z=jr(0,S[I],P[I]),V=_?S[I]/2-N-z-L-F:A-z-L-F,W=_?-S[I]/2+N+z+j+F:B+z+j+F,U=e.elements.arrow&&ur(e.elements.arrow),Y=U?"y"===D?U.clientTop||0:U.clientLeft||0:0,q=e.modifiersData.offset?e.modifiersData.offset[e.placement][D]:0,G=b[D]+V-q-Y,Q=b[D]+W-q,X=jr(f?Math.min(k,G):k,M,f?Math.max(E,Q):E);b[D]=X,C[D]=X-M}if(s){var J="x"===D?hr:fr,Z="x"===D?cr:dr,$=b[w],K=jr($+m[J],$,$-m[Z]);b[w]=K,C[w]=K-$}e.modifiersData[i]=C}},requiresIfExists:["offset"]},{name:"arrow",enabled:!0,phase:"main",fn:function(t){var e,n=t.state,i=t.name,r=n.elements.arrow,a=n.modifiersData.popperOffsets,o=Sr(n.placement),s=Fr(o),l=[fr,dr].indexOf(o)>=0?"height":"width";if(r&&a){var u=n.modifiersData[i+"#persistent"].padding,h=rr(r),c="y"===s?hr:fr,d="y"===s?cr:dr,f=n.rects.reference[l]+n.rects.reference[s]-a[s]-n.rects.popper[l],p=a[s]-n.rects.reference[s],g=ur(r),m=g?"y"===s?g.clientHeight||0:g.clientWidth||0:0,v=f/2-p/2,y=u[c],_=m-h[l]-u[d],D=m/2-h[l]/2+v,w=jr(y,D,_),b=s;n.modifiersData[i]=((e={})[b]=w,e.centerOffset=w-D,e)}},effect:function(t){var e=t.state,n=t.options,i=t.name,r=n.element,a=void 0===r?"[data-popper-arrow]":r,o=n.padding,s=void 0===o?0:o;null!=a&&("string"!=typeof a||(a=e.elements.popper.querySelector(a)))&&Nr(e.elements.popper,a)&&(e.elements.arrow=a,e.modifiersData[i+"#persistent"]={padding:Pr("number"!=typeof s?s:Hr(s,pr))})},requires:["popperOffsets"],requiresIfExists:["preventOverflow"]},{name:"hide",enabled:!0,phase:"main",requiresIfExists:["preventOverflow"],fn:function(t){var e=t.state,n=t.name,i=e.rects.reference,r=e.rects.popper,a=e.modifiersData.preventOverflow,o=Lr(e,{elementContext:"reference"}),s=Lr(e,{altBoundary:!0}),l=zr(o,i),u=zr(s,r,a),h=Vr(l),c=Vr(u);e.modifiersData[n]={referenceClippingOffsets:l,popperEscapeOffsets:u,isReferenceHidden:h,hasPopperEscaped:c},e.attributes.popper=Object.assign(Object.assign({},e.attributes.popper),{},{"data-popper-reference-hidden":h,"data-popper-escaped":c})}}]});class Ur{constructor(t,e){this.evaluator=e;let n=this;this.parent=t,this.button=t.append("div").attr("class","data-link").style("display","flex").on("click",(function(){n.copyLinkToChart()})),this.buttonIcon=this.button.append("div").attr("class","data-link-icon"),this.copyButtonText=this.button.append("div").style("display","inline").text(this._copyLinkString()),this.tooltipActive=!1,this.toolTipSelection=null}_copyLinkString(){return"Copy link to chart"}reset(){this.tooltipActive&&(this.copyButtonText.text(this._copyLinkString()),this.buttonIcon.attr("class","data-link-icon"),this.toolTipSelection.remove(),this.tooltipActive=!1,this.toolTipSelection=null)}copyLinkToChart(){if(this.tooltipActive)return void this.reset();this.tooltipActive=!0;let t=window.location,e="#"+this.evaluator.anchorNoun,n=t.hostname+t.pathname+e,i=t.protocol+"//"+n,r=Object(a.a)("body").append("textarea").text(i);r.node().select(),document.execCommand("copy"),r.remove(),console.log("Link copied: "+i),this.copyButtonText.text("Copied"),this.buttonIcon.attr("class","data-confirmation-icon"),this.toolTipSelection=this.parent.append("div").attr("id","tooltip").attr("role","tooltip").text(n),this.toolTipSelection.append("div").attr("id","arrow").attr("data-popper-arrow",""),Wr(this.button.node(),this.toolTipSelection.node(),{placement:"right",modifiers:[{name:"offset",options:{offset:[0,8]}},{name:"flip",options:{fallbackPlacements:["bottom"]}},{name:"preventOverflow",options:{rootBoundary:"document",padding:20}}]});let o=this;setTimeout((function(){o.reset()}),6e3)}}class Yr{constructor(t){let e=this;this.container=t.append("div").attr("class","robo-text-description content-column unselectable"),this.container.text("Florida reported 781 new cases of COVID-19 on May 17. On average, new cases are down 17% week over week, and down 31% month over month."),this.container.on("touchstart",(function(){e.touchDownElsewhere=!0})).on("touchend",(function(){e.touchDownElsewhere=!1})),this.dataQuantityHover=null,this.monthChangeHover=null,this.weekChangeHover=null,this.touchDownElsewhere=!1,this.didHoverDates=null,this.percentFormatter=O(".0%"),this.defaultFormatter=O(",.0f"),this.dateFormatter=mn("%B %e")}noDataHTML(t,e){return"There is no data available for this region."}updateForData(t,e,n,i){0!==t.length?(this.data=t,this.currentSnapshot=t[t.length-1],this.weekAgoSnapshot=t[t.length-1-7],this.monthAgoSnapshot=t[t.length-1-30],this.region=e,this.evaluator=n,this.averageEvaluator=i,this.container.html(this.htmlForTemplate(n.descriptionTemplate)),this.copyLinkButton=new Ur(this.container,n),this._updateHovers()):this.container.html(this.noDataHTML(n,e))}_hoverDates(t,e=null){if(!this.touchDownElsewhere){if(t=t.map(t=>Object(_.g)(t)),null!==e){qi(e).length>0&&Wi.c.stopPropagation()}null!==this.didHoverDates&&this.didHoverDates(t)}}_updateHovers(){let t=this;this.dataQuantityHover=this.container.select("#"+this._dataQuantityID()),this.dataQuantityHover.on("mouseenter touchstart",(function(){t._hoverDates([t.currentSnapshot.normalizedDate()],this)})),this.dataQuantityHover.on("mouseleave touchend",(function(){t._hoverDates([])})),this.weekChangeHover=this.container.select("#"+this._weekChangeID()),this.weekChangeHover.on("mouseenter touchstart",(function(){t._hoverDates([t.weekAgoSnapshot.normalizedDate(),t.currentSnapshot.normalizedDate()],this)})),this.weekChangeHover.on("mouseleave touchend",(function(){t._hoverDates([])})),this.monthChangeHover=this.container.select("#"+this._monthChangeID()),this.monthChangeHover.on("mouseenter touchstart",(function(){t._hoverDates([t.monthAgoSnapshot.normalizedDate(),t.currentSnapshot.normalizedDate()],this)})),this.monthChangeHover.on("mouseleave touchend",(function(){t._hoverDates([])}))}_dataQuantityID(){return"DataQuantity"}_monthChangeID(){return"MonthChange"}_weekChangeID(){return"WeekChange"}_tokenIteratorFromTemplate(t){return t.matchAll(/<Token:([A-Za-z]+)>/g)}_hoverDivForValue(t,e){return'<span class="robo-description-hover unselectable" id="'+e+'">'+t+"</span>"}_formatDataQuantity(t,e){return(null!==e.valueFormatter?e.valueFormatter:this.defaultFormatter)(t)}_formatShortDate(t){return(0,this.dateFormatter)(t)}_percentChangeFromSnapshot(t){let e=this.averageEvaluator.valueForSnapshot(this.currentSnapshot);if(void 0===t)return 0===e?0:e>0?1:-1;let n=this.averageEvaluator.valueForSnapshot(t),i=e-n,r=0===n?0:i/n;return Math.sign(i)!=Math.sign(r)&&(r*=-1),r}_amountChangeFromSnapshot(t){if(void 0===t)return 0;let e=this.averageEvaluator.valueForSnapshot(t);return this.averageEvaluator.valueForSnapshot(this.currentSnapshot)-e}_formatPercentChange(t){return(0,this.percentFormatter)(t)}_formattedPercentChangeFromSnapshot(t){let e=this._percentChangeFromSnapshot(t);return this._formatPercentChange(e)}_formattedAmountChangeFromSnapshot(t){let e=this._amountChangeFromSnapshot(t);return this._formatDataQuantity(e,this.averageEvaluator)}_directionStringForChange(t){return 0===t?"flat":t>0?"up":"down"}_changeVerbForChange(t,e=!1){return e?0===t?"have remained constant":t>0?"are increasing":"are decreasing":t>0?"increased by":"decreased by"}_evaluateToken(t){switch(t){case"Region":return this.region.plainEnglishNameWithArticle();case"RegionPreposition":return this.region.prepositionString();case"ReportingVerb":return this.evaluator.reportingVerb();case"DataQuantity":{let t=this.evaluator.valueForSnapshot(this.currentSnapshot),e=this._formatDataQuantity(t,this.evaluator);return this._hoverDivForValue(e,this._dataQuantityID())}case"DataQuantityDirection":{let t=this.evaluator.valueForSnapshot(this.currentSnapshot);return this._directionStringForChange(t)}case"FullyQualifiedNoun":return this.evaluator.fullyQualifiedNoun();case"TimePreposition":return this.evaluator.measureDelta?"on":"as of";case"ShortDate":return this._formatShortDate(this.currentSnapshot.normalizedDate());case"CumulativeSignifier":return this.evaluator.measureDelta?"":"all ";case"Noun":return this.evaluator.perCapitaNoun(!0);case"NounIs":return this.evaluator.dataIsAtomic()?"are":"is";case"DirectionDescriptionWeek":{let t=this._percentChangeFromSnapshot(this.weekAgoSnapshot);return this._directionStringForChange(t)}case"ChangeVerbCurrent":{let t=this.evaluator.valueForSnapshot(this.currentSnapshot);return this._changeVerbForChange(t)}case"ChangeVerbWeek":return this._changeVerbForChange(this._amountChangeFromSnapshot(this.weekAgoSnapshot));case"ChangeVerbWeekProgressive":return this._changeVerbForChange(this._amountChangeFromSnapshot(this.weekAgoSnapshot),!0);case"PercentChangeWeek":{let t=this._formattedPercentChangeFromSnapshot(this.weekAgoSnapshot);return this._hoverDivForValue(t,this._weekChangeID())}case"DirectionalPercentChangeWeek":{let t=this._percentChangeFromSnapshot(this.weekAgoSnapshot),e=this._directionStringForChange(t);return 0===t?this._hoverDivForValue(e,this._weekChangeID()):e+" "+this._evaluateToken("PercentChangeWeek")}case"AmountChangeWeek":{let t=this._formattedAmountChangeFromSnapshot(this.weekAgoSnapshot);return this._hoverDivForValue(t,this._weekChangeID())}case"DirectionDescriptionMonth":{let t=this._percentChangeFromSnapshot(this.monthAgoSnapshot);return this._directionStringForChange(t)}case"ChangeVerbMonth":return this._changeVerbForChange(this._amountChangeFromSnapshot(this.monthAgoSnapshot));case"PercentChangeMonth":{let t=this._formattedPercentChangeFromSnapshot(this.monthAgoSnapshot);return this._hoverDivForValue(t,this._monthChangeID())}case"DirectionalPercentChangeMonth":{let t=this._percentChangeFromSnapshot(this.monthAgoSnapshot),e=this._directionStringForChange(t);return 0===t?this._hoverDivForValue(e,this._monthChangeID()):e+" "+this._evaluateToken("PercentChangeMonth")}case"AmountChangeMonth":{let t=this._formattedAmountChangeFromSnapshot(this.monthAgoSnapshot);return this._hoverDivForValue(t,this._monthChangeID())}}return""}_stringByEvaluatingTokens(t,e){let n=e,i=t.next();for(;!i.done;){let e=i.value,r=e[0],a=e[1],o=e.index,s=this._evaluateToken(a);0===o&&(s=s.capitalize()),n=n.replace(r,s),i=t.next()}return n}htmlForTemplate(t){let e=this._tokenIteratorFromTemplate(t);return this._stringByEvaluatingTokens(e,t)}}class qr{constructor(t){let e=this;this.parent=t,this.container=t.append("div").attr("class","robo-text-title base-chart-container content-column unselectable"),this.statAdjective=this.container.append("span").attr("class","tappable").on("click",(function(){e._didTapStatAdjective()})),this.metricDescription=this.container.append("span"),this.regionPreposition=this.container.append("span").attr("class","robo-text"),this.regionDescription=this.container.append("span").attr("class","tappable").on("click",(function(){e._didTapRegionDescription()})),this.groupByClause=this.container.append("span").attr("class","robo-text").text(", by "),this.groupByNoun=this.container.append("span").attr("class","robo-text").text("day"),this.didTapStatAdjective=null,this.didTapRegionDescription=null}updateForContextChange(t,e,n,i=!0){this.evaluator=t,this.region=e,this.groupByUnit=n,this._updateText(i)}_updateText(t=!1){if(this.container.attr("id",this.evaluator.anchorNoun),t&&this.metricDescription.text().length>0){let t=parseInt(this.container.style("padding-bottom").replace("px","")),e=this.container.node().offsetHeight-t;this.container.style("height",e+"px");let n=new qr(this.parent);n.updateForContextChange(this.evaluator,this.region,this.groupByUnit,!1);let i=n.container.node().offsetHeight-t;n.container.remove(),i>e&&Math.abs(e-i)>3&&this.container.transition().duration(1e3).style("height",i+"px")}this.statAdjective.text(this.evaluator.statDescription().capitalize()),this.metricDescription.text(" "+this.evaluator.perCapitaNoun()+" "),this.regionPreposition.text(this.region.prepositionString()),this.regionDescription.text(this.region.plainEnglishNameWithArticle()),this.evaluator.needsGroupBy()?(this.groupByClause.text(", by "),this.groupByNoun.text(this.groupByUnit)):(this.groupByClause.text(""),this.groupByNoun.text(""))}_didTapRegionDescription(){this.didTapRegionDescription&&this.didTapRegionDescription(this.region)}_didTapStatAdjective(){this.didTapStatAdjective&&this.didTapStatAdjective(this)}}var Gr=function(t){var e=Ui();return e.changedTouches&&(e=e.changedTouches[0]),Yi(t,e)};class Qr{constructor(t,e,n,i){this.drawMode=-1,this.evaluator=e,this.hoverLine=t.append("line").style("stroke-width",2),this.hoverRawBlip=t.append("rect").attr("height",i).attr("width",n),this.hoverBlip=t.append("circle").style("stroke","white").style("stroke-width",2).attr("r",5),this.setDrawMode(ki)}setDrawMode(t){t!==this.drawMode&&(this.drawMode=t,this.hoverLine.style("stroke",this.fillColor()),this.hoverRawBlip.attr("fill",this.fillColor()),this.hoverBlip.attr("fill",this.fillColor()))}fillColor(){return Bi.colorForEvaluator(this.evaluator,this.drawMode)}setShowRawBlip(t){this.hoverRawBlip.style("display",t?"unset":"none")}remove(){this.hoverLine.remove(),this.hoverBlip.remove(),this.hoverRawBlip.remove()}setBlipCoordinate(t,e){this.hoverBlip.attr("cx",t).attr("cy",e)}setRawBlipCoordinate(t,e){this.hoverRawBlip.attr("x",t).attr("y",e)}setLineCoordinates(t,e,n,i){this.hoverLine.attr("x1",t).attr("y1",e).attr("x2",n).attr("y2",i)}}class Xr{constructor(t){this.container=t.append("div").attr("class","hover-container unselectable");let e=this.container.append("div").attr("class","hover-title-row");this.dateText=e.append("div").attr("class","hover-date-text");let n=this.container.append("div").attr("class","hover-row");this.primaryColumn=n.append("div").attr("class","hover-column-left"),this.rowOnePrimaryText=this.primaryColumn.append("div").attr("class","hover-primary-text"),this.rowTwoPrimaryText=this.primaryColumn.append("div").attr("class","hover-primary-text"),this.secondaryColumn=n.append("div").attr("class","hover-column-right"),this.rowOneSecondaryText=this.secondaryColumn.append("div").attr("class","hover-secondary-text"),this.rowTwoSecondaryText=this.secondaryColumn.append("div").attr("class","hover-secondary-text"),this.dateFormatter=mn("%B %e"),this.bigNumberFormatter=O(".2s"),this.smallNumberFormatter=O(".2"),this.numberFormatter=O(".3")}_formatterForValue(t,e){if(null!==e.valueFormatter)return e.valueFormatter;let n=Math.abs(t);return n>=1e3?this.bigNumberFormatter:n<100?this.smallNumberFormatter:this.numberFormatter}updateForSnapshots(t,e,n,i=ki){let r=t[0],a=!0,o=this.dateFormatter(r.normalizedDate()),s=e,l=s.valueForSnapshot(r),u=this._formatterForValue(l,s),h=s.graphedNoun(),c=n,d=c.valueForSnapshot(r),f=this._formatterForValue(d,c),p=c.graphedNoun(),g="";if(t.length>1){let e=t[1],i=this.dateFormatter,c="&nbsp;";r.dateOnlyDiffersInDay(e)&&(i=mn("%e"),c=""),a=!(n.displayAsPercent||n.normalized),o=o+c+"&ndash;"+c+i(e.normalizedDate());let m=n.valueForSnapshot(r),v=n.valueForSnapshot(e)-m;g=v>0?"+":"",l=v,u=this._formatterForValue(l,s),d=0===m?0:v/m,Math.sign(v)!=Math.sign(d)&&(d*=-1),f=O(".0%"),h=n.changeInGraphedNoun(),p=n.changeInGraphedNoun()}this.dateText.html(o),this.rowOnePrimaryText.text(g+u(l)),this.rowOneSecondaryText.text(h),this.rowTwoPrimaryText.text(g+f(d)),this.rowTwoSecondaryText.text(p);let m="initial";i!==ki&&(m=Bi.colorForEvaluator(n,i)),this.rowOnePrimaryText.style("color",m),this.rowTwoPrimaryText.style("color",m),this.rowTwoPrimaryText.style("display",a?"unset":"none"),this.rowTwoSecondaryText.style("display",a?"unset":"none")}}class Jr{constructor(t,e){this.dataIndex=t,this.data=e}equals(t){return null!==t&&this.dataIndex===t.dataIndex}}class Zr{constructor(t,e,n,i){this._hoverPoints=[],this._hoverHighlights=[],this._mouseDownPoint=null,this._hoverDidMove=!1,this.hoverDescription=null,this.hoverBoundsEvaluator=null,this.data=null,this.displayedDataSeries=null,this.displayedAverageDataSeries=null,this.evaluator=null,this.averageEvaluator=null;let r=this;this.viz=t,this.renderer=e,this.hoverContainer=n,this.hoverTouchRect=n.append("rect").attr("x","-10%").attr("width","120%").attr("height","100%").style("pointer-events","all").style("cursor","grab").attr("fill","rgba(0,0,0,0)").on("mouseenter touchstart",(function(){r._didStartHover(this)})).on("mousedown",(function(){r._didMouseDown(this)})).on("mouseup",(function(){r._didMouseUp(this)})).on("mousemove touchmove",(function(){r._didMoveHover(this)})).on("mouseleave touchend",(function(){r._didEndHover(this)})),this.descriptionContainer=i}highlightDates(t){let e=this,n=t.map(t=>e._hoverPointForDate(t)).filter(t=>null!==t);this._setHoverPoints(n)}chartSegments(){if(this.inComparisonMode()){let t=[0,this.data.length-1],e=this._hoverPoints[0].dataIndex,n=this._hoverPoints[1].dataIndex;return[new Bi(t[0],e,Ai,t),new Bi(e,n,this.drawMode(),t),new Bi(n,t[1],Ai,t)]}return[Bi.baseSegmentForData(this.data)]}inComparisonMode(){return this._hoverPoints.length>=2}_hoverPointsRequireUpdate(t,e){if(t.length!==e.length)return!0;for(let n=0;n<t.length;n++){let i=t[n],r=e[n];if(!i.equals(r))return!0}return!1}_hoverPointsToCompare(){return 2===this._hoverPoints.length&&this._hoverPoints[0].dataIndex===this._hoverPoints[1].dataIndex?[this._hoverPoints[0]]:this._hoverPoints}drawMode(){if(2===this._hoverPoints.length){let t=this._hoverPoints[0].data,e=this._hoverPoints[1].data,n=this._hoverEvaluator(),i=n.valueForSnapshot(t),r=n.valueForSnapshot(e);if(i===r)return ki;let a=r<i;return n.upIsBetter&&(a=!a),a?Ni:Ei}return ki}_setHoverPoints(t){t.sort((function(t,e){return t.dataIndex-e.dataIndex})),this._hoverPointsRequireUpdate(this._hoverPoints,t)&&(this._previousHoverPoints=this._hoverPoints,this._hoverPoints=t,this._drawHoverAnnotations(),2!==this._previousHoverPoints.length&&2!==this._hoverPoints.length||this.viz.redraw(!1,!0))}_rawBlipWidth(){return Math.max(1.1*this.renderer.barWidth(),6)}_rawBlipHeight(){return 2}_hoverEvaluator(){return this.averageEvaluator}_drawHoverAnnotations(){for(;this._hoverHighlights.length<this._hoverPoints.length;){let t=new Qr(this.hoverContainer,this.displayedAverageDataSeries.evaluator,this._rawBlipWidth(),this._rawBlipHeight());this._hoverHighlights.push(t)}for(;this._hoverHighlights.length>this._hoverPoints.length;){this._hoverHighlights[0].remove(),this._hoverHighlights.shift()}let t=this._hoverPointsToCompare();if(this._hoverPoints.length>0){let e=this.drawMode(),n=this.renderer,i=this,r=0;this._hoverPoints.forEach((function(a,o){let s=i._hoverHighlights[o],l=i.displayedAverageDataSeries.data[a.dataIndex],u=n.viewX(a.data.normalizedDate())+.5*n.barWidth();r+=u;let h=n.viewY(l[1]),c=n.viewY.range();s.setBlipCoordinate(u,h);let d=i.displayedDataSeries.data[a.dataIndex],f=n.viewY(d[1]);s.setRawBlipCoordinate(u-.5*i._rawBlipWidth(),f-.5*i._rawBlipHeight()),s.setShowRawBlip(t.length<2),s.setLineCoordinates(u,c[0],u,n._visualTopY),s.setDrawMode(e)})),r/=this._hoverPoints.length,null===this.hoverDescription&&(this.hoverDescription=new Xr(this.descriptionContainer)),this.hoverDescription.container.style("left","0px"),this.hoverDescription.updateForSnapshots(t.map(t=>t.data),this.evaluator,this.averageEvaluator,e);let a=this.hoverDescription.container.node().offsetWidth,o=this.hoverDescription.container.node().offsetHeight,s=r-.5*a,l=n.viewX.range(),u=8,h=Math.min(Math.max(s,l[0]),l[1]-a-1),c=n._visualTopY-(o+u)+n.currentCapHeightOffset;c=Math.max(c,this._minHoverY()),this.hoverDescription.container.style("left",h+"px").style("top",c+"px")}else null!==this.hoverDescription&&(this.hoverDescription.container.remove(),this.hoverDescription=null)}_minHoverY(){if(null===this.hoverBoundsEvaluator)return-1e3;return this.hoverBoundsEvaluator().y-this.descriptionContainer.node().getBoundingClientRect().y}_hoverPointsForTouchPoints(t){let e=[],n=this;return t.forEach((function(t){let i=n._dataIndexForPoint(t),r=n._snapshotForDataIndex(i);if(null!==r){let t=new Jr(i,r);e.push(t)}})),e}_updateHoverForTouchPoints(t){let e=this._hoverPointsForTouchPoints(t);this._setHoverPoints(e)}_hasData(){return null!==this.data&&this.data.length>0}_didStartHover(t){if(!this._hasData())return;let e=[Gr(t)],n=qi(t);if(this._hoverDidMove=!1,n.length>0)if(0===this._hoverPoints.length){let t=this;setTimeout((function(){t._initiateHoverAtPoints(n)}),200)}else this._updateHoverForTouchPoints(n);else this._initiateHoverAtPoints(e)}_resetMouseDown(){this._mouseDownPoint=null,this.hoverTouchRect.style("cursor","grab")}_didMouseDown(t){this.hoverTouchRect.style("cursor","grabbing"),this._mouseDownPoint=Gr(t),this._didMoveHover(t)}_didMouseUp(t){this._resetMouseDown(),this._didMoveHover(t)}_initiateHoverAtPoints(t){this._hoverDidMove||this._updateHoverForTouchPoints(t)}_didMoveHover(t){if(!this._hasData())return;let e=[Gr(t)];null!==this._mouseDownPoint&&e.push(this._mouseDownPoint);let n=qi(t),i=n.length>0;i&&(e=n),this._hoverDidMove=!0,this._hoverPoints.length>0&&(this._updateHoverForTouchPoints(e),i&&Wi.c.preventDefault())}_didEndHover(t){if(!this._hasData())return;let e=qi(t);this._resetMouseDown(),e.length>0?this._updateHoverForTouchPoints(e):this._hoverPoints.length>0&&this._setHoverPoints([])}_dayForPoint(t){let e=t[0]-this.renderer.margin.left,n=this.renderer.viewX.invert(e),i=this.renderer.displayedDateRange;return n<i[0]?n=i[0]:n>i[1]&&(n=i[1]),n}_dataIndexForPoint(t){let e=this._dayForPoint(t);return this._dataIndexForDate(e)}_dataIndexForDate(t){let e=Object(_.h)(this.renderer.displayedDateRange[0],t,!1);return Math.floor(e)}_snapshotForDataIndex(t){return t<this.data.length&&t>=0?this.data[t]:(console.log("ERROR: no data for index "+t+", filtered data size: "+this.data.length),null)}_snapshotForPoint(t){let e=this._dataIndexForPoint(t);return this._snapshotForDataIndex(e)}_hoverPointForDate(t){let e=this._dataIndexForDate(t),n=this._snapshotForDataIndex(e);return null===n?null:new Jr(e,n)}}class $r{constructor(t,e){this.data=t,this.evaluator=e}}const Kr=0,ta=1,ea=2;var na=0,ia=0;class ra{constructor(t,e,n=Kr){this.showSmoothedData=-1,this.visible=!0,this.evaluator=e,this._beginDate=null,this._endDate=null,this._currentData=null,this._filteredData=null,this._benchmarkSeries=null,this.title=null,this.description=null,this.hoverManager=null;let i=this;n===Kr&&(this.title=new qr(t),this.title.didTapStatAdjective=function(){i._didToggleStatAdjective()}),this.container=t.append("div").attr("class",i._containerClassForDisplayMode(n)).append("div").attr("class",i._chartContainerClassForDisplayMode(n)),n===Kr&&(this.description=new Yr(t),this.description.didHoverDates=function(t){i.hoverManager.highlightDates(t)}),this.svg=this._svgForDisplayMode(n),n===ea&&(this.miniTitle=this.container.append("div").attr("class","over-time-title-mini mini-title-text").html(e.title.replace(" ","<br>")));let r="ScaleTruncation"+Math.floor(1e6*Math.random()),a=this.svg.append("defs").append("linearGradient").attr("id",r).attr("x1",0).attr("x2",0).attr("y1",0).attr("y2",1);a.append("stop").attr("offset","0%").attr("stop-color","white"),a.append("stop").attr("offset","33%").attr("stop-color","white"),a.append("stop").attr("offset","100%").attr("stop-color","rgba(255, 255, 255, 0)"),this.xAxisContainer=this.svg.append("g").attr("class","x-axis"),this.barContainer=this.svg.append("g"),this.trendContainer=this.svg.append("g"),this.hoverContainer=this.svg.append("g").style("overflow","visible"),this.scaleTruncationMarker=this.svg.append("rect").attr("fill","url(#"+r+")"),this.yAxisContainer=this.svg.append("g").attr("class","y-axis"),this.xAxisLabelContainer=this.svg.append("g"),this.renderer=new ca(n,this.container,this.svg,this.barContainer,this.trendContainer,this.xAxisContainer,this.yAxisContainer,this.xAxisLabelContainer,this.scaleTruncationMarker),n===Kr&&(this.hoverManager=new Zr(this,this.renderer,this.hoverContainer,this.container)),this.setShowSmoothedData(!0)}_svgForDisplayMode(t){let e=this.container.append("svg").attr("width","100%").attr("height","100%").attr("class","svg-content over-time-svg");return t===Kr&&(e=e.attr("viewbox","0 0 100 100").attr("preserveAspectRatio","none")),e}_containerClassForDisplayMode(t){return t!==Kr?"base-chart-container-mini unselectable":"base-chart-container content-column unselectable"}_chartContainerClassForDisplayMode(t){return t!==Kr?"time-chart-container-mini":"time-chart-container"}get hoverBoundsEvaluator(){return null!==this.hoverManager?this.hoverManager.hoverBoundsEvaluator:null}set hoverBoundsEvaluator(t){null!==this.hoverManager&&(this.hoverManager.hoverBoundsEvaluator=t)}get benchmarkSeries(){return this._benchmarkSeries}set benchmarkSeries(t){this._benchmarkSeries=t,this._syncBenchmarkEvaluator()}setShowSmoothedData(t){t!==this.showSmoothedData&&(this.showSmoothedData=t,this._didUpdateEvaluator())}setEvaluator(t){this.evaluator=t,this._didUpdateEvaluator()}_syncBenchmarkEvaluator(){null!==this._benchmarkSeries&&this._benchmarkSeries.evaluator.toggleCount!=this.evaluator.toggleCount&&(this._benchmarkSeries.evaluator.toggleCount=this.evaluator.toggleCount-1,this._benchmarkSeries.evaluator=this._benchmarkSeries.evaluator.toggledEvaluator())}hide(t=!1){this.setVisible(!1,t)}show(t=!1){this.setVisible(!0,t)}setVisible(t,e=!1){if(t===this.visible)return;this.visible=t;let n=t?"block":"none";this.container.style("display",n),null!==this.title&&this.title.container.style("display",n),null!==this.description&&this.description.container.style("display",n)}redraw(t=!1,e=!1){this.updateForData(this._currentData,t,e)}updateForData(t,e,n=!1){void 0===this.renderer.width&&this._parseDimensions();let i=this.evaluator.metricEvaluators;this._currentData=t,this._filteredData=this._filterDataWithEvaluators(t,i);let r=this.evaluator.normalized,a=this.evaluator.allowNegative;this._barDataSeries=this._barDataFromRawData(this._filteredData,i,r),this._averageDataSeries=null;let o=null;if(this.showSmoothedData&&(o=Array.from(this._smoothedEvaluator.metricEvaluators),this._averageDataSeries=this._barDataFromRawData(this._filteredData,o,this._smoothedEvaluator.normalized)),null!==this._benchmarkSeries&&!this._inComparisonMode()){let t=this._benchmarkSeries.evaluator,e=this._alignDataWithData(this._benchmarkSeries.data,this._filteredData),n=this._barDataFromRawData(e,Array.from(t.metricEvaluators),t.normalized);t.smoothed?this._averageDataSeries.push(...n):this._barDataSeries.push(...n)}if(null!==this.hoverManager){let t=this.topSeriesIndex();this.hoverManager.data=this._filteredData,this.hoverManager.displayedDataSeries=this._barDataSeries[t],this.hoverManager.displayedAverageDataSeries=this._averageDataSeries[t],this.hoverManager.evaluator=this.evaluator,this.hoverManager.averageEvaluator=this._smoothedEvaluator}let s=this._barDataSeries.filter(t=>t.evaluator.display),l=this._averageDataSeries.filter(t=>t.evaluator.display);if(!n){let t=[this._earliestDataPoint(),this._latestDataPoint()];this.renderer.drawAxesForData(t,s,l,this.evaluator,r,a,e)}let u=this._chartSegments();this.renderer.drawBars(s,u,a,e),this.showSmoothedData&&this.renderer.drawTrendLines(l,u,e),this.renderer.drawAnnotations(l,e)}updateDescriptionForRegion(t,e=!1){null!==this.description&&this.description.updateForData(this._filteredData,t,this.evaluator,this._smoothedEvaluator,e)}fixTimeDomain(t,e){this._beginDate=t,this._endDate=e}_didToggleStatAdjective(){let t=this.evaluator.toggledEvaluator();this.setEvaluator(t)}_didUpdateEvaluator(){this._smoothedEvaluator=this.showSmoothedData?ga.smoothedCopy(this.evaluator):null,void 0!==this.title&&null!==this._filteredData&&(null!==this.title&&this.title.updateForContextChange(this.evaluator,this.title.region,this.title.groupByUnit),null!==this.description&&this.description.updateForData(this._filteredData,this.description.region,this.evaluator,this._smoothedEvaluator)),this._syncBenchmarkEvaluator(),this._didUpdate(!0)}_parseDimensions(){let t=this.renderer.isMini();t&&0===na&&(na=parseInt(this.container.style("width")),ia=parseInt(this.container.style("height")));let e=t?na:parseInt(this.container.style("width")),n=t?ia:parseInt(this.container.style("height"));return this.renderer.updateForDimensions(e,n)}topSeriesIndex(){let t=this.evaluator.metricEvaluators;for(let e=t.length-1;e>=0;e--)if(t[e].display)return e;return-1}didResize(){this._parseDimensions()&&this.updateForData(this._currentData,!1)}_chartSegments(){return null!==this.hoverManager?this.hoverManager.chartSegments():[Bi.baseSegmentForData(this._filteredData)]}_inComparisonMode(){return null!==this.hoverManager&&this.hoverManager.inComparisonMode()}_earliestDataPoint(){return null!==this._beginDate?this._beginDate:ct(this._currentData,t=>t.date)}_latestDataPoint(){return null!==this._endDate?this._endDate:ht(this._currentData,t=>t.date)}_didUpdate(t=!1){void 0!==this._currentData&&null!==this._currentData&&this.updateForData(this._currentData,t)}_barDataFromRawData(t,e,n){let i=function(){var t=at([]),e=ji,n=Li,i=zi;function r(r){var a,o,s=t.apply(this,arguments),l=r.length,u=s.length,h=new Array(u);for(a=0;a<u;++a){for(var c,d=s[a],f=h[a]=new Array(l),p=0;p<l;++p)f[p]=c=[0,+i(r[p],d,p,r)],c.data=r[p];f.key=d}for(a=0,o=e(h);a<u;++a)h[o[a]].index=a;return n(h,o),h}return r.keys=function(e){return arguments.length?(t="function"==typeof e?e:at(Hi.call(e)),r):t},r.value=function(t){return arguments.length?(i="function"==typeof t?t:at(+t),r):i},r.order=function(t){return arguments.length?(e=null==t?ji:"function"==typeof t?t:at(Hi.call(t)),r):e},r.offset=function(t){return arguments.length?(n=null==t?Li:t,r):n},r}().keys(e).value((function(t,e){return e.valueForSnapshot(t)}));n&&(i=i.offset(Vi));let r=i(t),a=[];return r.forEach((function(t,n){a.push(new $r(t,e[n]))})),a}_alignDataWithData(t,e){if(null===e||0===e.length)return[];let n=e.first().date,i=e.last().date;return t.filter((function(t){return t.date>=n&&t.date<=i}))}_filterDataWithEvaluators(t,e){return t.filter((function(t){for(let n=0;n<e.length;n++){if(null!==e[n].statForSnapshot(t)){if(null!==e[n].filterFunction){if(!e[n].filterFunction(e[n],t))return!1}return!0}}return!1}))}}class aa{static frequencyDataForSeries(t){if(0===t.length)return new Oi(null,0);let e=0;for(let n=0;n<t.length-1;n++){let i=t[n][1],r=t[n+1][1]-i;Math.abs(r)>Math.abs(e)&&(e=r)}let n=t.concat().sort((function(t,e){return t[1]-e[1]}));return new Oi(n,e)}static scaleParametersForSeries(t,e,n,i,r){let a=[];e.forEach((function(t){a=a.concat(t.data)}));let o=[];return n.forEach((function(t){o=o.concat(t.data)})),aa.scaleParametersForData(t,a,o,i,r)}static scaleParametersForData(t,e,n,i,r){let a=aa.frequencyDataForSeries(e),o=aa.frequencyDataForSeries(n);if(t!==Kr)return new Pi(o.min,o.max,!1);let s=new Pi(a.min,a.max,!1);if(r)return s;if(a.max>1.9*o.max)s.useOvershoot=!0,s.yMax=1.5*o.max,s.yDataMax=a.maxValueBelowValue(s.yMax);else{let t=o.max>2.2*o.topQuartile,e=Math.abs(o.maxJump)>.5*o.max;t&&e&&(s.useOvershoot=!0,s.yMax=2.2*o.topQuartile,s.yDataMax=a.maxValueBelowValue(s.yMax))}return s}}const oa=0,sa=1,la=2,ua=0,ha=1;class ca{constructor(t,e,n,i,r,a,o,s,l){this.displayMode=t,this.chartContainer=e,this.svg=n,this.barContainer=i,this.trendContainer=r,this.xAxisContainer=a,this.yAxisContainer=o,this.xAxisLabelContainer=s,this.truncatedScaleMarker=l,this.margin=ca._marginForDisplayMode(t),this.currentCapHeightOffset=0,this.viewX=null,this.viewY=null,this.trendLine=function(){var t=lt,e=ut,n=at(!0),i=null,r=st,a=null;function o(o){var s,l,u,h=o.length,c=!1;for(null==i&&(a=r(u=rt())),s=0;s<=h;++s)!(s<h&&n(l=o[s],s,o))===c&&((c=!c)?a.lineStart():a.lineEnd()),c&&a.point(+t(l,s,o),+e(l,s,o));if(u)return a=null,u+""||null}return o.x=function(e){return arguments.length?(t="function"==typeof e?e:at(+e),o):t},o.y=function(t){return arguments.length?(e="function"==typeof t?t:at(+t),o):e},o.defined=function(t){return arguments.length?(n="function"==typeof t?t:at(!!t),o):n},o.curve=function(t){return arguments.length?(r=t,null!=i&&(a=r(i)),o):r},o.context=function(t){return arguments.length?(null==t?i=a=null:a=r(i=t),o):i},o}().x((function(t){return t[0]})).y((function(t){return t[1]}))}updateForDimensions(t,e){let n=this.width,i=this.height;return this.width=t,this.height=e,(this.width!==n||this.height!==i)&&(this.rescaleAxes(),!0)}rescaleAxes(){this.viewY=Re().range([this.height-this.margin.bottom,this.margin.top]).clamp(!0),this.viewX=function(){return xe.apply(Mi(Ee,Ae,Oe,Ue,qe,Qe,Je,$e,mn).domain([new Date(2e3,0,1),new Date(2e3,0,2)]),arguments)}().range([this.margin.left,this.width-this.margin.right])}yAxisPaddingFactor(){return this.isMini()?1:1.1}animationSpeed(){return 1e3}workingWidth(){return this.width-this.margin.left-this.margin.right}workingHeight(){return this.height-this.margin.top-this.margin.bottom}numBarsInDomain(){let t=this.xDomain;return null==t&&(t=this._dateDomainOffsetForDisplay(this.dateDomain)),Math.round(Math.abs(Object(_.h)(t[0],t[1])))}barWidth(){return this._barWidthForDomainSize(this.numBarsInDomain(),this.barPadding())}_barWidthForDomainSize(t,e){let n=(t-1)*e;return(this.workingWidth()-n)/t}static _marginForDisplayMode(t){return t===Kr?{top:0,left:0,bottom:18.5,right:0}:{top:0,left:0,bottom:0,right:0}}barPadding(){let t=this.numBarsInDomain(),e=4,n=this._barWidthForDomainSize(t,e);for(;(n<2||n/e<4)&&e>0;)e--,n=this._barWidthForDomainSize(t,e);let i=this.isMini()?0:.75;return Math.max(e,i)}_segmentForIndex(t,e){for(let n=0;n<e.length;n++)if(e[n].contains(t))return e[n];return console.log("ERROR: no chart drawing behavior found for index: "+t),null}_dateDomainOffsetForDisplay(t){return[t[0].addDays(this.isMini()?0:-2),t[1].addDays(1)]}isMini(){return this.displayMode===ta||this.displayMode===ea}_trendLineClass(){return this.isMini()?"trend-line-mini":"trend-line"}drawXAxis(t,e,n,i){let r=this.animationSpeed(),a=this,o=mn("%B %e"),s=Object(_.h)(t[0],t[1]),l=s<22,u=function(t,e){return 0===t},h=function(t,e){return t===e.length-1};s<45&&(u=function(t,e){return!1},h=function(t,e){return!0});let c=this.xAxisLabelContainer.selectAll("text").data(l?[t[1]]:t,(function(t,e){return e})).join((function(t){return t.append("text").attr("class","over-time-x-label").attr("dy","1.35em").attr("y",0).attr("x",t=>a.viewX(t))}));i&&(c=c.transition().duration(r)),c.attr("x",t=>a.viewX(t)).attr("first",(function(t,e,n){return u(e,n)?"":null})).attr("last",(function(t,e,n){return h(e,n)?"":null})).text(t=>o(t));let d=!n&&!e,f=`translate(0, ${this.height-this.margin.bottom})`,p=(g=this.viewX,Z(3,g)).tickValues([]).tickSize(0);var g;let m=this.xAxisContainer.attr("transform",f);i&&(m=m.transition().duration(r)),m.call(p).style("opacity",d?1:0);let v=`translate(0, ${this.height-this.margin.bottom})`;this.xAxisLabelContainer.attr("transform",v)}drawYAxis(t,e,n,i,r,a,o){let s=this.animationSpeed(),l=this,u=this.viewY.ticks(3),h=this.viewY(u[u.length-1]),c=this.viewY(n);this._visualTopY=h<c?h:this.viewY.range()[1];let d=-(h-15);if(d>0&&d-this.currentCapHeightOffset>2){let t=this.svg;o&&(t=t.transition().duration(s)),this.currentCapHeightOffset=d,t.style("transform","translateY("+this.currentCapHeightOffset+"px)"),this.chartContainer.style("padding-bottom",this.currentCapHeightOffset+"px")}let f=$(this.viewY).ticks(3).tickSize(-this.workingWidth()).tickFormat((function(n,o,s){let u=l.viewY.tickFormat(3);(i||r)&&(u=".0%");let h=O(u)(n);if(r&&"0%"===h)h="Baseline";else{let n=Math.abs(t[0])>Math.abs(t[1]);o===(a&&n?0:s.length-1)&&(h+=" "+e.graphedNoun())}return h})),p=this.yAxisContainer.attr("transform",`translate(${this.margin.left}, 0)`);o&&(p=p.transition().duration(s)),p.call(f).attr("fill",null).selectAll("g.tick text").attr("class","grid-line-label").attr("dy","-0.41em").attr("x",0),this.yAxisContainer.selectAll("g.tick line").attr("class","grid-line"),(r||a)&&this.yAxisContainer.selectAll("g.tick line").filter((function(t){return 0===t})).attr("class","grid-line-baseline"),this.yAxisContainer.selectAll("path.domain").style("display","none")}drawScaleTruncationMarker(t,e,n){let i=this.animationSpeed(),r=this.truncatedScaleMarker;n&&(r=r.transition().duration(i)),r.attr("x",0).attr("y",t?this.viewY(e)-2:-30).attr("height",30).attr("width",this.width).style("opacity",t?1:0)}drawAxesForData(t,e,n,i,r,a,o){this.dateDomain=t;let s=t[0],l=t[1],u=this._dateDomainOffsetForDisplay(t),h=this.isMini()?n:e.concat(n),c=aa.scaleParametersForSeries(this.displayMode,e,n,r,a),d=e.first(),f=this.barWidth()/(this.barWidth()+this.barPadding()),p=u[0],g=Object(_.e)(l.addDays(f)),m=d.evaluator.displayAsPercent;this.xDomain=[Object(_.g)(p),Object(_.g)(g)];let v=ht(h,t=>ht(t.data,(function(t){return t[1]}))),y=ct(h,t=>ct(t.data,(function(t){return a?Math.min(t[0],t[1]):t[0]}))),D=c.useOvershoot?c.yDataMax:v,w=c.useOvershoot?c.yMax:this.yAxisPaddingFactor()*v,b=this.yAxisPaddingFactor()*Math.min(y,0);this.yDomain=[b,w];let S=this.isMini()?this._displayedDateDomainForSeries(h):this.xDomain;this.viewX.domain(S),this.viewY.domain(this.yDomain),this.displayedDateRange=this._visibleDateRangeForSeries(e,[s,g],f),this.isMini()||(this.drawScaleTruncationMarker(c.useOvershoot,w,o),this.drawXAxis(this.displayedDateRange,y<0,m,o),this.drawYAxis(this.yDomain,i,D,r,m,a,o))}_displayedDateDomainForSeries(t){return[ct(t,t=>ct(t.data,(function(t){return t.data.date}))),ht(t,t=>ht(t.data,(function(t){return t.data.date})))]}_visibleDateRangeForSeries(t,e,n=.99){let i=[];if(0===t[0].data.length)i=[Object(_.g)(e[0]),Object(_.g)(e[1])];else{let e=ct(t,t=>t.data[0].data.date),r=ht(t,t=>t.data[t.data.length-1].data.date).addDays(n);i=[Object(_.g)(e),r]}return i}_dataIndexForAnnotation(t){let e=0;switch(t.evaluator.annotationPlacement){case ha:{let n=0,i=0;t.data.forEach((function(t,e){let r=Math.abs(t[1]);r>i&&(i=r,n=e)})),e=n}case ua:{let n=7,i=t.data.length-n;i<n&&(i=t.data.length-1),e=i}}return e=Math.max(e,0),e=Math.min(e,t.data.length-1),e}_annotationPointForSeries(t,e=null){if(null===e&&(e=this._dataIndexForAnnotation(t)),void 0===t.data[e])return null;let n=t.data[e].data,i=t.data[e][1];return[this.viewX(n.normalizedDate())+.5*this.barWidth(),this.viewY(i)]}_annotationTransformForSeries(t,e=sa){let n=this._annotationPointForSeries(t);return null===n?"translate(0,0)":(e===oa&&(n[1]-=38),"translate("+n[0]+","+n[1]+")")}_annotationCalloutBeginForSeries(t,e=sa){return e===oa?28:0}_annotationCalloutEndForSeries(t,e=sa){return this._annotationCalloutBeginForSeries(t,e)+10}_annotationTextTransformForSeries(t,e=sa){let n=0;return e===sa&&(n=10),"translate(-10, "+n+")"}_annotationOrientationsForSeries(t,e){let n=this;return t.map((function(t){let i=n._dataIndexForAnnotation(t),r=n._annotationPointForSeries(t,i);if(null===r)return la;let a=!0;e.forEach((function(e){if(e!==t){let t=n._annotationPointForSeries(e,i);null!==t&&r[1]>t[1]&&(a=!1)}}));let o=a?oa:sa,s=o,l=o===oa?-38:38,u=r[1]+l;return u<n.viewY.range[0]&&(s=sa),u>n.viewY.range[1]&&(s=oa),s}))}drawAnnotations(t,e){if(this.isMini())return;let n=this,i=this.animationSpeed(),r=t.filter((function(t){return null!==t.evaluator.annotation&&t.data.length>0})),a=this._annotationOrientationsForSeries(r,t),o=this.yAxisContainer.selectAll("g.annotation").data(r,(function(t){return t.evaluator.hashString()})).join((function(t){return t.append("g").attr("class","annotation").attr("opacity",0).attr("transform",(function(t,e){return n._annotationTransformForSeries(t,a[e])})).append("line").attr("class","annotation-callout").attr("x1",0).attr("y1",(function(t,e){return n._annotationCalloutBeginForSeries(t,a[e])})).attr("x2",0).attr("y2",(function(t,e){return n._annotationCalloutEndForSeries(t,a[e])})).select((function(){return this.parentNode})).append("text").attr("class","annotation-label").attr("transform",(function(t,e){return n._annotationTextTransformForSeries(t,a[e])})).attr("dy",12).html((function(t){return t.evaluator.annotation})).select((function(){return this.parentNode}))}),(function(t){return t}),(function(t){return e&&(t=t.transition().duration(i)),t.attr("opacity",0).remove()}));e&&(o=o.transition().duration(i)),o.attr("transform",(function(t,e){return n._annotationTransformForSeries(t,a[e])})).attr("opacity",1).select("text").attr("transform",(function(t,e){return n._annotationTextTransformForSeries(t,a[e])})).select((function(){return this.parentNode})).select("line").attr("y1",(function(t,e){return n._annotationCalloutBeginForSeries(t,a[e])})).attr("y2",(function(t,e){return n._annotationCalloutEndForSeries(t,a[e])}))}drawBars(t,e,n,i){if(this.isMini())return;let r=this.animationSpeed(),a=this;this.barContainer.selectAll("g").data(t,(function(t){return t.evaluator.hashString()})).join((function(t){return t.append("g").attr("class","over-time-series").attr("evaluatorID",(function(t){return t.evaluator.hashString()}))})),t.forEach((function(t,o){let s=t.evaluator,l=t.data,u=s.hashString(),h=a.barContainer.selectAll("g[evaluatorID='"+u+"']").first().selectAll("rect").data(l,t=>t.data.dateString).join((function(t){return t.append("rect").attr("dateID",t=>ca.rectDateID(t.data)).attr("x",t=>a.viewX(t.data.normalizedDate())).attr("width",a.barWidth()).attr("y",a.viewY(0)).attr("height",0)}));i&&(h=h.transition().duration(r)),h.attr("y",(function(t){return Math.min(a.viewY(t[0]),a.viewY(t[1]))})).attr("height",(function(t){let e=a.viewY(t[0])-a.viewY(t[1]);return e=n?Math.abs(e):Math.max(e,0),e})).attr("width",a.barWidth()).attr("fill",(function(t,n){let i=a._segmentForIndex(n,e);return Bi.colorForEvaluator(s,i.drawMode)})).attr("x",t=>a.viewX(t.data.normalizedDate()))})),this.barContainer.style("opacity",this.showingTrendOverlay()?.25:1)}showingTrendOverlay(){return!0}drawTrendLines(t,e,n){t=t.concat().reverse();let i=this.animationSpeed(),r=this.trendContainer.selectAll("g").data(t,(function(t){return t.evaluator.hashString()})).join((function(t){return t.append("g").attr("class","over-time-series-trend").attr("evaluatorID",(function(t){return t.evaluator.hashString()})).style("opacity",0)}),(function(t){return t}),(function(t){return n&&(t=t.transition().duration(i)),t.style("opacity",0).remove()}));n&&(r=r.transition().duration(i)),r.style("opacity",1);let a=this;t.forEach((function(t,r){let o=t.evaluator,s=t.data,l=o.hashString(),u=a.trendContainer.selectAll("g[evaluatorID='"+l+"']").first(),h=[],c=[];e.forEach((function(t){let e=[],n=[];ca.computeTrendLinePoints(a,s,e,n,t),c.push(e),h.push(n)})),u.selectAll("path.trend-line-fill").data(h,(function(t,e){return"trendFill"+e})).join(t=>t.append("path").attr("class","trend-line-fill").attr("fill",(function(t,n){let i=e[n];return Bi.colorForEvaluator(o,i.drawMode,o.wantsFill?.2:0)})).attr("d",a.trendLine),(function(t){return n&&(t=t.transition().duration(i)),t.attr("fill",(function(t,n){let i=e[n];return Bi.colorForEvaluator(o,i.drawMode,o.wantsFill?.2:0)})).attr("d",a.trendLine)}));let d=u.selectAll("path."+a._trendLineClass()).data(c,(function(t,e){return"trendLine"+e})).join(t=>t.append("path").attr("class",a._trendLineClass()).attr("stroke",(function(t,n){let i=e[n];return Bi.colorForEvaluator(o,i.drawMode)})).attr("d",a.trendLine));n&&(d=d.transition().duration(i)),d.attr("stroke",(function(t,n){let i=e[n];return Bi.colorForEvaluator(o,i.drawMode)})).attr("d",a.trendLine)}))}static computeTrendLinePoints(t,e,n,i,r=null){let a=null===r?0:r.beginIndex,o=null===r?e.length-1:r.endIndex,s=null===r?ki:r.drawMode,l=[],u=t.barWidth()/2;for(let r=a;r<=o&&r<e.length;r++){let h=e[r],c=0===r,d=r===e.length-1,f=t.viewX(h.data.normalizedDate());d&&e.length>1?f+=2*u:c&&1!==e.length||(f+=u);let p=[f,t.viewY(h[1])],g=[f,t.viewY(h[0])],m=f;if(!c&&!d){let t=r===a,e=r===o;s===Ai?e?m-=u:t&&(m+=u):e?m+=u:t&&(m-=u)}n.push(p),i.push([m,p[1]]),l.push([m,g[1]])}let h=t.numBarsInDomain();for(;n.length<h&&n.length>0;)n.unshift(n[0]);for(;i.length<h&&i.length>0;)i.unshift(i[0]);for(;l.length<h&&l.length>0;)l.unshift(l[0]);l.reverse(),i.push(...l)}static rectDateID(t){return"date"+t.dateString}}const da="203,25,29",fa="47,42,45",pa="38,120,144";class ga{constructor(t,e,n,i,r,a=!1,s=!1,u=!1){this.title=t,this.noun=e,this.nounWithNumber=null,this.anchorNoun=null,this.deltaAdjective="new",this.cumulativeAdjective="total",this.needsGroupByCallback=null,this.filterFunction=null,this.valueFormatter=null,this.HTMLFormatter=null,this.nounQualifier=null,this.reportingVerbFormatter=null,this.descriptionTemplate=ga.baseDescriptionTemplate(),this.upIsBetter=!1,this.wantsFill=!0,this.source=null,this.annotation=null,this.annotationPlacement=ua,this.supportedRegionLevel=l,this.benchmarkEvaluator=null,this.benchmarkRegionType=o,this.toggleFunction=function(t){let e=!t.measureDelta,n=ga.from(t);return n.measureDelta=e,n},this.statDescriptionFunction=function(t){return t.measureDelta?t.deltaAdjective:t.cumulativeAdjective},this.toggleCount=0,this.measureDelta=a,this.smoothed=s,this.perCapita=u,this.normalized=!1,this.allowNegative=!1,this.displayAsPercent=!1,this.display=!0,this.baseStatForSnapshot=n,this._intensityForSnapshot=i,this._colorForIntensity=r,this.baseRGB="0, 0, 0",this.baseNegativeRGB="0, 200, 0",this.maxPowerOfTen=5,this.minAlpha=.15,this.maxAlpha=1}hashString(){return Object(W.HashString)(this.title)}equals(t){return this.hashString()===t.hashString()}get metricEvaluators(){return[this]}statDescription(){return this.statDescriptionFunction(this)}smoothedNounSuffix(){return this.smoothed?" (avg)":""}formatValue(t){return this._designatedValueFormatter()(t)}_designatedValueFormatter(){return null!==this.valueFormatter?this.valueFormatter:O(",.0f")}formatValueHTML(t,e){return null===this.HTMLFormatter?this._designatedValueFormatter()(e):this.HTMLFormatter(this,t,e)}graphedNoun(t=!0){let e=this.noun;return null!==this.nounWithNumber&&(e=this.nounWithNumber),e+(t?this.smoothedNounSuffix():"")}fullyQualifiedNoun(){return null!==this.nounQualifier?this.nounQualifier(this):this.statDescription()+" "+this.noun}perCapitaNoun(t=!1){let e=t?" people":"",n=this.perCapita?" per million"+e:"";return this.noun+n}reportingVerb(){return null!==this.reportingVerbFormatter?this.reportingVerbFormatter(this):this.measureDelta?"reported":"has reported"}dataIsAtomic(){return!this.normalized&&!this.displayAsPercent}changeInGraphedNoun(t=-1){return-1===t&&(t=this.dataIsAtomic()),this.graphedNoun(!1)+(this.measureDelta&&t?" / day":"")}needsGroupBy(){return null===this.needsGroupByCallback||this.needsGroupByCallback(this)}toggledEvaluator(){return this.toggleCount+=1,this.toggleFunction(this)}static baseDescriptionTemplate(){return"<Token:Region> <Token:ReportingVerb> <Token:DataQuantity> <Token:Noun> <Token:TimePreposition> <Token:ShortDate>. On average, <Token:FullyQualifiedNoun> <Token:NounIs> <Token:DirectionalPercentChangeWeek> week over week, and <Token:DirectionalPercentChangeMonth> month over month."}static from(t){if(t.metricEvaluators.length>1)return ma.from(t);let e=new ga(t.title,t.noun,t.baseStatForSnapshot,t._intensityForSnapshot,t._colorForIntensity,t.measureDelta,t.smoothed,t.perCapita);return e.baseRGB=t.baseRGB,e.baseNegativeRGB=t.baseNegativeRGB,e.maxPowerOfTen=t.maxPowerOfTen,e.minAlpha=t.minAlpha,e.maxAlpha=t.maxAlpha,e.display=t.display,e.normalized=t.normalized,e.nounWithNumber=t.nounWithNumber,e.anchorNoun=t.anchorNoun,e.deltaAdjective=t.deltaAdjective,e.cumulativeAdjective=t.cumulativeAdjective,e.needsGroupByCallback=t.needsGroupByCallback,e.allowNegative=t.allowNegative,e.displayAsPercent=t.displayAsPercent,e.statDescriptionFunction=t.statDescriptionFunction,e.toggleFunction=t.toggleFunction,e.toggleCount=t.toggleCount,e.filterFunction=t.filterFunction,e.valueFormatter=t.valueFormatter,e.HTMLFormatter=t.HTMLFormatter,e.upIsBetter=t.upIsBetter,e.descriptionTemplate=t.descriptionTemplate,e.nounQualifier=t.nounQualifier,e.reportingVerbFormatter=t.reportingVerbFormatter,e.benchmarkEvaluator=t.benchmarkEvaluator,e.benchmarkRegionType=t.benchmarkRegionType,e.wantsFill=t.wantsFill,e.annotation=t.annotation,e.annotationPlacement=t.annotationPlacement,e.supportedRegionLevel=t.supportedRegionLevel,e.source=t.source,e}static smoothedCopy(t){if(t.metricEvaluators.length>1)return ma.smoothedCopy(t);let e=ga.from(t);return e.smoothed=!0,e}statForSnapshot(t){let e=this.baseStatForSnapshot(this,t);if(!(e instanceof v||e instanceof Array))return e;if(void 0===e.rawdata)return null;let n=ga.dataIndexForParameters(this.measureDelta,this.smoothed);return e.rawdata[n]}static dataIndexForParameters(t,e){let n=d;return t&&(n=v.ChangeIndexForIndex(n)),e&&(n=v.AverageIndexForIndex(n)),n}setBaseStat(t){this.baseStatForSnapshot=t}valueForSnapshot(t){let e=this.statForSnapshot(t);return void 0===e||null==e?0:(this.perCapita&&(e=1e6*e/t.region.population),e)}intensityForSnapshot(t){return this._intensityForSnapshot(this,t)}colorForIntensity(t){return this._colorForIntensity(this,t)}supportsRegionType(t){return t<=this.supportedRegionLevel}colorForSnapshot(t){return this.colorForIntensity(this.intensityForSnapshot(t))}baseColor(t=1){return"rgba("+this.baseRGB+","+Math.min(Math.max(t,0),1)+")"}}class ma{constructor(t,e=!0){this.metricEvaluators=t,this.normalized=e,this.smoothed=!1,this.display=!0,this.upIsBetter=!1,this.overallValueForSnapshot=null,this.valueFormatter=null,this.nounQualifier=null,this.anchorNoun=null,this.reportingVerbFormatter=null,this.benchmarkEvaluator=null,this.benchmarkRegionType=o,this.descriptionTemplate=ga.baseDescriptionTemplate(),this.supportedRegionLevel=l}hashString(){let t="";return this.metricEvaluators.forEach((function(e){t+=e.hashString()+"-"})),t}equals(t){return this.hashString()===t.hashString()}formatValue(t){return(null!==this.valueFormatter?this.valueFormatter:O(",.0f"))(t)}formatValueHTML(t,e){return this.formatValue(e)}perCapitaNoun(t=!1){return this.metricEvaluators[0].perCapita?this.metricEvaluators[0].perCapitaNoun(t):this.noun}numSeries(){return this.metricEvaluators.length}statDescription(){return this.metricEvaluators[0].statDescription()}graphedNoun(){return this.metricEvaluators[0].graphedNoun()}changeInGraphedNoun(){return this.metricEvaluators[0].changeInGraphedNoun(!this.normalized)}needsGroupBy(){return this.metricEvaluators[0].needsGroupBy()}filterFunction(){return this.metricEvaluators[0].filterFunction}dataIsAtomic(){return!this.normalized}fullyQualifiedNoun(){return null!==this.nounQualifier?this.nounQualifier(this):this.statDescription()+" "+this.noun}reportingVerb(){return null!==this.reportingVerbFormatter?this.reportingVerbFormatter(this):this.measureDelta?"reported":"has reported"}valueForSnapshot(t){return null!==this.overallValueForSnapshot?this.overallValueForSnapshot(this,t):null}get measureDelta(){return this.metricEvaluators[0].measureDelta}set measureDelta(t){this.metricEvaluators.forEach((function(e){e.measureDelta=t}))}get source(){return this.metricEvaluators[0].source}set source(t){this.metricEvaluators.forEach((function(e){e.source=t}))}get allowNegative(){return this.metricEvaluators[0].allowNegative}set allowNegative(t){this.metricEvaluators.forEach((function(e){e.allowNegative=t}))}toggledEvaluator(){let t=ma.from(this);return t.metricEvaluators=this.metricEvaluators.map(t=>t.toggledEvaluator()),t}supportsRegionType(t){return t<=this.supportedRegionLevel}static movePropertiesFrom(t,e){return e.smoothed=t.smoothed,e.title=t.title,e.normalized=t.normalized,e.noun=t.noun,e.display=t.display,e.overallValueForSnapshot=t.overallValueForSnapshot,e.valueFormatter=t.valueFormatter,e.upIsBetter=t.upIsBetter,e.descriptionTemplate=t.descriptionTemplate,e.nounQualifier=t.nounQualifier,e.reportingVerbFormatter=t.reportingVerbFormatter,e.benchmarkEvaluator=t.benchmarkEvaluator,e.benchmarkRegionType=t.benchmarkRegionType,e.supportedRegionLevel=t.supportedRegionLevel,e.anchorNoun=t.anchorNoun,e}static from(t){let e=new ma(t.metricEvaluators.map(t=>ga.from(t)),t.normalized);return this.movePropertiesFrom(t,e),e}static smoothedCopy(t){let e=t.metricEvaluators.map(t=>ga.smoothedCopy(t)),n=new ma(e,t.normalized);return this.movePropertiesFrom(t,n),n.smoothed=!0,n}static quotientValueForSnapshot(){return function(t,e){let n=ma.sumValueForSnapshot()(t,e);return 0===n?0:t.metricEvaluators[0].valueForSnapshot(e)/n}}static sumValueForSnapshot(){return function(t,e){let n=0;for(let i=0;i<t.metricEvaluators.length;i++){n+=t.metricEvaluators[i].valueForSnapshot(e)}return n}}}class va{static baseLogHeatMapEvaluator(t,e){return new ga(t,e,(function(t,e){return e.infection.cases}),(function(t,e){let n=t.valueForSnapshot(e);if(0==n)return 0;let i=Math.abs(n),r=Math.max(Math.log10(i),0);if(0==r)return 0;let a=(r+.1)/t.maxPowerOfTen;return n<0&&(a*=-1),a}),(function(t,e){let n=t.minAlpha,i=t.maxAlpha,r=Math.min(Math.max(n+(i-n)*Math.abs(e),0),1);return"rgba("+(e>=0?t.baseRGB:t.baseNegativeRGB)+","+r.toString()+")"}))}static EvaluatorWithAnchor(t,e){let n=ga.from(t);return n.anchorNoun=e,n}static regionNameEvaluator(){let t=new ga("Region Name","region",(function(t,e){return e.region.name}),null,null);return t.valueFormatter=function(t){return t},t}static confirmedCaseEvaluator(){let t=va.baseLogHeatMapEvaluator("Confirmed cases","cases");return t.setBaseStat((function(t,e){return e.infection.cases})),t.baseRGB=da,t.maxPowerOfTen=5,t.supportedRegionLevel=u,t.source="The New York Times",t.anchorNoun="cases",t}static currentlyHospitalizedDescription(t){return t?"The number of currently hospitalized people <Token:RegionPreposition> <Token:Region> <Token:ChangeVerbCurrent> <Token:DataQuantity> <Token:TimePreposition> <Token:ShortDate>. On average, net hospitalizations per day are <Token:DirectionalPercentChangeWeek> week over week, and <Token:DirectionalPercentChangeMonth> month over month.":"<Token:Region> <Token:ReportingVerb> <Token:DataQuantity> people currently hospitalized <Token:TimePreposition> </Token:TimePreposition> <Token:ShortDate>. On average, current hospitalizations are <Token:DirectionalPercentChangeWeek> week over week, and <Token:DirectionalPercentChangeMonth> month over month."}static currentlyHospitalizedEvaluator(){let t=va.baseLogHeatMapEvaluator("Currently hospitalized","currently hospitalized");return t.setBaseStat((function(t,e){return e.infection.hospitalized})),t.filterFunction=function(t,e){return e.infection.hospitalized.value>0},t.baseRGB="240,135,0",t.nounWithNumber="hospitalized",t.deltaAdjective="Change in",t.maxPowerOfTen=3,t.allowNegative=!0,t.anchorNoun="hospitalized",t.source="The COVID Tracking Project",t.descriptionTemplate=va.currentlyHospitalizedDescription(!1),t.toggleFunction=function(t){let e=ga.from(t);return e.measureDelta=!t.measureDelta,e.descriptionTemplate=va.currentlyHospitalizedDescription(e.measureDelta),e},t}static totalTestEvaluator(){let t=va.baseLogHeatMapEvaluator("Total tests","tests");return t.setBaseStat((function(t,e){return e.infection.totalTests})),t.filterFunction=function(t,e){return null!==e.infection.totalTests},t.baseRGB=pa,t.maxPowerOfTen=7,t.upIsBetter=!0,t.source="The COVID Tracking Project",t}static testedPositiveEvaluator(){let t=va.baseLogHeatMapEvaluator("Total positive results","tests");return t.setBaseStat((function(t,e){return e.infection.testedPositive})),t.filterFunction=function(t,e){return null!==e.infection.testedPositive},t.baseRGB=da,t.maxPowerOfTen=5,t.source="The COVID Tracking Project",t}static testedNegativeEvaluator(){let t=va.baseLogHeatMapEvaluator("Total negative results","tests");return t.setBaseStat((function(t,e){return e.infection.testedNegative})),t.baseRGB=pa,t.maxPowerOfTen=5,t.upIsBetter=!0,t.source="The COVID Tracking Project",t}static newTestEvaluator(){let t=va.totalTestEvaluator();return t.title="New tests",t.measureDelta=!0,t}static newTestPositiveEvaluator(){let t=va.testedPositiveEvaluator();return t.title="New positive results",t.measureDelta=!0,t}static newTestNegativeEvaluator(){let t=va.testedNegativeEvaluator();return t.title="New negative results",t.measureDelta=!0,t}static newTestBreakdownEvaluator(){let t=va.newTestPositiveEvaluator(),e=va.newTestNegativeEvaluator(),n=new ma([t,e],!1);return n.title="New tests",n.noun="tests",n.overallValueForSnapshot=ma.sumValueForSnapshot(),n.upIsBetter=!0,n.anchorNoun="tests",n}static newCaseBreakdownEvaluator(){let t=va.newConfirmedCaseEvaluator(),e=va.newDeathEvaluator(),n=new ma([e,t],!1);return n.title="New cases",n.noun="people",n}static totalTestBreakdownEvaluator(){let t=va.testedPositiveEvaluator(),e=va.testedNegativeEvaluator(),n=new ma([t,e],!1);return n.title="Total tests",n.noun="tests",n.overallValueForSnapshot=ma.sumValueForSnapshot(),n.upIsBetter=!0,n}static newTestPercentPositiveEvaluator(t=!1,e=!1){let n=va.newTestPositiveEvaluator();n.cumulativeAdjective="overall",n.baseRGB="137,42,98",n.deltaAdjective="daily",n.nounWithNumber="positive",n.needsGroupByCallback=function(t){return!t.measureDelta};let i=va.newTestNegativeEvaluator();i.display=!1;let r=new ma([n,i],!1);return r.title="Positive rate",r.noun="test positive rate",r.anchorNoun="positive-rate",r.normalized=!0,r.overallValueForSnapshot=ma.quotientValueForSnapshot(),r.valueFormatter=O(".1%"),r.reportingVerbFormatter=function(t){return t.measureDelta?"came back positive":"have come back positive"},r.descriptionTemplate="<Token:TimePreposition> <Token:ShortDate>, <Token:DataQuantity> of <Token:CumulativeSignifier>COVID-19 tests <Token:RegionPreposition> <Token:Region> <Token:ReportingVerb>. On average, the <Token:FullyQualifiedNoun> has <Token:ChangeVerbWeek> <Token:AmountChangeWeek> when compared to last week, and <Token:ChangeVerbMonth> <Token:AmountChangeMonth> when compared to last month.",t&&(r=ga.smoothedCopy(r)),e&&(r.benchmarkEvaluator=va.nationalNewTestPercentPositiveEvaluator(),r.benchmarkRegionType=o),r}static nationalNewTestPercentPositiveEvaluator(){let t=va.newTestPercentPositiveEvaluator(!0,!1),e=t.metricEvaluators[0];return e.metricEvaluators[0].title="national new positive",e.title="National Positive Rate",e.baseRGB="201,79,150",e.wantsFill=!1,e.annotation="<tspan x='0'>National</tspan><tspan x='0'dy='14'>average</tspan>",e.annotationPlacement=ha,t}static newConfirmedCaseEvaluator(){let t=va.confirmedCaseEvaluator();return t.title="New cases",t.measureDelta=!0,t}static _newStatTrendEvaluator(t,e=7,n=0){let i=ga.from(t);return i.setBaseStat((function(n,i){let r=i.timeSeries.snapshotPrecedingSnapshot(i,e);if(null===r)return 0;let a=t.baseStatForSnapshot(t,r),o=t.baseStatForSnapshot(t,i);if(null===a||null===o)return 0;let s=ga.dataIndexForParameters(t.measureDelta,!0),l=a.rawdata[s],u=o.rawdata[s];return 0===l?0:u/l-1})),i.source=t.source,i.title=e+"-day change",i.displayAsPercent=!0,i.valueFormatter=function(t){let e=Math.abs(t),i="";return t>0&&(i="+ "),t<0&&(i="- "),i+O("."+n+"%")(e)},i.HTMLFormatter=function(t,e,n){let i=t.valueFormatter(n);if(0===n)return i;let r=n>0;return t.upIsBetter&&(r=!r),"<span style='color:rgb("+(r?da:pa)+")'>"+i+"</span>"},i}static dailyPercentPositiveTrendEvaluator(t=7){let e=va._newStatTrendEvaluator(va.newTestPositiveEvaluator(),t,1);return e.setBaseStat((function(e,n){let i=n.timeSeries.snapshotPrecedingSnapshot(n,t),r=ga.dataIndexForParameters(!0,!0),a=i.infection.testedPositive,o=i.infection.totalTests;if(null===a||null===o)return null;let s=a.rawdata[r],l=o.rawdata[r],u=n.infection.testedPositive.rawdata[r],h=n.infection.totalTests.rawdata[r];return(0===h?0:u/h)-(0===l?0:s/l)})),e}static dailyPercentPositiveGraphicEvaluator(t=null){return va.graphicEvaluator(this.dailyPercentPositiveTrendEvaluator(),this.newTestPercentPositiveEvaluator(!0),t)}static newCaseTrendEvaluator(t=7){return va._newStatTrendEvaluator(va.newConfirmedCaseEvaluator(),t)}static graphicEvaluator(t,e,n=null){let i=null;null!==n&&(i=n.map(t=>Object(_.d)(t)));let r=ga.from(t);return r.title="Trend",r.HTMLFormatter=function(t,r,o){let s=Object(a.a)("body").append("div").attr("class","mini-chart-sizing"),l=new ra(s,e,ta),u=r.timeSeries;null!==n&&(u=u.timeSeriesFrom(i[0],i[1]),l.fixTimeDomain(n[0],n[1]));let h=u.dataSliceForRegionID(r.region.ID);l.updateForData(h,!1);let c=s.node().innerHTML;return s.remove(),c},r}static newCaseGraphicEvaluator(t=null){return this.graphicEvaluator(this.newCaseTrendEvaluator(),this.newConfirmedCaseEvaluator(),t)}static newDeathTrendEvaluator(t=7){return va._newStatTrendEvaluator(va.newDeathEvaluator(),t)}static newDeathGraphicEvaluator(t=null){return this.graphicEvaluator(this.newDeathTrendEvaluator(),this.newDeathEvaluator(),t)}static currentlyHospitalizedTrendEvaluator(t=7){return va._newStatTrendEvaluator(va.currentlyHospitalizedEvaluator(),t)}static currentlyHospitalizedGraphicEvaluator(t=null){return this.graphicEvaluator(this.currentlyHospitalizedTrendEvaluator(),this.currentlyHospitalizedEvaluator(),t)}static newTestTrendEvaluator(t=7){let e=va._newStatTrendEvaluator(va.newTestEvaluator(),t);return e.upIsBetter=!0,e}static newTestGraphicEvaluator(t=null){return this.graphicEvaluator(this.newTestTrendEvaluator(),this.newTestEvaluator(),t)}static newDeathEvaluator(){let t=va.deathEvaluator();return t.title="New deaths",t.measureDelta=!0,t}static deathEvaluator(){let t=va.baseLogHeatMapEvaluator("Deaths","deaths");return t.setBaseStat((function(t,e){return e.infection.deaths})),t.baseRGB=fa,t.maxPowerOfTen=3,t.supportedRegionLevel=u,t.source="The New York Times",t.anchorNoun="deaths",t}}class ya{constructor(t){this.regionAtlas=new c,this.dataByDay=ya.aggregateTimeSeriesData(t,this.regionAtlas),this._precedingDateCache=new Map}static fromJSONObject(t,e=null){let n=new ya(null);return n.regionAtlas=c.fromJSONObject(t.regionAtlas,e),n.dataByDay=ya.dataByDayFromJSONObject(t.dataByDay,n.regionAtlas,n),n}updateForMobilityJSON(t){let e=this;for(const n in t)if(this.regionAtlas.has(n)){let i=t[n].dataByDay;for(const t in i){let r=e.snapshotForDay(t,n);null!==r&&(r.mobilityData=T.fromJSONObject(i[t]))}}}containsRegion(t){return this.regionAtlas.has(t)}containsRegionName(t){return this.regionAtlas.hasRegionWithName(t)}regionForID(t){return this.regionAtlas.regionWithID(t)}regionWithName(t){return this.regionAtlas.regionWithName(t)}dayForPercentElapsed(t){let e=this.firstDay.getTime(),n=e+(this.lastDay.getTime()-e)*t,i=Math.round(n/_.a)*_.a;return this._dateStringForTime(i)}lastDayString(){return this._dateStringForTime(this.lastDay.getTime())}snapshotPrecedingSnapshot(t,e=1){let n=t.dateString+"*"+e,i=this._precedingDateCache.get(n);if(void 0===i){let r=t.date.addDays(-e);i=Object(_.d)(r),this._precedingDateCache.set(n,i)}return this.snapshotForDay(i,t.region.ID)}_dateStringForTime(t){let e=Object(_.c)(t);return Object(_.d)(e)}dataSliceForRegionID(t){let e=[];return this.dataByDay.forEach((function(n){let i=n.get(t);i&&e.push(i)})),e}timeSeriesFrom(t,e){let n=new Map;this.dataByDay.forEach((function(i,r){(null===t||r>=t)&&(null===e||r<=e)&&n.set(r,i)}));let i=new ya;return i.dataByDay=n,i.regionAtlas=this.regionAtlas,i}topRegion(){return this.topRegions(1)[0]}topRegions(t=0,e=null,n=va.confirmedCaseEvaluator(),i=!1,r=null){let a=null!==r?r:this.lastDay,o=Object(_.d)(a),s=this.dataForDay(o);if(void 0===s)return[];let l=Array.from(s.values());return null!==e&&(l=l.filter(e)),l.sort((function(t,e){let r=n.valueForSnapshot(e),a=n.valueForSnapshot(t),o=0;return Number.isNaN(parseFloat(r))?"string"==typeof r&&(o=r.localeCompare(a)):o=r-a,i&&(o*=-1),o})),l.length>t&&t>0&&(l=l.slice(0,t)),l.map(t=>t.region)}timeSeriesBeginningAt(t){return this.timeSeriesFrom(t,null)}timeSeriesEndingAt(t){return this.timeSeriesFrom(null,t)}percentElapsedForDay(t){let e=new Date(t).getTime(),n=this.firstDay.getTime();return(e-n)/(this.lastDay.getTime()-n)}_didUpdateDataByDay(){let t=Array.from(this.days());t.sort((t,e)=>t>e),t.length>0&&(this.firstDay=new Date(t[0]),this.lastDay=new Date(t[t.length-1]))}get dataByDay(){return this._dataByDay}set dataByDay(t){this._dataByDay=t,this._didUpdateDataByDay()}snapshotForDay(t,e){let n=this.dataForDay(t);if(void 0===n)return null;let i=n.get(e);return void 0===i?null:i}dataForDay(t,e=null){let n=this._dataByDay.get(t);if(null!==e){let t=new Map(n);t.forEach((function(n,i){e(n)||t.delete(i)})),n=t}return n}dataForRegionOnDay(t,e){let n=this.regionAtlas.regionWithID(t);if(void 0===n)return null;let i=this.dataForDay(e);return void 0===i?null:i.get(n.ID)}days(){return this._dataByDay.keys()}static dataByDayFromJSONObject(t,e,n=null){let i=new Map;for(const r in t){let a=new Map,o=t[r];for(const t in o){let i=o[t],s=y.fromJSONObject(i.i),l=new w(r,e.regionWithID(t),s,n);a.set(t,l)}i.set(r,a)}return i=new Map([...i.entries()].sort()),i}static aggregateTimeSeriesData(t,e=null){if(!t)return new Map;let n=new Map;return t.forEach((function(t){const i=t.dateString;let r=n.get(i);r||(r=new Map),null!=e&&e.registerRegion(t.region);const a=t.region.ID;r.set(a,t),n.set(i,r)})),n}}class _a{constructor(t,e,n,i){this.x=t,this.y=e,this.width=n,this.height=i}unionRect(t){let e=Math.min(this.x,t.x),n=Math.min(this.y,t.y),i=Math.max(this.x+this.width,t.x+t.width),r=Math.max(this.y+this.height,t.y+t.height);this.x=e,this.y=n,this.width=i-e,this.height=r-n}expandBy(t){let e=[this.x+this.width/2,this.y+this.height/2],n=[-t*this.width/2,-t*this.height/2],i=[e[0]+n[0],e[1]+n[1]];this.x=i[0],this.y=i[1],this.width=t*this.width,this.height=t*this.height}aspectRatio(){return this.width/this.height}left(){return this.x}right(){return this.x+this.width}top(){return this.y}bottom(){return this.y+this.height}toString(){return"(x:"+this.x+" y:"+this.y+" w:"+this.width+" h:"+this.height+")"}static fromSVGRect(t){return new _a(t.x,t.y,t.width,t.height)}}class Da{constructor(t,e=[],n=null){this.container=t.append("div").attr("class","data-table-container content-column"),this.table=this.container.append("div").attr("class","data-table"),this.tableHeader=this.table.append("div").attr("class","data-table-header"),this.tableHeaderRow=this.tableHeader.append("div").attr("class","data-table-row"),this.tableBody=this.table.append("div").attr("class","data-table-body"),this.attribution=this.table.append("div").attr("class","data-attribution"),this.numDataRows=this._defaultNumRows(),this.descending=!0,this.sortEvaluator=n,this.onRegionClicked=null,this.data=null,this.dataIsIncomplete=!0,this.highlightedRegionID=null,this.aggregateRegionID=null,this.updateForEvaluators(e,n,!1)}updateForData(t,e,n,i=!1){this.aggregateSnapshot=t,this.aggregateRegionID!==t.region.ID&&(this.aggregateRegionID=t.region.ID,this.numDataRows=this._defaultNumRows()),this.data=null===e?[]:e,this.highlightedRegionID=null,i||this.render(n)}updateForEvaluators(t,e,n,i=!1){this.evaluators=t,this.sortEvaluator=e,null===this.sortEvaluator&&t.length>0&&(this.sortEvaluator=t.first()),i||this.render(n)}updateForSortEvaluator(t,e){null!==this.sortEvaluator&&this.sortEvaluator.equals(t)?this.descending=!this.descending:(this.sortEvaluator=t,this.descending=!0),this.render(e)}updateForHighlightedRegion(t){this.highlightedRegionID=t,this.render(!1)}render(t){if(null===this.data||0===this.evaluators.length)return;let e=this;this.tableHeaderRow.selectAll("div.data-table-cell").remove(),this.tableHeaderRow.selectAll("div.data-table-cell").data(this.evaluators,(function(t){return t.hashString()})).join((function(t){return t.append("div").attr("class","data-table-cell").html((function(t,n){if(0===n)return e._metadataSummaryHTML();return t.title.replace(" ","<br>")})).on("click",(function(t){e._didClickEvaluator(t)}))}));let n=Array.from(this.data.values()),i=this.descending?1:-1;if(null!==this.sortEvaluator){let t=this.sortEvaluator;n.sort((e,n)=>i*(t.valueForSnapshot(n)-t.valueForSnapshot(e)))}n=n.slice(0,this.numDataRows),n.unshift(this.aggregateSnapshot),n.length>0&&null===this.highlightedRegionID&&(this.highlightedRegionID=n[0].region.ID);let r=n.map(t=>t.region.ID),a=!1;if(!r.includes(this.highlightedRegionID)){let t=this.highlightedRegionID===this.aggregateSnapshot.region.ID?this.aggregateSnapshot:this.data.get(this.highlightedRegionID);n.push(t),a=!0}let o=this.evaluators;if(this.tableBody.selectAll("div.data-table-row").data(n,(function(t,n){return e._d3KeyForSnapshot(t,n,a)})).join((function(t){let n=t.append("div").attr("class",(function(t,n){return this.__key=e._d3KeyForSnapshot(t,n,a),e._classNameForRowWithSnapshot(t,a)})).on("click",(function(t){e._didClickRegion(t.region),Wi.c.preventDefault()})).on("touchstart",(function(t){let n=this;e._touchDidMove=!1,setTimeout((function(){e._touchDidMove||(n.className+=" active")}),60)})).on("touchmove",(function(t){e._touchDidMove=!0,this.className=this.className.replace(" active","")})).on("touchend",(function(t){e._touchDidMove||(e._didClickRegion(t.region),Wi.c.preventDefault()),this.className=this.className.replace(" active","")}));return o.forEach((function(t,e){n=n.append("div").attr("class","data-table-cell").html((function(e){return t.formatValueHTML(e,t.valueForSnapshot(e))})).select((function(){return this.parentNode}))})),n}),(function(t){let n=t.filter((function(t,n){let i=e._d3KeyForSnapshot(t,n,a);return i!==this.__key&&(this.__key=i,!0)}));return n=n.attr("class",(function(t){return e._classNameForRowWithSnapshot(t,a)})),n=n.selectAll("div.data-table-cell").html((function(t,e){let n=o[e];return n.formatValueHTML(t,n.valueForSnapshot(t))})),n=n.select((function(){return this.parentNode})),n}),(function(t){return t.remove()})),void 0!==this.showButton&&this.showButton.remove(),this._needsShowButton()){let t=this._isTruncatingTable()?"Show more":"Show less";this.showButton=this.tableBody.append("div").attr("class","data-table-button-row").on("click",(function(){e._didClickShowButton()})).on("touchstart",(function(t){})),this.showButton.append("div").attr("class","data-table-button-cell").text(t)}this.attribution.text(this._sourceString())}aggregateRegionType(){return null===this.aggregateSnapshot||void 0===this.aggregateSnapshot?o:this.aggregateSnapshot.region.type}childRegionType(){return this.aggregateRegionType()+1}_d3KeyForSnapshot(t,e,n){return t.dateString+"*"+e+"*"+t.region.ID+this.sortEvaluator.title+this._classNameForRowWithSnapshot(t,n)}_classNameForRowWithSnapshot(t,e=!1){let n="data-table-row";return t.region.ID===this.highlightedRegionID&&(n+=" highlighted",e&&(n+=" data-table-row-after-truncation")),n}_metadataSummaryHTML(){let t=this.aggregateSnapshot.normalizedDate(),e=Object(_.f)(t);return this.dataIsIncomplete&&(e+="<br /><i>Updated hourly</i>"),e}_sourceString(){return"Data from "+this.sortEvaluator.source}_defaultNumRows(){return 5}_needsShowButton(){return this.data.size>this._defaultNumRows()}_isTruncatingTable(){return this.numDataRows<this.data.size&&this.data.size>this._defaultNumRows()}_didClickEvaluator(t){this.updateForSortEvaluator(t,!1)}_didClickRegion(t){null!==this.onRegionClicked&&this.onRegionClicked(t.ID)}_didClickShowButton(){this._isTruncatingTable()?this.numDataRows+=this._defaultNumRows():this.numDataRows=this._defaultNumRows(),this.render(!1)}}var wa=Math.PI,ba=wa/2,Sa=wa/4,xa=2*wa,Fa=180/wa,Ca=wa/180,Ra=Math.abs,Ta=Math.atan,Ia=Math.atan2,Ma=Math.cos,ka=(Math.ceil,Math.exp,Math.floor,Math.log,Math.pow,Math.sin),Ea=Math.sign||function(t){return t>0?1:t<0?-1:0},Na=Math.sqrt;Math.tan;function Aa(t){return t>1?ba:t<-1?-ba:Math.asin(t)}function Ba(){}var Oa=function(){var t,e=[];return{point:function(e,n,i){t.push([e,n,i])},lineStart:function(){e.push(t=[])},lineEnd:Ba,rejoin:function(){e.length>1&&e.push(e.pop().concat(e.shift()))},result:function(){var n=e;return e=[],t=null,n}}},Pa=function(t,e){return Ra(t[0]-e[0])<1e-6&&Ra(t[1]-e[1])<1e-6};function Ha(t,e,n,i){this.x=t,this.z=e,this.o=n,this.e=i,this.v=!1,this.n=this.p=null}var La=function(t,e,n,i,r){var a,o,s=[],l=[];if(t.forEach((function(t){if(!((e=t.length-1)<=0)){var e,n,i=t[0],o=t[e];if(Pa(i,o)){if(!i[2]&&!o[2]){for(r.lineStart(),a=0;a<e;++a)r.point((i=t[a])[0],i[1]);return void r.lineEnd()}o[0]+=2e-6}s.push(n=new Ha(i,t,null,!0)),l.push(n.o=new Ha(i,null,n,!1)),s.push(n=new Ha(o,t,null,!1)),l.push(n.o=new Ha(o,null,n,!0))}})),s.length){for(l.sort(e),ja(s),ja(l),a=0,o=l.length;a<o;++a)l[a].e=n=!n;for(var u,h,c=s[0];;){for(var d=c,f=!0;d.v;)if((d=d.n)===c)return;u=d.z,r.lineStart();do{if(d.v=d.o.v=!0,d.e){if(f)for(a=0,o=u.length;a<o;++a)r.point((h=u[a])[0],h[1]);else i(d.x,d.n.x,1,r);d=d.n}else{if(f)for(u=d.p.z,a=u.length-1;a>=0;--a)r.point((h=u[a])[0],h[1]);else i(d.x,d.p.x,-1,r);d=d.p}u=(d=d.o).z,f=!f}while(!d.v);r.lineEnd()}}};function ja(t){if(e=t.length){for(var e,n,i=0,r=t[0];++i<e;)r.n=n=t[i],n.p=r,r=n;r.n=n=t[0],n.p=r}}var za=function(){return new Va};function Va(){this.reset()}Va.prototype={constructor:Va,reset:function(){this.s=this.t=0},add:function(t){Ua(Wa,t,this.t),Ua(this,Wa.s,this.s),this.s?this.t+=Wa.t:this.s=Wa.t},valueOf:function(){return this.s}};var Wa=new Va;function Ua(t,e,n){var i=t.s=e+n,r=i-e,a=i-r;t.t=e-a+(n-r)}function Ya(t){return[Ia(t[1],t[0]),Aa(t[2])]}function qa(t){var e=t[0],n=t[1],i=Ma(n);return[i*Ma(e),i*ka(e),ka(n)]}function Ga(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function Qa(t,e){return[t[1]*e[2]-t[2]*e[1],t[2]*e[0]-t[0]*e[2],t[0]*e[1]-t[1]*e[0]]}function Xa(t,e){t[0]+=e[0],t[1]+=e[1],t[2]+=e[2]}function Ja(t,e){return[t[0]*e,t[1]*e,t[2]*e]}function Za(t){var e=Na(t[0]*t[0]+t[1]*t[1]+t[2]*t[2]);t[0]/=e,t[1]/=e,t[2]/=e}var $a=za();function Ka(t){return Ra(t[0])<=wa?t[0]:Ea(t[0])*((Ra(t[0])+wa)%xa-wa)}var to=function(t,e){return t<e?-1:t>e?1:t>=e?0:NaN};var eo,no;1===(eo=to).length&&(no=eo,eo=function(t,e){return to(no(t),e)});var io=Array.prototype;io.slice,io.map,Math.sqrt(50),Math.sqrt(10),Math.sqrt(2);var ro=function(t){for(var e,n,i,r=t.length,a=-1,o=0;++a<r;)o+=t[a].length;for(n=new Array(o);--r>=0;)for(e=(i=t[r]).length;--e>=0;)n[--o]=i[e];return n};var ao=function(t,e,n,i){return function(r){var a,o,s,l=e(r),u=Oa(),h=e(u),c=!1,d={point:f,lineStart:g,lineEnd:m,polygonStart:function(){d.point=v,d.lineStart=y,d.lineEnd=_,o=[],a=[]},polygonEnd:function(){d.point=f,d.lineStart=g,d.lineEnd=m,o=ro(o);var t=function(t,e){var n=Ka(e),i=e[1],r=ka(i),a=[ka(n),-Ma(n),0],o=0,s=0;$a.reset(),1===r?i=ba+1e-6:-1===r&&(i=-ba-1e-6);for(var l=0,u=t.length;l<u;++l)if(c=(h=t[l]).length)for(var h,c,d=h[c-1],f=Ka(d),p=d[1]/2+Sa,g=ka(p),m=Ma(p),v=0;v<c;++v,f=_,g=w,m=b,d=y){var y=h[v],_=Ka(y),D=y[1]/2+Sa,w=ka(D),b=Ma(D),S=_-f,x=S>=0?1:-1,F=x*S,C=F>wa,R=g*w;if($a.add(Ia(R*x*ka(F),m*b+R*Ma(F))),o+=C?S+x*xa:S,C^f>=n^_>=n){var T=Qa(qa(d),qa(y));Za(T);var I=Qa(a,T);Za(I);var M=(C^S>=0?-1:1)*Aa(I[2]);(i>M||i===M&&(T[0]||T[1]))&&(s+=C^S>=0?1:-1)}}return(o<-1e-6||o<1e-6&&$a<-1e-6)^1&s}(a,i);o.length?(c||(r.polygonStart(),c=!0),La(o,so,t,n,r)):t&&(c||(r.polygonStart(),c=!0),r.lineStart(),n(null,null,1,r),r.lineEnd()),c&&(r.polygonEnd(),c=!1),o=a=null},sphere:function(){r.polygonStart(),r.lineStart(),n(null,null,1,r),r.lineEnd(),r.polygonEnd()}};function f(e,n){t(e,n)&&r.point(e,n)}function p(t,e){l.point(t,e)}function g(){d.point=p,l.lineStart()}function m(){d.point=f,l.lineEnd()}function v(t,e){s.push([t,e]),h.point(t,e)}function y(){h.lineStart(),s=[]}function _(){v(s[0][0],s[0][1]),h.lineEnd();var t,e,n,i,l=h.clean(),d=u.result(),f=d.length;if(s.pop(),a.push(s),s=null,f)if(1&l){if((e=(n=d[0]).length-1)>0){for(c||(r.polygonStart(),c=!0),r.lineStart(),t=0;t<e;++t)r.point((i=n[t])[0],i[1]);r.lineEnd()}}else f>1&&2&l&&d.push(d.pop().concat(d.shift())),o.push(d.filter(oo))}return d}};function oo(t){return t.length>1}function so(t,e){return((t=t.x)[0]<0?t[1]-ba-1e-6:ba-t[1])-((e=e.x)[0]<0?e[1]-ba-1e-6:ba-e[1])}var lo=ao((function(){return!0}),(function(t){var e,n=NaN,i=NaN,r=NaN;return{lineStart:function(){t.lineStart(),e=1},point:function(a,o){var s=a>0?wa:-wa,l=Ra(a-n);Ra(l-wa)<1e-6?(t.point(n,i=(i+o)/2>0?ba:-ba),t.point(r,i),t.lineEnd(),t.lineStart(),t.point(s,i),t.point(a,i),e=0):r!==s&&l>=wa&&(Ra(n-r)<1e-6&&(n-=1e-6*r),Ra(a-s)<1e-6&&(a-=1e-6*s),i=function(t,e,n,i){var r,a,o=ka(t-n);return Ra(o)>1e-6?Ta((ka(e)*(a=Ma(i))*ka(n)-ka(i)*(r=Ma(e))*ka(t))/(r*a*o)):(e+i)/2}(n,i,a,o),t.point(r,i),t.lineEnd(),t.lineStart(),t.point(s,i),e=0),t.point(n=a,i=o),r=s},lineEnd:function(){t.lineEnd(),n=i=NaN},clean:function(){return 2-e}}}),(function(t,e,n,i){var r;if(null==t)r=n*ba,i.point(-wa,r),i.point(0,r),i.point(wa,r),i.point(wa,0),i.point(wa,-r),i.point(0,-r),i.point(-wa,-r),i.point(-wa,0),i.point(-wa,r);else if(Ra(t[0]-e[0])>1e-6){var a=t[0]<e[0]?wa:-wa;r=n*a/2,i.point(-a,r),i.point(0,r),i.point(a,r)}else i.point(e[0],e[1])}),[-wa,-ba]);var uo=function(t,e){function n(n,i){return n=t(n,i),e(n[0],n[1])}return t.invert&&e.invert&&(n.invert=function(n,i){return(n=e.invert(n,i))&&t.invert(n[0],n[1])}),n};function ho(t,e){return[Ra(t)>wa?t+Math.round(-t/xa)*xa:t,e]}function co(t,e,n){return(t%=xa)?e||n?uo(po(t),go(e,n)):po(t):e||n?go(e,n):ho}function fo(t){return function(e,n){return[(e+=t)>wa?e-xa:e<-wa?e+xa:e,n]}}function po(t){var e=fo(t);return e.invert=fo(-t),e}function go(t,e){var n=Ma(t),i=ka(t),r=Ma(e),a=ka(e);function o(t,e){var o=Ma(e),s=Ma(t)*o,l=ka(t)*o,u=ka(e),h=u*n+s*i;return[Ia(l*r-h*a,s*n-u*i),Aa(h*r+l*a)]}return o.invert=function(t,e){var o=Ma(e),s=Ma(t)*o,l=ka(t)*o,u=ka(e),h=u*r-l*a;return[Ia(l*r+u*a,s*n+h*i),Aa(h*n-s*i)]},o}ho.invert=ho;function mo(t,e,n,i,r,a){if(n){var o=Ma(e),s=ka(e),l=i*n;null==r?(r=e+i*xa,a=e-l/2):(r=vo(o,r),a=vo(o,a),(i>0?r<a:r>a)&&(r+=i*xa));for(var u,h=r;i>0?h>a:h<a;h-=l)u=Ya([o,-s*Ma(h),-s*ka(h)]),t.point(u[0],u[1])}}function vo(t,e){(e=qa(e))[0]-=t,Za(e);var n,i=(n=-e[1])>1?0:n<-1?wa:Math.acos(n);return((-e[2]<0?-i:i)+xa-1e-6)%xa}var yo=function(t){var e=Ma(t),n=6*Ca,i=e>0,r=Ra(e)>1e-6;function a(t,n){return Ma(t)*Ma(n)>e}function o(t,n,i){var r=[1,0,0],a=Qa(qa(t),qa(n)),o=Ga(a,a),s=a[0],l=o-s*s;if(!l)return!i&&t;var u=e*o/l,h=-e*s/l,c=Qa(r,a),d=Ja(r,u);Xa(d,Ja(a,h));var f=c,p=Ga(d,f),g=Ga(f,f),m=p*p-g*(Ga(d,d)-1);if(!(m<0)){var v=Na(m),y=Ja(f,(-p-v)/g);if(Xa(y,d),y=Ya(y),!i)return y;var _,D=t[0],w=n[0],b=t[1],S=n[1];w<D&&(_=D,D=w,w=_);var x=w-D,F=Ra(x-wa)<1e-6;if(!F&&S<b&&(_=b,b=S,S=_),F||x<1e-6?F?b+S>0^y[1]<(Ra(y[0]-D)<1e-6?b:S):b<=y[1]&&y[1]<=S:x>wa^(D<=y[0]&&y[0]<=w)){var C=Ja(f,(-p+v)/g);return Xa(C,d),[y,Ya(C)]}}}function s(e,n){var r=i?t:wa-t,a=0;return e<-r?a|=1:e>r&&(a|=2),n<-r?a|=4:n>r&&(a|=8),a}return ao(a,(function(t){var e,n,l,u,h;return{lineStart:function(){u=l=!1,h=1},point:function(c,d){var f,p=[c,d],g=a(c,d),m=i?g?0:s(c,d):g?s(c+(c<0?wa:-wa),d):0;if(!e&&(u=l=g)&&t.lineStart(),g!==l&&(!(f=o(e,p))||Pa(e,f)||Pa(p,f))&&(p[2]=1),g!==l)h=0,g?(t.lineStart(),f=o(p,e),t.point(f[0],f[1])):(f=o(e,p),t.point(f[0],f[1],2),t.lineEnd()),e=f;else if(r&&e&&i^g){var v;m&n||!(v=o(p,e,!0))||(h=0,i?(t.lineStart(),t.point(v[0][0],v[0][1]),t.point(v[1][0],v[1][1]),t.lineEnd()):(t.point(v[1][0],v[1][1]),t.lineEnd(),t.lineStart(),t.point(v[0][0],v[0][1],3)))}!g||e&&Pa(e,p)||t.point(p[0],p[1]),e=p,l=g,n=m},lineEnd:function(){l&&t.lineEnd(),e=null},clean:function(){return h|(u&&l)<<1}}}),(function(e,i,r,a){mo(a,t,n,r,e,i)}),i?[0,-t]:[-wa,t-wa])};function _o(t,e,n,i){function r(r,a){return t<=r&&r<=n&&e<=a&&a<=i}function a(r,a,s,u){var h=0,c=0;if(null==r||(h=o(r,s))!==(c=o(a,s))||l(r,a)<0^s>0)do{u.point(0===h||3===h?t:n,h>1?i:e)}while((h=(h+s+4)%4)!==c);else u.point(a[0],a[1])}function o(i,r){return Ra(i[0]-t)<1e-6?r>0?0:3:Ra(i[0]-n)<1e-6?r>0?2:1:Ra(i[1]-e)<1e-6?r>0?1:0:r>0?3:2}function s(t,e){return l(t.x,e.x)}function l(t,e){var n=o(t,1),i=o(e,1);return n!==i?n-i:0===n?e[1]-t[1]:1===n?t[0]-e[0]:2===n?t[1]-e[1]:e[0]-t[0]}return function(o){var l,u,h,c,d,f,p,g,m,v,y,_=o,D=Oa(),w={point:b,lineStart:function(){w.point=S,u&&u.push(h=[]);v=!0,m=!1,p=g=NaN},lineEnd:function(){l&&(S(c,d),f&&m&&D.rejoin(),l.push(D.result()));w.point=b,m&&_.lineEnd()},polygonStart:function(){_=D,l=[],u=[],y=!0},polygonEnd:function(){var e=function(){for(var e=0,n=0,r=u.length;n<r;++n)for(var a,o,s=u[n],l=1,h=s.length,c=s[0],d=c[0],f=c[1];l<h;++l)a=d,o=f,c=s[l],d=c[0],f=c[1],o<=i?f>i&&(d-a)*(i-o)>(f-o)*(t-a)&&++e:f<=i&&(d-a)*(i-o)<(f-o)*(t-a)&&--e;return e}(),n=y&&e,r=(l=ro(l)).length;(n||r)&&(o.polygonStart(),n&&(o.lineStart(),a(null,null,1,o),o.lineEnd()),r&&La(l,s,e,a,o),o.polygonEnd());_=o,l=u=h=null}};function b(t,e){r(t,e)&&_.point(t,e)}function S(a,o){var s=r(a,o);if(u&&h.push([a,o]),v)c=a,d=o,f=s,v=!1,s&&(_.lineStart(),_.point(a,o));else if(s&&m)_.point(a,o);else{var l=[p=Math.max(-1e9,Math.min(1e9,p)),g=Math.max(-1e9,Math.min(1e9,g))],D=[a=Math.max(-1e9,Math.min(1e9,a)),o=Math.max(-1e9,Math.min(1e9,o))];!function(t,e,n,i,r,a){var o,s=t[0],l=t[1],u=0,h=1,c=e[0]-s,d=e[1]-l;if(o=n-s,c||!(o>0)){if(o/=c,c<0){if(o<u)return;o<h&&(h=o)}else if(c>0){if(o>h)return;o>u&&(u=o)}if(o=r-s,c||!(o<0)){if(o/=c,c<0){if(o>h)return;o>u&&(u=o)}else if(c>0){if(o<u)return;o<h&&(h=o)}if(o=i-l,d||!(o>0)){if(o/=d,d<0){if(o<u)return;o<h&&(h=o)}else if(d>0){if(o>h)return;o>u&&(u=o)}if(o=a-l,d||!(o<0)){if(o/=d,d<0){if(o>h)return;o>u&&(u=o)}else if(d>0){if(o<u)return;o<h&&(h=o)}return u>0&&(t[0]=s+u*c,t[1]=l+u*d),h<1&&(e[0]=s+h*c,e[1]=l+h*d),!0}}}}}(l,D,t,e,n,i)?s&&(_.lineStart(),_.point(a,o),y=!1):(m||(_.lineStart(),_.point(l[0],l[1])),_.point(D[0],D[1]),s||_.lineEnd(),y=!1)}p=a,g=o,m=s}return w}}var Do=function(t){return t};function wo(t){return function(e){var n=new bo;for(var i in t)n[i]=t[i];return n.stream=e,n}}function bo(){}function So(t,e){t&&Fo.hasOwnProperty(t.type)&&Fo[t.type](t,e)}bo.prototype={constructor:bo,point:function(t,e){this.stream.point(t,e)},sphere:function(){this.stream.sphere()},lineStart:function(){this.stream.lineStart()},lineEnd:function(){this.stream.lineEnd()},polygonStart:function(){this.stream.polygonStart()},polygonEnd:function(){this.stream.polygonEnd()}};var xo={Feature:function(t,e){So(t.geometry,e)},FeatureCollection:function(t,e){for(var n=t.features,i=-1,r=n.length;++i<r;)So(n[i].geometry,e)}},Fo={Sphere:function(t,e){e.sphere()},Point:function(t,e){t=t.coordinates,e.point(t[0],t[1],t[2])},MultiPoint:function(t,e){for(var n=t.coordinates,i=-1,r=n.length;++i<r;)t=n[i],e.point(t[0],t[1],t[2])},LineString:function(t,e){Co(t.coordinates,e,0)},MultiLineString:function(t,e){for(var n=t.coordinates,i=-1,r=n.length;++i<r;)Co(n[i],e,0)},Polygon:function(t,e){Ro(t.coordinates,e)},MultiPolygon:function(t,e){for(var n=t.coordinates,i=-1,r=n.length;++i<r;)Ro(n[i],e)},GeometryCollection:function(t,e){for(var n=t.geometries,i=-1,r=n.length;++i<r;)So(n[i],e)}};function Co(t,e,n){var i,r=-1,a=t.length-n;for(e.lineStart();++r<a;)i=t[r],e.point(i[0],i[1],i[2]);e.lineEnd()}function Ro(t,e){var n=-1,i=t.length;for(e.polygonStart();++n<i;)Co(t[n],e,1);e.polygonEnd()}var To=function(t,e){t&&xo.hasOwnProperty(t.type)?xo[t.type](t,e):So(t,e)},Io=1/0,Mo=Io,ko=-Io,Eo=ko;var No={point:function(t,e){t<Io&&(Io=t);t>ko&&(ko=t);e<Mo&&(Mo=e);e>Eo&&(Eo=e)},lineStart:Ba,lineEnd:Ba,polygonStart:Ba,polygonEnd:Ba,result:function(){var t=[[Io,Mo],[ko,Eo]];return ko=Eo=-(Mo=Io=1/0),t}};function Ao(t,e,n){var i=t.clipExtent&&t.clipExtent();return t.scale(150).translate([0,0]),null!=i&&t.clipExtent(null),To(n,t.stream(No)),e(No.result()),null!=i&&t.clipExtent(i),t}function Bo(t,e,n){return Ao(t,(function(n){var i=e[1][0]-e[0][0],r=e[1][1]-e[0][1],a=Math.min(i/(n[1][0]-n[0][0]),r/(n[1][1]-n[0][1])),o=+e[0][0]+(i-a*(n[1][0]+n[0][0]))/2,s=+e[0][1]+(r-a*(n[1][1]+n[0][1]))/2;t.scale(150*a).translate([o,s])}),n)}var Oo=Ma(30*Ca),Po=function(t,e){return+e?function(t,e){function n(i,r,a,o,s,l,u,h,c,d,f,p,g,m){var v=u-i,y=h-r,_=v*v+y*y;if(_>4*e&&g--){var D=o+d,w=s+f,b=l+p,S=Na(D*D+w*w+b*b),x=Aa(b/=S),F=Ra(Ra(b)-1)<1e-6||Ra(a-c)<1e-6?(a+c)/2:Ia(w,D),C=t(F,x),R=C[0],T=C[1],I=R-i,M=T-r,k=y*I-v*M;(k*k/_>e||Ra((v*I+y*M)/_-.5)>.3||o*d+s*f+l*p<Oo)&&(n(i,r,a,o,s,l,R,T,F,D/=S,w/=S,b,g,m),m.point(R,T),n(R,T,F,D,w,b,u,h,c,d,f,p,g,m))}}return function(e){var i,r,a,o,s,l,u,h,c,d,f,p,g={point:m,lineStart:v,lineEnd:_,polygonStart:function(){e.polygonStart(),g.lineStart=D},polygonEnd:function(){e.polygonEnd(),g.lineStart=v}};function m(n,i){n=t(n,i),e.point(n[0],n[1])}function v(){h=NaN,g.point=y,e.lineStart()}function y(i,r){var a=qa([i,r]),o=t(i,r);n(h,c,u,d,f,p,h=o[0],c=o[1],u=i,d=a[0],f=a[1],p=a[2],16,e),e.point(h,c)}function _(){g.point=m,e.lineEnd()}function D(){v(),g.point=w,g.lineEnd=b}function w(t,e){y(i=t,e),r=h,a=c,o=d,s=f,l=p,g.point=y}function b(){n(h,c,u,d,f,p,r,a,i,o,s,l,16,e),g.lineEnd=_,_()}return g}}(t,e):function(t){return wo({point:function(e,n){e=t(e,n),this.stream.point(e[0],e[1])}})}(t)};var Ho=wo({point:function(t,e){this.stream.point(t*Ca,e*Ca)}});function Lo(t,e,n,i,r){function a(a,o){return[e+t*(a*=i),n-t*(o*=r)]}return a.invert=function(a,o){return[(a-e)/t*i,(n-o)/t*r]},a}function jo(t,e,n,i,r,a){var o=Ma(a),s=ka(a),l=o*t,u=s*t,h=o/t,c=s/t,d=(s*n-o*e)/t,f=(s*e+o*n)/t;function p(t,a){return[l*(t*=i)-u*(a*=r)+e,n-u*t-l*a]}return p.invert=function(t,e){return[i*(h*t-c*e+d),r*(f-c*t-h*e)]},p}function zo(t){var e,n,i,r,a,o,s,l,u,h,c=150,d=480,f=250,p=0,g=0,m=0,v=0,y=0,_=0,D=1,w=1,b=null,S=lo,x=null,F=Do,C=.5;function R(t){return l(t[0]*Ca,t[1]*Ca)}function T(t){return(t=l.invert(t[0],t[1]))&&[t[0]*Fa,t[1]*Fa]}function I(){var t=jo(c,0,0,D,w,_).apply(null,e(p,g)),i=(_?jo:Lo)(c,d-t[0],f-t[1],D,w,_);return n=co(m,v,y),s=uo(e,i),l=uo(n,s),o=Po(s,C),M()}function M(){return u=h=null,R}return R.stream=function(t){return u&&h===t?u:u=Ho(function(t){return wo({point:function(e,n){var i=t(e,n);return this.stream.point(i[0],i[1])}})}(n)(S(o(F(h=t)))))},R.preclip=function(t){return arguments.length?(S=t,b=void 0,M()):S},R.postclip=function(t){return arguments.length?(F=t,x=i=r=a=null,M()):F},R.clipAngle=function(t){return arguments.length?(S=+t?yo(b=t*Ca):(b=null,lo),M()):b*Fa},R.clipExtent=function(t){return arguments.length?(F=null==t?(x=i=r=a=null,Do):_o(x=+t[0][0],i=+t[0][1],r=+t[1][0],a=+t[1][1]),M()):null==x?null:[[x,i],[r,a]]},R.scale=function(t){return arguments.length?(c=+t,I()):c},R.translate=function(t){return arguments.length?(d=+t[0],f=+t[1],I()):[d,f]},R.center=function(t){return arguments.length?(p=t[0]%360*Ca,g=t[1]%360*Ca,I()):[p*Fa,g*Fa]},R.rotate=function(t){return arguments.length?(m=t[0]%360*Ca,v=t[1]%360*Ca,y=t.length>2?t[2]%360*Ca:0,I()):[m*Fa,v*Fa,y*Fa]},R.angle=function(t){return arguments.length?(_=t%360*Ca,I()):_*Fa},R.reflectX=function(t){return arguments.length?(D=t?-1:1,I()):D<0},R.reflectY=function(t){return arguments.length?(w=t?-1:1,I()):w<0},R.precision=function(t){return arguments.length?(o=Po(s,C=t*t),M()):Na(C)},R.fitExtent=function(t,e){return Bo(R,t,e)},R.fitSize=function(t,e){return function(t,e,n){return Bo(t,[[0,0],e],n)}(R,t,e)},R.fitWidth=function(t,e){return function(t,e,n){return Ao(t,(function(n){var i=+e,r=i/(n[1][0]-n[0][0]),a=(i-r*(n[1][0]+n[0][0]))/2,o=-r*n[0][1];t.scale(150*r).translate([a,o])}),n)}(R,t,e)},R.fitHeight=function(t,e){return function(t,e,n){return Ao(t,(function(n){var i=+e,r=i/(n[1][1]-n[0][1]),a=-r*n[0][0],o=(i-r*(n[1][1]+n[0][1]))/2;t.scale(150*r).translate([a,o])}),n)}(R,t,e)},function(){return e=t.apply(this,arguments),R.invert=e.invert&&T,I()}}function Vo(t,e){var n=ka(t),i=(n+ka(e))/2;if(Ra(i)<1e-6)return function(t){var e=Ma(t);function n(t,n){return[t*e,ka(n)/e]}return n.invert=function(t,n){return[t/e,Aa(n*e)]},n}(t);var r=1+n*(2*i-n),a=Na(r)/i;function o(t,e){var n=Na(r-2*i*ka(e))/i;return[n*ka(t*=i),a-n*Ma(t)]}return o.invert=function(t,e){var n=a-e,o=Ia(t,Ra(n))*Ea(n);return n*i<0&&(o-=wa*Ea(t)*Ea(n)),[o/i,Aa((r-(t*t+n*n)*i*i)/(2*i))]},o}var Wo,Uo,Yo,qo,Go=function(){return(t=Vo,e=0,n=wa/3,i=zo(t),r=i(e,n),r.parallels=function(t){return arguments.length?i(e=t[0]*Ca,n=t[1]*Ca):[e*Fa,n*Fa]},r).scale(155.424).center([0,33.6442]);var t,e,n,i,r},Qo=za(),Xo=za(),Jo={point:Ba,lineStart:Ba,lineEnd:Ba,polygonStart:function(){Jo.lineStart=Zo,Jo.lineEnd=ts},polygonEnd:function(){Jo.lineStart=Jo.lineEnd=Jo.point=Ba,Qo.add(Ra(Xo)),Xo.reset()},result:function(){var t=Qo/2;return Qo.reset(),t}};function Zo(){Jo.point=$o}function $o(t,e){Jo.point=Ko,Wo=Yo=t,Uo=qo=e}function Ko(t,e){Xo.add(qo*t-Yo*e),Yo=t,qo=e}function ts(){Ko(Wo,Uo)}var es,ns,is,rs,as=Jo,os=0,ss=0,ls=0,us=0,hs=0,cs=0,ds=0,fs=0,ps=0,gs={point:ms,lineStart:vs,lineEnd:Ds,polygonStart:function(){gs.lineStart=ws,gs.lineEnd=bs},polygonEnd:function(){gs.point=ms,gs.lineStart=vs,gs.lineEnd=Ds},result:function(){var t=ps?[ds/ps,fs/ps]:cs?[us/cs,hs/cs]:ls?[os/ls,ss/ls]:[NaN,NaN];return os=ss=ls=us=hs=cs=ds=fs=ps=0,t}};function ms(t,e){os+=t,ss+=e,++ls}function vs(){gs.point=ys}function ys(t,e){gs.point=_s,ms(is=t,rs=e)}function _s(t,e){var n=t-is,i=e-rs,r=Na(n*n+i*i);us+=r*(is+t)/2,hs+=r*(rs+e)/2,cs+=r,ms(is=t,rs=e)}function Ds(){gs.point=ms}function ws(){gs.point=Ss}function bs(){xs(es,ns)}function Ss(t,e){gs.point=xs,ms(es=is=t,ns=rs=e)}function xs(t,e){var n=t-is,i=e-rs,r=Na(n*n+i*i);us+=r*(is+t)/2,hs+=r*(rs+e)/2,cs+=r,ds+=(r=rs*t-is*e)*(is+t),fs+=r*(rs+e),ps+=3*r,ms(is=t,rs=e)}var Fs=gs;function Cs(t){this._context=t}Cs.prototype={_radius:4.5,pointRadius:function(t){return this._radius=t,this},polygonStart:function(){this._line=0},polygonEnd:function(){this._line=NaN},lineStart:function(){this._point=0},lineEnd:function(){0===this._line&&this._context.closePath(),this._point=NaN},point:function(t,e){switch(this._point){case 0:this._context.moveTo(t,e),this._point=1;break;case 1:this._context.lineTo(t,e);break;default:this._context.moveTo(t+this._radius,e),this._context.arc(t,e,this._radius,0,xa)}},result:Ba};var Rs,Ts,Is,Ms,ks,Es=za(),Ns={point:Ba,lineStart:function(){Ns.point=As},lineEnd:function(){Rs&&Bs(Ts,Is),Ns.point=Ba},polygonStart:function(){Rs=!0},polygonEnd:function(){Rs=null},result:function(){var t=+Es;return Es.reset(),t}};function As(t,e){Ns.point=Bs,Ts=Ms=t,Is=ks=e}function Bs(t,e){Ms-=t,ks-=e,Es.add(Na(Ms*Ms+ks*ks)),Ms=t,ks=e}var Os=Ns;function Ps(){this._string=[]}function Hs(t){return"m0,"+t+"a"+t+","+t+" 0 1,1 0,"+-2*t+"a"+t+","+t+" 0 1,1 0,"+2*t+"z"}Ps.prototype={_radius:4.5,_circle:Hs(4.5),pointRadius:function(t){return(t=+t)!==this._radius&&(this._radius=t,this._circle=null),this},polygonStart:function(){this._line=0},polygonEnd:function(){this._line=NaN},lineStart:function(){this._point=0},lineEnd:function(){0===this._line&&this._string.push("Z"),this._point=NaN},point:function(t,e){switch(this._point){case 0:this._string.push("M",t,",",e),this._point=1;break;case 1:this._string.push("L",t,",",e);break;default:null==this._circle&&(this._circle=Hs(this._radius)),this._string.push("M",t,",",e,this._circle)}},result:function(){if(this._string.length){var t=this._string.join("");return this._string=[],t}return null}};var Ls={value:function(){}};function js(){for(var t,e=0,n=arguments.length,i={};e<n;++e){if(!(t=arguments[e]+"")||t in i||/[\s.]/.test(t))throw new Error("illegal type: "+t);i[t]=[]}return new zs(i)}function zs(t){this._=t}function Vs(t,e){return t.trim().split(/^|\s+/).map((function(t){var n="",i=t.indexOf(".");if(i>=0&&(n=t.slice(i+1),t=t.slice(0,i)),t&&!e.hasOwnProperty(t))throw new Error("unknown type: "+t);return{type:t,name:n}}))}function Ws(t,e){for(var n,i=0,r=t.length;i<r;++i)if((n=t[i]).name===e)return n.value}function Us(t,e,n){for(var i=0,r=t.length;i<r;++i)if(t[i].name===e){t[i]=Ls,t=t.slice(0,i).concat(t.slice(i+1));break}return null!=n&&t.push({name:e,value:n}),t}zs.prototype=js.prototype={constructor:zs,on:function(t,e){var n,i=this._,r=Vs(t+"",i),a=-1,o=r.length;if(!(arguments.length<2)){if(null!=e&&"function"!=typeof e)throw new Error("invalid callback: "+e);for(;++a<o;)if(n=(t=r[a]).type)i[n]=Us(i[n],t.name,e);else if(null==e)for(n in i)i[n]=Us(i[n],t.name,null);return this}for(;++a<o;)if((n=(t=r[a]).type)&&(n=Ws(i[n],t.name)))return n},copy:function(){var t={},e=this._;for(var n in e)t[n]=e[n].slice();return new zs(t)},call:function(t,e){if((n=arguments.length-2)>0)for(var n,i,r=new Array(n),a=0;a<n;++a)r[a]=arguments[a+2];if(!this._.hasOwnProperty(t))throw new Error("unknown type: "+t);for(a=0,n=(i=this._[t]).length;a<n;++a)i[a].value.apply(e,r)},apply:function(t,e,n){if(!this._.hasOwnProperty(t))throw new Error("unknown type: "+t);for(var i=this._[t],r=0,a=i.length;r<a;++r)i[r].value.apply(e,n)}};var Ys=js;var qs=function(){Wi.c.preventDefault(),Wi.c.stopImmediatePropagation()},Gs=function(t){var e=t.document.documentElement,n=Object(a.a)(t).on("dragstart.drag",qs,!0);"onselectstart"in e?n.on("selectstart.drag",qs,!0):(e.__noselect=e.style.MozUserSelect,e.style.MozUserSelect="none")};function Qs(t,e){var n=t.document.documentElement,i=Object(a.a)(t).on("dragstart.drag",null);e&&(i.on("click.drag",qs,!0),setTimeout((function(){i.on("click.drag",null)}),0)),"onselectstart"in n?i.on("selectstart.drag",null):(n.style.MozUserSelect=n.__noselect,delete n.__noselect)}var Xs=Math.SQRT2;function Js(t){return((t=Math.exp(t))+1/t)/2}var Zs,$s,Ks=function(t,e){var n,i,r=t[0],a=t[1],o=t[2],s=e[0],l=e[1],u=e[2],h=s-r,c=l-a,d=h*h+c*c;if(d<1e-12)i=Math.log(u/o)/Xs,n=function(t){return[r+t*h,a+t*c,o*Math.exp(Xs*t*i)]};else{var f=Math.sqrt(d),p=(u*u-o*o+4*d)/(2*o*2*f),g=(u*u-o*o-4*d)/(2*u*2*f),m=Math.log(Math.sqrt(p*p+1)-p),v=Math.log(Math.sqrt(g*g+1)-g);i=(v-m)/Xs,n=function(t){var e,n=t*i,s=Js(m),l=o/(2*f)*(s*(e=Xs*n+m,((e=Math.exp(2*e))-1)/(e+1))-function(t){return((t=Math.exp(t))-1/t)/2}(m));return[r+l*h,a+l*c,o*s/Js(Xs*n+m)]}}return n.duration=1e3*i,n},tl=function(t,e,n){arguments.length<3&&(n=e,e=Ui().changedTouches);for(var i,r=0,a=e?e.length:0;r<a;++r)if((i=e[r]).identifier===n)return Yi(t,i);return null},el=n(3),nl=0,il=0,rl=0,al=0,ol=0,sl=0,ll="object"==typeof performance&&performance.now?performance:Date,ul="object"==typeof window&&window.requestAnimationFrame?window.requestAnimationFrame.bind(window):function(t){setTimeout(t,17)};function hl(){return ol||(ul(cl),ol=ll.now()+sl)}function cl(){ol=0}function dl(){this._call=this._time=this._next=null}function fl(t,e,n){var i=new dl;return i.restart(t,e,n),i}function pl(){ol=(al=ll.now())+sl,nl=il=0;try{!function(){hl(),++nl;for(var t,e=Zs;e;)(t=ol-e._time)>=0&&e._call.call(null,t),e=e._next;--nl}()}finally{nl=0,function(){var t,e,n=Zs,i=1/0;for(;n;)n._call?(i>n._time&&(i=n._time),t=n,n=n._next):(e=n._next,n._next=null,n=t?t._next=e:Zs=e);$s=t,ml(i)}(),ol=0}}function gl(){var t=ll.now(),e=t-al;e>1e3&&(sl-=e,al=t)}function ml(t){nl||(il&&(il=clearTimeout(il)),t-ol>24?(t<1/0&&(il=setTimeout(pl,t-ll.now()-sl)),rl&&(rl=clearInterval(rl))):(rl||(al=ll.now(),rl=setInterval(gl,1e3)),nl=1,ul(pl)))}dl.prototype=fl.prototype={constructor:dl,restart:function(t,e,n){if("function"!=typeof t)throw new TypeError("callback is not a function");n=(null==n?hl():+n)+(null==e?0:+e),this._next||$s===this||($s?$s._next=this:Zs=this,$s=this),this._call=t,this._time=n,ml()},stop:function(){this._call&&(this._call=null,this._time=1/0,ml())}};var vl=function(t,e,n){var i=new dl;return e=null==e?0:+e,i.restart((function(n){i.stop(),t(n+e)}),e,n),i},yl=Ys("start","end","cancel","interrupt"),_l=[],Dl=function(t,e,n,i,r,a){var o=t.__transition;if(o){if(n in o)return}else t.__transition={};!function(t,e,n){var i,r=t.__transition;function a(l){var u,h,c,d;if(1!==n.state)return s();for(u in r)if((d=r[u]).name===n.name){if(3===d.state)return vl(a);4===d.state?(d.state=6,d.timer.stop(),d.on.call("interrupt",t,t.__data__,d.index,d.group),delete r[u]):+u<e&&(d.state=6,d.timer.stop(),d.on.call("cancel",t,t.__data__,d.index,d.group),delete r[u])}if(vl((function(){3===n.state&&(n.state=4,n.timer.restart(o,n.delay,n.time),o(l))})),n.state=2,n.on.call("start",t,t.__data__,n.index,n.group),2===n.state){for(n.state=3,i=new Array(c=n.tween.length),u=0,h=-1;u<c;++u)(d=n.tween[u].value.call(t,t.__data__,n.index,n.group))&&(i[++h]=d);i.length=h+1}}function o(e){for(var r=e<n.duration?n.ease.call(null,e/n.duration):(n.timer.restart(s),n.state=5,1),a=-1,o=i.length;++a<o;)i[a].call(t,r);5===n.state&&(n.on.call("end",t,t.__data__,n.index,n.group),s())}function s(){for(var i in n.state=6,n.timer.stop(),delete r[e],r)return;delete t.__transition}r[e]=n,n.timer=fl((function(t){n.state=1,n.timer.restart(a,n.delay,n.time),n.delay<=t&&a(t-n.delay)}),0,n.time)}(t,n,{name:e,index:i,group:r,on:yl,tween:_l,time:a.time,delay:a.delay,duration:a.duration,ease:a.ease,timer:null,state:0})};function wl(t,e){var n=Sl(t,e);if(n.state>0)throw new Error("too late; already scheduled");return n}function bl(t,e){var n=Sl(t,e);if(n.state>3)throw new Error("too late; already running");return n}function Sl(t,e){var n=t.__transition;if(!n||!(n=n[e]))throw new Error("transition not found");return n}var xl,Fl,Cl,Rl,Tl=function(t,e){var n,i,r,a=t.__transition,o=!0;if(a){for(r in e=null==e?null:e+"",a)(n=a[r]).name===e?(i=n.state>2&&n.state<5,n.state=6,n.timer.stop(),n.on.call(i?"interrupt":"cancel",t,t.__data__,n.index,n.group),delete a[r]):o=!1;o&&delete t.__transition}},Il=180/Math.PI,Ml={translateX:0,translateY:0,rotate:0,skewX:0,scaleX:1,scaleY:1},kl=function(t,e,n,i,r,a){var o,s,l;return(o=Math.sqrt(t*t+e*e))&&(t/=o,e/=o),(l=t*n+e*i)&&(n-=t*l,i-=e*l),(s=Math.sqrt(n*n+i*i))&&(n/=s,i/=s,l/=s),t*i<e*n&&(t=-t,e=-e,l=-l,o=-o),{translateX:r,translateY:a,rotate:Math.atan2(e,t)*Il,skewX:Math.atan(l)*Il,scaleX:o,scaleY:s}};function El(t,e,n,i){function r(t){return t.length?t.pop()+" ":""}return function(a,o){var s=[],l=[];return a=t(a),o=t(o),function(t,i,r,a,o,s){if(t!==r||i!==a){var l=o.push("translate(",null,e,null,n);s.push({i:l-4,x:le(t,r)},{i:l-2,x:le(i,a)})}else(r||a)&&o.push("translate("+r+e+a+n)}(a.translateX,a.translateY,o.translateX,o.translateY,s,l),function(t,e,n,a){t!==e?(t-e>180?e+=360:e-t>180&&(t+=360),a.push({i:n.push(r(n)+"rotate(",null,i)-2,x:le(t,e)})):e&&n.push(r(n)+"rotate("+e+i)}(a.rotate,o.rotate,s,l),function(t,e,n,a){t!==e?a.push({i:n.push(r(n)+"skewX(",null,i)-2,x:le(t,e)}):e&&n.push(r(n)+"skewX("+e+i)}(a.skewX,o.skewX,s,l),function(t,e,n,i,a,o){if(t!==n||e!==i){var s=a.push(r(a)+"scale(",null,",",null,")");o.push({i:s-4,x:le(t,n)},{i:s-2,x:le(e,i)})}else 1===n&&1===i||a.push(r(a)+"scale("+n+","+i+")")}(a.scaleX,a.scaleY,o.scaleX,o.scaleY,s,l),a=o=null,function(t){for(var e,n=-1,i=l.length;++n<i;)s[(e=l[n]).i]=e.x(t);return s.join("")}}}var Nl=El((function(t){return"none"===t?Ml:(xl||(xl=document.createElement("DIV"),Fl=document.documentElement,Cl=document.defaultView),xl.style.transform=t,t=Cl.getComputedStyle(Fl.appendChild(xl),null).getPropertyValue("transform"),Fl.removeChild(xl),t=t.slice(7,-1).split(","),kl(+t[0],+t[1],+t[2],+t[3],+t[4],+t[5]))}),"px, ","px)","deg)"),Al=El((function(t){return null==t?Ml:(Rl||(Rl=document.createElementNS("http://www.w3.org/2000/svg","g")),Rl.setAttribute("transform",t),(t=Rl.transform.baseVal.consolidate())?(t=t.matrix,kl(t.a,t.b,t.c,t.d,t.e,t.f)):Ml)}),", ",")",")"),Bl=n(10);function Ol(t,e){var n,i;return function(){var r=bl(this,t),a=r.tween;if(a!==n)for(var o=0,s=(i=n=a).length;o<s;++o)if(i[o].name===e){(i=i.slice()).splice(o,1);break}r.tween=i}}function Pl(t,e,n){var i,r;if("function"!=typeof n)throw new Error;return function(){var a=bl(this,t),o=a.tween;if(o!==i){r=(i=o).slice();for(var s={name:e,value:n},l=0,u=r.length;l<u;++l)if(r[l].name===e){r[l]=s;break}l===u&&r.push(s)}a.tween=r}}function Hl(t,e,n){var i=t._id;return t.each((function(){var t=bl(this,i);(t.value||(t.value={}))[e]=n.apply(this,arguments)})),function(t){return Sl(t,i).value[e]}}var Ll=function(t,e){var n;return("number"==typeof e?le:e instanceof Ht?ne:(n=Ht(e))?(e=n,ne):de)(t,e)};function jl(t){return function(){this.removeAttribute(t)}}function zl(t){return function(){this.removeAttributeNS(t.space,t.local)}}function Vl(t,e,n){var i,r,a=n+"";return function(){var o=this.getAttribute(t);return o===a?null:o===i?r:r=e(i=o,n)}}function Wl(t,e,n){var i,r,a=n+"";return function(){var o=this.getAttributeNS(t.space,t.local);return o===a?null:o===i?r:r=e(i=o,n)}}function Ul(t,e,n){var i,r,a;return function(){var o,s,l=n(this);if(null!=l)return(o=this.getAttribute(t))===(s=l+"")?null:o===i&&s===r?a:(r=s,a=e(i=o,l));this.removeAttribute(t)}}function Yl(t,e,n){var i,r,a;return function(){var o,s,l=n(this);if(null!=l)return(o=this.getAttributeNS(t.space,t.local))===(s=l+"")?null:o===i&&s===r?a:(r=s,a=e(i=o,l));this.removeAttributeNS(t.space,t.local)}}function ql(t,e){return function(n){this.setAttribute(t,e.call(this,n))}}function Gl(t,e){return function(n){this.setAttributeNS(t.space,t.local,e.call(this,n))}}function Ql(t,e){var n,i;function r(){var r=e.apply(this,arguments);return r!==i&&(n=(i=r)&&Gl(t,r)),n}return r._value=e,r}function Xl(t,e){var n,i;function r(){var r=e.apply(this,arguments);return r!==i&&(n=(i=r)&&ql(t,r)),n}return r._value=e,r}function Jl(t,e){return function(){wl(this,t).delay=+e.apply(this,arguments)}}function Zl(t,e){return e=+e,function(){wl(this,t).delay=e}}function $l(t,e){return function(){bl(this,t).duration=+e.apply(this,arguments)}}function Kl(t,e){return e=+e,function(){bl(this,t).duration=e}}function tu(t,e){if("function"!=typeof e)throw new Error;return function(){bl(this,t).ease=e}}var eu=n(15);function nu(t,e,n){var i,r,a=function(t){return(t+"").trim().split(/^|\s+/).every((function(t){var e=t.indexOf(".");return e>=0&&(t=t.slice(0,e)),!t||"start"===t}))}(e)?wl:bl;return function(){var o=a(this,t),s=o.on;s!==i&&(r=(i=s).copy()).on(e,n),o.on=r}}var iu=n(9),ru=n(14),au=el.b.prototype.constructor,ou=n(16);function su(t){return function(){this.style.removeProperty(t)}}function lu(t,e,n){return function(i){this.style.setProperty(t,e.call(this,i),n)}}function uu(t,e,n){var i,r;function a(){var a=e.apply(this,arguments);return a!==r&&(i=(r=a)&&lu(t,a,n)),i}return a._value=e,a}function hu(t){return function(e){this.textContent=t.call(this,e)}}function cu(t){var e,n;function i(){var i=t.apply(this,arguments);return i!==n&&(e=(n=i)&&hu(i)),e}return i._value=t,i}var du=0;function fu(t,e,n,i){this._groups=t,this._parents=e,this._name=n,this._id=i}function pu(){return++du}var gu=el.b.prototype;fu.prototype=function(t){return Object(el.b)().transition(t)}.prototype={constructor:fu,select:function(t){var e=this._name,n=this._id;"function"!=typeof t&&(t=Object(iu.a)(t));for(var i=this._groups,r=i.length,a=new Array(r),o=0;o<r;++o)for(var s,l,u=i[o],h=u.length,c=a[o]=new Array(h),d=0;d<h;++d)(s=u[d])&&(l=t.call(s,s.__data__,d,u))&&("__data__"in s&&(l.__data__=s.__data__),c[d]=l,Dl(c[d],e,n,d,c,Sl(s,n)));return new fu(a,this._parents,e,n)},selectAll:function(t){var e=this._name,n=this._id;"function"!=typeof t&&(t=Object(ru.a)(t));for(var i=this._groups,r=i.length,a=[],o=[],s=0;s<r;++s)for(var l,u=i[s],h=u.length,c=0;c<h;++c)if(l=u[c]){for(var d,f=t.call(l,l.__data__,c,u),p=Sl(l,n),g=0,m=f.length;g<m;++g)(d=f[g])&&Dl(d,e,n,g,f,p);a.push(f),o.push(l)}return new fu(a,o,e,n)},filter:function(t){"function"!=typeof t&&(t=Object(eu.a)(t));for(var e=this._groups,n=e.length,i=new Array(n),r=0;r<n;++r)for(var a,o=e[r],s=o.length,l=i[r]=[],u=0;u<s;++u)(a=o[u])&&t.call(a,a.__data__,u,o)&&l.push(a);return new fu(i,this._parents,this._name,this._id)},merge:function(t){if(t._id!==this._id)throw new Error;for(var e=this._groups,n=t._groups,i=e.length,r=n.length,a=Math.min(i,r),o=new Array(i),s=0;s<a;++s)for(var l,u=e[s],h=n[s],c=u.length,d=o[s]=new Array(c),f=0;f<c;++f)(l=u[f]||h[f])&&(d[f]=l);for(;s<i;++s)o[s]=e[s];return new fu(o,this._parents,this._name,this._id)},selection:function(){return new au(this._groups,this._parents)},transition:function(){for(var t=this._name,e=this._id,n=pu(),i=this._groups,r=i.length,a=0;a<r;++a)for(var o,s=i[a],l=s.length,u=0;u<l;++u)if(o=s[u]){var h=Sl(o,e);Dl(o,t,n,u,s,{time:h.time+h.delay+h.duration,delay:0,duration:h.duration,ease:h.ease})}return new fu(i,this._parents,t,n)},call:gu.call,nodes:gu.nodes,node:gu.node,size:gu.size,empty:gu.empty,each:gu.each,on:function(t,e){var n=this._id;return arguments.length<2?Sl(this.node(),n).on.on(t):this.each(nu(n,t,e))},attr:function(t,e){var n=Object(Bl.a)(t),i="transform"===n?Al:Ll;return this.attrTween(t,"function"==typeof e?(n.local?Yl:Ul)(n,i,Hl(this,"attr."+t,e)):null==e?(n.local?zl:jl)(n):(n.local?Wl:Vl)(n,i,e))},attrTween:function(t,e){var n="attr."+t;if(arguments.length<2)return(n=this.tween(n))&&n._value;if(null==e)return this.tween(n,null);if("function"!=typeof e)throw new Error;var i=Object(Bl.a)(t);return this.tween(n,(i.local?Ql:Xl)(i,e))},style:function(t,e,n){var i="transform"==(t+="")?Nl:Ll;return null==e?this.styleTween(t,function(t,e){var n,i,r;return function(){var a=Object(ou.b)(this,t),o=(this.style.removeProperty(t),Object(ou.b)(this,t));return a===o?null:a===n&&o===i?r:r=e(n=a,i=o)}}(t,i)).on("end.style."+t,su(t)):"function"==typeof e?this.styleTween(t,function(t,e,n){var i,r,a;return function(){var o=Object(ou.b)(this,t),s=n(this),l=s+"";return null==s&&(this.style.removeProperty(t),l=s=Object(ou.b)(this,t)),o===l?null:o===i&&l===r?a:(r=l,a=e(i=o,s))}}(t,i,Hl(this,"style."+t,e))).each(function(t,e){var n,i,r,a,o="style."+e,s="end."+o;return function(){var l=bl(this,t),u=l.on,h=null==l.value[o]?a||(a=su(e)):void 0;u===n&&r===h||(i=(n=u).copy()).on(s,r=h),l.on=i}}(this._id,t)):this.styleTween(t,function(t,e,n){var i,r,a=n+"";return function(){var o=Object(ou.b)(this,t);return o===a?null:o===i?r:r=e(i=o,n)}}(t,i,e),n).on("end.style."+t,null)},styleTween:function(t,e,n){var i="style."+(t+="");if(arguments.length<2)return(i=this.tween(i))&&i._value;if(null==e)return this.tween(i,null);if("function"!=typeof e)throw new Error;return this.tween(i,uu(t,e,null==n?"":n))},text:function(t){return this.tween("text","function"==typeof t?function(t){return function(){var e=t(this);this.textContent=null==e?"":e}}(Hl(this,"text",t)):function(t){return function(){this.textContent=t}}(null==t?"":t+""))},textTween:function(t){var e="text";if(arguments.length<1)return(e=this.tween(e))&&e._value;if(null==t)return this.tween(e,null);if("function"!=typeof t)throw new Error;return this.tween(e,cu(t))},remove:function(){return this.on("end.remove",(t=this._id,function(){var e=this.parentNode;for(var n in this.__transition)if(+n!==t)return;e&&e.removeChild(this)}));var t},tween:function(t,e){var n=this._id;if(t+="",arguments.length<2){for(var i,r=Sl(this.node(),n).tween,a=0,o=r.length;a<o;++a)if((i=r[a]).name===t)return i.value;return null}return this.each((null==e?Ol:Pl)(n,t,e))},delay:function(t){var e=this._id;return arguments.length?this.each(("function"==typeof t?Jl:Zl)(e,t)):Sl(this.node(),e).delay},duration:function(t){var e=this._id;return arguments.length?this.each(("function"==typeof t?$l:Kl)(e,t)):Sl(this.node(),e).duration},ease:function(t){var e=this._id;return arguments.length?this.each(tu(e,t)):Sl(this.node(),e).ease},end:function(){var t,e,n=this,i=n._id,r=n.size();return new Promise((function(a,o){var s={value:o},l={value:function(){0==--r&&a()}};n.each((function(){var n=bl(this,i),r=n.on;r!==t&&((e=(t=r).copy())._.cancel.push(s),e._.interrupt.push(s),e._.end.push(l)),n.on=e}))}))}};var mu={time:null,delay:0,duration:250,ease:function(t){return((t*=2)<=1?t*t*t:(t-=2)*t*t+2)/2}};function vu(t,e){for(var n;!(n=t.__transition)||!(n=n[e]);)if(!(t=t.parentNode))return mu.time=hl(),mu;return n}el.b.prototype.interrupt=function(t){return this.each((function(){Tl(this,t)}))},el.b.prototype.transition=function(t){var e,n;t instanceof fu?(e=t._id,t=t._name):(e=pu(),(n=mu).time=hl(),t=null==t?null:t+"");for(var i=this._groups,r=i.length,a=0;a<r;++a)for(var o,s=i[a],l=s.length,u=0;u<l;++u)(o=s[u])&&Dl(o,t,e,u,s,n||vu(o,e));return new fu(i,this._parents,t,e)};var yu=function(t){return function(){return t}};function _u(t,e,n){this.target=t,this.type=e,this.transform=n}function Du(t,e,n){this.k=t,this.x=e,this.y=n}Du.prototype={constructor:Du,scale:function(t){return 1===t?this:new Du(this.k*t,this.x,this.y)},translate:function(t,e){return 0===t&0===e?this:new Du(this.k,this.x+this.k*t,this.y+this.k*e)},apply:function(t){return[t[0]*this.k+this.x,t[1]*this.k+this.y]},applyX:function(t){return t*this.k+this.x},applyY:function(t){return t*this.k+this.y},invert:function(t){return[(t[0]-this.x)/this.k,(t[1]-this.y)/this.k]},invertX:function(t){return(t-this.x)/this.k},invertY:function(t){return(t-this.y)/this.k},rescaleX:function(t){return t.copy().domain(t.range().map(this.invertX,this).map(t.invert,t))},rescaleY:function(t){return t.copy().domain(t.range().map(this.invertY,this).map(t.invert,t))},toString:function(){return"translate("+this.x+","+this.y+") scale("+this.k+")"}};var wu=new Du(1,0,0);function bu(){Wi.c.stopImmediatePropagation()}Du.prototype;var Su=function(){Wi.c.preventDefault(),Wi.c.stopImmediatePropagation()};function xu(){return!Wi.c.ctrlKey&&!Wi.c.button}function Fu(){var t=this;return t instanceof SVGElement?(t=t.ownerSVGElement||t).hasAttribute("viewBox")?[[(t=t.viewBox.baseVal).x,t.y],[t.x+t.width,t.y+t.height]]:[[0,0],[t.width.baseVal.value,t.height.baseVal.value]]:[[0,0],[t.clientWidth,t.clientHeight]]}function Cu(){return this.__zoom||wu}function Ru(){return-Wi.c.deltaY*(1===Wi.c.deltaMode?.05:Wi.c.deltaMode?1:.002)}function Tu(){return navigator.maxTouchPoints||"ontouchstart"in this}function Iu(t,e,n){var i=t.invertX(e[0][0])-n[0][0],r=t.invertX(e[1][0])-n[1][0],a=t.invertY(e[0][1])-n[0][1],o=t.invertY(e[1][1])-n[1][1];return t.translate(r>i?(i+r)/2:Math.min(0,i)||Math.max(0,r),o>a?(a+o)/2:Math.min(0,a)||Math.max(0,o))}var Mu=function(t){return t},ku=function(t){if(null==t)return Mu;var e,n,i=t.scale[0],r=t.scale[1],a=t.translate[0],o=t.translate[1];return function(t,s){s||(e=n=0);var l=2,u=t.length,h=new Array(u);for(h[0]=(e+=t[0])*i+a,h[1]=(n+=t[1])*r+o;l<u;)h[l]=t[l],++l;return h}},Eu=function(t,e){return"string"==typeof e&&(e=t.objects[e]),"GeometryCollection"===e.type?{type:"FeatureCollection",features:e.geometries.map((function(e){return Nu(t,e)}))}:Nu(t,e)};function Nu(t,e){var n=e.id,i=e.bbox,r=null==e.properties?{}:e.properties,a=Au(t,e);return null==n&&null==i?{type:"Feature",properties:r,geometry:a}:null==i?{type:"Feature",id:n,properties:r,geometry:a}:{type:"Feature",id:n,bbox:i,properties:r,geometry:a}}function Au(t,e){var n=ku(t.transform),i=t.arcs;function r(t,e){e.length&&e.pop();for(var r=i[t<0?~t:t],a=0,o=r.length;a<o;++a)e.push(n(r[a],a));t<0&&function(t,e){for(var n,i=t.length,r=i-e;r<--i;)n=t[r],t[r++]=t[i],t[i]=n}(e,o)}function a(t){return n(t)}function o(t){for(var e=[],n=0,i=t.length;n<i;++n)r(t[n],e);return e.length<2&&e.push(e[0]),e}function s(t){for(var e=o(t);e.length<4;)e.push(e[0]);return e}function l(t){return t.map(s)}return function t(e){var n,i=e.type;switch(i){case"GeometryCollection":return{type:i,geometries:e.geometries.map(t)};case"Point":n=a(e.coordinates);break;case"MultiPoint":n=e.coordinates.map(a);break;case"LineString":n=o(e.arcs);break;case"MultiLineString":n=e.arcs.map(o);break;case"Polygon":n=l(e.arcs);break;case"MultiPolygon":n=e.arcs.map(l);break;default:return null}return{type:i,coordinates:n}}(e)}const Bu=0,Ou=1,Pu=2,Hu=3;class Lu{constructor(t,e,n,i,r){this.desiredWidth=t,this.desiredHeight=e,this.zoomBoxPaddingFactor=.7,this.maxScale=50;let a=i.objects;this.nationFeature=Eu(i,a.nation).features,this.setStateFeatures(Eu(i,a.states).features),void 0!==a.counties?this.setCountyFeatures(Eu(i,a.counties).features):this.setCountyFeatures(null),this._evaluator=r,this.onRegionClicked=null,this.onRegionMouseOver=null,this.onRegionMouseOut=null,this.onOceanClicked=null,this.didScrollAwayFromHighlightedState=null,this.currentHighlightState=Bu,this._highlightedRegionID=null,this._hoveredRegionID=null,this._zoomedBounds=null,this.apparentWidth=null,this.apparentHeight=null;let o=this;this._updateZoomFunction(.5),this.mapContainer=n,this.container=this.mapContainer.append("div").attr("class","map-viz-wrapper header-collapsed-element"),this.svg=this.container.append("svg").attr("class","map-viz"),this._updateViewboxForNewDimensions(t,e),this.svg.append("rect").attr("width","100%").attr("height","100%").attr("fill","white").on("click",(function(){o._didClickOcean(o)})),this._baseLayer=this.svg.append("g"),this._nationLayer=this._baseLayer.append("g"),this._countyLayer=this._baseLayer.append("g").attr("class","county-layer"),this._stateLayer=this._baseLayer.append("g").attr("class","state-layer");let s=Go().parallels([29.5,45.5]).scale(1070).translate([480,250]).rotate([96,0]).center([-.6,38.7]).scale(925).translate([.5*t,.5*e]);this._geoPath=function(t,e){var n,i,r=4.5;function a(t){return t&&("function"==typeof r&&i.pointRadius(+r.apply(this,arguments)),To(t,n(i))),i.result()}return a.area=function(t){return To(t,n(as)),as.result()},a.measure=function(t){return To(t,n(Os)),Os.result()},a.bounds=function(t){return To(t,n(No)),No.result()},a.centroid=function(t){return To(t,n(Fs)),Fs.result()},a.projection=function(e){return arguments.length?(n=null==e?(t=null,Do):(t=e).stream,a):t},a.context=function(t){return arguments.length?(i=null==t?(e=null,new Ps):new Cs(e=t),"function"!=typeof r&&i.pointRadius(r),a):e},a.pointRadius=function(t){return arguments.length?(r="function"==typeof t?t:(i.pointRadius(+t),+t),a):r},a.projection(t).context(e)}().projection(s),this._initializeFeatures(),this._createNation(this._nationLayer,this.nationFeature,this._geoPath),this._createStates(this._stateLayer,this.stateFeatures,this._geoPath),this._createCounties(this._countyLayer,this.countyFeatures,this._geoPath),this._parseDimensions(),this.resetZoom(!1)}windowBounds(){return _a.fromSVGRect(this.svg.node().getBoundingClientRect())}setEvaluator(t){t.measureDelta&&(t=Evaluator.smoothedCopy(t)),this._evaluator=t,this.updateMapForDay(this._currentDay,this._currentData,!0)}resetZoom(t=!0,e=1e3){this.zoomToBox(this.baseBox(),t,.95,e),this._zoomedBounds=null}baseBox(){return new _a(0,0,this.desiredWidth,this.desiredHeight)}zoomToBox(t,e=!0,n=null,i=1e3){const r=t.x,a=t.x+t.width,o=t.y,s=t.y+t.height;this._regionIDsContainCounty([this._highlightedRegionID])||(this._zoomedBounds=t);let l=[(r+a)/2,(o+s)/2],u=this._scaleForBoundingBox(t,n),h=this,c=this.svg;e&&(c=c.transition().duration(i));let d=function(){h._finishedZoomTransition()};c.call(this._zoom.transform,wu.translate(this.activeWidth/2,this.activeHeight/2).scale(u).translate(-(r+a)/2,-(o+s)/2),l).on("end",d),e||d()}_updateZoomFunction(t=null){null===t&&(t=this._scaleForBoundingBox(this.baseBox(),.95));let e=this;this._zoom=function(){var t,e,n=xu,i=Fu,r=Iu,o=Ru,s=Tu,l=[0,1/0],u=[[-1/0,-1/0],[1/0,1/0]],h=250,c=Ks,d=Ys("start","zoom","end"),f=0;function p(t){t.property("__zoom",Cu).on("wheel.zoom",w).on("mousedown.zoom",b).on("dblclick.zoom",S).filter(s).on("touchstart.zoom",x).on("touchmove.zoom",F).on("touchend.zoom touchcancel.zoom",C).style("touch-action","none").style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}function g(t,e){return(e=Math.max(l[0],Math.min(l[1],e)))===t.k?t:new Du(e,t.x,t.y)}function m(t,e,n){var i=e[0]-n[0]*t.k,r=e[1]-n[1]*t.k;return i===t.x&&r===t.y?t:new Du(t.k,i,r)}function v(t){return[(+t[0][0]+ +t[1][0])/2,(+t[0][1]+ +t[1][1])/2]}function y(t,e,n){t.on("start.zoom",(function(){_(this,arguments).start()})).on("interrupt.zoom end.zoom",(function(){_(this,arguments).end()})).tween("zoom",(function(){var t=this,r=arguments,a=_(t,r),o=i.apply(t,r),s=null==n?v(o):"function"==typeof n?n.apply(t,r):n,l=Math.max(o[1][0]-o[0][0],o[1][1]-o[0][1]),u=t.__zoom,h="function"==typeof e?e.apply(t,r):e,d=c(u.invert(s).concat(l/u.k),h.invert(s).concat(l/h.k));return function(t){if(1===t)t=h;else{var e=d(t),n=l/e[2];t=new Du(n,s[0]-e[0]*n,s[1]-e[1]*n)}a.zoom(null,t)}}))}function _(t,e,n){return!n&&t.__zooming||new D(t,e)}function D(t,e){this.that=t,this.args=e,this.active=0,this.extent=i.apply(t,e),this.taps=0}function w(){if(n.apply(this,arguments)){var t=_(this,arguments),e=this.__zoom,i=Math.max(l[0],Math.min(l[1],e.k*Math.pow(2,o.apply(this,arguments)))),a=Gr(this);if(t.wheel)t.mouse[0][0]===a[0]&&t.mouse[0][1]===a[1]||(t.mouse[1]=e.invert(t.mouse[0]=a)),clearTimeout(t.wheel);else{if(e.k===i)return;t.mouse=[a,e.invert(a)],Tl(this),t.start()}Su(),t.wheel=setTimeout(s,150),t.zoom("mouse",r(m(g(e,i),t.mouse[0],t.mouse[1]),t.extent,u))}function s(){t.wheel=null,t.end()}}function b(){if(!e&&n.apply(this,arguments)){var t=_(this,arguments,!0),i=Object(a.a)(Wi.c.view).on("mousemove.zoom",h,!0).on("mouseup.zoom",c,!0),o=Gr(this),s=Wi.c.clientX,l=Wi.c.clientY;Gs(Wi.c.view),bu(),t.mouse=[o,this.__zoom.invert(o)],Tl(this),t.start()}function h(){if(Su(),!t.moved){var e=Wi.c.clientX-s,n=Wi.c.clientY-l;t.moved=e*e+n*n>f}t.zoom("mouse",r(m(t.that.__zoom,t.mouse[0]=Gr(t.that),t.mouse[1]),t.extent,u))}function c(){i.on("mousemove.zoom mouseup.zoom",null),Qs(Wi.c.view,t.moved),Su(),t.end()}}function S(){if(n.apply(this,arguments)){var t=this.__zoom,e=Gr(this),o=t.invert(e),s=t.k*(Wi.c.shiftKey?.5:2),l=r(m(g(t,s),e,o),i.apply(this,arguments),u);Su(),h>0?Object(a.a)(this).transition().duration(h).call(y,l,e):Object(a.a)(this).call(p.transform,l)}}function x(){if(n.apply(this,arguments)){var e,i,r,a,o=Wi.c.touches,s=o.length,l=_(this,arguments,Wi.c.changedTouches.length===s);for(bu(),i=0;i<s;++i)r=o[i],a=[a=tl(this,o,r.identifier),this.__zoom.invert(a),r.identifier],l.touch0?l.touch1||l.touch0[2]===a[2]||(l.touch1=a,l.taps=0):(l.touch0=a,e=!0,l.taps=1+!!t);t&&(t=clearTimeout(t)),e&&(l.taps<2&&(t=setTimeout((function(){t=null}),500)),Tl(this),l.start())}}function F(){if(this.__zooming){var e,n,i,a,o=_(this,arguments),s=Wi.c.changedTouches,l=s.length;for(Su(),t&&(t=clearTimeout(t)),o.taps=0,e=0;e<l;++e)n=s[e],i=tl(this,s,n.identifier),o.touch0&&o.touch0[2]===n.identifier?o.touch0[0]=i:o.touch1&&o.touch1[2]===n.identifier&&(o.touch1[0]=i);if(n=o.that.__zoom,o.touch1){var h=o.touch0[0],c=o.touch0[1],d=o.touch1[0],f=o.touch1[1],p=(p=d[0]-h[0])*p+(p=d[1]-h[1])*p,v=(v=f[0]-c[0])*v+(v=f[1]-c[1])*v;n=g(n,Math.sqrt(p/v)),i=[(h[0]+d[0])/2,(h[1]+d[1])/2],a=[(c[0]+f[0])/2,(c[1]+f[1])/2]}else{if(!o.touch0)return;i=o.touch0[0],a=o.touch0[1]}o.zoom("touch",r(m(n,i,a),o.extent,u))}}function C(){if(this.__zooming){var t,n,i=_(this,arguments),r=Wi.c.changedTouches,o=r.length;for(bu(),e&&clearTimeout(e),e=setTimeout((function(){e=null}),500),t=0;t<o;++t)n=r[t],i.touch0&&i.touch0[2]===n.identifier?delete i.touch0:i.touch1&&i.touch1[2]===n.identifier&&delete i.touch1;if(i.touch1&&!i.touch0&&(i.touch0=i.touch1,delete i.touch1),i.touch0)i.touch0[1]=this.__zoom.invert(i.touch0[0]);else if(i.end(),2===i.taps){var s=Object(a.a)(this).on("dblclick.zoom");s&&s.apply(this,arguments)}}}return p.transform=function(t,e,n){var i=t.selection?t.selection():t;i.property("__zoom",Cu),t!==i?y(t,e,n):i.interrupt().each((function(){_(this,arguments).start().zoom(null,"function"==typeof e?e.apply(this,arguments):e).end()}))},p.scaleBy=function(t,e,n){p.scaleTo(t,(function(){var t=this.__zoom.k,n="function"==typeof e?e.apply(this,arguments):e;return t*n}),n)},p.scaleTo=function(t,e,n){p.transform(t,(function(){var t=i.apply(this,arguments),a=this.__zoom,o=null==n?v(t):"function"==typeof n?n.apply(this,arguments):n,s=a.invert(o),l="function"==typeof e?e.apply(this,arguments):e;return r(m(g(a,l),o,s),t,u)}),n)},p.translateBy=function(t,e,n){p.transform(t,(function(){return r(this.__zoom.translate("function"==typeof e?e.apply(this,arguments):e,"function"==typeof n?n.apply(this,arguments):n),i.apply(this,arguments),u)}))},p.translateTo=function(t,e,n,a){p.transform(t,(function(){var t=i.apply(this,arguments),o=this.__zoom,s=null==a?v(t):"function"==typeof a?a.apply(this,arguments):a;return r(wu.translate(s[0],s[1]).scale(o.k).translate("function"==typeof e?-e.apply(this,arguments):-e,"function"==typeof n?-n.apply(this,arguments):-n),t,u)}),a)},D.prototype={start:function(){return 1==++this.active&&(this.that.__zooming=this,this.emit("start")),this},zoom:function(t,e){return this.mouse&&"mouse"!==t&&(this.mouse[1]=e.invert(this.mouse[0])),this.touch0&&"touch"!==t&&(this.touch0[1]=e.invert(this.touch0[0])),this.touch1&&"touch"!==t&&(this.touch1[1]=e.invert(this.touch1[0])),this.that.__zoom=e,this.emit("zoom"),this},end:function(){return 0==--this.active&&(delete this.that.__zooming,this.emit("end")),this},emit:function(t){Object(Wi.a)(new _u(p,t,this.that.__zoom),d.apply,d,[t,this.that,this.args])}},p.wheelDelta=function(t){return arguments.length?(o="function"==typeof t?t:yu(+t),p):o},p.filter=function(t){return arguments.length?(n="function"==typeof t?t:yu(!!t),p):n},p.touchable=function(t){return arguments.length?(s="function"==typeof t?t:yu(!!t),p):s},p.extent=function(t){return arguments.length?(i="function"==typeof t?t:yu([[+t[0][0],+t[0][1]],[+t[1][0],+t[1][1]]]),p):i},p.scaleExtent=function(t){return arguments.length?(l[0]=+t[0],l[1]=+t[1],p):[l[0],l[1]]},p.translateExtent=function(t){return arguments.length?(u[0][0]=+t[0][0],u[1][0]=+t[1][0],u[0][1]=+t[0][1],u[1][1]=+t[1][1],p):[[u[0][0],u[0][1]],[u[1][0],u[1][1]]]},p.constrain=function(t){return arguments.length?(r=t,p):r},p.duration=function(t){return arguments.length?(h=+t,p):h},p.interpolate=function(t){return arguments.length?(c=t,p):c},p.on=function(){var t=d.on.apply(d,arguments);return t===d?p:t},p.clickDistance=function(t){return arguments.length?(f=(t=+t)*t,p):Math.sqrt(f)},p}().scaleExtent([t,this.maxScale]).interpolate(fe).on("zoom",(function(){e._zoomed(e)})),void 0!==this.svg&&this.svg.call(this._zoom)}_scaleForBoundingBox(t,e=null){null===e&&(e=this.zoomBoxPaddingFactor);let n=Math.max(t.width/this.activeWidth,t.height/this.activeHeight);return Math.min(this.maxScale,e/n)}boundingBoxForRegion(t){if("0000"===t)return this.baseBox();const e=this._pathSelectionForRegionID(t).node();return _a.fromSVGRect(e.getBBox())}boundingBoxForRegions(t,e=1){if(0===t.length)return null;let n=this,i=null;return t.forEach((function(t){let e=n.boundingBoxForRegion(t);null===i?i=e:i.unionRect(e)})),i.expandBy(e),i}setCompactView(t){this.isCompact!==t&&(this.isCompact=t,this.container.attr("compact",t?"":null))}_regionIDsContainState(t){return null!==t&&(0!==t.length&&this._containerLayerForRegionID(t[0])===this._stateLayer)}_regionIDsContainCounty(t){return null!==t&&(0!==t.length&&this._containerLayerForRegionID(t[0])===this._countyLayer)}_regionIDsRepresentNation(t){return null===t||(0===t.length||this._containerLayerForRegionID(t[0])===this._nationLayer)}highlightRegionWithID(t){this.highlightRegionsWithIDs(null===t?[]:[t])}highlightRegionsWithIDs(t,e=!0){let n=this._regionIDsRepresentNation(t);if(n&&this.currentHighlightState<=Ou)return;let i=this._regionIDsContainState(t),r=t.length>1,a=r&&i?null:t[0];if(this._setHighlightedRegionWithID(a,!r,e),i||n){let i=this,a=new Set(t);i._stateLayer.style("pointer-events",n?"all":"none"),i.currentHighlightState=n?Ou:Pu;let o=this._stateLayer.selectAll("path.statePath");e&&(o=o.transition().duration(1e3));let s=function(){i.currentHighlightState=n?Bu:Hu};o.attr("fill",(function(t){return n||a.has(t.id)?"rgba(0, 0, 0, 0.0)":"rgba(235, 235, 235, 0.85)"})).attr("stroke",t=>this._strokeForRegionID(t.id)).attr("stroke-width",t=>this._strokeWidthForRegionID(t.id)).style("pointer-events",(function(t){return a.has(t.id)&&!r?"none":"all"})).on("end",s),e||s()}}_containerLayerForRegionID(t){return this._stateRegions.has(t)?this._stateLayer:this._countyRegions.has(t)?this._countyLayer:this._nationRegions.has(t)?this._nationLayer:null}_pathSelectionForRegionID(t){return this._containerLayerForRegionID(t).select("path[regionID="+Lu.pathRegionID(t)+"]")}_updateStrokeForRegionID(t,e=!1,n=!1){if(t){let i=this._pathSelectionForRegionID(t);e&&i.moveToFront(),n&&(i=i.transition().duration(1e3));let r=this._strokeForRegionID(t),a="none"===r?"rgba(0,0,0,0)":r;i.attr("stroke",a).attr("stroke-width",this._strokeWidthForRegionID(t))}}_setHighlightedRegionWithID(t,e=!0,n=!1){let i=this._highlightedRegionID;this._highlightedRegionID=t,this._hoveredRegionID===t&&(this._hoveredRegionID=null),this._updateStrokeForRegionID(i,!1,n),this._updateStrokeForRegionID(e?t:null,!0,n)}hoverRegionWithID(t,e=!1){if(this.currentHighlightState>Bu&&this.currentHighlightState<Hu&&this._containerLayerForRegionID(t)===this._countyLayer)return;let n=this._hoveredRegionID;if(this._hoveredRegionID=t,this._updateStrokeForRegionID(n,!1,e),this._updateStrokeForRegionID(t,!0,e),t&&this._highlightedRegionID){this._containerLayerForRegionID(t)===this._containerLayerForRegionID(this._highlightedRegionID)&&this._pathSelectionForRegionID(this._highlightedRegionID).moveToFront()}this._registerInteraction()}_strokeWidthForRegionID(t){let e=this._containerLayerForRegionID(t)===this._stateLayer,n=this._containerLayerForRegionID(t)===this._countyLayer,i=t===this._hoveredRegionID,r=t===this._highlightedRegionID;return e?r||i?2:1:n?2:0}_strokeForRegionID(t){let e=this._containerLayerForRegionID(t)===this._stateLayer,n=this._containerLayerForRegionID(t)===this._countyLayer,i=t===this._hoveredRegionID,r=t===this._highlightedRegionID;return e?r?"rgb(255, 255, 255)":i?"rgba(255, 255, 255, 1.0)":"rgba(0, 0, 0, 0.15)":n?r?"rgb(255, 255, 255)":i?"rgba(255, 255, 255, 1.0)":"none":"none"}_impliedBoundsFromTransform(t){let e=-t.x/t.k,n=e+this.activeWidth/t.k,i=-t.y/t.k,r=i+this.activeHeight/t.k;return new _a(e,i,n-e,r-i)}_parseDimensions(){let t=this.apparentWidth;if(this.apparentWidth=parseInt(this.mapContainer.style("width")),this.apparentWidth===t)return;let e=this.apparentWidth*(this.desiredHeight/this.desiredWidth);this.apparentHeight=Math.min(e,150);let n=this.desiredWidth/this.desiredHeight,i=this.apparentWidth/this.apparentHeight;if(i>n){let t=this.desiredWidth/i;this._updateViewboxForNewDimensions(this.desiredWidth,t)}else this.activeHeight!==this.desiredHeight&&this._updateViewboxForNewDimensions(this.desiredWidth,this.desiredHeight);this._updateZoomFunction()}_updateViewboxForNewDimensions(t,e){this.svg.attr("viewBox",[0,0,t,e]),this.activeWidth=t,this.activeHeight=e}didResize(){this._parseDimensions()}_mapDimensionFromApparentDimension(t,e){return t*(1/e.k)*(this.activeWidth/this.apparentWidth)}_zoomed(t){const{transform:e}=Wi.c;if(t._baseLayer.attr("transform",e),null===t.apparentWidth&&t._parseDimensions(),t.currentHighlightState===Hu&&null!=t.didScrollAwayFromHighlightedState&&null!=t._zoomedBounds){let n=t._zoomedBounds,i=t._impliedBoundsFromTransform(e),r=(n.aspectRatio()>i.aspectRatio()?i.width/n.width:i.height/n.height)>2.5,a=.25*t.apparentWidth,o=.25*t.apparentHeight,s=t._mapDimensionFromApparentDimension(a,e),l=t._mapDimensionFromApparentDimension(o,e),u=i.top()+l>n.bottom(),h=i.bottom()-l<n.top(),c=i.left()+s>n.right(),d=i.right()-s<n.left();(u||h||c||d||r)&&(t._zoomedBounds=null,t.didScrollAwayFromHighlightedState(),t._resetZoomAfterDelay())}this._registerInteraction()}_registerInteraction(){this.currentHighlightState===Bu&&(this.lastInteractionTime=performance.now())}_resetZoomIfNecessary(){if(this.currentHighlightState===Bu){if(null!==this._hoveredRegionID)return void this._resetZoomAfterDelay(7e3);let t=7e3-(performance.now()-this.lastInteractionTime);t>100?this._resetZoomAfterDelay(t):this.resetZoom(!0,1500)}}_resetZoomAfterDelay(t=7e3){let e=this;setTimeout((function(){e._resetZoomIfNecessary()}),t)}_finishedZoomTransition(){}_initializeFeatures(){this._nationRegions=new Set,this._nationRegions.add("0000")}setStateFeatures(t){if(this.stateFeatures=t,this._stateRegions=new Set,null!==t){let e=this;t.forEach((function(t){e._stateRegions.add(t.id)}))}}setCountyFeatures(t){if(this.countyFeatures=t,this._countyRegions=new Set,null!==t){let e=this;t.forEach((function(t){e._countyRegions.add(t.id)}))}}updateForCountryGeometry(t){let e=t.objects;if(void 0!==e.counties){let n=null===this.countyFeatures;this.setCountyFeatures(Eu(t,e.counties).features),n&&this._createCounties(this._countyLayer,this.countyFeatures,this._geoPath)}else this.setCountyFeatures(null)}_createNation(t,e,n){t.selectAll("path").data(e).enter().append("path").attr("fill","#ccc").attr("stroke-width",0).attr("stroke","none").attr("vector-effect","non-scaling-stroke").attr("regionID",(function(t){return Lu.pathRegionID(t.id)})).attr("d",n)}_createStates(t,e,n){if(null===e)return;let i=this;t.selectAll("path").data(e).enter().append("path").attr("class","statePath").attr("fill","rgba(0, 0, 0, 0.0)").attr("stroke",t=>i._strokeForRegionID(t.id)).attr("stroke-width",t=>i._strokeWidthForRegionID(t.id)).attr("vector-effect","non-scaling-stroke").attr("regionID",(function(t){return Lu.pathRegionID(t.id)})).attr("d",n).on("mouseenter touchstart",(function(t){i._touchDidMove=!1,i._didMouseOverRegion(i,this,t)})).on("mouseleave touchmove",(function(t){i._touchDidMove=!0,i._didMouseOutRegion(i,this,t)})).on("touchend",(function(t){i._touchDidMove||(i._didClickRegion(i,this,t),Wi.c.preventDefault())})).on("click",(function(t){i._didClickRegion(i,this,t),this._touchDidMove=!1,Wi.c.preventDefault()}))}_createCounties(t,e,n){if(null===e)return;let i=this;t.selectAll("path").data(e).enter().append("path").attr("class","countyPath").attr("fill","rgba(255, 0, 0, 0)").attr("stroke","none").attr("stroke-width",2).attr("vector-effect","non-scaling-stroke").attr("regionID",(function(t){return Lu.pathRegionID(t.id)})).attr("d",n).on("mouseover",(function(t){i._didMouseOverRegion(i,this,t)})).on("mouseout",(function(t){i._didMouseOutRegion(i,this,t)})).on("click",(function(t){i._didClickRegion(i,this,t)}))}updateMapForDay(t,e,n){this._currentDay=t,this._currentData=e,this._updateCountiesForDay(t,e,n)}_updateCountiesForDay(t,e,n){let i=this._countyLayer.selectAll("path.countyPath");n&&(i=i.transition().duration(1e3));let r=this;i.attr("fill",(function(n){let i=e.dataForRegionOnDay(n.id,t);if(null!=i){let t=r._evaluator.intensityForSnapshot(i);if(0!==t)return r._evaluator.colorForIntensity(t)}return"rgba(255, 0, 0, 0)"}))}_didMouseOverRegion(t,e,n){t.onRegionMouseOver&&t.onRegionMouseOver(n.id)}_didMouseOutRegion(t,e,n){t.onRegionMouseOut&&t.onRegionMouseOut(n.id)}_didClickRegion(t,e,n){t.onRegionClicked&&t.onRegionClicked(n.id)}_didClickOcean(t){t.onOceanClicked&&t.onOceanClicked()}static pathRegionID(t){return"region"+t}}class ju{static MobilityTypeForToggleCount(t){return t%R}static MobilityStatFromSnapshot(t,e){if(null===e.mobilityData)return null;switch(ju.MobilityTypeForToggleCount(t.toggleCount)){case b:return e.mobilityData.retailAndRecreation;case C:return e.mobilityData.residential;case S:return e.mobilityData.workplace;case F:return e.mobilityData.parks;case x:return e.mobilityData.transit}return null}static MobilityAdjectiveForEvaluator(t){switch(ju.MobilityTypeForToggleCount(t.toggleCount)){case b:return"Retail";case C:return"Residential";case S:return"Workplace";case F:return"Park";case x:return"Transit"}return null}static NounForEvaluator(t){return ju.MobilityAdjectiveForEvaluator(t).toLowerCase()+" visits"}static DescriptionTemplateForEvaluator(t){return"<Token:FullyQualifiedNoun> <Token:RegionPreposition> <Token:Region> are <Token:DataQuantityDirection> <Token:DataQuantity> <Token:TimePreposition> <Token:ShortDate>."+ju.CategoryDescriptionForEvaluator(t)+" On average, visits <Token:ChangeVerbWeekProgressive>: this metric has <Token:ChangeVerbWeek> <Token:AmountChangeWeek> when compared to a week ago, and <Token:ChangeVerbMonth> <Token:AmountChangeMonth> when compared to a month ago."}static CategoryDescriptionForEvaluator(t){switch(ju.MobilityTypeForToggleCount(t.toggleCount)){case b:return" This metric includes places like restaurants, shopping centers, theme parks, and movie theaters.";case x:return" This metric includes places like public transit hubs, such as subway, bus, and train stations.";case F:return" This metric includes places like national parks, public beaches, plazas, and public gardens."}return""}static mobilityDataEvaluator(t=!0){let e=va.baseLogHeatMapEvaluator("Mobility","cases");return e.setBaseStat((function(t,e){return ju.MobilityStatFromSnapshot(t,e)})),e.statDescriptionFunction=function(t){return ju.MobilityAdjectiveForEvaluator(t)},e.toggleFunction=function(t){let e=ga.from(t);return e.descriptionTemplate=ju.DescriptionTemplateForEvaluator(t),e},e.allowNegative=!0,e.displayAsPercent=!0,e.valueFormatter=O(".0%"),e.nounWithNumber="change",e.noun="visitation",e.anchorNoun="mobility",e.baseRGB="131,182,146",e.supportedRegionLevel=u,e.maxPowerOfTen=0,e.descriptionTemplate=ju.DescriptionTemplateForEvaluator(e),e.nounQualifier=function(t){return ju.NounForEvaluator(t)},e.source="Google Mobility",t&&(e.benchmarkEvaluator=ju.nationalMobilityDataEvaluator(),e.benchmarkRegionType=o),e}static nationalMobilityDataEvaluator(){let t=ju.mobilityDataEvaluator(!1);return t.title="National Mobility Data",t.baseRGB="49,84,71",t.smoothed=!0,t.wantsFill=!1,t.annotation="<tspan x='0'>National</tspan><tspan x='0'dy='14'>average</tspan>",t}}var zu=function(t,e,n){t=+t,e=+e,n=(r=arguments.length)<2?(e=t,t=0,1):r<3?1:+n;for(var i=-1,r=0|Math.max(0,Math.ceil((e-t)/n)),a=new Array(r);++i<r;)a[i]=t+i*n;return a};const Vu=Symbol("implicit");function Wu(){var t=new Map,e=[],n=[],i=Vu;function r(r){var a=r+"",o=t.get(a);if(!o){if(i!==Vu)return i;t.set(a,o=e.push(r))}return n[(o-1)%n.length]}return r.domain=function(n){if(!arguments.length)return e.slice();e=[],t=new Map;for(const i of n){const n=i+"";t.has(n)||t.set(n,e.push(i))}return r},r.range=function(t){return arguments.length?(n=Array.from(t),r):n.slice()},r.unknown=function(t){return arguments.length?(i=t,r):i},r.copy=function(){return Wu(e,n).unknown(i)},xe.apply(r,arguments),r}function Uu(){var t,e,n=Wu().unknown(void 0),i=n.domain,r=n.range,a=0,o=1,s=!1,l=0,u=0,h=.5;function c(){var n=i().length,c=o<a,d=c?o:a,f=c?a:o;t=(f-d)/Math.max(1,n-l+2*u),s&&(t=Math.floor(t)),d+=(f-d-t*(n-l))*h,e=t*(1-l),s&&(d=Math.round(d),e=Math.round(e));var p=zu(n).map((function(e){return d+t*e}));return r(c?p.reverse():p)}return delete n.unknown,n.domain=function(t){return arguments.length?(i(t),c()):i()},n.range=function(t){return arguments.length?([a,o]=t,a=+a,o=+o,c()):[a,o]},n.rangeRound=function(t){return[a,o]=t,a=+a,o=+o,s=!0,c()},n.bandwidth=function(){return e},n.step=function(){return t},n.round=function(t){return arguments.length?(s=!!t,c()):s},n.padding=function(t){return arguments.length?(l=Math.min(1,u=+t),c()):l},n.paddingInner=function(t){return arguments.length?(l=Math.min(1,t),c()):l},n.paddingOuter=function(t){return arguments.length?(u=+t,c()):u},n.align=function(t){return arguments.length?(h=Math.max(0,Math.min(1,t)),c()):h},n.copy=function(){return Uu(i(),[a,o]).round(s).paddingInner(l).paddingOuter(u).align(h)},xe.apply(c(),arguments)}class Yu{constructor(t,e,n,i){this.numBars=10,this.labelBarPadding=6,this.labelFontSize=7,this.margin={top:12,left:110,bottom:10,right:10},this.onRegionMouseOver=null,this.onRegionMouseOut=null,this.onRegionClicked=null,this.evaluator=i,this._highlightedRegionID=null,this._currentHighlightedData=null,this._currentData=null,this.title=new qr(n);let r=n.append("div").attr("class","base-chart-container-ranked content-column");this.container=r.append("div").attr("class","ranked-chart-container"),this.svg=this.container.append("svg").attr("width","100%").attr("height","100%").style("overflow","visible"),this.svg.append("rect").attr("width","100%").attr("height","100%").attr("fill","rgba(0,0,0,0)").attr("stroke-width","2px").attr("stroke","none"),this.yAxisContainer=this.svg.append("g").attr("class","y-axis"),this.xAxisContainer=this.svg.append("g").attr("transform",`translate(0,${this.margin.top})`).attr("class","x-axis"),this.barContainer=this.svg.append("g"),this._summaryText=this.svg.append("text").attr("x",10).attr("y",e-10).attr("class","medium");let a=this;this.title.didTapStatAdjective=function(t){a._didToggleStatAdjective()}}barHeight(){return 15}_workingHeight(){return this.height-(this.margin.bottom+this.margin.top)}_rescaleAxes(){this.viewY=Uu().range([this.margin.top,this.height-this.margin.bottom]).paddingOuter(.25).align(.75),this.viewX=Re().range([this.margin.left,this.width-this.margin.right])}_didToggleStatAdjective(){let t=this.evaluator.toggledEvaluator();this.setEvaluator(t)}didResize(){this._parseDimensions()&&this.updateForData(this._currentData,this._currentHighlightedData,!1)}_parseDimensions(){let t=this.width,e=this.height;return this.width=parseInt(this.svg.style("width")),this.height=parseInt(this.svg.style("height")),(this.width!==t||this.height!==e)&&(this._rescaleAxes(),!0)}setEvaluator(t){this.evaluator=t,this.title.updateForContextChange(t,this.title.region,this.title.groupByUnit),this.updateForData(this._currentData,this._currentHighlightedData,!0)}_stringForNumber(t){return t<1e3?t.toString():O(",.2r")(t)}hoverRegionWithID(t){!t&&this._currentHighlightedData&&(t=this._currentHighlightedData.region.ID),this._highlightedRegionID&&this.barContainer.select("rect[regionID="+Yu.rectRegionID(this._highlightedRegionID)+"]").attr("stroke","none").attr("stroke-width",0),this._highlightedRegionID=t,t&&this.barContainer.select("rect[regionID="+Yu.rectRegionID(t)+"]").attr("stroke","rgba(0, 0, 0, 1.0)").attr("stroke-width",2)}_strokeWidthForRegionID(t){return t===this._highlightedRegionID?2:0}_strokeForRegionID(t){return t===this._highlightedRegionID?"rgba(0, 0, 0, 1.0)":"none"}updateAxesForData(t,e){let n=this;this.xDomain=[0,1.1*ht(t,t=>n.evaluator.valueForSnapshot(t))],this.viewX.domain(this.xDomain).nice(),this.viewY.domain(t.map(t=>t.region.name));let i=this.xAxisContainer.attr("dummy","marker");e&&(i=i.transition().duration(1e3));let r=this.viewX.ticks(4);0===r[0]&&this.xDomain[1]>=1e3&&(r[1]>1e4?r[0]=5e3:r[1]>1e3?r[0]=500:r[0]=100);let a=(o=this.viewX,Z(1,o)).ticks(4).tickSize(-this._workingHeight()).tickValues(r);var o;i.call(a).selectAll("text").attr("class","ranked-bar-tick-label");let s=this.yAxisContainer.attr("transform","translate(4,0)");e&&(s=s.transition().duration(1e3)),s.call($(this.viewY).tickSize(0)).attr("text-anchor","begin").selectAll("text").attr("class","ranked-bar-label unselectable"),this.xAxisContainer.selectAll("g.tick line").attr("class","ranked-bar-line"),this.yAxisContainer.selectAll("path.domain").style("display","none"),this.xAxisContainer.selectAll("path.domain").style("display","none")}updateForData(t,e,n){void 0===this.width&&this._parseDimensions(),this._currentData=t,this._currentHighlightedData=e;let i=this,r=Array.from(t.values());r.sort((t,e)=>i.evaluator.valueForSnapshot(e)-i.evaluator.valueForSnapshot(t)),r=r.slice(0,this.numBars),r=r.filter((function(t){return i.evaluator.valueForSnapshot(t)>0}));let a=r.map(t=>t.region.ID);null===e||a.includes(e.region.ID)||r.push(e),this.updateAxesForData(r,n);let o=this.barContainer.selectAll("rect").data(r,(function(t){return t.region.ID})).join((function(t){return t.append("rect").attr("regionID",t=>Yu.rectRegionID(t.region.ID)).attr("width",0).attr("x",i.viewX(0)).attr("height",i.barHeight()).attr("y",(function(t){return i.viewY(t.region.name)+.5*(i.viewY.bandwidth()-i.barHeight())})).on("mouseenter touchstart",(function(t){i._touchDidMove=!1,i._didMouseOverRegion(i,this,t)})).on("mouseleave touchmove",(function(t){i._touchDidMove=!0,i._didMouseOutRegion(i,this,t)})).on("touchend",(function(t){i._touchDidMove||(i._didClickRegion(i,this,t),Wi.c.preventDefault())})).on("click",(function(t){i._didClickRegion(i,this,t),this._touchDidMove=!1,Wi.c.preventDefault()}))}),(function(t){return t}),(function(t){return n&&(t=t.transition().duration(1e3)),t.attr("width",0).attr("transform","translate(0,"+i._workingHeight()+")").remove()}));n&&(i.svg.style("overflow","hidden"),o=o.transition().duration(1e3).on("end",(function(){i.svg.style("overflow","visible")}))),o.attr("fill","rgb(252, 185, 163)").attr("transform","translate(0, 0)").attr("stroke",t=>i._strokeForRegionID(t.region.ID)).attr("stroke-width",t=>i._strokeWidthForRegionID(t.region.ID)).attr("y",(function(t){return i.viewY(t.region.name)+.5*(i.viewY.bandwidth()-i.barHeight())})).attr("height",i.barHeight()).attr("width",t=>i.viewX(i.evaluator.valueForSnapshot(t))-i.viewX(0)),null!==e?this.hoverRegionWithID(e.region.ID):this.hoverRegionWithID(null)}_didMouseOverRegion(t,e,n){t.onRegionMouseOver&&t.onRegionMouseOver(n.region.ID)}_didMouseOutRegion(t,e,n){t.onRegionMouseOut&&t.onRegionMouseOut(n.region.ID)}_didClickRegion(t,e,n){t.onRegionClicked&&t.onRegionClicked(n.region.ID)}static rectRegionID(t){return void 0===t?"regionUndefined":"region"+Object(W.HashString)(t)}}class qu{constructor(t,e){this.label=t,this.value=e}}class Gu{constructor(t,e){this.stats=e,this.container=t.append("div").attr("class","stat-column"),this.labelDivs=new Map,this.valueDivs=new Map;let n=this;e.forEach((function(t){n.valueDivs.set(t.label,n.container.append("div").attr("class","stat-value").text(t.value)),n.labelDivs.set(t.label,n.container.append("div").attr("class","stat-label").text(t.label))}))}updateStat(t){this.valueDivs.get(t.label).text(t.value)}}class Qu{constructor(t,e){this.container=t.append("div").attr("class","stat-dashboard content-column"),this.numColumns=2,this.columnStats=new Array;let n=this;e.forEach((function(t,e){let i=e%n.numColumns;for(;n.columnStats.length<=i;)n.columnStats.push([]);n.columnStats[i].push(t)})),n.columns=[],this.columnStats.forEach((function(t){n.columns.push(new Gu(n.container,t))}))}updateForStats(t){let e=this;t.forEach((function(t,n){let i=n%e.numColumns;e.columns[i].updateStat(t)}))}}class Xu{constructor(t,e=!1){this.standalone=e;let n=e?" standalone":"",i=this;this.parent=t,this.form=t.append("form").attr("id","resizingForm").attr("class","region-select-text"+n),this.select=this.form.append("select").attr("id","resizingSelect").attr("class","title").on("change",(function(){i._didChange(this)})),this.onRegionSelected=null,this.selectedRegionID=null}elementSelection(){return this.form}_resize(t){let e=t.options[t.selectedIndex];if(void 0!==e){let t=this.form.append("select").attr("class","title sizing-only"),n=(t.append("option").text(e.text),t.style("width"));t.remove(),this.select.style("width",n)}}_didChange(t){this._resize(t);let e=t.options[t.selectedIndex];void 0!==e&&null!==this.onRegionSelected&&(this.selectedRegionID=e.value,this.onRegionSelected(this.selectedRegionID))}_currentlySelectedIndex(){return this.select.node().selectedIndex}setSelectedRegionWithID(t){let e=this.select.select("option[value='"+t+"']").node();null!==e?e.index!=this._currentlySelectedIndex()&&(this.select.node().selectedIndex=e.index,this._didChange(this.select.node())):console.log("No region in drop-down with ID: "+t)}updateForOptions(t){this.options=t,this.select.selectAll("optgroup").remove();let e=this;this.options.forEach((function(t,n){let i=e.select.append("optgroup").attr("label",n);t.forEach((function(t){i.append("option").attr("value",t.ID).text(e.standalone?t.fullyQualifiedName():t.qualifiedNameWithArticle())}))})),this._resize(this.select.node())}}class Ju{constructor(t,e="center",n=!1){let i=this;this.container=t.append("h2").attr("class","date-subtitle header-subtitle-element header-expanded-element"+(n?" standalone":"")).style("text-align",e);let r=this.container.append("span").attr("class","date-intro").text("Update for: ");n&&r.style("display","none"),this.yesterdayButton=this.container.append("span").attr("class","date-unselected").text("Yesterday").on("click",(function(){i._didClickDate(this)}));this.container.append("span").attr("class","date-divider").text(" | ");this.todayButton=this.container.append("span").attr("class","date-selected").text("Now").on("click",(function(){i._didClickDate(this)})),this.selectedButton=this.todayButton,this.dateFormatter=mn("%B %e"),this.today=null,this.onDateChanged=null}_didClickDate(t){t===this.yesterdayButton.node()?this._setLatest(!1):t===this.todayButton.node()&&this._setLatest(!0)}isLatest(){return this.selectedButton===this.todayButton}mostRecentDataIsFromToday(){let t=new Date,e=Object(_.e)(t.addHours(-3));return Object(_.i)(e)==Object(_.i)(this.today)}yesterday(){return this.today.addDays(-1)}_setLatest(t,e=!1){let n=t?this.todayButton:this.yesterdayButton;if(n!==this.selectedButton&&(this.selectedButton=n,this.todayButton.attr("class",t?"date-selected":"date-unselected"),this.yesterdayButton.attr("class",t?"date-unselected":"date-selected"),null!==this.onDateChanged&&!e)){let e=t?this.today:this.yesterday(),n=Object(_.d)(e);this.onDateChanged(n)}}setDate(t){null===this.today?this.setToday(t):this._setLatest(t.getTime()===this.today.getTime(),!0)}setToday(t){this.today=t,this.todayButton.text(this.dateFormatter(t)),this.yesterdayButton.text(this.mostRecentDataIsFromToday()?"Yesterday":this.dateFormatter(this.yesterday()))}}class Zu{constructor(t,e=!1){let n=this,i=e?" standalone":"";this.container=e?t:t.append("div").attr("class","nav-control"+i),this.backButton=this.container.append("div").attr("class","back-button"+i).on("touchstart",(function(){this._touchDidMove=!1})).on("touchmove",(function(){n._touchDidMove=!0})).on("touchend",(function(){n._touchDidMove||(n._backButtonClicked(),Wi.c.preventDefault())})).on("click",(function(){n._backButtonClicked(),Wi.c.preventDefault()})),this._touchDidMove=!1,this.titleSelection=null,this.didClickBackButton=null,this._backButtonVisible=!0,this.setBackButtonVisible(!1,!1)}setBackButtonVisible(t,e=!0){t!==this._backButtonVisible&&(this.backButton.style("display",t?"flex":"none"),this._backButtonVisible=t)}_backButtonClicked(){null!==this.didClickBackButton&&this.didClickBackButton()}}class $u{constructor(t,e,n){this.isLoading=!1,this.allRegions=e,this.parentElement=t,this.container=t.append("div").attr("class","header-container"),this.collapsedFeatureElement=null;this.titleContainer=this.container.append("div").attr("class","title title-container header-title-element content-column header-expanded-element").style("text-align","left"),this.titleNav=new Zu(this.titleContainer),this.titleTextContainer=this.titleNav.container.append("div").attr("class","title-text-container"),this.virusName=this.titleTextContainer.append("span").attr("class","robo-text").text("Coronavirus "),this.regionPreposition=this.titleTextContainer.append("span").attr("class","robo-text"),this.regionSelect=new Xu(this.titleTextContainer),this.dataByline=this.titleContainer.append("h3").attr("class","subtitle header-subtitle-element header-expanded-element").style("text-align","left").html("Data from the New&nbsp;York&nbsp;Times and the COVID&nbsp;Tracking&nbsp;Project"),this.dateSelector=new Ju(this.titleContainer,"left"),this.expandedElements=[this.titleContainer,this.dataByline,this.dateSelector.container],this.compactTitleContainer=this.container.append("div").attr("class","title title-container standalone header-collapsed-element").style("transform","translateY(-100%)"),this.compactTitleContent=this.compactTitleContainer.append("div").attr("class","standalone-title-content"),this.compactTitleNav=new Zu(this.compactTitleContent,!0),this.compactRegionSelect=new Xu(this.compactTitleContent,!0),this.compactDateSelector=new Ju(this.compactTitleContent,"right",!0),this.updateForOptions(e);let i=this;this.titleNav.didClickBackButton=function(){i._didClickBackButton()},this.compactTitleNav.didClickBackButton=this.titleNav.didClickBackButton,this._computeCollapsedLayout(),this.setCollapsed(!1,!1),this.didClickBackButton=null}_didClickBackButton(){null!==this.didClickBackButton&&this.didClickBackButton()}_computeCollapsedLayout(){let t=this.compactTitleContainer.node();if(this.minHeaderHeight=t.offsetTop+t.offsetHeight,this.maxHeaderHeight=this._currentHeaderNodeHeight(),null!==this.collapsedFeatureElement){let t=this.parentElement.node().offsetHeight,e=this.isCollapsed?t+(this.maxHeaderHeight-this.minHeaderHeight):t;this.parentElement.style("height",e+"px")}}_currentHeaderNodeHeight(){let t=this.container.node(),e=parseInt(this.container.style("padding-bottom").replace("px",""));return t.offsetTop+t.offsetHeight-e}setBackButtonVisible(t,e=!0){this.titleNav.setBackButtonVisible(t,e),this.compactTitleNav.setBackButtonVisible(t,e)}setFeaturedCollapseElement(t){this.collapsedFeatureElement=t,this._computeCollapsedLayout()}resetHeaderHeight(){this.parentElement.style("height","unset"),this._updateForResize(),this._computeCollapsedLayout()}_updateFeaturedElementPosition(t=!0){if(null===this.collapsedFeatureElement)return;let e=this.isCollapsed?this.minHeaderHeight-this.maxHeaderHeight-2:0,n=this.collapsedFeatureElement.container,i=n.node();t||i.classList.add("no-transition"),n.style("transform","translateY("+e+"px)"),t||setTimeout((function(){i.classList.remove("no-transition")}),30)}_addLoadingMessage(t,e=null,n=!1){let i=n?" standalone":"",r=n?"loading-title-standalone":"loading-title",a=t.insert("div",e).attr("class","region-select-text title "+r+i).text("Loading Counties");return a.append("div").attr("class","lds-ellipsis").html("<div></div><div></div><div></div><div></div>"),a}setIsLoading(t){this.isLoading!==t&&(t?(this.titleLoadingText=this._addLoadingMessage(this.titleContainer,"div.nav-control",!1),this.compactTitleLoadingText=this._addLoadingMessage(this.compactTitleContent,"form.region-select-text",!0),this.titleNav.container.style("display","none"),this.compactRegionSelect.elementSelection().style("display","none")):(this.titleLoadingText.remove(),this.compactTitleLoadingText.remove(),this.titleLoadingText=null,this.compactTitleLoadingText=null,this.titleNav.container.style("display","flex"),this.compactRegionSelect.elementSelection().style("display","flex")),this.isLoading=t)}setCollapsed(t,e){if(this.isCollapsed===t)return;this.isCollapsed=t;let n=1-(t?1:0);this.expandedElements.forEach((function(t){t.style("opacity",n)}));let i="translateY(-"+100*n+"%)",r=this.compactTitleContainer.node();e||r.classList.add("no-transition"),this.compactTitleContainer.style("transform",i),e||setTimeout((function(){r.classList.remove("no-transition")}),30),this._updateFeaturedElementPosition(e)}updateForRegion(t,e){this.regionPreposition.text(t.prepositionString()),this.setDate(e)}setDate(t){let e=new Date(t);e=Object(_.g)(e),this.dateSelector.setDate(e),void 0!==this.compactDateSelector&&this.compactDateSelector.setDate(e)}set onRegionSelected(t){this.regionSelect.onRegionSelected=t,this.compactRegionSelect.onRegionSelected=t}get onRegionSelected(){return this.regionSelect.onRegionSelected}_updateForResize(){let t=this._currentHeaderNodeHeight();t!==this.maxHeaderHeight&&(this.maxHeaderHeight=t,this._updateFeaturedElementPosition(!1))}setSelectedRegionWithID(t){this.regionSelect.setSelectedRegionWithID(t),this.compactRegionSelect.setSelectedRegionWithID(t),this._updateForResize()}updateForOptions(t){this.regionSelect.updateForOptions(t),this.compactRegionSelect.updateForOptions(t)}set onDateChanged(t){this.dateSelector.onDateChanged=t,this.compactDateSelector.onDateChanged=t}get onDateChanged(){return this.dateSelector.onDateChanged}}const Ku=0,th=1,eh=2,nh=3,ih=4;class rh{constructor(t,e=null){this.baseStat=-1,this.dateRange=e,this.recentDateRange=[e[1].addDays(-30),e[1]],this.didUpdateEvaluators=null;let n=this;this.baseStatToggle=t.append("div").attr("class","layer-toggles content-column"),this.caseButton=this.baseStatToggle.append("button").attr("class","toggle-button").text("Cases").on("click",(function(){n._didClickStatButton(this)})),this.deathButton=this.baseStatToggle.append("button").attr("class","toggle-button").text("Deaths").on("click",(function(){n._didClickStatButton(this)})),this.hospitalizationButton=this.baseStatToggle.append("button").attr("class","toggle-button").text("Hospitalizations").on("click",(function(){n._didClickStatButton(this)})),this.percentPositiveButton=this.baseStatToggle.append("button").attr("class","toggle-button").text("% Positive").on("click",(function(){n._didClickStatButton(this)})),this._setBaseStat(Ku)}currentEvaluators(){return rh.evaluatorsForConfiguration(this)}sortEvaluator(){let t=this.currentEvaluators();return t.length>1?t[1]:null}_didClickStatButton(t){let e=this._baseStatForButton(t);this._setBaseStat(e)}static activeClassName(){return"active"}_setBaseStat(t){if(this.baseStat===t)return;this.baseStat=t;const e=rh.activeClassName();this.baseStatToggle.selectAll("button").each((function(){this.classList.remove(e)})),this._buttonForBaseStat(t).classList.add(e),this._didUpdate()}_didUpdate(){this.didUpdateEvaluators&&this.didUpdateEvaluators(this.currentEvaluators())}_baseStatForButton(t){return t===this.caseButton.node()?Ku:t===this.deathButton.node()?th:t===this.hospitalizationButton.node()?eh:t===this.percentPositiveButton.node()?ih:t===this.testButton.node()?nh:void 0}_buttonForBaseStat(t){return t===Ku?this.caseButton.node():t===th?this.deathButton.node():t===eh?this.hospitalizationButton.node():t===ih?this.percentPositiveButton.node():t===nh?this.testButton.node():void 0}static evaluatorsForConfiguration(t){let e=[];return t.baseStat===Ku?e=[va.newConfirmedCaseEvaluator(),va.newCaseTrendEvaluator(),va.newCaseGraphicEvaluator(t.dateRange)]:t.baseStat===th?e=[va.newDeathEvaluator(),va.newDeathTrendEvaluator(),va.newDeathGraphicEvaluator(t.dateRange)]:t.baseStat===nh?e=[va.newTestEvaluator(),va.newTestTrendEvaluator(),va.newTestGraphicEvaluator(t.dateRange)]:t.baseStat===eh?e=[va.currentlyHospitalizedEvaluator(),va.currentlyHospitalizedTrendEvaluator(),va.currentlyHospitalizedGraphicEvaluator(t.dateRange)]:t.baseStat===ih&&(e=[va.newTestPercentPositiveEvaluator(!0),va.dailyPercentPositiveTrendEvaluator(),va.dailyPercentPositiveGraphicEvaluator(t.recentDateRange)]),[va.regionNameEvaluator()].concat(e)}}class ah{constructor(t,e,n,i,r,a,o){this.firstDay="2020-03-04",this.baseRegion=a,this._nextRegionQueue=[],this.previouslySelectedRegionID=null,this._inRegionSet=!1,this._inDataChange=!1,this._processingURL=!1,this._processingHash=!0,this.didSelectCounty=null;const s=this;this.setNationData(i),this.setCoalitionData(r),this.setStateData(n),this.setCountyData(e);let l=[this.nationInfectionData.firstDay,this.nationInfectionData.lastDay];this.headerSpacer=t.append("div").attr("class","header-spacer"),this.statDashboard=new Qu(t,this._coreStatsForSnapshot(null)),this.tableConfiguration=new rh(t,l),this.tableConfiguration.didUpdateEvaluators=function(t){let e=s.tableConfiguration.sortEvaluator(),n=e.supportsRegionType(s.dataTable.childRegionType()),i=s.dataTable.highlightedRegionID===s.selectedRegionID,r=!n||!i;s.dataTable.updateForEvaluators(t,e,!1,r),r&&s.updateDataTable(!1)},this.dataTable=new Da(t,this.tableConfiguration.currentEvaluators(),this.tableConfiguration.sortEvaluator());let u=this._overTimeEvaluators();this.overTimeCharts=[],u.forEach((function(e){let n=new ra(t,e);n.fixTimeDomain(l[0],l[1]),s.overTimeCharts.push(n)}));let h=this._rankedBarChartEvaluators();this.rankedBarCharts=[],h.forEach((function(e){let n=new Yu(600,400,t,e);s.rankedBarCharts.push(n)})),this.interactiveElements=[this.dataTable].concat(this.overTimeCharts).concat(this.rankedBarCharts),this.attributionDetails=this._pageAttribution(t),this.headerContainer=t.append("div").attr("class","fixed-header-summary"),this.header=new $u(this.headerContainer,this._regionMenuGroups(),l),this.map=new Lu(900,450,this.headerContainer,o,va.confirmedCaseEvaluator()),this.header.setFeaturedCollapseElement(this.map),this._updateFixedRegionSpacing(),this.selectedRegionID=a.ID,this.hoveredRegionID=null,this.lastWindowWidthUpdate=window.outerWidth,window.addEventListener("resize",(function(){s.didResize()})),window.addEventListener("scroll",(function(){s.didScroll(this,!s._processingHash)})),window.onpopstate=function(t){let e=s.deepestAvailableRegionFromCurrentURLPath().ID;e!==s.selectedRegionID&&s.setRegion(e,!0,"BrowserBackButton")},this.map.onRegionClicked=function(t){s._vizClickedRegionID(t,s.map)},this.header.onRegionSelected=function(t){s._vizClickedRegionID(t,s.header)},this.header.onDateChanged=function(t){s.setDay(t,!0)},this.header.didClickBackButton=function(){let t=s._currentRegion(),e=null!==t.parentRegion?t.parentRegion:s.baseRegion;s._vizClickedRegionID(e.ID,s.header)},this.dataTable.onRegionClicked=function(t){s._vizClickedRegionID(t,s.dataTable)},this.overTimeCharts.forEach((function(t){null!==t.title&&(t.title.didTapRegionDescription=function(e){s._vizClickedRegionID(e.ID,t)}),t.hoverBoundsEvaluator=function(){return s.currentHoverBounds()}})),this.rankedBarCharts.forEach((function(t){null!==t.title&&(t.title.didTapRegionDescription=function(e){s._vizClickedRegionID(e.ID,t)}),t.onRegionClicked=function(e){s._vizClickedRegionID(e,t)},t.onRegionMouseOver=function(t){s.setHoveredRegion(t)},t.onRegionMouseOut=function(t){s.setHoveredRegion(null)}})),this.map.onRegionMouseOver=function(t){s.setHoveredRegion(t)},this.map.onRegionMouseOut=function(t){s.setHoveredRegion(null)},this.map.onOceanClicked=function(){s.unsetRegion(!0)},this.map.didScrollAwayFromHighlightedState=function(){console.log("Did scroll away from highlighted state"),s.unsetRegion(!1)},this.collapsed=!1,this.lastScrollOffset=0,this.didScroll(window,!1);let c=this.processURLPath(!1);this.setDay(this.nationInfectionData.lastDayString()),this.selectedRegionID!==this.baseRegion.ID&&(this.zoomToRegion(this.selectedRegionID,!1),this.map.highlightRegionsWithIDs(this._mapRegionIDsForRegionID(this.selectedRegionID),!1)),this.processURLHash(),c&&this.header.setIsLoading(!0)}floatingHeaderBottomY(){let t=this.map.windowBounds();return t.y+t.height}currentHoverBounds(){let t=new _a(0,0,window.innerWidth,window.innerHeight),e=this.floatingHeaderBottomY()+8;return new _a(t.x,e,t.width,t.height-e)}currentlyFocusedChartElement(){let t=this.floatingHeaderBottomY();for(let e=0;e<this.interactiveElements.length;e++){let n=this.interactiveElements[e].container.node();if(n.getBoundingClientRect().y>=t)return n}return null}chartIsVisible(t){let e=t.container.node(),n=_a.fromSVGRect(e.getBoundingClientRect()),i=this.currentHoverBounds(),r=n.top()>i.top()&&n.top()<i.bottom(),a=n.bottom()>i.top()&&n.bottom()<i.bottom();return r||a}setNationData(t){this.nationInfectionData=t?t.timeSeriesBeginningAt(this.firstDay):null}setCoalitionData(t){t?(this.coalitionInfectionData=t.timeSeriesBeginningAt(this.firstDay),this.enqueueTopRegions()):this.coalitionInfectionData=null}setStateData(t){t?(this.stateInfectionData=t.timeSeriesBeginningAt(this.firstDay),void 0!==this.currentDay&&(void 0!==this.header&&this.header.updateForOptions(this._regionMenuGroups()),this.updateRankedChartForDay(this.currentDay,!1),this.updateDashboard(!1),this.updateDataTable(!1))):this.stateInfectionData=null}setCountyData(t){let e=null==this.countyInfectionData;if(t){this.countyInfectionData=t.timeSeriesBeginningAt(this.firstDay);let n=this,i=this.selectedRegionID;this._preserveContentOffsetAroundBlock((function(){n.header.setIsLoading(!1),e&&n._regionIsState(n.dataTable.aggregateRegionID)&&n.updateDataTable(!1);let t=n._regionIsState(i)||n._regionIsCounty(i);e&&t&&n.updateRankedChartForDay(n.currentDay,!1),void 0!==n.map&&n.updateMapForDay(n.currentDay,!0)}))}else this.countyInfectionData=null}processURLHash(t=!1){let e=window.location.hash.split("#").filter((function(t){return t.length>0}));this._processingHash=!0,e.length>0&&(console.log("Processing hash: "+e[0]),window.location=location.href);let n=this;setTimeout((function(){n._processingHash=!1}),100)}processURLPath(t=!0,e=!1,n=!1){let i=ah.CurrentURLComponents(),r=this.deepestAvailableRegionFromBreadCrumb(i),a=i.length>1&&!this._regionIsCounty(r.ID),o=null!==this.countyInfectionData&&i.length>1&&!this._regionIsCounty(r.ID),s=i.length>0&&r.ID===this.baseRegion.ID;return o||s?(console.log("404: No region for: "+i.last()),this.updateBrowserStateForRegion(this.regionForRegionID(this.selectedRegionID)),!1):(this._processingURL=!0,t&&r.ID!==this.baseRegion.ID?(this.setRegion(r.ID,!1,this,null,e),this.zoomToRegion(r.ID,this._regionIsCounty(r.ID))):this.selectedRegionID=r.ID,r.ID!==this.baseRegion.ID&&this.resetRegionQueue(),n&&this.registerPageView(),this._processingURL=!1,a)}static CurrentURLComponents(){return window.location.pathname.split("/").filter((function(t){return t.length>0}))}deepestAvailableRegionFromCurrentURLPath(){let t=ah.CurrentURLComponents();return this.deepestAvailableRegionFromBreadCrumb(t)}_decodeURLRegionName(t){return t.replace(/-/g," ")}_encodeURLRegionName(t){return t.replace(/ /g,"-")}deepestAvailableRegionFromBreadCrumb(t){if(0===t.length)return this.baseRegion;let e=this._decodeURLRegionName(t[0]),n=this._datasetForRegionName(e);if(null===n)return this.baseRegion;let i=n.regionWithName(e);if(1===t.length||null===this.countyInfectionData)return i;let r=c.normalizeRegionName(this._decodeURLRegionName(t[1])),a=this.countyInfectionData.topRegions(0,(function(t){if(null!==t.region.parentRegion&&t.region.parentRegion.ID===i.ID){return c.normalizeRegionName(t.region.name)===r}return!1}),va.regionNameEvaluator());return null===a||0===a.length?i:a[0]}updateCountryGeometry(t){this.map.updateForCountryGeometry(t)}updateMobilityChart(){let t=this.overTimeCharts.last(),e=this.currentOverTimeDataSlice(this.currentDay),n=this;this._preserveContentOffsetAroundBlock((function(){n.updateOverTimeChart(t,n.currentDay,n._currentRegion(),e,!0)}))}isStateSelected(){return this._regionIsState(this.selectedRegionID)}isCoalitionSelected(){return this._regionIsCoalition(this.selectedRegionID)}didResize(){let t=window.innerWidth;t!==this.lastWindowWidthUpdate&&(this.header.resetHeaderHeight(),this._updateFixedRegionSpacing(),this.map.didResize(),this.overTimeCharts.forEach((function(t){t.didResize()})),this.rankedBarCharts.forEach((function(t){t.didResize()})),this.lastWindowWidthUpdate=t)}didScroll(t,e=!0){let n=t.scrollY;this.lastScrollOffset<20&&!(n<20)?this.setHeaderCollapsed(!0,e):this.collapsed&&n<=0&&this.setHeaderCollapsed(!1,e),this.lastScrollOffset=n}enqueueTopRegions(){null!==this.coalitionInfectionData&&(this._nextRegionQueue=this.coalitionInfectionData.topRegions(0,null,va.newConfirmedCaseEvaluator()))}resetRegionQueue(){this._nextRegionQueue=[]}popNextRegion(){return this._nextRegionQueue.shift()}setHeaderCollapsed(t,e){this.collapsed!==t&&(this.collapsed=t,this.headerContainer.attr("compact",t?"":null),this.header.setCollapsed(t,e),this.map.setCompactView(t))}_overTimeEvaluators(){return[va.newConfirmedCaseEvaluator(),va.newDeathEvaluator(),va.currentlyHospitalizedEvaluator(),va.newTestBreakdownEvaluator(),va.newTestPercentPositiveEvaluator(),ju.mobilityDataEvaluator()]}_rankedBarChartEvaluators(){return[va.EvaluatorWithAnchor(va.newConfirmedCaseEvaluator(),"ranked-cases"),va.EvaluatorWithAnchor(va.newDeathEvaluator(),"ranked-deaths")]}_updateFixedRegionSpacing(){let t=this.headerContainer.node().offsetHeight;this.headerSpacer.style("height",t+"px")}_regionMenuGroups(){let t=new Map;t.set("Country",[this.baseRegion]),null!==this.coalitionInfectionData&&t.set("Regions",this.coalitionInfectionData.topRegions()),null!==this.stateInfectionData&&t.set("States",this.stateInfectionData.topRegions(0,null,va.regionNameEvaluator(),!0));let e=this._currentRegion();if(null!==e&&null!==this.countyInfectionData){let n=this._regionIsState(e.ID),i=this._regionIsCounty(e.ID);if(n||i){let i=n?e:e.parentRegion,r=this.countyInfectionData.topRegions(0,(function(t){return null!==t.region.parentRegion&&t.region.parentRegion.ID===i.ID}),va.regionNameEvaluator(),!0);t.set(i.name+" Counties",r)}}return t}_currentInfectionSnapshot(){let t=this._currentDataset(),e=this.currentDay,n=t.dataForDay(e),i=this.selectedRegionID?this.selectedRegionID:this.baseRegion.ID;return n.get(i)}_coreStatsForSnapshot(t){let e=t?t.infection:y.NullInfection(),n=O(","),i=[];return i.push(new qu("Total Cases",e.cases?n(e.cases.value):"N/A")),i.push(new qu("Deaths",e.deaths?n(e.deaths.value):"N/A")),i}_elementSupportsRepeatedSelection(t,e){return t===this.dataTable&&(e!==this.dataTable.aggregateRegionID&&e===this.dataTable.highlightedRegionID&&!this._regionIsCounty(e))}_elementRequiresUpdateForRegion(t,e){return t!==this.dataTable||e===this.dataTable.highlightedRegionID}_vizClickedRegionID(t,e){if(this._inSelectionCallback||this._inRegionSet)return;this._inSelectionCallback=!0;let n=this.regionForRegionID(t),i=t=n.ID,r=this.selectedRegionID===t;r&&this.selectedRegionID===this.baseRegion.ID&&this.enqueueTopRegions(),r?this._elementSupportsRepeatedSelection(e,t)||(i=this._nextRegionQueue.length>0?this.popNextRegion().ID:(n.parentRegion?n.parentRegion:this.baseRegion).ID):this.resetRegionQueue(),this.setRegion(i,this._shouldZoomToRegion(i),e,t),this.selectedRegionID===this.baseRegion.ID&&this.map.resetZoom(),this._inSelectionCallback=!1}setHoveredRegion(t){if(this.hoveredRegionID===t)return;this.hoveredRegionID=t;let e=this._mapRegionIDsForRegionID(t);this.map.hoverRegionWithID(e[0]),this.rankedBarCharts.forEach((function(e){e.hoverRegionWithID(t)}))}setEvaluator(t){this._inEvaluatorCallback||(this._inEvaluatorCallback=!0,this.map.setEvaluator(t),this.updateTitles(),this._inEvaluatorCallback=!1)}_mapRegionIDsForRegionID(t){if(this._regionIsCoalition(t)){return this.regionForRegionID(t).subregionIDs}{let e=this._regionAliasesForRegion(t);if(void 0!==e&&e.length>0)return e}return[t]}zoomToRegion(t,e=!0){let n=this._mapRegionIDsForRegionID(t);if(t){let i=1;this._regionIsCounty(t)?i=3:this._regionIsCoalition(t)&&(i=.8);let r=this.map.boundingBoxForRegions(n,i);this.map.zoomToBox(r,e)}}setRegion(t,e=!0,n=null,i=null,r=!0){if(this.selectedRegionID===t&&!this._elementSupportsRepeatedSelection(n,i))return;if(this._inRegionSet||this._inDataChange)return;this._inRegionSet=!0,console.log("Setting region ID: "+t),this.previouslySelectedRegionID=this.selectedRegionID,this.selectedRegionID=t,this._regionIsCounty(t)&&null!==this.didSelectCounty&&this.didSelectCounty(this.countyInfectionData);let a=this;this._preserveContentOffsetAroundBlock((function(){"BrowserBackButton"===n||a._processingURL||a.updateBrowserStateForRegion(a._currentRegion()),a._updateForDataChange(e,!1,n,i,r)})),this._inRegionSet=!1}_preserveContentOffsetAroundBlock(t){let e=-1,n=this.lastScrollOffset<20?null:this.currentlyFocusedChartElement();if(null!==n&&(e=n.getBoundingClientRect().y),t(),null!==n){let t=n.getBoundingClientRect().y;t!=e&&window.scrollBy(0,t-e)}}_updateForDataChange(t=!0,e=!0,n=null,i=null,r=!1){this._inDataChange||(this._inDataChange=!0,this.header.setBackButtonVisible(this.selectedRegionID!==this.baseRegion.ID,r),this.updateHeader(r),e&&this.updateMapForDay(this.currentDay,r),this.map.highlightRegionsWithIDs(this._mapRegionIDsForRegionID(this.selectedRegionID),r),t&&this.zoomToRegion(this.selectedRegionID,r),this.updateDashboard(r),this.updateDataTable(r,n,i),this.updateTitles(r),this.updateOverTimeChartsForDay(this.currentDay,r),this.updateRankedChartForDay(this.currentDay,r),this._inDataChange=!1)}regionForRegionID(t){if(void 0===t)return null;let e=this._datasetForRegionID(t);return null===e?null:e.regionForID(t)}unsetRegion(t){this.setRegion(this.baseRegion.ID,!1),t&&this.map.resetZoom()}_regionIsState(t){return this._datasetForRegionID(t)===this.stateInfectionData}_regionIsCounty(t){return this._datasetForRegionID(t)===this.countyInfectionData}_regionIsCoalition(t){return this._datasetForRegionID(t)===this.coalitionInfectionData}_regionIsNation(t){return this._datasetForRegionID(t)===this.nationInfectionData}_regionAliasesForRegion(t){let e=this._datasetForRegionID(t);if(null!==e)return e.regionAtlas.aliasesForRegion(t)}_shouldZoomToRegion(t){return this._regionIsState(t)||this._regionIsCoalition(t)||this._regionIsCounty(t)}_datasetForRegionID(t){return void 0===t?null:null===t?this.nationInfectionData:null!==this.stateInfectionData&&this.stateInfectionData.containsRegion(t)?this.stateInfectionData:null!==this.nationInfectionData&&this.nationInfectionData.containsRegion(t)?this.nationInfectionData:null!==this.countyInfectionData&&this.countyInfectionData.containsRegion(t)?this.countyInfectionData:null!==this.coalitionInfectionData&&this.coalitionInfectionData.containsRegion(t)?this.coalitionInfectionData:null}_datasetForRegionName(t){return void 0===t?null:null===t||null!==this.nationInfectionData&&this.nationInfectionData.containsRegionName(t)?this.nationInfectionData:null!==this.coalitionInfectionData&&this.coalitionInfectionData.containsRegionName(t)?this.coalitionInfectionData:null!==this.stateInfectionData&&this.stateInfectionData.containsRegionName(t)?this.stateInfectionData:null!==this.countyInfectionData&&this.countyInfectionData.containsRegionName(t)?this.countyInfectionData:null}_datasetForRegionType(t){switch(t){case o:return this.nationInfectionData;case s:return this.coalitionInfectionData;case l:return this.stateInfectionData;case u:return this.countyInfectionData}return null}_currentDataset(){return this._datasetForRegionID(this.selectedRegionID)}_currentDaysData(){return this._currentDataset().dataForDay(this.currentDay)}_currentRegion(){return this.regionForRegionID(this.selectedRegionID)}updateDashboard(t){let e=this._currentInfectionSnapshot(),n=this._coreStatsForSnapshot(e);this.statDashboard.updateForStats(n)}updateDataTable(t,e=null,n=null){let i=this._currentRegion(),r=i,a=this.dataTable.sortEvaluator,o=a.supportsRegionType(i.type);if(o||(i=i.parentRegion,r=i.topParent()),this.dataTable.dataIsIncomplete=this.header.dateSelector.isLatest()&&this.header.dateSelector.mostRecentDataIsFromToday(),this._elementRequiresUpdateForRegion(e,n)){let e=i.type+1;!a.supportsRegionType(e)&&o&&(r=i.type===l?i.topParent():i.parentRegion);let n=this._datasetForRegionID(r.ID),s=this._childDataSetForRegionOnDay(r.ID,this.currentDay),u=n.snapshotForDay(this.currentDay,r.ID);this.dataTable.updateForData(u,s,t,!0)}this.dataTable.updateForHighlightedRegion(i.ID)}updateBrowserStateForRegion(t){console.log("Updating browser history for: "+t.name);let e=t.ID===this.baseRegion.ID?"/":this.URLPathForRegion(t);history.pushState({regionID:t.ID},document.title,e),this.registerPageView()}registerPageView(){if("function"==typeof gtag){let t=window.location.pathname,e=document.title;gtag("config","UA-164933561-1",{page_title:e,page_path:t})}}URLPathForRegion(t){let e=[t];this._regionIsCounty(t.ID)&&e.unshift(t.parentRegion);let n=this;return e=e.map((function(t){return"/"+n._encodeURLRegionName(c.normalizeRegionName(t.name))})),e.join("")}updateTitles(t){let e=this.regionForRegionID(this.selectedRegionID),n=this;if(document.title="Coronavirus "+e.preposition+" "+e.qualifiedNameWithArticle(),this.overTimeCharts.forEach((function(i){if(null!==i.title){let r=n.chartIsVisible(i);i.title.updateForContextChange(i.evaluator,e,"day",t&&r)}})),!this._regionIsCounty(e.ID)){let i=this._regionIsState(e.ID)?"county":"state";this.rankedBarCharts.forEach((function(r){if(null!==r.title){let a=n.chartIsVisible(r);r.title.updateForContextChange(r.evaluator,e,i,t&&a)}}))}}updateHeader(t){this.updateHeaderDay(t),this.header.updateForOptions(this._regionMenuGroups()),this.header.setSelectedRegionWithID(this.selectedRegionID)}updateHeaderDay(t){this.header.updateForRegion(this._currentRegion(),this.currentDay)}updateMapForDay(t,e){null!==this.countyInfectionData&&this.map.updateMapForDay(t,this.countyInfectionData,e)}_currentChildDataSetForDay(t){return this._childDataSetForRegionOnDay(this._currentRegion().ID,t)}_childDataSetForRegionOnDay(t,e){let n=this._datasetForRegionID(t),i=n===this.stateInfectionData,r=n===this.coalitionInfectionData,a=n===this.countyInfectionData,o=null;if((i||r)&&t){let n=i?this.countyInfectionData:this.stateInfectionData;null!==n&&(o=n.dataForDay(e,(function(e){const n=e.region.parentRegion;return null!==n?n.ID===t:(console.log("missing parent region for: "+e.region.name+", ID: "+e.region.ID),!1)})))}else a||null===this.stateInfectionData||(o=this.stateInfectionData.dataForDay(e));return o}updateRankedChartForDay(t,e){if(null===this.stateInfectionData)return;this._currentDataset();let n=this._currentRegion(),i=n,r=null,a=null;n.type===u&&(i=n.parentRegion,r=n);let o=this._childDataSetForRegionOnDay(i.ID,t);if(null===o&&(o=this.stateInfectionData.dataForDay(t)),null!==r&&(a=o.get(r.ID)),null!==o){let t=this;this.rankedBarCharts.forEach((function(n){let i=t.chartIsVisible(n);n.updateForData(o,a,e&&i)}))}}updateOverTimeChart(t,e,n,i,r){let a=t.evaluator;if(!a.supportsRegionType(n.type))return void t.hide(r);if(t.show(r),null!==a.benchmarkEvaluator)if("0000"===n.ID)t.benchmarkSeries=null;else if(null===t.benchmarkSeries){let n=this._datasetForRegionType(a.benchmarkRegionType).timeSeriesEndingAt(e).dataSliceForRegionID("0000");t.benchmarkSeries=new $r(n,a.benchmarkEvaluator)}let o=this.chartIsVisible(t);t.updateForData(i,r&&o),t.updateDescriptionForRegion(n)}currentOverTimeDataSlice(t){let e=this._currentDataset().timeSeriesEndingAt(t),n=this.selectedRegionID?this.selectedRegionID:"0000";return e.dataSliceForRegionID(n)}updateOverTimeChartsForDay(t,e){let n=this.currentOverTimeDataSlice(t);if(n){let i=this,r=this._currentRegion(),a=this.overTimeCharts.length;for(let o=0;o<a;o++){let s=i.overTimeCharts[a-1-o];i.updateOverTimeChart(s,t,r,n,e)}}}setDay(t,e=!1){if(this.currentDay===t)return;this.previousDay=this.currentDay,this.currentDay=t;let n=void 0===this.previousDay;this._updateForDataChange(!1,n,null,null,e)}_pageAttribution(t){return t.append("div").attr("class","attribution-footer content-column").html('<p>Data is updated and aggregated every hour according to the following open-source datasets:</p><p>Case and death data is reported via <a href="https://www.nytimes.com/interactive/2020/us/coronavirus-us-cases.html">The New York Times</a>. Testing and hospitalization data is reported via the <a href="https://covidtracking.com/">COVID Tracking Project</a>. Visitation data is calculated via <a href="https://www.google.com/covid19/mobility/">Google Community Mobility Reports</a>.</p><p>Site is developed and maintained by <a href="https://www.twitter.com/codeblue87">Ben Cunningham</a>. Front-end code is available on <a href="https://github.com/bcunning/CoronaViz">github</a>.</p>')}}var oh=!1,sh=null;function lh(t,e,n){console.time("Process top-level Data");let i=new c,o=ya.fromJSONObject(e.nationData,i),s=null,l=null,u=null;i.addAll(o.regionAtlas),o.updateForMobilityJSON(n);let h=o.topRegion();var d;void 0!==e.coalitionData&&(s=ya.fromJSONObject(e.coalitionData,i),i.addAll(s.regionAtlas)),void 0!==e.stateData&&(l=ya.fromJSONObject(e.stateData,i),i.addAll(l.regionAtlas)),console.timeEnd("Process top-level Data"),console.log("Begin County CSV Load"),console.time("Load County CSVs"),Promise.all([r("/processed-data/data-county.json?d=LastUpdateToken"),r("/topo/counties-10m.json"),r("/processed-data/mobility-coalition.json?d=LastUpdateToken")]).then((function(t){console.timeEnd("Load County CSVs");let e=t[0],n=t[1],r=t[2];console.time("Process remaining region data"),s.updateForMobilityJSON(r),sh.isCoalitionSelected()&&sh.updateMobilityChart(),void 0!==e.countyData&&(console.time("Parse county JSON"),u=ya.fromJSONObject(e.countyData,i),console.timeEnd("Parse county JSON")),console.timeEnd("Process remaining region data"),void 0!==n&&(console.time("Create county paths"),sh.updateCountryGeometry(n),console.timeEnd("Create county paths")),null!==u&&(console.time("Update county fill"),sh.setCountyData(u),sh.processURLPath(!0,!1,!0),console.timeEnd("Update county fill")),console.timeEnd("Full Site Load")})),d=l,console.time("Load State mobility data"),Promise.all([r("/processed-data/mobility-state.json?d=LastUpdateToken")]).then((function(t){console.timeEnd("Load State mobility data"),console.time("Process State mobility data");let e=t[0];d.updateForMobilityJSON(e),sh.isStateSelected()&&sh.updateMobilityChart(),console.timeEnd("Process State mobility data")})),console.log("Begin building initial view"),console.time("Build initial view"),(sh=new ah(Object(a.a)("body"),u,l,o,s,h,t)).didSelectCounty=function(t){oh||(oh=!0,function(t){console.time("Load county mobility data"),Promise.all([r("/processed-data/mobility-county.json?d=LastUpdateToken")]).then((function(e){console.timeEnd("Load county mobility data"),console.time("Process county mobility data");let n=e[0];t.updateForMobilityJSON(n),sh.updateMobilityChart(),console.timeEnd("Process county mobility data")}))}(t))},console.timeEnd("Build initial view"),console.timeEnd("First site load")}console.time("Full Site Load"),console.time("First site load"),console.time("Load top-level CSVs"),Promise.all([r("/topo/states-10m.json"),r("/processed-data/data-nation-state.json?d=LastUpdateToken"),r("/processed-data/mobility-nation.json?d=LastUpdateToken")]).then((function(t){console.timeEnd("Load top-level CSVs"),lh(t[0],t[1],t[2])}))}])}));
//# sourceMappingURL=CoronaBundle.js.map