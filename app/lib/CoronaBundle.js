!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define("CoronaBundle",[],e):"object"==typeof exports?exports.CoronaBundle=e():t.CoronaBundle=e()}(window,(function(){return function(t){var e={};function n(i){if(e[i])return e[i].exports;var r=e[i]={i:i,l:!1,exports:{}};return t[i].call(r.exports,r,r.exports,n),r.l=!0,r.exports}return n.m=t,n.c=e,n.d=function(t,e,i){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var r in t)n.d(i,r,function(e){return t[e]}.bind(null,r));return i},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=22)}({10:function(t,e,n){"use strict";n.d(e,"c",(function(){return r})),n.d(e,"a",(function(){return h}));var i={},r=null;"undefined"!=typeof document&&("onmouseenter"in document.documentElement||(i={mouseenter:"mouseover",mouseleave:"mouseout"}));function a(t,e,n){return t=o(t,e,n),function(e){var n=e.relatedTarget;n&&(n===this||8&n.compareDocumentPosition(this))||t.call(this,e)}}function o(t,e,n){return function(i){var a=r;r=i;try{t.call(this,this.__data__,e,n)}finally{r=a}}}function s(t){return t.trim().split(/^|\s+/).map((function(t){var e="",n=t.indexOf(".");return n>=0&&(e=t.slice(n+1),t=t.slice(0,n)),{type:t,name:e}}))}function u(t){return function(){var e=this.__on;if(e){for(var n,i=0,r=-1,a=e.length;i<a;++i)n=e[i],t.type&&n.type!==t.type||n.name!==t.name?e[++r]=n:this.removeEventListener(n.type,n.listener,n.capture);++r?e.length=r:delete this.__on}}}function l(t,e,n){var r=i.hasOwnProperty(t.type)?a:o;return function(i,a,o){var s,u=this.__on,l=r(e,a,o);if(u)for(var h=0,c=u.length;h<c;++h)if((s=u[h]).type===t.type&&s.name===t.name)return this.removeEventListener(s.type,s.listener,s.capture),this.addEventListener(s.type,s.listener=l,s.capture=n),void(s.value=e);this.addEventListener(t.type,l,n),s={type:t.type,name:t.name,value:e,listener:l,capture:n},u?u.push(s):this.__on=[s]}}function h(t,e,n,i){var a=r;t.sourceEvent=r,r=t;try{return e.apply(n,i)}finally{r=a}}e.b=function(t,e,n){var i,r,a=s(t+""),o=a.length;if(!(arguments.length<2)){for(h=e?l:u,null==n&&(n=!1),i=0;i<o;++i)this.each(h(a[i],e,n));return this}var h=this.node().__on;if(h)for(var c,d=0,f=h.length;d<f;++d)for(i=0,c=h[d];i<o;++i)if((r=a[i]).type===c.type&&r.name===c.name)return c.value}},14:function(t,e,n){"use strict";function i(){return[]}e.a=function(t){return null==t?i:function(){return this.querySelectorAll(t)}}},15:function(t,e,n){"use strict";e.a=function(t){return function(){return this.matches(t)}}},16:function(t,e,n){"use strict";n.d(e,"b",(function(){return s}));var i=n(9);function r(t){return function(){this.style.removeProperty(t)}}function a(t,e,n){return function(){this.style.setProperty(t,e,n)}}function o(t,e,n){return function(){var i=e.apply(this,arguments);null==i?this.style.removeProperty(t):this.style.setProperty(t,i,n)}}function s(t,e){return t.style.getPropertyValue(e)||Object(i.a)(t).getComputedStyle(t,null).getPropertyValue(e)}e.a=function(t,e,n){return arguments.length>1?this.each((null==e?r:"function"==typeof e?o:a)(t,e,null==n?"":n)):s(this.node(),t)}},17:function(t,e,n){"use strict";var i=n(3);e.a=function(t){return"string"==typeof t?new i.a([[document.querySelector(t)]],[document.documentElement]):new i.a([[t]],i.c)}},175:function(t,e,n){"use strict";n.d(e,"b",(function(){return i})),n.d(e,"a",(function(){return r})),n.d(e,"d",(function(){return o})),n.d(e,"i",(function(){return s})),n.d(e,"f",(function(){return u})),n.d(e,"g",(function(){return l})),n.d(e,"e",(function(){return h})),n.d(e,"h",(function(){return c})),n.d(e,"c",(function(){return d}));const i=36e5,r=24*i;var a=new Map;function o(t){return`${new Intl.DateTimeFormat("en",{year:"numeric"}).format(t)}-${new Intl.DateTimeFormat("en",{month:"2-digit"}).format(t)}-${new Intl.DateTimeFormat("en",{day:"2-digit"}).format(t)}`}function s(t){return`${new Intl.DateTimeFormat("en",{month:"short"}).format(t)} ${new Intl.DateTimeFormat("en",{day:"numeric"}).format(t)}`}function u(t){return t.toLocaleDateString("en-US",{month:"long",day:"numeric",year:"numeric"})}function l(t){let e=t.getTime(),n=a.get(e);if(void 0===n){let i=e+6e4*t.getTimezoneOffset();n=new Date(i),a.set(e,n)}return n}function h(t){return new Date(t.getTime()-6e4*t.getTimezoneOffset())}function c(t,e,n=!0){let i=(e.getTime()-t.getTime())/r;return n&&(i=Math.round(i)),i}function d(t){let e=new Date(t);return e=l(e),e}},22:function(t,e,n){n(5),n(23),t.exports=n(24)},23:function(t,e,n){"use strict";n.r(e);var i=n(3),r=n(17);i.b.prototype.moveToFront=function(){return this.each((function(){this.parentNode.appendChild(this)}))},i.b.prototype.moveToBack=function(){return this.each((function(){let t=this.parentNode.firstChild;t&&this.parentNode.insertBefore(this,t)}))},i.b.prototype.first=function(){return Object(r.a)(this._groups[0][0])},i.b.prototype.last=function(){let t=this.size()-1;return Object(r.a)(this._groups[0][t])}},24:function(t,e,n){"use strict";n.r(e);var i={},r={};function a(t){return new Function("d","return {"+t.map((function(t,e){return JSON.stringify(t)+": d["+e+'] || ""'})).join(",")+"}")}function o(t){var e=Object.create(null),n=[];return t.forEach((function(t){for(var i in t)i in e||n.push(e[i]=i)})),n}function s(t,e){var n=t+"",i=n.length;return i<e?new Array(e-i+1).join(0)+n:n}function u(t){var e,n=t.getUTCHours(),i=t.getUTCMinutes(),r=t.getUTCSeconds(),a=t.getUTCMilliseconds();return isNaN(t)?"Invalid Date":((e=t.getUTCFullYear())<0?"-"+s(-e,6):e>9999?"+"+s(e,6):s(e,4))+"-"+s(t.getUTCMonth()+1,2)+"-"+s(t.getUTCDate(),2)+(a?"T"+s(n,2)+":"+s(i,2)+":"+s(r,2)+"."+s(a,3)+"Z":r?"T"+s(n,2)+":"+s(i,2)+":"+s(r,2)+"Z":i||n?"T"+s(n,2)+":"+s(i,2)+"Z":"")}var l=function(t){var e=new RegExp('["'+t+"\n\r]"),n=t.charCodeAt(0);function s(t,e){var a,o=[],s=t.length,u=0,l=0,h=s<=0,c=!1;function d(){if(h)return r;if(c)return c=!1,i;var e,a,o=u;if(34===t.charCodeAt(o)){for(;u++<s&&34!==t.charCodeAt(u)||34===t.charCodeAt(++u););return(e=u)>=s?h=!0:10===(a=t.charCodeAt(u++))?c=!0:13===a&&(c=!0,10===t.charCodeAt(u)&&++u),t.slice(o+1,e-1).replace(/""/g,'"')}for(;u<s;){if(10===(a=t.charCodeAt(e=u++)))c=!0;else if(13===a)c=!0,10===t.charCodeAt(u)&&++u;else if(a!==n)continue;return t.slice(o,e)}return h=!0,t.slice(o,s)}for(10===t.charCodeAt(s-1)&&--s,13===t.charCodeAt(s-1)&&--s;(a=d())!==r;){for(var f=[];a!==i&&a!==r;)f.push(a),a=d();e&&null==(f=e(f,l++))||o.push(f)}return o}function l(e,n){return e.map((function(e){return n.map((function(t){return c(e[t])})).join(t)}))}function h(e){return e.map(c).join(t)}function c(t){return null==t?"":t instanceof Date?u(t):e.test(t+="")?'"'+t.replace(/"/g,'""')+'"':t}return{parse:function(t,e){var n,i,r=s(t,(function(t,r){if(n)return n(t,r-1);i=t,n=e?function(t,e){var n=a(t);return function(i,r){return e(n(i),r,t)}}(t,e):a(t)}));return r.columns=i||[],r},parseRows:s,format:function(e,n){return null==n&&(n=o(e)),[n.map(c).join(t)].concat(l(e,n)).join("\n")},formatBody:function(t,e){return null==e&&(e=o(t)),l(t,e).join("\n")},formatRows:function(t){return t.map(h).join("\n")},formatRow:h,formatValue:c}},h=l(","),c=h.parse,d=(h.parseRows,h.format,h.formatBody,h.formatRows,h.formatRow,h.formatValue,l("\t")),f=d.parse;d.parseRows,d.format,d.formatBody,d.formatRows,d.formatRow,d.formatValue;function p(t){if(!t.ok)throw new Error(t.status+" "+t.statusText);return t.text()}var g=function(t,e){return fetch(t,e).then(p)};function v(t){return function(e,n,i){return 2===arguments.length&&"function"==typeof n&&(i=n,n=void 0),g(e,n).then((function(e){return t(e,i)}))}}v(c),v(f);function m(t){if(!t.ok)throw new Error(t.status+" "+t.statusText);return t.json()}var y=function(t,e){return fetch(t,e).then(m)};function _(t){return function(e,n){return g(e,n).then((function(e){return(new DOMParser).parseFromString(e,t)}))}}_("application/xml"),_("text/html"),_("image/svg+xml");var D=n(17);const w=0,b=1,S=2,F=3;class x{constructor(t,e,n,i){this.ID=e,this.population=n,this.type=i,this.name=t,this.article=null,this.shortName=null,this.preposition="in",this.plainEnglishNameFormatter=null,this.fullyQualifiedNameFormatter=null,this.parentRegion=null,this.subregionIDs=null}fullyQualifiedName(){return this.fullyQualifiedNameFormatter?this.fullyQualifiedNameFormatter(this.name,this.parentRegion):this.name}plainEnglishName(){return this.plainEnglishNameFormatter?this.plainEnglishNameFormatter(this.name,this.parentRegion):this.name}articleString(){return null===this.article?"":this.article+" "}qualifiedNameWithArticle(){return this.articleString()+this.fullyQualifiedName()}plainEnglishNameWithArticle(){return this.articleString()+this.plainEnglishName()}prepositionString(){return null===this.preposition?"":this.preposition+" "}topParent(){let t=this.parentRegion;for(;null!==t.parentRegion;)t=t.parentRegion;return t}static fromRegion(t){let e=new x(t.name,t.ID,t.population,t.type);return e.article=t.article,e.shortName=t.shortName,e.preposition=t.preposition,e.plainEnglishNameFormatter=t.plainEnglishNameFormatter,e.fullyQualifiedNameFormatter=t.fullyQualifiedNameFormatter,e.parentRegion=t.parentRegion,e.subregionIDs=Array.from(t.subregionIDs),e}static metroCountyNames(){return new Set(["New York City","Los Angeles","San Francisco","Philadelphia","Denver","San Diego","Dallas","East Baton Rouge","Sacramento","Alameda","San Bernardino"])}static fromJSONObject(t,e,n){let i=x.RegionTypeFromString(e),r=new x(t.name,t.ID,t.population,i);switch(void 0!==t.preposition&&(r.preposition=t.preposition),void 0!==t.shortName&&(r.shortName=t.shortName),void 0!==t.parentRegionID&&null!==n&&(r.parentRegion=n.regionWithID(t.parentRegionID)),void 0!==t.subregionIDs&&(r.subregionIDs=Array.from(t.subregionIDs)),i){case w:r.article="the",r.fullyQualifiedNameFormatter=function(t,e){return"United States"},r.plainEnglishNameFormatter=function(t,e){return"United States"};break;case b:r.article="the";break;case S:break;case F:r.fullyQualifiedNameFormatter=function(t,e){let n=" County, ";return x.metroCountyNames().has(t)&&(n=", "),t+n+e.shortName},r.plainEnglishNameFormatter=function(t,e){let n=" County";return x.metroCountyNames().has(t)&&(n=""),t+n}}return r}static RegionTypeFromString(t){switch(t){case"Nation":return w;case"Coalition":return b;case"State":return S;case"County":return F}return null}}class C{constructor(){this._regionsByID=new Map,this._regionIDAliases=new Map,this._aliasesByTargetID=new Map}static fromJSONObject(t,e){let n=new C,i=t.regionType;for(const r in t.regionsByID){let a=x.fromJSONObject(t.regionsByID[r],i,e);n.registerRegion(a)}for(const e in t.regionIDAliases){let i=t.regionIDAliases[e];n.registerIDAlias(e,i)}return n}registerRegion(t){this._regionsByID.set(t.ID,t)}registerIDAlias(t,e){this._regionIDAliases.set(t,e);let n=this._aliasesByTargetID.get(e);void 0===n&&(n=[]),n.push(t),this._aliasesByTargetID.set(e,n)}aliasesForRegion(t){return this._aliasesByTargetID.get(t)}regionWithID(t){let e=this._regionsByID.get(t);return void 0===e&&this._regionIDAliases.has(t)&&(e=this.regionWithID(this._regionIDAliases.get(t))),e}has(t){return this._regionIDAliases.has(t)&&(t=this._regionIDAliases.get(t)),void 0!==this.regionWithID(t)}addAll(t){this._regionsByID=new Map([...this._regionsByID,...t._regionsByID])}}const T=0,R=1,I=3,M=5;var k=Array.prototype;Object.defineProperty(k,"rawdata",{get:function(){return this},set:function(t){}}),Object.defineProperty(k,"value",{get:function(){return this[E.FilterIndexToUsedIndices(T)]},set:function(t){this[E.FilterIndexToUsedIndices(T)]=t}}),Object.defineProperty(k,"change",{get:function(){return this[E.FilterIndexToUsedIndices(R)]},set:function(t){this[E.FilterIndexToUsedIndices(R)]=t}});class E{constructor(t){null!==t&&((Number.isNaN(t)||void 0===t)&&(t=0),this.rawdata=new Array(13).fill(0),this.value=t)}get value(){return this.rawdata[E.FilterIndexToUsedIndices(T)]}set value(t){this.rawdata[E.FilterIndexToUsedIndices(T)]=t}get change(){return this.rawdata[E.FilterIndexToUsedIndices(R)]}set change(t){this.rawdata[E.FilterIndexToUsedIndices(R)]=t}static FilterIndexToUsedIndices(t){switch(t){case T:return 0;case R:return 1;case I:return 2;case M:return 3}return-1}static ChangeIndexForIndex(t){return this.FilterIndexToUsedIndices(t+1)}static AverageIndexForIndex(t){const e=t===T?M-T:I-R;return this.FilterIndexToUsedIndices(t+e)}static fromJSONObject(t){return void 0===t||void 0===t.d?null:t.d}}class A{constructor(t,e){null===t&&null===e||(this.cases=new E(parseInt(t)),this.deaths=new E(parseInt(e)),this.hospitalized=new E(0),this.ventilated=null,this.totalTests=new E(0),this.testedNegative=new E(0),this.testedPositive=new E(0))}percentPositive(){if(null===this.totalTests||0===this.totalTests.value)return"N/A";let t=this.testedPositive.value/this.totalTests.value*100;return Math.round(10*t)/10+"%"}static NullInfection(){return new A(0,0)}static fromJSONObject(t){let e=new A(null,null);return e.cases=E.fromJSONObject(t.C),e.deaths=E.fromJSONObject(t.D),e.hospitalized=E.fromJSONObject(t.H),e.totalTests=E.fromJSONObject(t.TT),e.testedNegative=E.fromJSONObject(t.TN),e.testedPositive=E.fromJSONObject(t.TP),e}}var B=n(175);const N=new Map;class P{constructor(t,e,n,i=null){this.dateString=t,this.date=P.dateForString(t),this.region=e,this.infection=n,this.mobilityData=null,this.timeSeries=i}monthString(){return this.dateString.split("-")[1]}yearString(){return this.dateString.split("-")[0]}normalizedDate(){return Object(B.g)(this.date)}dateOnlyDiffersInDay(t){return this.monthString()===t.monthString()&&this.yearString()===t.yearString()}static dateForString(t){let e=N.get(t);return void 0===e&&(e=new Date(t),N.set(t,e)),e}}const O=0,H=1,z=2,j=3,L=4,V=5;class W{static fromJSONObject(t){let e=new W;return e.retailAndRecreation=E.fromJSONObject(t.rr),e.workplace=E.fromJSONObject(t.w),e.parks=E.fromJSONObject(t.p),e.transit=E.fromJSONObject(t.t),e.residential=E.fromJSONObject(t.res),e}}var U=function(t,e){if((n=(t=e?t.toExponential(e-1):t.toExponential()).indexOf("e"))<0)return null;var n,i=t.slice(0,n);return[i.length>1?i[0]+i.slice(2):i,+t.slice(n+1)]},Y=function(t){return(t=U(Math.abs(t)))?t[1]:NaN},G=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function Q(t){if(!(e=G.exec(t)))throw new Error("invalid format: "+t);var e;return new q({fill:e[1],align:e[2],sign:e[3],symbol:e[4],zero:e[5],width:e[6],comma:e[7],precision:e[8]&&e[8].slice(1),trim:e[9],type:e[10]})}function q(t){this.fill=void 0===t.fill?" ":t.fill+"",this.align=void 0===t.align?">":t.align+"",this.sign=void 0===t.sign?"-":t.sign+"",this.symbol=void 0===t.symbol?"":t.symbol+"",this.zero=!!t.zero,this.width=void 0===t.width?void 0:+t.width,this.comma=!!t.comma,this.precision=void 0===t.precision?void 0:+t.precision,this.trim=!!t.trim,this.type=void 0===t.type?"":t.type+""}Q.prototype=q.prototype,q.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(void 0===this.width?"":Math.max(1,0|this.width))+(this.comma?",":"")+(void 0===this.precision?"":"."+Math.max(0,0|this.precision))+(this.trim?"~":"")+this.type};var X,J,Z,$,K=function(t,e){var n=U(t,e);if(!n)return t+"";var i=n[0],r=n[1];return r<0?"0."+new Array(-r).join("0")+i:i.length>r+1?i.slice(0,r+1)+"."+i.slice(r+1):i+new Array(r-i.length+2).join("0")},tt={"%":function(t,e){return(100*t).toFixed(e)},b:function(t){return Math.round(t).toString(2)},c:function(t){return t+""},d:function(t){return Math.round(t).toString(10)},e:function(t,e){return t.toExponential(e)},f:function(t,e){return t.toFixed(e)},g:function(t,e){return t.toPrecision(e)},o:function(t){return Math.round(t).toString(8)},p:function(t,e){return K(100*t,e)},r:K,s:function(t,e){var n=U(t,e);if(!n)return t+"";var i=n[0],r=n[1],a=r-(X=3*Math.max(-8,Math.min(8,Math.floor(r/3))))+1,o=i.length;return a===o?i:a>o?i+new Array(a-o+1).join("0"):a>0?i.slice(0,a)+"."+i.slice(a):"0."+new Array(1-a).join("0")+U(t,Math.max(0,e+a-1))[0]},X:function(t){return Math.round(t).toString(16).toUpperCase()},x:function(t){return Math.round(t).toString(16)}},et=function(t){return t},nt=Array.prototype.map,it=["y","z","a","f","p","n","µ","m","","k","M","G","T","P","E","Z","Y"];J=function(t){var e,n,i=void 0===t.grouping||void 0===t.thousands?et:(e=nt.call(t.grouping,Number),n=t.thousands+"",function(t,i){for(var r=t.length,a=[],o=0,s=e[0],u=0;r>0&&s>0&&(u+s+1>i&&(s=Math.max(1,i-u)),a.push(t.substring(r-=s,r+s)),!((u+=s+1)>i));)s=e[o=(o+1)%e.length];return a.reverse().join(n)}),r=void 0===t.currency?"":t.currency[0]+"",a=void 0===t.currency?"":t.currency[1]+"",o=void 0===t.decimal?".":t.decimal+"",s=void 0===t.numerals?et:function(t){return function(e){return e.replace(/[0-9]/g,(function(e){return t[+e]}))}}(nt.call(t.numerals,String)),u=void 0===t.percent?"%":t.percent+"",l=void 0===t.minus?"-":t.minus+"",h=void 0===t.nan?"NaN":t.nan+"";function c(t){var e=(t=Q(t)).fill,n=t.align,c=t.sign,d=t.symbol,f=t.zero,p=t.width,g=t.comma,v=t.precision,m=t.trim,y=t.type;"n"===y?(g=!0,y="g"):tt[y]||(void 0===v&&(v=12),m=!0,y="g"),(f||"0"===e&&"="===n)&&(f=!0,e="0",n="=");var _="$"===d?r:"#"===d&&/[boxX]/.test(y)?"0"+y.toLowerCase():"",D="$"===d?a:/[%p]/.test(y)?u:"",w=tt[y],b=/[defgprs%]/.test(y);function S(t){var r,a,u,d=_,S=D;if("c"===y)S=w(t)+S,t="";else{var F=(t=+t)<0||1/t<0;if(t=isNaN(t)?h:w(Math.abs(t),v),m&&(t=function(t){t:for(var e,n=t.length,i=1,r=-1;i<n;++i)switch(t[i]){case".":r=e=i;break;case"0":0===r&&(r=i),e=i;break;default:if(!+t[i])break t;r>0&&(r=0)}return r>0?t.slice(0,r)+t.slice(e+1):t}(t)),F&&0==+t&&"+"!==c&&(F=!1),d=(F?"("===c?c:l:"-"===c||"("===c?"":c)+d,S=("s"===y?it[8+X/3]:"")+S+(F&&"("===c?")":""),b)for(r=-1,a=t.length;++r<a;)if(48>(u=t.charCodeAt(r))||u>57){S=(46===u?o+t.slice(r+1):t.slice(r))+S,t=t.slice(0,r);break}}g&&!f&&(t=i(t,1/0));var x=d.length+t.length+S.length,C=x<p?new Array(p-x+1).join(e):"";switch(g&&f&&(t=i(C+t,C.length?p-S.length:1/0),C=""),n){case"<":t=d+t+S+C;break;case"=":t=d+C+t+S;break;case"^":t=C.slice(0,x=C.length>>1)+d+t+S+C.slice(x);break;default:t=C+d+t+S}return s(t)}return v=void 0===v?6:/[gprs]/.test(y)?Math.max(1,Math.min(21,v)):Math.max(0,Math.min(20,v)),S.toString=function(){return t+""},S}return{format:c,formatPrefix:function(t,e){var n=c(((t=Q(t)).type="f",t)),i=3*Math.max(-8,Math.min(8,Math.floor(Y(e)/3))),r=Math.pow(10,-i),a=it[8+i/3];return function(t){return n(r*t)+a}}}}({decimal:".",thousands:",",grouping:[3],currency:["$",""],minus:"-"}),Z=J.format,$=J.formatPrefix;var rt=n(5),at=Array.prototype.slice,ot=function(t){return t};function st(t){return"translate("+(t+.5)+",0)"}function ut(t){return"translate(0,"+(t+.5)+")"}function lt(t){return function(e){return+t(e)}}function ht(t){var e=Math.max(0,t.bandwidth()-1)/2;return t.round()&&(e=Math.round(e)),function(n){return+t(n)+e}}function ct(){return!this.__axis}function dt(t,e){var n=[],i=null,r=null,a=6,o=6,s=3,u=1===t||4===t?-1:1,l=4===t||2===t?"x":"y",h=1===t||3===t?st:ut;function c(c){var d=null==i?e.ticks?e.ticks.apply(e,n):e.domain():i,f=null==r?e.tickFormat?e.tickFormat.apply(e,n):ot:r,p=Math.max(a,0)+s,g=e.range(),v=+g[0]+.5,m=+g[g.length-1]+.5,y=(e.bandwidth?ht:lt)(e.copy()),_=c.selection?c.selection():c,D=_.selectAll(".domain").data([null]),w=_.selectAll(".tick").data(d,e).order(),b=w.exit(),S=w.enter().append("g").attr("class","tick"),F=w.select("line"),x=w.select("text");D=D.merge(D.enter().insert("path",".tick").attr("class","domain").attr("stroke","currentColor")),w=w.merge(S),F=F.merge(S.append("line").attr("stroke","currentColor").attr(l+"2",u*a)),x=x.merge(S.append("text").attr("fill","currentColor").attr(l,u*p).attr("dy",1===t?"0em":3===t?"0.71em":"0.32em")),c!==_&&(D=D.transition(c),w=w.transition(c),F=F.transition(c),x=x.transition(c),b=b.transition(c).attr("opacity",1e-6).attr("transform",(function(t){return isFinite(t=y(t))?h(t):this.getAttribute("transform")})),S.attr("opacity",1e-6).attr("transform",(function(t){var e=this.parentNode.__axis;return h(e&&isFinite(e=e(t))?e:y(t))}))),b.remove(),D.attr("d",4===t||2==t?o?"M"+u*o+","+v+"H0.5V"+m+"H"+u*o:"M0.5,"+v+"V"+m:o?"M"+v+","+u*o+"V0.5H"+m+"V"+u*o:"M"+v+",0.5H"+m),w.attr("opacity",1).attr("transform",(function(t){return h(y(t))})),F.attr(l+"2",u*a),x.attr(l,u*p).text(f),_.filter(ct).attr("fill","none").attr("font-size",10).attr("font-family","sans-serif").attr("text-anchor",2===t?"start":4===t?"end":"middle"),_.each((function(){this.__axis=y}))}return c.scale=function(t){return arguments.length?(e=t,c):e},c.ticks=function(){return n=at.call(arguments),c},c.tickArguments=function(t){return arguments.length?(n=null==t?[]:at.call(t),c):n.slice()},c.tickValues=function(t){return arguments.length?(i=null==t?null:at.call(t),c):i&&i.slice()},c.tickFormat=function(t){return arguments.length?(r=t,c):r},c.tickSize=function(t){return arguments.length?(a=o=+t,c):a},c.tickSizeInner=function(t){return arguments.length?(a=+t,c):a},c.tickSizeOuter=function(t){return arguments.length?(o=+t,c):o},c.tickPadding=function(t){return arguments.length?(s=+t,c):s},c}function ft(t){return dt(4,t)}var pt=Math.PI,gt=2*pt,vt=gt-1e-6;function mt(){this._x0=this._y0=this._x1=this._y1=null,this._=""}function yt(){return new mt}mt.prototype=yt.prototype={constructor:mt,moveTo:function(t,e){this._+="M"+(this._x0=this._x1=+t)+","+(this._y0=this._y1=+e)},closePath:function(){null!==this._x1&&(this._x1=this._x0,this._y1=this._y0,this._+="Z")},lineTo:function(t,e){this._+="L"+(this._x1=+t)+","+(this._y1=+e)},quadraticCurveTo:function(t,e,n,i){this._+="Q"+ +t+","+ +e+","+(this._x1=+n)+","+(this._y1=+i)},bezierCurveTo:function(t,e,n,i,r,a){this._+="C"+ +t+","+ +e+","+ +n+","+ +i+","+(this._x1=+r)+","+(this._y1=+a)},arcTo:function(t,e,n,i,r){t=+t,e=+e,n=+n,i=+i,r=+r;var a=this._x1,o=this._y1,s=n-t,u=i-e,l=a-t,h=o-e,c=l*l+h*h;if(r<0)throw new Error("negative radius: "+r);if(null===this._x1)this._+="M"+(this._x1=t)+","+(this._y1=e);else if(c>1e-6)if(Math.abs(h*s-u*l)>1e-6&&r){var d=n-a,f=i-o,p=s*s+u*u,g=d*d+f*f,v=Math.sqrt(p),m=Math.sqrt(c),y=r*Math.tan((pt-Math.acos((p+c-g)/(2*v*m)))/2),_=y/m,D=y/v;Math.abs(_-1)>1e-6&&(this._+="L"+(t+_*l)+","+(e+_*h)),this._+="A"+r+","+r+",0,0,"+ +(h*d>l*f)+","+(this._x1=t+D*s)+","+(this._y1=e+D*u)}else this._+="L"+(this._x1=t)+","+(this._y1=e);else;},arc:function(t,e,n,i,r,a){t=+t,e=+e,a=!!a;var o=(n=+n)*Math.cos(i),s=n*Math.sin(i),u=t+o,l=e+s,h=1^a,c=a?i-r:r-i;if(n<0)throw new Error("negative radius: "+n);null===this._x1?this._+="M"+u+","+l:(Math.abs(this._x1-u)>1e-6||Math.abs(this._y1-l)>1e-6)&&(this._+="L"+u+","+l),n&&(c<0&&(c=c%gt+gt),c>vt?this._+="A"+n+","+n+",0,1,"+h+","+(t-o)+","+(e-s)+"A"+n+","+n+",0,1,"+h+","+(this._x1=u)+","+(this._y1=l):c>1e-6&&(this._+="A"+n+","+n+",0,"+ +(c>=pt)+","+h+","+(this._x1=t+n*Math.cos(r))+","+(this._y1=e+n*Math.sin(r))))},rect:function(t,e,n,i){this._+="M"+(this._x0=this._x1=+t)+","+(this._y0=this._y1=+e)+"h"+ +n+"v"+ +i+"h"+-n+"Z"},toString:function(){return this._}};var _t=yt,Dt=function(t){return function(){return t}};function wt(t){this._context=t}wt.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._point=0},lineEnd:function(){(this._line||0!==this._line&&1===this._point)&&this._context.closePath(),this._line=1-this._line},point:function(t,e){switch(t=+t,e=+e,this._point){case 0:this._point=1,this._line?this._context.lineTo(t,e):this._context.moveTo(t,e);break;case 1:this._point=2;default:this._context.lineTo(t,e)}}};var bt=function(t){return new wt(t)};function St(t){return t[0]}function Ft(t){return t[1]}function xt(t,e){let n;if(void 0===e)for(const e of t)null!=e&&(n<e||void 0===n&&e>=e)&&(n=e);else{let i=-1;for(let r of t)null!=(r=e(r,++i,t))&&(n<r||void 0===n&&r>=r)&&(n=r)}return n}function Ct(t,e){let n;if(void 0===e)for(const e of t)null!=e&&(n>e||void 0===n&&e>=e)&&(n=e);else{let i=-1;for(let r of t)null!=(r=e(r,++i,t))&&(n>r||void 0===n&&r>=r)&&(n=r)}return n}var Tt=Math.sqrt(50),Rt=Math.sqrt(10),It=Math.sqrt(2);function Mt(t,e,n){var i=(e-t)/Math.max(0,n),r=Math.floor(Math.log(i)/Math.LN10),a=i/Math.pow(10,r);return r>=0?(a>=Tt?10:a>=Rt?5:a>=It?2:1)*Math.pow(10,r):-Math.pow(10,-r)/(a>=Tt?10:a>=Rt?5:a>=It?2:1)}function kt(t,e,n){var i=Math.abs(e-t)/Math.max(0,n),r=Math.pow(10,Math.floor(Math.log(i)/Math.LN10)),a=i/r;return a>=Tt?r*=10:a>=Rt?r*=5:a>=It&&(r*=2),e<t?-r:r}var Et=function(t,e){return t<e?-1:t>e?1:t>=e?0:NaN},At=function(t){var e;return 1===t.length&&(e=t,t=function(t,n){return Et(e(t),n)}),{left:function(e,n,i,r){for(null==i&&(i=0),null==r&&(r=e.length);i<r;){var a=i+r>>>1;t(e[a],n)<0?i=a+1:r=a}return i},right:function(e,n,i,r){for(null==i&&(i=0),null==r&&(r=e.length);i<r;){var a=i+r>>>1;t(e[a],n)>0?r=a:i=a+1}return i}}};var Bt=At(Et),Nt=Bt.right,Pt=(Bt.left,Nt),Ot=function(t,e,n){t.prototype=e.prototype=n,n.constructor=t};function Ht(t,e){var n=Object.create(t.prototype);for(var i in e)n[i]=e[i];return n}function zt(){}var jt="\\s*([+-]?\\d+)\\s*",Lt="\\s*([+-]?\\d*\\.?\\d+(?:[eE][+-]?\\d+)?)\\s*",Vt="\\s*([+-]?\\d*\\.?\\d+(?:[eE][+-]?\\d+)?)%\\s*",Wt=/^#([0-9a-f]{3,8})$/,Ut=new RegExp("^rgb\\("+[jt,jt,jt]+"\\)$"),Yt=new RegExp("^rgb\\("+[Vt,Vt,Vt]+"\\)$"),Gt=new RegExp("^rgba\\("+[jt,jt,jt,Lt]+"\\)$"),Qt=new RegExp("^rgba\\("+[Vt,Vt,Vt,Lt]+"\\)$"),qt=new RegExp("^hsl\\("+[Lt,Vt,Vt]+"\\)$"),Xt=new RegExp("^hsla\\("+[Lt,Vt,Vt,Lt]+"\\)$"),Jt={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};function Zt(){return this.rgb().formatHex()}function $t(){return this.rgb().formatRgb()}function Kt(t){var e,n;return t=(t+"").trim().toLowerCase(),(e=Wt.exec(t))?(n=e[1].length,e=parseInt(e[1],16),6===n?te(e):3===n?new re(e>>8&15|e>>4&240,e>>4&15|240&e,(15&e)<<4|15&e,1):8===n?ee(e>>24&255,e>>16&255,e>>8&255,(255&e)/255):4===n?ee(e>>12&15|e>>8&240,e>>8&15|e>>4&240,e>>4&15|240&e,((15&e)<<4|15&e)/255):null):(e=Ut.exec(t))?new re(e[1],e[2],e[3],1):(e=Yt.exec(t))?new re(255*e[1]/100,255*e[2]/100,255*e[3]/100,1):(e=Gt.exec(t))?ee(e[1],e[2],e[3],e[4]):(e=Qt.exec(t))?ee(255*e[1]/100,255*e[2]/100,255*e[3]/100,e[4]):(e=qt.exec(t))?ue(e[1],e[2]/100,e[3]/100,1):(e=Xt.exec(t))?ue(e[1],e[2]/100,e[3]/100,e[4]):Jt.hasOwnProperty(t)?te(Jt[t]):"transparent"===t?new re(NaN,NaN,NaN,0):null}function te(t){return new re(t>>16&255,t>>8&255,255&t,1)}function ee(t,e,n,i){return i<=0&&(t=e=n=NaN),new re(t,e,n,i)}function ne(t){return t instanceof zt||(t=Kt(t)),t?new re((t=t.rgb()).r,t.g,t.b,t.opacity):new re}function ie(t,e,n,i){return 1===arguments.length?ne(t):new re(t,e,n,null==i?1:i)}function re(t,e,n,i){this.r=+t,this.g=+e,this.b=+n,this.opacity=+i}function ae(){return"#"+se(this.r)+se(this.g)+se(this.b)}function oe(){var t=this.opacity;return(1===(t=isNaN(t)?1:Math.max(0,Math.min(1,t)))?"rgb(":"rgba(")+Math.max(0,Math.min(255,Math.round(this.r)||0))+", "+Math.max(0,Math.min(255,Math.round(this.g)||0))+", "+Math.max(0,Math.min(255,Math.round(this.b)||0))+(1===t?")":", "+t+")")}function se(t){return((t=Math.max(0,Math.min(255,Math.round(t)||0)))<16?"0":"")+t.toString(16)}function ue(t,e,n,i){return i<=0?t=e=n=NaN:n<=0||n>=1?t=e=NaN:e<=0&&(t=NaN),new he(t,e,n,i)}function le(t){if(t instanceof he)return new he(t.h,t.s,t.l,t.opacity);if(t instanceof zt||(t=Kt(t)),!t)return new he;if(t instanceof he)return t;var e=(t=t.rgb()).r/255,n=t.g/255,i=t.b/255,r=Math.min(e,n,i),a=Math.max(e,n,i),o=NaN,s=a-r,u=(a+r)/2;return s?(o=e===a?(n-i)/s+6*(n<i):n===a?(i-e)/s+2:(e-n)/s+4,s/=u<.5?a+r:2-a-r,o*=60):s=u>0&&u<1?0:o,new he(o,s,u,t.opacity)}function he(t,e,n,i){this.h=+t,this.s=+e,this.l=+n,this.opacity=+i}function ce(t,e,n){return 255*(t<60?e+(n-e)*t/60:t<180?n:t<240?e+(n-e)*(240-t)/60:e)}function de(t,e,n,i,r){var a=t*t,o=a*t;return((1-3*t+3*a-o)*e+(4-6*a+3*o)*n+(1+3*t+3*a-3*o)*i+o*r)/6}Ot(zt,Kt,{copy:function(t){return Object.assign(new this.constructor,this,t)},displayable:function(){return this.rgb().displayable()},hex:Zt,formatHex:Zt,formatHsl:function(){return le(this).formatHsl()},formatRgb:$t,toString:$t}),Ot(re,ie,Ht(zt,{brighter:function(t){return t=null==t?1/.7:Math.pow(1/.7,t),new re(this.r*t,this.g*t,this.b*t,this.opacity)},darker:function(t){return t=null==t?.7:Math.pow(.7,t),new re(this.r*t,this.g*t,this.b*t,this.opacity)},rgb:function(){return this},displayable:function(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:ae,formatHex:ae,formatRgb:oe,toString:oe})),Ot(he,(function(t,e,n,i){return 1===arguments.length?le(t):new he(t,e,n,null==i?1:i)}),Ht(zt,{brighter:function(t){return t=null==t?1/.7:Math.pow(1/.7,t),new he(this.h,this.s,this.l*t,this.opacity)},darker:function(t){return t=null==t?.7:Math.pow(.7,t),new he(this.h,this.s,this.l*t,this.opacity)},rgb:function(){var t=this.h%360+360*(this.h<0),e=isNaN(t)||isNaN(this.s)?0:this.s,n=this.l,i=n+(n<.5?n:1-n)*e,r=2*n-i;return new re(ce(t>=240?t-240:t+120,r,i),ce(t,r,i),ce(t<120?t+240:t-120,r,i),this.opacity)},displayable:function(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl:function(){var t=this.opacity;return(1===(t=isNaN(t)?1:Math.max(0,Math.min(1,t)))?"hsl(":"hsla(")+(this.h||0)+", "+100*(this.s||0)+"%, "+100*(this.l||0)+"%"+(1===t?")":", "+t+")")}}));var fe=function(t){return function(){return t}};function pe(t,e){return function(n){return t+n*e}}function ge(t){return 1==(t=+t)?ve:function(e,n){return n-e?function(t,e,n){return t=Math.pow(t,n),e=Math.pow(e,n)-t,n=1/n,function(i){return Math.pow(t+i*e,n)}}(e,n,t):fe(isNaN(e)?n:e)}}function ve(t,e){var n=e-t;return n?pe(t,n):fe(isNaN(t)?e:t)}var me=function t(e){var n=ge(e);function i(t,e){var i=n((t=ie(t)).r,(e=ie(e)).r),r=n(t.g,e.g),a=n(t.b,e.b),o=ve(t.opacity,e.opacity);return function(e){return t.r=i(e),t.g=r(e),t.b=a(e),t.opacity=o(e),t+""}}return i.gamma=t,i}(1);function ye(t){return function(e){var n,i,r=e.length,a=new Array(r),o=new Array(r),s=new Array(r);for(n=0;n<r;++n)i=ie(e[n]),a[n]=i.r||0,o[n]=i.g||0,s[n]=i.b||0;return a=t(a),o=t(o),s=t(s),i.opacity=1,function(t){return i.r=a(t),i.g=o(t),i.b=s(t),i+""}}}ye((function(t){var e=t.length-1;return function(n){var i=n<=0?n=0:n>=1?(n=1,e-1):Math.floor(n*e),r=t[i],a=t[i+1],o=i>0?t[i-1]:2*r-a,s=i<e-1?t[i+2]:2*a-r;return de((n-i/e)*e,o,r,a,s)}})),ye((function(t){var e=t.length;return function(n){var i=Math.floor(((n%=1)<0?++n:n)*e),r=t[(i+e-1)%e],a=t[i%e],o=t[(i+1)%e],s=t[(i+2)%e];return de((n-i/e)*e,r,a,o,s)}}));var _e=function(t,e){e||(e=[]);var n,i=t?Math.min(e.length,t.length):0,r=e.slice();return function(a){for(n=0;n<i;++n)r[n]=t[n]*(1-a)+e[n]*a;return r}};function De(t){return ArrayBuffer.isView(t)&&!(t instanceof DataView)}function we(t,e){var n,i=e?e.length:0,r=t?Math.min(i,t.length):0,a=new Array(r),o=new Array(i);for(n=0;n<r;++n)a[n]=Re(t[n],e[n]);for(;n<i;++n)o[n]=e[n];return function(t){for(n=0;n<r;++n)o[n]=a[n](t);return o}}var be=function(t,e){var n=new Date;return t=+t,e=+e,function(i){return n.setTime(t*(1-i)+e*i),n}},Se=function(t,e){return t=+t,e=+e,function(n){return t*(1-n)+e*n}},Fe=function(t,e){var n,i={},r={};for(n in null!==t&&"object"==typeof t||(t={}),null!==e&&"object"==typeof e||(e={}),e)n in t?i[n]=Re(t[n],e[n]):r[n]=e[n];return function(t){for(n in i)r[n]=i[n](t);return r}},xe=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,Ce=new RegExp(xe.source,"g");var Te=function(t,e){var n,i,r,a=xe.lastIndex=Ce.lastIndex=0,o=-1,s=[],u=[];for(t+="",e+="";(n=xe.exec(t))&&(i=Ce.exec(e));)(r=i.index)>a&&(r=e.slice(a,r),s[o]?s[o]+=r:s[++o]=r),(n=n[0])===(i=i[0])?s[o]?s[o]+=i:s[++o]=i:(s[++o]=null,u.push({i:o,x:Se(n,i)})),a=Ce.lastIndex;return a<e.length&&(r=e.slice(a),s[o]?s[o]+=r:s[++o]=r),s.length<2?u[0]?function(t){return function(e){return t(e)+""}}(u[0].x):function(t){return function(){return t}}(e):(e=u.length,function(t){for(var n,i=0;i<e;++i)s[(n=u[i]).i]=n.x(t);return s.join("")})},Re=function(t,e){var n,i=typeof e;return null==e||"boolean"===i?fe(e):("number"===i?Se:"string"===i?(n=Kt(e))?(e=n,me):Te:e instanceof Kt?me:e instanceof Date?be:De(e)?_e:Array.isArray(e)?we:"function"!=typeof e.valueOf&&"function"!=typeof e.toString||isNaN(e)?Fe:Se)(t,e)},Ie=function(t,e){return t=+t,e=+e,function(n){return Math.round(t*(1-n)+e*n)}},Me=function(t){return+t},ke=[0,1];function Ee(t){return t}function Ae(t,e){return(e-=t=+t)?function(n){return(n-t)/e}:(n=isNaN(e)?NaN:.5,function(){return n});var n}function Be(t,e,n){var i=t[0],r=t[1],a=e[0],o=e[1];return r<i?(i=Ae(r,i),a=n(o,a)):(i=Ae(i,r),a=n(a,o)),function(t){return a(i(t))}}function Ne(t,e,n){var i=Math.min(t.length,e.length)-1,r=new Array(i),a=new Array(i),o=-1;for(t[i]<t[0]&&(t=t.slice().reverse(),e=e.slice().reverse());++o<i;)r[o]=Ae(t[o],t[o+1]),a[o]=n(e[o],e[o+1]);return function(e){var n=Pt(t,e,1,i)-1;return a[n](r[n](e))}}function Pe(t,e){return e.domain(t.domain()).range(t.range()).interpolate(t.interpolate()).clamp(t.clamp()).unknown(t.unknown())}function Oe(){var t,e,n,i,r,a,o=ke,s=ke,u=Re,l=Ee;function h(){var t,e,n,u=Math.min(o.length,s.length);return l!==Ee&&(t=o[0],e=o[u-1],t>e&&(n=t,t=e,e=n),l=function(n){return Math.max(t,Math.min(e,n))}),i=u>2?Ne:Be,r=a=null,c}function c(e){return isNaN(e=+e)?n:(r||(r=i(o.map(t),s,u)))(t(l(e)))}return c.invert=function(n){return l(e((a||(a=i(s,o.map(t),Se)))(n)))},c.domain=function(t){return arguments.length?(o=Array.from(t,Me),h()):o.slice()},c.range=function(t){return arguments.length?(s=Array.from(t),h()):s.slice()},c.rangeRound=function(t){return s=Array.from(t),u=Ie,h()},c.clamp=function(t){return arguments.length?(l=!!t||Ee,h()):l!==Ee},c.interpolate=function(t){return arguments.length?(u=t,h()):u},c.unknown=function(t){return arguments.length?(n=t,c):n},function(n,i){return t=n,e=i,h()}}function He(){return Oe()(Ee,Ee)}function ze(t,e){switch(arguments.length){case 0:break;case 1:this.range(t);break;default:this.range(e).domain(t)}return this}var je=function(t,e,n,i){var r,a=kt(t,e,n);switch((i=Q(null==i?",f":i)).type){case"s":var o=Math.max(Math.abs(t),Math.abs(e));return null!=i.precision||isNaN(r=function(t,e){return Math.max(0,3*Math.max(-8,Math.min(8,Math.floor(Y(e)/3)))-Y(Math.abs(t)))}(a,o))||(i.precision=r),$(i,o);case"":case"e":case"g":case"p":case"r":null!=i.precision||isNaN(r=function(t,e){return t=Math.abs(t),e=Math.abs(e)-t,Math.max(0,Y(e)-Y(t))+1}(a,Math.max(Math.abs(t),Math.abs(e))))||(i.precision=r-("e"===i.type));break;case"f":case"%":null!=i.precision||isNaN(r=function(t){return Math.max(0,-Y(Math.abs(t)))}(a))||(i.precision=r-2*("%"===i.type))}return Z(i)};function Le(t){var e=t.domain;return t.ticks=function(t){var n=e();return function(t,e,n){var i,r,a,o,s=-1;if(n=+n,(t=+t)===(e=+e)&&n>0)return[t];if((i=e<t)&&(r=t,t=e,e=r),0===(o=Mt(t,e,n))||!isFinite(o))return[];if(o>0)for(t=Math.ceil(t/o),e=Math.floor(e/o),a=new Array(r=Math.ceil(e-t+1));++s<r;)a[s]=(t+s)*o;else for(t=Math.floor(t*o),e=Math.ceil(e*o),a=new Array(r=Math.ceil(t-e+1));++s<r;)a[s]=(t-s)/o;return i&&a.reverse(),a}(n[0],n[n.length-1],null==t?10:t)},t.tickFormat=function(t,n){var i=e();return je(i[0],i[i.length-1],null==t?10:t,n)},t.nice=function(n){null==n&&(n=10);var i,r=e(),a=0,o=r.length-1,s=r[a],u=r[o];return u<s&&(i=s,s=u,u=i,i=a,a=o,o=i),(i=Mt(s,u,n))>0?i=Mt(s=Math.floor(s/i)*i,u=Math.ceil(u/i)*i,n):i<0&&(i=Mt(s=Math.ceil(s*i)/i,u=Math.floor(u*i)/i,n)),i>0?(r[a]=Math.floor(s/i)*i,r[o]=Math.ceil(u/i)*i,e(r)):i<0&&(r[a]=Math.ceil(s*i)/i,r[o]=Math.floor(u*i)/i,e(r)),t},t}function Ve(){var t=He();return t.copy=function(){return Pe(t,Ve())},ze.apply(t,arguments),Le(t)}var We=new Date,Ue=new Date;function Ye(t,e,n,i){function r(e){return t(e=0===arguments.length?new Date:new Date(+e)),e}return r.floor=function(e){return t(e=new Date(+e)),e},r.ceil=function(n){return t(n=new Date(n-1)),e(n,1),t(n),n},r.round=function(t){var e=r(t),n=r.ceil(t);return t-e<n-t?e:n},r.offset=function(t,n){return e(t=new Date(+t),null==n?1:Math.floor(n)),t},r.range=function(n,i,a){var o,s=[];if(n=r.ceil(n),a=null==a?1:Math.floor(a),!(n<i&&a>0))return s;do{s.push(o=new Date(+n)),e(n,a),t(n)}while(o<n&&n<i);return s},r.filter=function(n){return Ye((function(e){if(e>=e)for(;t(e),!n(e);)e.setTime(e-1)}),(function(t,i){if(t>=t)if(i<0)for(;++i<=0;)for(;e(t,-1),!n(t););else for(;--i>=0;)for(;e(t,1),!n(t););}))},n&&(r.count=function(e,i){return We.setTime(+e),Ue.setTime(+i),t(We),t(Ue),Math.floor(n(We,Ue))},r.every=function(t){return t=Math.floor(t),isFinite(t)&&t>0?t>1?r.filter(i?function(e){return i(e)%t==0}:function(e){return r.count(0,e)%t==0}):r:null}),r}var Ge=Ye((function(t){t.setMonth(0,1),t.setHours(0,0,0,0)}),(function(t,e){t.setFullYear(t.getFullYear()+e)}),(function(t,e){return e.getFullYear()-t.getFullYear()}),(function(t){return t.getFullYear()}));Ge.every=function(t){return isFinite(t=Math.floor(t))&&t>0?Ye((function(e){e.setFullYear(Math.floor(e.getFullYear()/t)*t),e.setMonth(0,1),e.setHours(0,0,0,0)}),(function(e,n){e.setFullYear(e.getFullYear()+n*t)})):null};var Qe=Ge,qe=(Ge.range,Ye((function(t){t.setDate(1),t.setHours(0,0,0,0)}),(function(t,e){t.setMonth(t.getMonth()+e)}),(function(t,e){return e.getMonth()-t.getMonth()+12*(e.getFullYear()-t.getFullYear())}),(function(t){return t.getMonth()}))),Xe=qe;qe.range;function Je(t){return Ye((function(e){e.setDate(e.getDate()-(e.getDay()+7-t)%7),e.setHours(0,0,0,0)}),(function(t,e){t.setDate(t.getDate()+7*e)}),(function(t,e){return(e-t-6e4*(e.getTimezoneOffset()-t.getTimezoneOffset()))/6048e5}))}var Ze=Je(0),$e=Je(1),Ke=Je(2),tn=Je(3),en=Je(4),nn=Je(5),rn=Je(6),an=(Ze.range,$e.range,Ke.range,tn.range,en.range,nn.range,rn.range,Ye((function(t){t.setHours(0,0,0,0)}),(function(t,e){t.setDate(t.getDate()+e)}),(function(t,e){return(e-t-6e4*(e.getTimezoneOffset()-t.getTimezoneOffset()))/864e5}),(function(t){return t.getDate()-1}))),on=an,sn=(an.range,Ye((function(t){t.setTime(t-t.getMilliseconds()-1e3*t.getSeconds()-6e4*t.getMinutes())}),(function(t,e){t.setTime(+t+36e5*e)}),(function(t,e){return(e-t)/36e5}),(function(t){return t.getHours()}))),un=sn,ln=(sn.range,Ye((function(t){t.setTime(t-t.getMilliseconds()-1e3*t.getSeconds())}),(function(t,e){t.setTime(+t+6e4*e)}),(function(t,e){return(e-t)/6e4}),(function(t){return t.getMinutes()}))),hn=ln,cn=(ln.range,Ye((function(t){t.setTime(t-t.getMilliseconds())}),(function(t,e){t.setTime(+t+1e3*e)}),(function(t,e){return(e-t)/1e3}),(function(t){return t.getUTCSeconds()}))),dn=cn,fn=(cn.range,Ye((function(){}),(function(t,e){t.setTime(+t+e)}),(function(t,e){return e-t})));fn.every=function(t){return t=Math.floor(t),isFinite(t)&&t>0?t>1?Ye((function(e){e.setTime(Math.floor(e/t)*t)}),(function(e,n){e.setTime(+e+n*t)}),(function(e,n){return(n-e)/t})):fn:null};var pn=fn;fn.range;function gn(t){return Ye((function(e){e.setUTCDate(e.getUTCDate()-(e.getUTCDay()+7-t)%7),e.setUTCHours(0,0,0,0)}),(function(t,e){t.setUTCDate(t.getUTCDate()+7*e)}),(function(t,e){return(e-t)/6048e5}))}var vn=gn(0),mn=gn(1),yn=gn(2),_n=gn(3),Dn=gn(4),wn=gn(5),bn=gn(6),Sn=(vn.range,mn.range,yn.range,_n.range,Dn.range,wn.range,bn.range,Ye((function(t){t.setUTCHours(0,0,0,0)}),(function(t,e){t.setUTCDate(t.getUTCDate()+e)}),(function(t,e){return(e-t)/864e5}),(function(t){return t.getUTCDate()-1}))),Fn=Sn,xn=(Sn.range,Ye((function(t){t.setUTCMonth(0,1),t.setUTCHours(0,0,0,0)}),(function(t,e){t.setUTCFullYear(t.getUTCFullYear()+e)}),(function(t,e){return e.getUTCFullYear()-t.getUTCFullYear()}),(function(t){return t.getUTCFullYear()})));xn.every=function(t){return isFinite(t=Math.floor(t))&&t>0?Ye((function(e){e.setUTCFullYear(Math.floor(e.getUTCFullYear()/t)*t),e.setUTCMonth(0,1),e.setUTCHours(0,0,0,0)}),(function(e,n){e.setUTCFullYear(e.getUTCFullYear()+n*t)})):null};var Cn=xn;xn.range;function Tn(t){if(0<=t.y&&t.y<100){var e=new Date(-1,t.m,t.d,t.H,t.M,t.S,t.L);return e.setFullYear(t.y),e}return new Date(t.y,t.m,t.d,t.H,t.M,t.S,t.L)}function Rn(t){if(0<=t.y&&t.y<100){var e=new Date(Date.UTC(-1,t.m,t.d,t.H,t.M,t.S,t.L));return e.setUTCFullYear(t.y),e}return new Date(Date.UTC(t.y,t.m,t.d,t.H,t.M,t.S,t.L))}function In(t,e,n){return{y:t,m:e,d:n,H:0,M:0,S:0,L:0}}var Mn,kn,En={"-":"",_:" ",0:"0"},An=/^\s*\d+/,Bn=/^%/,Nn=/[\\^$*+?|[\]().{}]/g;function Pn(t,e,n){var i=t<0?"-":"",r=(i?-t:t)+"",a=r.length;return i+(a<n?new Array(n-a+1).join(e)+r:r)}function On(t){return t.replace(Nn,"\\$&")}function Hn(t){return new RegExp("^(?:"+t.map(On).join("|")+")","i")}function zn(t){for(var e={},n=-1,i=t.length;++n<i;)e[t[n].toLowerCase()]=n;return e}function jn(t,e,n){var i=An.exec(e.slice(n,n+1));return i?(t.w=+i[0],n+i[0].length):-1}function Ln(t,e,n){var i=An.exec(e.slice(n,n+1));return i?(t.u=+i[0],n+i[0].length):-1}function Vn(t,e,n){var i=An.exec(e.slice(n,n+2));return i?(t.U=+i[0],n+i[0].length):-1}function Wn(t,e,n){var i=An.exec(e.slice(n,n+2));return i?(t.V=+i[0],n+i[0].length):-1}function Un(t,e,n){var i=An.exec(e.slice(n,n+2));return i?(t.W=+i[0],n+i[0].length):-1}function Yn(t,e,n){var i=An.exec(e.slice(n,n+4));return i?(t.y=+i[0],n+i[0].length):-1}function Gn(t,e,n){var i=An.exec(e.slice(n,n+2));return i?(t.y=+i[0]+(+i[0]>68?1900:2e3),n+i[0].length):-1}function Qn(t,e,n){var i=/^(Z)|([+-]\d\d)(?::?(\d\d))?/.exec(e.slice(n,n+6));return i?(t.Z=i[1]?0:-(i[2]+(i[3]||"00")),n+i[0].length):-1}function qn(t,e,n){var i=An.exec(e.slice(n,n+1));return i?(t.q=3*i[0]-3,n+i[0].length):-1}function Xn(t,e,n){var i=An.exec(e.slice(n,n+2));return i?(t.m=i[0]-1,n+i[0].length):-1}function Jn(t,e,n){var i=An.exec(e.slice(n,n+2));return i?(t.d=+i[0],n+i[0].length):-1}function Zn(t,e,n){var i=An.exec(e.slice(n,n+3));return i?(t.m=0,t.d=+i[0],n+i[0].length):-1}function $n(t,e,n){var i=An.exec(e.slice(n,n+2));return i?(t.H=+i[0],n+i[0].length):-1}function Kn(t,e,n){var i=An.exec(e.slice(n,n+2));return i?(t.M=+i[0],n+i[0].length):-1}function ti(t,e,n){var i=An.exec(e.slice(n,n+2));return i?(t.S=+i[0],n+i[0].length):-1}function ei(t,e,n){var i=An.exec(e.slice(n,n+3));return i?(t.L=+i[0],n+i[0].length):-1}function ni(t,e,n){var i=An.exec(e.slice(n,n+6));return i?(t.L=Math.floor(i[0]/1e3),n+i[0].length):-1}function ii(t,e,n){var i=Bn.exec(e.slice(n,n+1));return i?n+i[0].length:-1}function ri(t,e,n){var i=An.exec(e.slice(n));return i?(t.Q=+i[0],n+i[0].length):-1}function ai(t,e,n){var i=An.exec(e.slice(n));return i?(t.s=+i[0],n+i[0].length):-1}function oi(t,e){return Pn(t.getDate(),e,2)}function si(t,e){return Pn(t.getHours(),e,2)}function ui(t,e){return Pn(t.getHours()%12||12,e,2)}function li(t,e){return Pn(1+on.count(Qe(t),t),e,3)}function hi(t,e){return Pn(t.getMilliseconds(),e,3)}function ci(t,e){return hi(t,e)+"000"}function di(t,e){return Pn(t.getMonth()+1,e,2)}function fi(t,e){return Pn(t.getMinutes(),e,2)}function pi(t,e){return Pn(t.getSeconds(),e,2)}function gi(t){var e=t.getDay();return 0===e?7:e}function vi(t,e){return Pn(Ze.count(Qe(t)-1,t),e,2)}function mi(t,e){var n=t.getDay();return t=n>=4||0===n?en(t):en.ceil(t),Pn(en.count(Qe(t),t)+(4===Qe(t).getDay()),e,2)}function yi(t){return t.getDay()}function _i(t,e){return Pn($e.count(Qe(t)-1,t),e,2)}function Di(t,e){return Pn(t.getFullYear()%100,e,2)}function wi(t,e){return Pn(t.getFullYear()%1e4,e,4)}function bi(t){var e=t.getTimezoneOffset();return(e>0?"-":(e*=-1,"+"))+Pn(e/60|0,"0",2)+Pn(e%60,"0",2)}function Si(t,e){return Pn(t.getUTCDate(),e,2)}function Fi(t,e){return Pn(t.getUTCHours(),e,2)}function xi(t,e){return Pn(t.getUTCHours()%12||12,e,2)}function Ci(t,e){return Pn(1+Fn.count(Cn(t),t),e,3)}function Ti(t,e){return Pn(t.getUTCMilliseconds(),e,3)}function Ri(t,e){return Ti(t,e)+"000"}function Ii(t,e){return Pn(t.getUTCMonth()+1,e,2)}function Mi(t,e){return Pn(t.getUTCMinutes(),e,2)}function ki(t,e){return Pn(t.getUTCSeconds(),e,2)}function Ei(t){var e=t.getUTCDay();return 0===e?7:e}function Ai(t,e){return Pn(vn.count(Cn(t)-1,t),e,2)}function Bi(t,e){var n=t.getUTCDay();return t=n>=4||0===n?Dn(t):Dn.ceil(t),Pn(Dn.count(Cn(t),t)+(4===Cn(t).getUTCDay()),e,2)}function Ni(t){return t.getUTCDay()}function Pi(t,e){return Pn(mn.count(Cn(t)-1,t),e,2)}function Oi(t,e){return Pn(t.getUTCFullYear()%100,e,2)}function Hi(t,e){return Pn(t.getUTCFullYear()%1e4,e,4)}function zi(){return"+0000"}function ji(){return"%"}function Li(t){return+t}function Vi(t){return Math.floor(+t/1e3)}!function(t){Mn=function(t){var e=t.dateTime,n=t.date,i=t.time,r=t.periods,a=t.days,o=t.shortDays,s=t.months,u=t.shortMonths,l=Hn(r),h=zn(r),c=Hn(a),d=zn(a),f=Hn(o),p=zn(o),g=Hn(s),v=zn(s),m=Hn(u),y=zn(u),_={a:function(t){return o[t.getDay()]},A:function(t){return a[t.getDay()]},b:function(t){return u[t.getMonth()]},B:function(t){return s[t.getMonth()]},c:null,d:oi,e:oi,f:ci,H:si,I:ui,j:li,L:hi,m:di,M:fi,p:function(t){return r[+(t.getHours()>=12)]},q:function(t){return 1+~~(t.getMonth()/3)},Q:Li,s:Vi,S:pi,u:gi,U:vi,V:mi,w:yi,W:_i,x:null,X:null,y:Di,Y:wi,Z:bi,"%":ji},D={a:function(t){return o[t.getUTCDay()]},A:function(t){return a[t.getUTCDay()]},b:function(t){return u[t.getUTCMonth()]},B:function(t){return s[t.getUTCMonth()]},c:null,d:Si,e:Si,f:Ri,H:Fi,I:xi,j:Ci,L:Ti,m:Ii,M:Mi,p:function(t){return r[+(t.getUTCHours()>=12)]},q:function(t){return 1+~~(t.getUTCMonth()/3)},Q:Li,s:Vi,S:ki,u:Ei,U:Ai,V:Bi,w:Ni,W:Pi,x:null,X:null,y:Oi,Y:Hi,Z:zi,"%":ji},w={a:function(t,e,n){var i=f.exec(e.slice(n));return i?(t.w=p[i[0].toLowerCase()],n+i[0].length):-1},A:function(t,e,n){var i=c.exec(e.slice(n));return i?(t.w=d[i[0].toLowerCase()],n+i[0].length):-1},b:function(t,e,n){var i=m.exec(e.slice(n));return i?(t.m=y[i[0].toLowerCase()],n+i[0].length):-1},B:function(t,e,n){var i=g.exec(e.slice(n));return i?(t.m=v[i[0].toLowerCase()],n+i[0].length):-1},c:function(t,n,i){return F(t,e,n,i)},d:Jn,e:Jn,f:ni,H:$n,I:$n,j:Zn,L:ei,m:Xn,M:Kn,p:function(t,e,n){var i=l.exec(e.slice(n));return i?(t.p=h[i[0].toLowerCase()],n+i[0].length):-1},q:qn,Q:ri,s:ai,S:ti,u:Ln,U:Vn,V:Wn,w:jn,W:Un,x:function(t,e,i){return F(t,n,e,i)},X:function(t,e,n){return F(t,i,e,n)},y:Gn,Y:Yn,Z:Qn,"%":ii};function b(t,e){return function(n){var i,r,a,o=[],s=-1,u=0,l=t.length;for(n instanceof Date||(n=new Date(+n));++s<l;)37===t.charCodeAt(s)&&(o.push(t.slice(u,s)),null!=(r=En[i=t.charAt(++s)])?i=t.charAt(++s):r="e"===i?" ":"0",(a=e[i])&&(i=a(n,r)),o.push(i),u=s+1);return o.push(t.slice(u,s)),o.join("")}}function S(t,e){return function(n){var i,r,a=In(1900,void 0,1);if(F(a,t,n+="",0)!=n.length)return null;if("Q"in a)return new Date(a.Q);if("s"in a)return new Date(1e3*a.s+("L"in a?a.L:0));if(e&&!("Z"in a)&&(a.Z=0),"p"in a&&(a.H=a.H%12+12*a.p),void 0===a.m&&(a.m="q"in a?a.q:0),"V"in a){if(a.V<1||a.V>53)return null;"w"in a||(a.w=1),"Z"in a?(r=(i=Rn(In(a.y,0,1))).getUTCDay(),i=r>4||0===r?mn.ceil(i):mn(i),i=Fn.offset(i,7*(a.V-1)),a.y=i.getUTCFullYear(),a.m=i.getUTCMonth(),a.d=i.getUTCDate()+(a.w+6)%7):(r=(i=Tn(In(a.y,0,1))).getDay(),i=r>4||0===r?$e.ceil(i):$e(i),i=on.offset(i,7*(a.V-1)),a.y=i.getFullYear(),a.m=i.getMonth(),a.d=i.getDate()+(a.w+6)%7)}else("W"in a||"U"in a)&&("w"in a||(a.w="u"in a?a.u%7:"W"in a?1:0),r="Z"in a?Rn(In(a.y,0,1)).getUTCDay():Tn(In(a.y,0,1)).getDay(),a.m=0,a.d="W"in a?(a.w+6)%7+7*a.W-(r+5)%7:a.w+7*a.U-(r+6)%7);return"Z"in a?(a.H+=a.Z/100|0,a.M+=a.Z%100,Rn(a)):Tn(a)}}function F(t,e,n,i){for(var r,a,o=0,s=e.length,u=n.length;o<s;){if(i>=u)return-1;if(37===(r=e.charCodeAt(o++))){if(r=e.charAt(o++),!(a=w[r in En?e.charAt(o++):r])||(i=a(t,n,i))<0)return-1}else if(r!=n.charCodeAt(i++))return-1}return i}return _.x=b(n,_),_.X=b(i,_),_.c=b(e,_),D.x=b(n,D),D.X=b(i,D),D.c=b(e,D),{format:function(t){var e=b(t+="",_);return e.toString=function(){return t},e},parse:function(t){var e=S(t+="",!1);return e.toString=function(){return t},e},utcFormat:function(t){var e=b(t+="",D);return e.toString=function(){return t},e},utcParse:function(t){var e=S(t+="",!0);return e.toString=function(){return t},e}}}(t),kn=Mn.format,Mn.parse,Mn.utcFormat,Mn.utcParse}({dateTime:"%x, %X",date:"%-m/%-d/%Y",time:"%-I:%M:%S %p",periods:["AM","PM"],days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],shortDays:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],shortMonths:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]});function Wi(t){return new Date(t)}function Ui(t){return t instanceof Date?+t:+new Date(+t)}function Yi(t,e,n,i,r,a,o,s,u){var l=He(),h=l.invert,c=l.domain,d=u(".%L"),f=u(":%S"),p=u("%I:%M"),g=u("%I %p"),v=u("%a %d"),m=u("%b %d"),y=u("%B"),_=u("%Y"),D=[[o,1,1e3],[o,5,5e3],[o,15,15e3],[o,30,3e4],[a,1,6e4],[a,5,3e5],[a,15,9e5],[a,30,18e5],[r,1,36e5],[r,3,108e5],[r,6,216e5],[r,12,432e5],[i,1,864e5],[i,2,1728e5],[n,1,6048e5],[e,1,2592e6],[e,3,7776e6],[t,1,31536e6]];function w(s){return(o(s)<s?d:a(s)<s?f:r(s)<s?p:i(s)<s?g:e(s)<s?n(s)<s?v:m:t(s)<s?y:_)(s)}function b(e,n,i){if(null==e&&(e=10),"number"==typeof e){var r,a=Math.abs(i-n)/e,o=At((function(t){return t[2]})).right(D,a);return o===D.length?(r=kt(n/31536e6,i/31536e6,e),e=t):o?(r=(o=D[a/D[o-1][2]<D[o][2]/a?o-1:o])[1],e=o[0]):(r=Math.max(kt(n,i,e),1),e=s),e.every(r)}return e}return l.invert=function(t){return new Date(h(t))},l.domain=function(t){return arguments.length?c(Array.from(t,Ui)):c().map(Wi)},l.ticks=function(t){var e,n=c(),i=n[0],r=n[n.length-1],a=r<i;return a&&(e=i,i=r,r=e),e=(e=b(t,i,r))?e.range(i,r+1):[],a?e.reverse():e},l.tickFormat=function(t,e){return null==e?w:u(e)},l.nice=function(t){var e=c();return(t=b(t,e[0],e[e.length-1]))?c(function(t,e){var n,i=0,r=(t=t.slice()).length-1,a=t[i],o=t[r];return o<a&&(n=i,i=r,r=n,n=a,a=o,o=n),t[i]=e.floor(a),t[r]=e.ceil(o),t}(e,t)):l},l.copy=function(){return Pe(l,Yi(t,e,n,i,r,a,o,s,u))},l}const Gi=0,Qi=1,qi=2,Xi=3;class Ji{constructor(t,e,n,i){this.beginIndex=t,this.endIndex=e,this.drawMode=n,this.chartRange=i}contains(t){let e=t===this.chartRange[0]||t===this.chartRange[1],n=this.drawMode!==Xi||e,i=n?t>=this.beginIndex:t>this.beginIndex,r=n?t<=this.endIndex:t<this.endIndex;return i&&r}static baseSegmentForData(t){return new Ji(0,t.length,Gi,[0,t.length-1])}static colorForEvaluator(t,e=Gi,n=1){let i="0,0,0";switch(e){case Gi:return t.baseColor(n);case Qi:i=Ir;break;case qi:i=kr;break;case Xi:i=Mr,n*=.4}return"rgba("+i+","+n+")"}}class Zi{constructor(t,e){if(this.series=t,this.maxJump=e,null===t||0===t.length)return;let n=t.length-1,i=Math.round(n/2),r=Math.round(n/4),a=Math.round(3/4*n);this.min=t[0][1],this.max=t[n][1],this.bottomQuartile=t[r][1],this.median=t[i][1],this.topQuartile=t[a][1]}maxValueBelowValue(t){let e=-1,n=this.series.length;for(;1+e<n;){let i=e+(n-e>>1);this.series[i][1]>t?n=i:e=i}return this.series[n][1]}}class $i{constructor(t,e,n){this.yMin=t,this.yMax=e,this.yDataMin=t,this.yDataMax=e,this.useOvershoot=n}}var Ki=Array.prototype.slice,tr=function(t,e){if((r=t.length)>1)for(var n,i,r,a=1,o=t[e[0]],s=o.length;a<r;++a)for(i=o,o=t[e[a]],n=0;n<s;++n)o[n][1]+=o[n][0]=isNaN(i[n][1])?i[n][0]:i[n][1]},er=function(t){for(var e=t.length,n=new Array(e);--e>=0;)n[e]=e;return n};function nr(t,e){return t[e]}var ir=function(t,e){if((i=t.length)>0){for(var n,i,r,a=0,o=t[0].length;a<o;++a){for(r=n=0;n<i;++n)r+=t[n][a][1]||0;if(r)for(n=0;n<i;++n)t[n][a][1]/=r}tr(t,e)}},rr=n(10),ar=function(){for(var t,e=rr.c;t=e.sourceEvent;)e=t;return e},or=function(t,e){var n=t.ownerSVGElement||t;if(n.createSVGPoint){var i=n.createSVGPoint();return i.x=e.clientX,i.y=e.clientY,[(i=i.matrixTransform(t.getScreenCTM().inverse())).x,i.y]}var r=t.getBoundingClientRect();return[e.clientX-r.left-t.clientLeft,e.clientY-r.top-t.clientTop]},sr=function(t,e){null==e&&(e=ar().touches);for(var n=0,i=e?e.length:0,r=new Array(i);n<i;++n)r[n]=or(t,e[n]);return r};class ur{constructor(t){let e=this;this.container=t.append("div").attr("class","robo-text-description content-column unselectable"),this.container.text("Florida reported 781 new cases of COVID-19 on May 17. On average, new cases are down 17% week over week, and down 31% month over month."),this.container.on("touchstart",(function(){e.touchDownElsewhere=!0})).on("touchend",(function(){e.touchDownElsewhere=!1})),this.dataQuantityHover=null,this.monthChangeHover=null,this.weekChangeHover=null,this.touchDownElsewhere=!1,this.didHoverDates=null,this.percentFormatter=Z(".0%"),this.defaultFormatter=Z(","),this.dateFormatter=kn("%B %e")}noDataHTML(t,e){return"There is no test data available at the county level."}updateForData(t,e,n,i){0!==t.length?(this.data=t,this.currentSnapshot=t[t.length-1],this.weekAgoSnapshot=t[t.length-1-7],this.monthAgoSnapshot=t[t.length-1-30],this.region=e,this.evaluator=n,this.averageEvaluator=i,this.container.html(this.htmlForTemplate(n.descriptionTemplate)),this._updateHovers()):this.container.html(this.noDataHTML(n,e))}_hoverDates(t,e=null){if(!this.touchDownElsewhere){if(t=t.map(t=>Object(B.g)(t)),null!==e){sr(e).length>0&&rr.c.stopPropagation()}null!==this.didHoverDates&&this.didHoverDates(t)}}_updateHovers(){let t=this;this.dataQuantityHover=this.container.select("#"+this._dataQuantityID()),this.dataQuantityHover.on("mouseenter touchstart",(function(){t._hoverDates([t.currentSnapshot.normalizedDate()],this)})),this.dataQuantityHover.on("mouseleave touchend",(function(){t._hoverDates([])})),this.weekChangeHover=this.container.select("#"+this._weekChangeID()),this.weekChangeHover.on("mouseenter touchstart",(function(){t._hoverDates([t.weekAgoSnapshot.normalizedDate(),t.currentSnapshot.normalizedDate()],this)})),this.weekChangeHover.on("mouseleave touchend",(function(){t._hoverDates([])})),this.monthChangeHover=this.container.select("#"+this._monthChangeID()),this.monthChangeHover.on("mouseenter touchstart",(function(){t._hoverDates([t.monthAgoSnapshot.normalizedDate(),t.currentSnapshot.normalizedDate()],this)})),this.monthChangeHover.on("mouseleave touchend",(function(){t._hoverDates([])}))}_dataQuantityID(){return"DataQuantity"}_monthChangeID(){return"MonthChange"}_weekChangeID(){return"WeekChange"}_tokenIteratorFromTemplate(t){return t.matchAll(/<Token:([A-Za-z]+)>/g)}_hoverDivForValue(t,e){return'<div class="robo-description-hover unselectable" id="'+e+'">'+t+"</div>"}_formatDataQuantity(t,e){return(null!==e.valueFormatter?e.valueFormatter:this.defaultFormatter)(t)}_formatShortDate(t){return(0,this.dateFormatter)(t)}_percentChangeFromSnapshot(t){let e=this.averageEvaluator.valueForSnapshot(this.currentSnapshot);if(void 0===t)return 0===e?0:e>0?1:-1;let n=this.averageEvaluator.valueForSnapshot(t),i=e-n,r=0===n?0:i/n;return Math.sign(i)!=Math.sign(r)&&(r*=-1),r}_amountChangeFromSnapshot(t){if(void 0===t)return 0;let e=this.averageEvaluator.valueForSnapshot(t);return this.averageEvaluator.valueForSnapshot(this.currentSnapshot)-e}_formatPercentChange(t){return(0,this.percentFormatter)(t)}_formattedPercentChangeFromSnapshot(t){let e=this._percentChangeFromSnapshot(t);return this._formatPercentChange(e)}_formattedAmountChangeFromSnapshot(t){let e=this._amountChangeFromSnapshot(t);return this._formatDataQuantity(e,this.averageEvaluator)}_directionStringForChange(t){return 0===t?"flat":t>0?"up":"down"}_changeVerbForChange(t,e=!1){return e?0===t?"have remained constant":t>0?"are increasing":"are decreasing":t>0?"increased by":"decreased by"}_evaluateToken(t){switch(t){case"Region":return this.region.plainEnglishNameWithArticle();case"RegionPreposition":return this.region.prepositionString();case"ReportingVerb":return this.evaluator.reportingVerb();case"DataQuantity":{let t=this.evaluator.valueForSnapshot(this.currentSnapshot),e=this._formatDataQuantity(t,this.evaluator);return this._hoverDivForValue(e,this._dataQuantityID())}case"DataQuantityDirection":{let t=this.evaluator.valueForSnapshot(this.currentSnapshot);return this._directionStringForChange(t)}case"FullyQualifiedNoun":return this.evaluator.fullyQualifiedNoun();case"TimePreposition":return this.evaluator.measureDelta?"on":"as of";case"ShortDate":return this._formatShortDate(this.currentSnapshot.normalizedDate());case"CumulativeSignifier":return this.evaluator.measureDelta?"":"all ";case"Noun":return this.evaluator.noun;case"NounIs":return this.evaluator.dataIsAtomic()?"are":"is";case"DirectionDescriptionWeek":{let t=this._percentChangeFromSnapshot(this.weekAgoSnapshot);return this._directionStringForChange(t)}case"ChangeVerbCurrent":{let t=this.evaluator.valueForSnapshot(this.currentSnapshot);return this._changeVerbForChange(t)}case"ChangeVerbWeek":return this._changeVerbForChange(this._amountChangeFromSnapshot(this.weekAgoSnapshot));case"ChangeVerbWeekProgressive":return this._changeVerbForChange(this._amountChangeFromSnapshot(this.weekAgoSnapshot),!0);case"PercentChangeWeek":{let t=this._formattedPercentChangeFromSnapshot(this.weekAgoSnapshot);return this._hoverDivForValue(t,this._weekChangeID())}case"DirectionalPercentChangeWeek":{let t=this._percentChangeFromSnapshot(this.weekAgoSnapshot),e=this._directionStringForChange(t);return 0===t?this._hoverDivForValue(e,this._weekChangeID()):e+" "+this._evaluateToken("PercentChangeWeek")}case"AmountChangeWeek":{let t=this._formattedAmountChangeFromSnapshot(this.weekAgoSnapshot);return this._hoverDivForValue(t,this._weekChangeID())}case"DirectionDescriptionMonth":{let t=this._percentChangeFromSnapshot(this.monthAgoSnapshot);return this._directionStringForChange(t)}case"ChangeVerbMonth":return this._changeVerbForChange(this._amountChangeFromSnapshot(this.monthAgoSnapshot));case"PercentChangeMonth":{let t=this._formattedPercentChangeFromSnapshot(this.monthAgoSnapshot);return this._hoverDivForValue(t,this._monthChangeID())}case"DirectionalPercentChangeMonth":{let t=this._percentChangeFromSnapshot(this.monthAgoSnapshot),e=this._directionStringForChange(t);return 0===t?this._hoverDivForValue(e,this._monthChangeID()):e+" "+this._evaluateToken("PercentChangeMonth")}case"AmountChangeMonth":{let t=this._formattedAmountChangeFromSnapshot(this.monthAgoSnapshot);return this._hoverDivForValue(t,this._monthChangeID())}}return""}_stringByEvaluatingTokens(t,e){let n=e,i=t.next();for(;!i.done;){let e=i.value,r=e[0],a=e[1],o=e.index,s=this._evaluateToken(a);0===o&&(s=s.capitalize()),n=n.replace(r,s),i=t.next()}return n}htmlForTemplate(t){let e=this._tokenIteratorFromTemplate(t);return this._stringByEvaluatingTokens(e,t)}}class lr{constructor(t){let e=this;this.parent=t,this.container=t.append("div").attr("class","robo-text-title base-chart-container content-column unselectable"),this.statAdjective=this.container.append("b").attr("class","tappable").on("click",(function(){e._didTapStatAdjective()})),this.metricDescription=this.container.append("b"),this.regionPreposition=this.container.append("div").attr("class","robo-text"),this.regionDescription=this.container.append("b").attr("class","tappable").on("click",(function(){e._didTapRegionDescription()})),this.groupByClause=this.container.append("div").attr("class","robo-text").text(", by "),this.groupByNoun=this.container.append("div").attr("class","robo-text").text("day"),this.didTapStatAdjective=null,this.didTapRegionDescription=null}updateForContextChange(t,e,n,i=!0){this.evaluator=t,this.region=e,this.groupByUnit=n,this._updateText(i)}_updateText(t=!1){if(t&&this.metricDescription.text().length>0){let t=parseInt(this.container.style("padding-bottom").replace("px","")),e=this.container.node().offsetHeight-t;this.container.style("height",e+"px");let n=new lr(this.parent);n.updateForContextChange(this.evaluator,this.region,this.groupByUnit,!1);let i=n.container.node().offsetHeight-t;n.container.remove(),i>e&&Math.abs(e-i)>3&&this.container.transition().duration(1e3).style("height",i+"px")}this.statAdjective.text(this.evaluator.statDescription().capitalize()),this.metricDescription.text(" "+this.evaluator.noun+" "),this.regionPreposition.text(this.region.prepositionString()),this.regionDescription.text(this.region.plainEnglishNameWithArticle()),this.evaluator.needsGroupBy()?(this.groupByClause.text(", by "),this.groupByNoun.text(this.groupByUnit)):(this.groupByClause.text(""),this.groupByNoun.text(""))}_didTapRegionDescription(){this.didTapRegionDescription&&this.didTapRegionDescription(this.region)}_didTapStatAdjective(){this.didTapStatAdjective&&this.didTapStatAdjective(this)}}var hr=function(t){var e=ar();return e.changedTouches&&(e=e.changedTouches[0]),or(t,e)};class cr{constructor(t,e,n,i){this.drawMode=-1,this.evaluator=e,this.hoverLine=t.append("line").style("stroke-width",2),this.hoverRawBlip=t.append("rect").attr("height",i).attr("width",n),this.hoverBlip=t.append("circle").style("stroke","white").style("stroke-width",2).attr("r",5),this.setDrawMode(Gi)}setDrawMode(t){t!==this.drawMode&&(this.drawMode=t,this.hoverLine.style("stroke",this.fillColor()),this.hoverRawBlip.attr("fill",this.fillColor()),this.hoverBlip.attr("fill",this.fillColor()))}fillColor(){return Ji.colorForEvaluator(this.evaluator,this.drawMode)}setShowRawBlip(t){this.hoverRawBlip.style("display",t?"unset":"none")}remove(){this.hoverLine.remove(),this.hoverBlip.remove(),this.hoverRawBlip.remove()}setBlipCoordinate(t,e){this.hoverBlip.attr("cx",t).attr("cy",e)}setRawBlipCoordinate(t,e){this.hoverRawBlip.attr("x",t).attr("y",e)}setLineCoordinates(t,e,n,i){this.hoverLine.attr("x1",t).attr("y1",e).attr("x2",n).attr("y2",i)}}class dr{constructor(t){this.container=t.append("div").attr("class","hover-container unselectable");let e=this.container.append("div").attr("class","hover-title-row");this.dateText=e.append("div").attr("class","hover-date-text");let n=this.container.append("div").attr("class","hover-row");this.primaryColumn=n.append("div").attr("class","hover-column-left"),this.rowOnePrimaryText=this.primaryColumn.append("div").attr("class","hover-primary-text"),this.rowTwoPrimaryText=this.primaryColumn.append("div").attr("class","hover-primary-text"),this.secondaryColumn=n.append("div").attr("class","hover-column-right"),this.rowOneSecondaryText=this.secondaryColumn.append("div").attr("class","hover-secondary-text"),this.rowTwoSecondaryText=this.secondaryColumn.append("div").attr("class","hover-secondary-text"),this.dateFormatter=kn("%B %e"),this.bigNumberFormatter=Z(".2s"),this.numberFormatter=Z(".3")}_formatterForValue(t,e){return null!==e.valueFormatter?e.valueFormatter:Math.abs(t)>=1e3?this.bigNumberFormatter:this.numberFormatter}updateForSnapshots(t,e,n,i=Gi){let r=t[0],a=!0,o=this.dateFormatter(r.normalizedDate()),s=e,u=s.valueForSnapshot(r),l=this._formatterForValue(u,s),h=s.graphedNoun(),c=n,d=c.valueForSnapshot(r),f=this._formatterForValue(d,c),p=c.graphedNoun(),g="";if(t.length>1){let e=t[1],i=this.dateFormatter,c="&nbsp;";r.dateOnlyDiffersInDay(e)&&(i=kn("%e"),c=""),a=!(n.displayAsPercent||n.normalized),o=o+c+"&ndash;"+c+i(e.normalizedDate());let v=n.valueForSnapshot(r),m=n.valueForSnapshot(e)-v;g=m>0?"+":"",u=m,l=this._formatterForValue(u,s),d=0===v?0:m/v,Math.sign(m)!=Math.sign(d)&&(d*=-1),f=Z(".0%"),h=n.changeInGraphedNoun(),p=n.changeInGraphedNoun()}this.dateText.html(o),this.rowOnePrimaryText.text(g+l(u)),this.rowOneSecondaryText.text(h),this.rowTwoPrimaryText.text(g+f(d)),this.rowTwoSecondaryText.text(p);let v="initial";i!==Gi&&(v=Ji.colorForEvaluator(n,i)),this.rowOnePrimaryText.style("color",v),this.rowTwoPrimaryText.style("color",v),this.rowTwoPrimaryText.style("display",a?"unset":"none"),this.rowTwoSecondaryText.style("display",a?"unset":"none")}}class fr{constructor(t,e){this.dataIndex=t,this.data=e}equals(t){return null!==t&&this.dataIndex===t.dataIndex}}class pr{constructor(t,e,n,i){this._hoverPoints=[],this._hoverHighlights=[],this._mouseDownPoint=null,this._hoverDidMove=!1,this.hoverDescription=null,this.hoverBoundsEvaluator=null,this.data=null,this.displayedDataSeries=null,this.displayedAverageDataSeries=null,this.evaluator=null,this.averageEvaluator=null;let r=this;this.viz=t,this.renderer=e,this.hoverContainer=n,this.hoverTouchRect=n.append("rect").attr("x","-10%").attr("width","120%").attr("height","100%").style("pointer-events","all").style("cursor","grab").attr("fill","rgba(0,0,0,0)").on("mouseenter touchstart",(function(){r._didStartHover(this)})).on("mousedown",(function(){r._didMouseDown(this)})).on("mouseup",(function(){r._didMouseUp(this)})).on("mousemove touchmove",(function(){r._didMoveHover(this)})).on("mouseleave touchend",(function(){r._didEndHover(this)})),this.descriptionContainer=i}highlightDates(t){let e=this,n=t.map(t=>e._hoverPointForDate(t)).filter(t=>null!==t);this._setHoverPoints(n)}chartSegments(){if(this.inComparisonMode()){let t=[0,this.data.length-1],e=this._hoverPoints[0].dataIndex,n=this._hoverPoints[1].dataIndex;return[new Ji(t[0],e,Xi,t),new Ji(e,n,this.drawMode(),t),new Ji(n,t[1],Xi,t)]}return[Ji.baseSegmentForData(this.data)]}inComparisonMode(){return this._hoverPoints.length>=2}_hoverPointsRequireUpdate(t,e){if(t.length!==e.length)return!0;for(let n=0;n<t.length;n++){let i=t[n],r=e[n];if(!i.equals(r))return!0}return!1}_hoverPointsToCompare(){return 2===this._hoverPoints.length&&this._hoverPoints[0].dataIndex===this._hoverPoints[1].dataIndex?[this._hoverPoints[0]]:this._hoverPoints}drawMode(){if(2===this._hoverPoints.length){let t=this._hoverPoints[0].data,e=this._hoverPoints[1].data,n=this._hoverEvaluator(),i=n.valueForSnapshot(t),r=n.valueForSnapshot(e);if(i===r)return Gi;let a=r<i;return n.upIsBetter&&(a=!a),a?qi:Qi}return Gi}_setHoverPoints(t){t.sort((function(t,e){return t.dataIndex-e.dataIndex})),this._hoverPointsRequireUpdate(this._hoverPoints,t)&&(this._previousHoverPoints=this._hoverPoints,this._hoverPoints=t,this._drawHoverAnnotations(),2!==this._previousHoverPoints.length&&2!==this._hoverPoints.length||this.viz.redraw(!1,!0))}_rawBlipWidth(){return Math.max(1.1*this.renderer.barWidth(),6)}_rawBlipHeight(){return 2}_hoverEvaluator(){return this.averageEvaluator}_drawHoverAnnotations(){for(;this._hoverHighlights.length<this._hoverPoints.length;){let t=new cr(this.hoverContainer,this.displayedAverageDataSeries.evaluator,this._rawBlipWidth(),this._rawBlipHeight());this._hoverHighlights.push(t)}for(;this._hoverHighlights.length>this._hoverPoints.length;){this._hoverHighlights[0].remove(),this._hoverHighlights.shift()}let t=this._hoverPointsToCompare();if(this._hoverPoints.length>0){let e=this.drawMode(),n=this.renderer,i=this,r=0;this._hoverPoints.forEach((function(a,o){let s=i._hoverHighlights[o],u=i.displayedAverageDataSeries.data[a.dataIndex],l=n.viewX(a.data.normalizedDate())+.5*n.barWidth();r+=l;let h=n.viewY(u[1]),c=n.viewY.range();s.setBlipCoordinate(l,h);let d=i.displayedDataSeries.data[a.dataIndex],f=n.viewY(d[1]);s.setRawBlipCoordinate(l-.5*i._rawBlipWidth(),f-.5*i._rawBlipHeight()),s.setShowRawBlip(t.length<2),s.setLineCoordinates(l,c[0],l,n._visualTopY),s.setDrawMode(e)})),r/=this._hoverPoints.length,null===this.hoverDescription&&(this.hoverDescription=new dr(this.descriptionContainer)),this.hoverDescription.updateForSnapshots(t.map(t=>t.data),this.evaluator,this.averageEvaluator,e);let a=this.hoverDescription.container.node().offsetWidth,o=this.hoverDescription.container.node().offsetHeight,s=r-.5*a,u=n.viewX.range(),l=8,h=Math.min(Math.max(s,u[0]),u[1]-a-1),c=n._visualTopY-(o+l)+n.currentCapHeightOffset;c=Math.max(c,this._minHoverY()),this.hoverDescription.container.style("left",h+"px").style("top",c+"px")}else null!==this.hoverDescription&&(this.hoverDescription.container.remove(),this.hoverDescription=null)}_minHoverY(){if(null===this.hoverBoundsEvaluator)return-1e3;return this.hoverBoundsEvaluator().y-this.descriptionContainer.node().getBoundingClientRect().y}_hoverPointsForTouchPoints(t){let e=[],n=this;return t.forEach((function(t){let i=n._dataIndexForPoint(t),r=n._snapshotForDataIndex(i);if(null!==r){let t=new fr(i,r);e.push(t)}})),e}_updateHoverForTouchPoints(t){let e=this._hoverPointsForTouchPoints(t);this._setHoverPoints(e)}_hasData(){return null!==this.data&&this.data.length>0}_didStartHover(t){if(!this._hasData())return;let e=[hr(t)],n=sr(t);if(this._hoverDidMove=!1,n.length>0)if(0===this._hoverPoints.length){let t=this;setTimeout((function(){t._initiateHoverAtPoints(n)}),200)}else this._updateHoverForTouchPoints(n);else this._initiateHoverAtPoints(e)}_resetMouseDown(){this._mouseDownPoint=null,this.hoverTouchRect.style("cursor","grab")}_didMouseDown(t){this.hoverTouchRect.style("cursor","grabbing"),this._mouseDownPoint=hr(t),this._didMoveHover(t)}_didMouseUp(t){this._resetMouseDown(),this._didMoveHover(t)}_initiateHoverAtPoints(t){this._hoverDidMove||this._updateHoverForTouchPoints(t)}_didMoveHover(t){if(!this._hasData())return;let e=[hr(t)];null!==this._mouseDownPoint&&e.push(this._mouseDownPoint);let n=sr(t),i=n.length>0;i&&(e=n),this._hoverDidMove=!0,this._hoverPoints.length>0&&(this._updateHoverForTouchPoints(e),i&&rr.c.preventDefault())}_didEndHover(t){if(!this._hasData())return;let e=sr(t);this._resetMouseDown(),e.length>0?this._updateHoverForTouchPoints(e):this._hoverPoints.length>0&&this._setHoverPoints([])}_dayForPoint(t){let e=t[0]-this.renderer.margin.left,n=this.renderer.viewX.invert(e),i=this.renderer.displayedDateRange;return n<i[0]?n=i[0]:n>i[1]&&(n=i[1]),n}_dataIndexForPoint(t){let e=this._dayForPoint(t);return this._dataIndexForDate(e)}_dataIndexForDate(t){let e=Object(B.h)(this.renderer.displayedDateRange[0],t,!1);return Math.floor(e)}_snapshotForDataIndex(t){return t<this.data.length&&t>=0?this.data[t]:(console.log("ERROR: no data for index "+t+", filtered data size: "+this.data.length),null)}_snapshotForPoint(t){let e=this._dataIndexForPoint(t);return this._snapshotForDataIndex(e)}_hoverPointForDate(t){let e=this._dataIndexForDate(t),n=this._snapshotForDataIndex(e);return null===n?null:new fr(e,n)}}class gr{constructor(t,e){this.data=t,this.evaluator=e}}const vr=0,mr=1,yr=2;var _r=0,Dr=0;class wr{constructor(t,e,n=vr){this.showSmoothedData=-1,this.visible=!0,this.evaluator=e,this._beginDate=null,this._endDate=null,this._currentData=null,this._filteredData=null,this._benchmarkSeries=null,this.title=null,this.description=null,this.hoverManager=null;let i=this;n===vr&&(this.title=new lr(t),this.title.didTapStatAdjective=function(){i._didToggleStatAdjective()}),this.container=t.append("div").attr("class",i._containerClassForDisplayMode(n)).append("div").attr("class",i._chartContainerClassForDisplayMode(n)),n===vr&&(this.description=new ur(t),this.description.didHoverDates=function(t){i.hoverManager.highlightDates(t)}),this.svg=this._svgForDisplayMode(n),n===yr&&(this.miniTitle=this.container.append("div").attr("class","over-time-title-mini mini-title-text").html(e.title.replace(" ","<br>")));let r="ScaleTruncation"+Math.floor(1e6*Math.random()),a=this.svg.append("defs").append("linearGradient").attr("id",r).attr("x1",0).attr("x2",0).attr("y1",0).attr("y2",1);a.append("stop").attr("offset","0%").attr("stop-color","white"),a.append("stop").attr("offset","33%").attr("stop-color","white"),a.append("stop").attr("offset","100%").attr("stop-color","rgba(255, 255, 255, 0)"),this.xAxisContainer=this.svg.append("g").attr("class","x-axis"),this.barContainer=this.svg.append("g"),this.trendContainer=this.svg.append("g"),this.hoverContainer=this.svg.append("g").style("overflow","visible"),this.scaleTruncationMarker=this.svg.append("rect").attr("fill","url(#"+r+")"),this.yAxisContainer=this.svg.append("g").attr("class","y-axis"),this.xAxisLabelContainer=this.svg.append("g"),this.renderer=new Rr(n,this.container,this.svg,this.barContainer,this.trendContainer,this.xAxisContainer,this.yAxisContainer,this.xAxisLabelContainer,this.scaleTruncationMarker),n===vr&&(this.hoverManager=new pr(this,this.renderer,this.hoverContainer,this.container)),this.setShowSmoothedData(!0),window.addEventListener("resize",(function(){i.didResize()}))}_svgForDisplayMode(t){let e=this.container.append("svg").attr("width","100%").attr("height","100%").attr("class","svg-content over-time-svg");return t===vr&&(e=e.attr("viewbox","0 0 100 100").attr("preserveAspectRatio","none")),e}_containerClassForDisplayMode(t){return t!==vr?"base-chart-container-mini unselectable":"base-chart-container content-column unselectable"}_chartContainerClassForDisplayMode(t){return t!==vr?"time-chart-container-mini":"time-chart-container"}get hoverBoundsEvaluator(){return null!==this.hoverManager?this.hoverManager.hoverBoundsEvaluator:null}set hoverBoundsEvaluator(t){null!==this.hoverManager&&(this.hoverManager.hoverBoundsEvaluator=t)}get benchmarkSeries(){return this._benchmarkSeries}set benchmarkSeries(t){this._benchmarkSeries=t,this._syncBenchmarkEvaluator()}setShowSmoothedData(t){t!==this.showSmoothedData&&(this.showSmoothedData=t,this._didUpdateEvaluator())}setEvaluator(t){this.evaluator=t,this._didUpdateEvaluator()}_syncBenchmarkEvaluator(){null!==this._benchmarkSeries&&this._benchmarkSeries.evaluator.toggleCount!=this.evaluator.toggleCount&&(this._benchmarkSeries.evaluator.toggleCount=this.evaluator.toggleCount-1,this._benchmarkSeries.evaluator=this._benchmarkSeries.evaluator.toggledEvaluator())}hide(t=!1){this.setVisible(!1,t)}show(t=!1){this.setVisible(!0,t)}setVisible(t,e=!1){if(t===this.visible)return;this.visible=t;let n=t?"block":"none";this.container.style("display",n),null!==this.title&&this.title.container.style("display",n),null!==this.description&&this.description.container.style("display",n)}redraw(t=!1,e=!1){this.updateForData(this._currentData,t,e)}updateForData(t,e,n=!1){void 0===this.renderer.width&&this._parseDimensions();let i=this.evaluator.metricEvaluators;this._currentData=t,this._filteredData=this._filterDataWithEvaluators(t,i);let r=this.evaluator.normalized,a=this.evaluator.allowNegative;this._barDataSeries=this._barDataFromRawData(this._filteredData,i,r),this._averageDataSeries=null;let o=null;if(this.showSmoothedData&&(o=Array.from(this._smoothedEvaluator.metricEvaluators),this._averageDataSeries=this._barDataFromRawData(this._filteredData,o,this._smoothedEvaluator.normalized)),null!==this._benchmarkSeries&&!this._inComparisonMode()){let t=this._benchmarkSeries.evaluator,e=this._alignDataWithData(this._benchmarkSeries.data,this._filteredData),n=this._barDataFromRawData(e,Array.from(t.metricEvaluators),t.normalized);t.smoothed?this._averageDataSeries.push(...n):this._barDataSeries.push(...n)}if(null!==this.hoverManager){let t=this.topSeriesIndex();this.hoverManager.data=this._filteredData,this.hoverManager.displayedDataSeries=this._barDataSeries[t],this.hoverManager.displayedAverageDataSeries=this._averageDataSeries[t],this.hoverManager.evaluator=this.evaluator,this.hoverManager.averageEvaluator=this._smoothedEvaluator}let s=this._barDataSeries.filter(t=>t.evaluator.display),u=this._averageDataSeries.filter(t=>t.evaluator.display);if(!n){let t=[this._earliestDataPoint(),this._latestDataPoint()];this.renderer.drawAxesForData(t,s,u,this.evaluator,r,a,e)}let l=this._chartSegments();this.renderer.drawBars(s,l,a,e),this.showSmoothedData&&this.renderer.drawTrendLines(u,l,e),this.renderer.drawAnnotations(u,e)}updateDescriptionForRegion(t){null!==this.description&&this.description.updateForData(this._filteredData,t,this.evaluator,this._smoothedEvaluator)}fixTimeDomain(t,e){this._beginDate=t,this._endDate=e}_didToggleStatAdjective(){let t=this.evaluator.toggledEvaluator();this.setEvaluator(t)}_didUpdateEvaluator(){this._smoothedEvaluator=this.showSmoothedData?Er.smoothedCopy(this.evaluator):null,void 0!==this.title&&null!==this._filteredData&&(null!==this.title&&this.title.updateForContextChange(this.evaluator,this.title.region,this.title.groupByUnit),null!==this.description&&this.description.updateForData(this._filteredData,this.description.region,this.evaluator,this._smoothedEvaluator)),this._syncBenchmarkEvaluator(),this._didUpdate(!0)}_parseDimensions(){let t=this.renderer.isMini();t&&0===_r&&(_r=parseInt(this.container.style("width")),Dr=parseInt(this.container.style("height")));let e=t?_r:parseInt(this.container.style("width")),n=t?Dr:parseInt(this.container.style("height"));return this.renderer.updateForDimensions(e,n)}topSeriesIndex(){let t=this.evaluator.metricEvaluators;for(let e=t.length-1;e>=0;e--)if(t[e].display)return e;return-1}didResize(){this._parseDimensions()&&this.updateForData(this._currentData,!1)}_chartSegments(){return null!==this.hoverManager?this.hoverManager.chartSegments():[Ji.baseSegmentForData(this._filteredData)]}_inComparisonMode(){return null!==this.hoverManager&&this.hoverManager.inComparisonMode()}_earliestDataPoint(){return null!==this._beginDate?this._beginDate:Ct(this._currentData,t=>t.date)}_latestDataPoint(){return null!==this._endDate?this._endDate:xt(this._currentData,t=>t.date)}_didUpdate(t=!1){void 0!==this._currentData&&null!==this._currentData&&this.updateForData(this._currentData,t)}_barDataFromRawData(t,e,n){let i=function(){var t=Dt([]),e=er,n=tr,i=nr;function r(r){var a,o,s=t.apply(this,arguments),u=r.length,l=s.length,h=new Array(l);for(a=0;a<l;++a){for(var c,d=s[a],f=h[a]=new Array(u),p=0;p<u;++p)f[p]=c=[0,+i(r[p],d,p,r)],c.data=r[p];f.key=d}for(a=0,o=e(h);a<l;++a)h[o[a]].index=a;return n(h,o),h}return r.keys=function(e){return arguments.length?(t="function"==typeof e?e:Dt(Ki.call(e)),r):t},r.value=function(t){return arguments.length?(i="function"==typeof t?t:Dt(+t),r):i},r.order=function(t){return arguments.length?(e=null==t?er:"function"==typeof t?t:Dt(Ki.call(t)),r):e},r.offset=function(t){return arguments.length?(n=null==t?tr:t,r):n},r}().keys(e).value((function(t,e){return e.valueForSnapshot(t)}));n&&(i=i.offset(ir));let r=i(t),a=[];return r.forEach((function(t,n){a.push(new gr(t,e[n]))})),a}_alignDataWithData(t,e){if(null===e||0===e.length)return[];let n=e.first().date,i=e.last().date;return t.filter((function(t){return t.date>=n&&t.date<=i}))}_filterDataWithEvaluators(t,e){return t.filter((function(t){for(let n=0;n<e.length;n++){if(null!==e[n].statForSnapshot(t)){if(null!==e[n].filterFunction){if(!e[n].filterFunction(e[n],t))return!1}return!0}}return!1}))}}class br{static frequencyDataForSeries(t){if(0===t.length)return new Zi(null,0);let e=0;for(let n=0;n<t.length-1;n++){let i=t[n][1],r=t[n+1][1]-i;Math.abs(r)>Math.abs(e)&&(e=r)}let n=t.concat().sort((function(t,e){return t[1]-e[1]}));return new Zi(n,e)}static scaleParametersForSeries(t,e,n,i,r){let a=[];e.forEach((function(t){a=a.concat(t.data)}));let o=[];return n.forEach((function(t){o=o.concat(t.data)})),br.scaleParametersForData(t,a,o,i,r)}static scaleParametersForData(t,e,n,i,r){let a=br.frequencyDataForSeries(e),o=br.frequencyDataForSeries(n);if(t!==vr)return new $i(o.min,o.max,!1);let s=new $i(a.min,a.max,!1);if(r)return s;if(a.max>1.9*o.max)s.useOvershoot=!0,s.yMax=1.5*o.max,s.yDataMax=a.maxValueBelowValue(s.yMax);else{let t=o.max>2.2*o.topQuartile,e=Math.abs(o.maxJump)>.5*o.max;t&&e&&(s.useOvershoot=!0,s.yMax=2.2*o.topQuartile,s.yDataMax=a.maxValueBelowValue(s.yMax))}return s}}const Sr=0,Fr=1,xr=2,Cr=0,Tr=1;class Rr{constructor(t,e,n,i,r,a,o,s,u){this.displayMode=t,this.chartContainer=e,this.svg=n,this.barContainer=i,this.trendContainer=r,this.xAxisContainer=a,this.yAxisContainer=o,this.xAxisLabelContainer=s,this.truncatedScaleMarker=u,this.margin=Rr._marginForDisplayMode(t),this.currentCapHeightOffset=0,this.viewX=null,this.viewY=null,this.trendLine=function(){var t=St,e=Ft,n=Dt(!0),i=null,r=bt,a=null;function o(o){var s,u,l,h=o.length,c=!1;for(null==i&&(a=r(l=_t())),s=0;s<=h;++s)!(s<h&&n(u=o[s],s,o))===c&&((c=!c)?a.lineStart():a.lineEnd()),c&&a.point(+t(u,s,o),+e(u,s,o));if(l)return a=null,l+""||null}return o.x=function(e){return arguments.length?(t="function"==typeof e?e:Dt(+e),o):t},o.y=function(t){return arguments.length?(e="function"==typeof t?t:Dt(+t),o):e},o.defined=function(t){return arguments.length?(n="function"==typeof t?t:Dt(!!t),o):n},o.curve=function(t){return arguments.length?(r=t,null!=i&&(a=r(i)),o):r},o.context=function(t){return arguments.length?(null==t?i=a=null:a=r(i=t),o):i},o}().x((function(t){return t[0]})).y((function(t){return t[1]}))}updateForDimensions(t,e){let n=this.width,i=this.height;return this.width=t,this.height=e,(this.width!==n||this.height!==i)&&(this.rescaleAxes(),!0)}rescaleAxes(){this.viewY=Ve().range([this.height-this.margin.bottom,this.margin.top]).clamp(!0),this.viewX=function(){return ze.apply(Yi(Qe,Xe,Ze,on,un,hn,dn,pn,kn).domain([new Date(2e3,0,1),new Date(2e3,0,2)]),arguments)}().range([this.margin.left,this.width-this.margin.right])}yAxisPaddingFactor(){return this.isMini()?1:1.1}animationSpeed(){return 1e3}workingWidth(){return this.width-this.margin.left-this.margin.right}workingHeight(){return this.height-this.margin.top-this.margin.bottom}numBarsInDomain(){let t=this.xDomain;return null==t&&(t=this._dateDomainOffsetForDisplay(this.dateDomain)),Math.round(Math.abs(Object(B.h)(t[0],t[1])))}barWidth(){return this._barWidthForDomainSize(this.numBarsInDomain(),this.barPadding())}_barWidthForDomainSize(t,e){let n=(t-1)*e;return(this.workingWidth()-n)/t}static _marginForDisplayMode(t){return t===vr?{top:0,left:0,bottom:18.5,right:0}:{top:0,left:0,bottom:0,right:0}}barPadding(){let t=this.numBarsInDomain(),e=4,n=this._barWidthForDomainSize(t,e);for(;(n<2||n/e<4)&&e>0;)e--,n=this._barWidthForDomainSize(t,e);let i=this.isMini()?0:.75;return Math.max(e,i)}_segmentForIndex(t,e){for(let n=0;n<e.length;n++)if(e[n].contains(t))return e[n];return console.log("ERROR: no chart drawing behavior found for index: "+t),null}_dateDomainOffsetForDisplay(t){return[t[0].addDays(this.isMini()?0:-2),t[1].addDays(1)]}isMini(){return this.displayMode===mr||this.displayMode===yr}_trendLineClass(){return this.isMini()?"trend-line-mini":"trend-line"}drawXAxis(t,e,n,i){let r=this.animationSpeed(),a=this,o=kn("%B %e"),s=this.xAxisLabelContainer.selectAll("text").data(t,(function(t,e){return e})).join((function(t){return t.append("text").attr("class","over-time-x-label").attr("first",(function(t,e){return 0===e?"":null})).attr("last",(function(t,e,n){return e===n.length-1?"":null})).attr("dy","1.35em").attr("y",0).attr("x",t=>a.viewX(t))}));i&&(s=s.transition().duration(r)),s.attr("x",t=>a.viewX(t)).text(t=>o(t));let u=!n&&!e,l=`translate(0, ${this.height-this.margin.bottom})`,h=(c=this.viewX,dt(3,c)).tickValues([]).tickSize(0);var c;let d=this.xAxisContainer.attr("transform",l);i&&(d=d.transition().duration(r)),d.call(h).style("opacity",u?1:0);let f=`translate(0, ${this.height-this.margin.bottom})`;this.xAxisLabelContainer.attr("transform",f)}drawYAxis(t,e,n,i,r,a,o){let s=this.animationSpeed(),u=this,l=this.viewY.ticks(3),h=this.viewY(l[l.length-1]),c=this.viewY(n);this._visualTopY=h<c?h:this.viewY.range()[1];let d=-(h-15);if(d>0&&d-this.currentCapHeightOffset>2){let t=this.svg;o&&(t=t.transition().duration(s)),this.currentCapHeightOffset=d,t.style("transform","translateY("+this.currentCapHeightOffset+"px)"),this.chartContainer.style("padding-bottom",this.currentCapHeightOffset+"px")}let f=ft(this.viewY).ticks(3).tickSize(-this.workingWidth()).tickFormat((function(n,o,s){let l=u.viewY.tickFormat(3);(i||r)&&(l=".0%");let h=Z(l)(n);if(r&&"0%"===h)h="Baseline";else{let n=Math.abs(t[0])>Math.abs(t[1]);o===(a&&n?0:s.length-1)&&(h+=" "+e.graphedNoun())}return h})),p=this.yAxisContainer.attr("transform",`translate(${this.margin.left}, 0)`);o&&(p=p.transition().duration(s)),p.call(f).attr("fill",null).selectAll("g.tick text").attr("class","grid-line-label").attr("dy","-0.41em").attr("x",0),this.yAxisContainer.selectAll("g.tick line").attr("class","grid-line"),(r||a)&&this.yAxisContainer.selectAll("g.tick line").filter((function(t){return 0===t})).attr("class","grid-line-baseline"),this.yAxisContainer.selectAll("path.domain").style("display","none")}drawScaleTruncationMarker(t,e,n){let i=this.animationSpeed(),r=this.truncatedScaleMarker;n&&(r=r.transition().duration(i)),r.attr("x",0).attr("y",t?this.viewY(e)-2:-30).attr("height",30).attr("width",this.width).style("opacity",t?1:0)}drawAxesForData(t,e,n,i,r,a,o){this.dateDomain=t;let s=t[0],u=t[1],l=this._dateDomainOffsetForDisplay(t),h=this.isMini()?n:e.concat(n),c=br.scaleParametersForSeries(this.displayMode,e,n,r,a),d=e.first(),f=this.barWidth()/(this.barWidth()+this.barPadding()),p=l[0],g=u.addDays(f),v=d.evaluator.displayAsPercent;this.xDomain=[Object(B.g)(p),Object(B.g)(g)];let m=xt(h,t=>xt(t.data,(function(t){return t[1]}))),y=Ct(h,t=>Ct(t.data,(function(t){return a?Math.min(t[0],t[1]):t[0]}))),_=c.useOvershoot?c.yDataMax:m,D=c.useOvershoot?c.yMax:this.yAxisPaddingFactor()*m,w=this.yAxisPaddingFactor()*Math.min(y,0);this.yDomain=[w,D];let b=this.isMini()?this._displayedDateDomainForSeries(h):this.xDomain;this.viewX.domain(b),this.viewY.domain(this.yDomain),this.displayedDateRange=this._visibleDateRangeForSeries(e,[s,g],f),this.isMini()||(this.drawScaleTruncationMarker(c.useOvershoot,D,o),this.drawXAxis(this.displayedDateRange,y<0,v,o),this.drawYAxis(this.yDomain,i,_,r,v,a,o))}_displayedDateDomainForSeries(t){return[Ct(t,t=>Ct(t.data,(function(t){return t.data.date}))),xt(t,t=>xt(t.data,(function(t){return t.data.date})))]}_visibleDateRangeForSeries(t,e,n=.99){let i=[];if(0===t[0].data.length)i=[Object(B.g)(e[0]),Object(B.g)(e[1])];else{let e=Ct(t,t=>t.data[0].data.date),r=xt(t,t=>t.data[t.data.length-1].data.date).addDays(n);i=[Object(B.g)(e),Object(B.g)(r)]}return i}_dataIndexForAnnotation(t){let e=0;switch(t.evaluator.annotationPlacement){case Tr:{let n=0,i=0;t.data.forEach((function(t,e){let r=Math.abs(t[1]);r>i&&(i=r,n=e)})),e=n}case Cr:{let n=7,i=t.data.length-n;i<n&&(i=t.data.length-1),e=i}}return e=Math.max(e,0),e=Math.min(e,t.data.length-1),e}_annotationPointForSeries(t,e=null){if(null===e&&(e=this._dataIndexForAnnotation(t)),void 0===t.data[e])return null;let n=t.data[e].data,i=t.data[e][1];return[this.viewX(n.normalizedDate())+.5*this.barWidth(),this.viewY(i)]}_annotationTransformForSeries(t,e=Fr){let n=this._annotationPointForSeries(t);return null===n?"translate(0,0)":(e===Sr&&(n[1]-=38),"translate("+n[0]+","+n[1]+")")}_annotationCalloutBeginForSeries(t,e=Fr){return e===Sr?28:0}_annotationCalloutEndForSeries(t,e=Fr){return this._annotationCalloutBeginForSeries(t,e)+10}_annotationTextTransformForSeries(t,e=Fr){let n=0;return e===Fr&&(n=10),"translate(-10, "+n+")"}_annotationOrientationsForSeries(t,e){let n=this;return t.map((function(t){let i=n._dataIndexForAnnotation(t),r=n._annotationPointForSeries(t,i);if(null===r)return xr;let a=!0;e.forEach((function(e){if(e!==t){let t=n._annotationPointForSeries(e,i);null!==t&&r[1]>t[1]&&(a=!1)}}));let o=a?Sr:Fr,s=o,u=o===Sr?-38:38,l=r[1]+u;return l<n.viewY.range[0]&&(s=Fr),l>n.viewY.range[1]&&(s=Sr),s}))}drawAnnotations(t,e){if(this.isMini())return;let n=this,i=this.animationSpeed(),r=t.filter((function(t){return null!==t.evaluator.annotation&&t.data.length>0})),a=this._annotationOrientationsForSeries(r,t),o=this.yAxisContainer.selectAll("g.annotation").data(r,(function(t){return t.evaluator.hashString()})).join((function(t){return t.append("g").attr("class","annotation").attr("opacity",0).attr("transform",(function(t,e){return n._annotationTransformForSeries(t,a[e])})).append("line").attr("class","annotation-callout").attr("x1",0).attr("y1",(function(t,e){return n._annotationCalloutBeginForSeries(t,a[e])})).attr("x2",0).attr("y2",(function(t,e){return n._annotationCalloutEndForSeries(t,a[e])})).select((function(){return this.parentNode})).append("text").attr("class","annotation-label").attr("transform",(function(t,e){return n._annotationTextTransformForSeries(t,a[e])})).attr("dy",12).html((function(t){return t.evaluator.annotation})).select((function(){return this.parentNode}))}),(function(t){return t}),(function(t){return e&&(t=t.transition().duration(i)),t.attr("opacity",0).remove()}));e&&(o=o.transition().duration(i)),o.attr("transform",(function(t,e){return n._annotationTransformForSeries(t,a[e])})).attr("opacity",1).select("text").attr("transform",(function(t,e){return n._annotationTextTransformForSeries(t,a[e])})).select((function(){return this.parentNode})).select("line").attr("y1",(function(t,e){return n._annotationCalloutBeginForSeries(t,a[e])})).attr("y2",(function(t,e){return n._annotationCalloutEndForSeries(t,a[e])}))}drawBars(t,e,n,i){if(this.isMini())return;let r=this.animationSpeed(),a=this;this.barContainer.selectAll("g").data(t,(function(t){return t.evaluator.hashString()})).join((function(t){return t.append("g").attr("class","over-time-series").attr("evaluatorID",(function(t){return t.evaluator.hashString()}))})),t.forEach((function(t,o){let s=t.evaluator,u=t.data,l=s.hashString(),h=a.barContainer.selectAll("g[evaluatorID='"+l+"']").first().selectAll("rect").data(u,t=>t.data.dateString).join((function(t){return t.append("rect").attr("dateID",t=>Rr.rectDateID(t.data)).attr("x",t=>a.viewX(t.data.normalizedDate())).attr("width",a.barWidth()).attr("y",a.viewY(0)).attr("height",0)}));i&&(h=h.transition().duration(r)),h.attr("y",(function(t){return Math.min(a.viewY(t[0]),a.viewY(t[1]))})).attr("height",(function(t){let e=a.viewY(t[0])-a.viewY(t[1]);return e=n?Math.abs(e):Math.max(e,0),e})).attr("width",a.barWidth()).attr("fill",(function(t,n){let i=a._segmentForIndex(n,e);return Ji.colorForEvaluator(s,i.drawMode)})).attr("x",t=>a.viewX(t.data.normalizedDate()))})),this.barContainer.style("opacity",this.showingTrendOverlay()?.25:1)}showingTrendOverlay(){return!0}drawTrendLines(t,e,n){t=t.concat().reverse();let i=this.animationSpeed(),r=this.trendContainer.selectAll("g").data(t,(function(t){return t.evaluator.hashString()})).join((function(t){return t.append("g").attr("class","over-time-series-trend").attr("evaluatorID",(function(t){return t.evaluator.hashString()})).style("opacity",0)}),(function(t){return t}),(function(t){return n&&(t=t.transition().duration(i)),t.style("opacity",0).remove()}));n&&(r=r.transition().duration(i)),r.style("opacity",1);let a=this;t.forEach((function(t,r){let o=t.evaluator,s=t.data,u=o.hashString(),l=a.trendContainer.selectAll("g[evaluatorID='"+u+"']").first(),h=[],c=[];e.forEach((function(t){let e=[],n=[];Rr.computeTrendLinePoints(a,s,e,n,t),c.push(e),h.push(n)})),l.selectAll("path.trend-line-fill").data(h,(function(t,e){return"trendFill"+e})).join(t=>t.append("path").attr("class","trend-line-fill").attr("fill",(function(t,n){let i=e[n];return Ji.colorForEvaluator(o,i.drawMode,o.wantsFill?.2:0)})).attr("d",a.trendLine),(function(t){return n&&(t=t.transition().duration(i)),t.attr("fill",(function(t,n){let i=e[n];return Ji.colorForEvaluator(o,i.drawMode,o.wantsFill?.2:0)})).attr("d",a.trendLine)}));let d=l.selectAll("path."+a._trendLineClass()).data(c,(function(t,e){return"trendLine"+e})).join(t=>t.append("path").attr("class",a._trendLineClass()).attr("stroke",(function(t,n){let i=e[n];return Ji.colorForEvaluator(o,i.drawMode)})).attr("d",a.trendLine));n&&(d=d.transition().duration(i)),d.attr("stroke",(function(t,n){let i=e[n];return Ji.colorForEvaluator(o,i.drawMode)})).attr("d",a.trendLine)}))}static computeTrendLinePoints(t,e,n,i,r=null){let a=null===r?0:r.beginIndex,o=null===r?e.length-1:r.endIndex,s=null===r?Gi:r.drawMode,u=[],l=t.barWidth()/2;for(let r=a;r<=o&&r<e.length;r++){let h=e[r],c=0===r,d=r===e.length-1,f=t.viewX(h.data.normalizedDate());d&&e.length>1?f+=2*l:c&&1!==e.length||(f+=l);let p=[f,t.viewY(h[1])],g=[f,t.viewY(h[0])],v=f;if(!c&&!d){let t=r===a,e=r===o;s===Xi?e?v-=l:t&&(v+=l):e?v+=l:t&&(v-=l)}n.push(p),i.push([v,p[1]]),u.push([v,g[1]])}let h=t.numBarsInDomain();for(;n.length<h&&n.length>0;)n.unshift(n[0]);for(;i.length<h&&i.length>0;)i.unshift(i[0]);for(;u.length<h&&u.length>0;)u.unshift(u[0]);u.reverse(),i.push(...u)}static rectDateID(t){return"date"+t.dateString}}const Ir="203,25,29",Mr="47,42,45",kr="38,120,144";class Er{constructor(t,e,n,i,r,a=!1,o=!1,s=!1){this.title=t,this.noun=e,this.nounWithNumber=null,this.deltaAdjective="new",this.cumulativeAdjective="total",this.needsGroupByCallback=null,this.filterFunction=null,this.valueFormatter=null,this.HTMLFormatter=null,this.nounQualifier=null,this.reportingVerbFormatter=null,this.descriptionTemplate=Er.baseDescriptionTemplate(),this.upIsBetter=!1,this.wantsFill=!0,this.source=null,this.annotation=null,this.annotationPlacement=Cr,this.supportedRegionLevel=S,this.benchmarkEvaluator=null,this.benchmarkRegionType=w,this.toggleFunction=function(t){let e=!t.measureDelta,n=Er.from(t);return n.measureDelta=e,n},this.statDescriptionFunction=function(t){return t.measureDelta?t.deltaAdjective:t.cumulativeAdjective},this.toggleCount=0,this.measureDelta=a,this.smoothed=o,this.perCapita=s,this.normalized=!1,this.allowNegative=!1,this.displayAsPercent=!1,this.display=!0,this.baseStatForSnapshot=n,this._intensityForSnapshot=i,this._colorForIntensity=r,this.baseRGB="0, 0, 0",this.baseNegativeRGB="0, 200, 0",this.maxPowerOfTen=5,this.minAlpha=.15,this.maxAlpha=1}hashString(){return Object(rt.HashString)(this.title)}equals(t){return this.hashString()===t.hashString()}get metricEvaluators(){return[this]}statDescription(){return this.statDescriptionFunction(this)}smoothedNounSuffix(){return this.smoothed?" (avg)":""}formatValue(t){return this._designatedValueFormatter()(t)}_designatedValueFormatter(){return null!==this.valueFormatter?this.valueFormatter:Z(",")}formatValueHTML(t,e){return null===this.HTMLFormatter?this._designatedValueFormatter()(e):this.HTMLFormatter(this,t,e)}graphedNoun(t=!0){let e=this.noun;return null!==this.nounWithNumber&&(e=this.nounWithNumber),e+(t?this.smoothedNounSuffix():"")}fullyQualifiedNoun(){return null!==this.nounQualifier?this.nounQualifier(this):this.statDescription()+" "+this.noun}reportingVerb(){return null!==this.reportingVerbFormatter?this.reportingVerbFormatter(this):this.measureDelta?"reported":"has reported"}dataIsAtomic(){return!this.normalized&&!this.displayAsPercent}changeInGraphedNoun(t=-1){return-1===t&&(t=this.dataIsAtomic()),this.graphedNoun(!1)+(this.measureDelta&&t?" / day":"")}needsGroupBy(){return null===this.needsGroupByCallback||this.needsGroupByCallback(this)}toggledEvaluator(){return this.toggleCount+=1,this.toggleFunction(this)}static baseDescriptionTemplate(){return"<Token:Region> <Token:ReportingVerb> <Token:DataQuantity> <Token:Noun> <Token:TimePreposition> <Token:ShortDate>. On average, <Token:FullyQualifiedNoun> <Token:NounIs> <Token:DirectionalPercentChangeWeek> week over week, and <Token:DirectionalPercentChangeMonth> month over month."}static from(t){if(t.metricEvaluators.length>1)return Ar.from(t);let e=new Er(t.title,t.noun,t.baseStatForSnapshot,t._intensityForSnapshot,t._colorForIntensity,t.measureDelta,t.smoothed,t.perCapita);return e.baseRGB=t.baseRGB,e.baseNegativeRGB=t.baseNegativeRGB,e.maxPowerOfTen=t.maxPowerOfTen,e.minAlpha=t.minAlpha,e.maxAlpha=t.maxAlpha,e.display=t.display,e.normalized=t.normalized,e.nounWithNumber=t.nounWithNumber,e.deltaAdjective=t.deltaAdjective,e.cumulativeAdjective=t.cumulativeAdjective,e.needsGroupByCallback=t.needsGroupByCallback,e.allowNegative=t.allowNegative,e.displayAsPercent=t.displayAsPercent,e.statDescriptionFunction=t.statDescriptionFunction,e.toggleFunction=t.toggleFunction,e.toggleCount=t.toggleCount,e.filterFunction=t.filterFunction,e.valueFormatter=t.valueFormatter,e.HTMLFormatter=t.HTMLFormatter,e.upIsBetter=t.upIsBetter,e.descriptionTemplate=t.descriptionTemplate,e.nounQualifier=t.nounQualifier,e.reportingVerbFormatter=t.reportingVerbFormatter,e.benchmarkEvaluator=t.benchmarkEvaluator,e.benchmarkRegionType=t.benchmarkRegionType,e.wantsFill=t.wantsFill,e.annotation=t.annotation,e.annotationPlacement=t.annotationPlacement,e.supportedRegionLevel=t.supportedRegionLevel,e.source=t.source,e}static smoothedCopy(t){if(t.metricEvaluators.length>1)return Ar.smoothedCopy(t);let e=Er.from(t);return e.smoothed=!0,e}statForSnapshot(t){let e=this.baseStatForSnapshot(this,t);if(!(e instanceof E||e instanceof Array))return e;if(void 0===e.rawdata)return null;let n=Er.dataIndexForParameters(this.measureDelta,this.smoothed);return e.rawdata[n]}static dataIndexForParameters(t,e){let n=T;return t&&(n=E.ChangeIndexForIndex(n)),e&&(n=E.AverageIndexForIndex(n)),n}setBaseStat(t){this.baseStatForSnapshot=t}valueForSnapshot(t){let e=this.statForSnapshot(t);return void 0===e||null==e?0:(this.perCapita&&(e/=t.region.population),e)}intensityForSnapshot(t){return this._intensityForSnapshot(this,t)}colorForIntensity(t){return this._colorForIntensity(this,t)}supportsRegionType(t){return t<=this.supportedRegionLevel}colorForSnapshot(t){return this.colorForIntensity(this.intensityForSnapshot(t))}baseColor(t=1){return"rgba("+this.baseRGB+","+Math.min(Math.max(t,0),1)+")"}}class Ar{constructor(t,e=!0){this.metricEvaluators=t,this.normalized=e,this.smoothed=!1,this.display=!0,this.upIsBetter=!1,this.overallValueForSnapshot=null,this.valueFormatter=null,this.nounQualifier=null,this.reportingVerbFormatter=null,this.benchmarkEvaluator=null,this.benchmarkRegionType=w,this.descriptionTemplate=Er.baseDescriptionTemplate(),this.supportedRegionLevel=S}hashString(){let t="";return this.metricEvaluators.forEach((function(e){t+=e.hashString()+"-"})),t}equals(t){return this.hashString()===t.hashString()}formatValue(t){return(null!==this.valueFormatter?this.valueFormatter:Z(","))(t)}formatValueHTML(t,e){return this.formatValue(e)}numSeries(){return this.metricEvaluators.length}statDescription(){return this.metricEvaluators[0].statDescription()}graphedNoun(){return this.metricEvaluators[0].graphedNoun()}changeInGraphedNoun(){return this.metricEvaluators[0].changeInGraphedNoun(!this.normalized)}needsGroupBy(){return this.metricEvaluators[0].needsGroupBy()}filterFunction(){return this.metricEvaluators[0].filterFunction}dataIsAtomic(){return!this.normalized}fullyQualifiedNoun(){return null!==this.nounQualifier?this.nounQualifier(this):this.statDescription()+" "+this.noun}reportingVerb(){return null!==this.reportingVerbFormatter?this.reportingVerbFormatter(this):this.measureDelta?"reported":"has reported"}valueForSnapshot(t){return null!==this.overallValueForSnapshot?this.overallValueForSnapshot(this,t):null}get measureDelta(){return this.metricEvaluators[0].measureDelta}set measureDelta(t){this.metricEvaluators.forEach((function(e){e.measureDelta=t}))}get source(){return this.metricEvaluators[0].source}set source(t){this.metricEvaluators.forEach((function(e){e.source=t}))}get allowNegative(){return this.metricEvaluators[0].allowNegative}set allowNegative(t){this.metricEvaluators.forEach((function(e){e.allowNegative=t}))}toggledEvaluator(){let t=Ar.from(this);return t.metricEvaluators=this.metricEvaluators.map(t=>t.toggledEvaluator()),t}supportsRegionType(t){return t<=this.supportedRegionLevel}static movePropertiesFrom(t,e){return e.smoothed=t.smoothed,e.title=t.title,e.normalized=t.normalized,e.noun=t.noun,e.display=t.display,e.overallValueForSnapshot=t.overallValueForSnapshot,e.valueFormatter=t.valueFormatter,e.upIsBetter=t.upIsBetter,e.descriptionTemplate=t.descriptionTemplate,e.nounQualifier=t.nounQualifier,e.reportingVerbFormatter=t.reportingVerbFormatter,e.benchmarkEvaluator=t.benchmarkEvaluator,e.benchmarkRegionType=t.benchmarkRegionType,e.supportedRegionLevel=t.supportedRegionLevel,e}static from(t){let e=new Ar(t.metricEvaluators.map(t=>Er.from(t)),t.normalized);return this.movePropertiesFrom(t,e),e}static smoothedCopy(t){let e=t.metricEvaluators.map(t=>Er.smoothedCopy(t)),n=new Ar(e,t.normalized);return this.movePropertiesFrom(t,n),n.smoothed=!0,n}static quotientValueForSnapshot(){return function(t,e){let n=Ar.sumValueForSnapshot()(t,e);return 0===n?0:t.metricEvaluators[0].valueForSnapshot(e)/n}}static sumValueForSnapshot(){return function(t,e){let n=0;for(let i=0;i<t.metricEvaluators.length;i++){n+=t.metricEvaluators[i].valueForSnapshot(e)}return n}}}class Br{static baseLogHeatMapEvaluator(t,e){return new Er(t,e,(function(t,e){return e.infection.cases}),(function(t,e){let n=t.valueForSnapshot(e);if(0==n)return 0;let i=Math.abs(n),r=Math.max(Math.log10(i),0);if(0==r)return 0;let a=(r+.1)/t.maxPowerOfTen;return n<0&&(a*=-1),a}),(function(t,e){let n=t.minAlpha,i=t.maxAlpha,r=Math.min(Math.max(n+(i-n)*Math.abs(e),0),1);return"rgba("+(e>=0?t.baseRGB:t.baseNegativeRGB)+","+r.toString()+")"}))}static regionNameEvaluator(){let t=new Er("Region Name","region",(function(t,e){return e.region.name}),null,null);return t.valueFormatter=function(t){return t},t}static confirmedCaseEvaluator(){let t=Br.baseLogHeatMapEvaluator("Confirmed cases","cases");return t.setBaseStat((function(t,e){return e.infection.cases})),t.baseRGB=Ir,t.maxPowerOfTen=5,t.supportedRegionLevel=F,t.source="The New York Times",t}static currentlyHospitalizedDescription(t){return t?"The number of currently hospitalized people <Token:RegionPreposition> <Token:Region> <Token:ChangeVerbCurrent> <Token:DataQuantity> <Token:TimePreposition> <Token:ShortDate>. On average, net hospitalizations per day are <Token:DirectionalPercentChangeWeek> week over week, and <Token:DirectionalPercentChangeMonth> month over month.":"<Token:Region> <Token:ReportingVerb> <Token:DataQuantity> people currently hospitalized <Token:TimePreposition> </Token:TimePreposition> <Token:ShortDate>. On average, current hospitalizations are <Token:DirectionalPercentChangeWeek> week over week, and <Token:DirectionalPercentChangeMonth> month over month."}static currentlyHospitalizedEvaluator(){let t=Br.baseLogHeatMapEvaluator("Currently hospitalized","currently hospitalized");return t.setBaseStat((function(t,e){return e.infection.hospitalized})),t.filterFunction=function(t,e){return e.infection.hospitalized.value>0},t.baseRGB="240,135,0",t.nounWithNumber="hospitalized",t.deltaAdjective="Change in",t.maxPowerOfTen=3,t.allowNegative=!0,t.source="The COVID Tracking Project",t.descriptionTemplate=Br.currentlyHospitalizedDescription(!1),t.toggleFunction=function(t){let e=Er.from(t);return e.measureDelta=!t.measureDelta,e.descriptionTemplate=Br.currentlyHospitalizedDescription(e.measureDelta),e},t}static totalTestEvaluator(){let t=Br.baseLogHeatMapEvaluator("Total tests","tests");return t.setBaseStat((function(t,e){return e.infection.totalTests})),t.filterFunction=function(t,e){return null!==e.infection.totalTests},t.baseRGB=kr,t.maxPowerOfTen=7,t.upIsBetter=!0,t.source="The COVID Tracking Project",t}static testedPositiveEvaluator(){let t=Br.baseLogHeatMapEvaluator("Total positive results","tests");return t.setBaseStat((function(t,e){return e.infection.testedPositive})),t.filterFunction=function(t,e){return null!==e.infection.testedPositive},t.baseRGB=Ir,t.maxPowerOfTen=5,t.source="The COVID Tracking Project",t}static testedNegativeEvaluator(){let t=Br.baseLogHeatMapEvaluator("Total negative results","tests");return t.setBaseStat((function(t,e){return e.infection.testedNegative})),t.baseRGB=kr,t.maxPowerOfTen=5,t.upIsBetter=!0,t.source="The COVID Tracking Project",t}static newTestEvaluator(){let t=Br.totalTestEvaluator();return t.title="New tests",t.measureDelta=!0,t}static newTestPositiveEvaluator(){let t=Br.testedPositiveEvaluator();return t.title="New positive results",t.measureDelta=!0,t}static newTestNegativeEvaluator(){let t=Br.testedNegativeEvaluator();return t.title="New negative results",t.measureDelta=!0,t}static newTestBreakdownEvaluator(){let t=Br.newTestPositiveEvaluator(),e=Br.newTestNegativeEvaluator(),n=new Ar([t,e],!1);return n.title="New tests",n.noun="tests",n.overallValueForSnapshot=Ar.sumValueForSnapshot(),n.upIsBetter=!0,n}static newCaseBreakdownEvaluator(){let t=Br.newConfirmedCaseEvaluator(),e=Br.newDeathEvaluator(),n=new Ar([e,t],!1);return n.title="New cases",n.noun="people",n}static totalTestBreakdownEvaluator(){let t=Br.testedPositiveEvaluator(),e=Br.testedNegativeEvaluator(),n=new Ar([t,e],!1);return n.title="Total tests",n.noun="tests",n.overallValueForSnapshot=Ar.sumValueForSnapshot(),n.upIsBetter=!0,n}static newTestPercentPositiveEvaluator(t=!1,e=!1){let n=Br.newTestPositiveEvaluator();n.cumulativeAdjective="overall",n.baseRGB="137,42,98",n.deltaAdjective="daily",n.nounWithNumber="positive",n.needsGroupByCallback=function(t){return!t.measureDelta};let i=Br.newTestNegativeEvaluator();i.display=!1;let r=new Ar([n,i],!1);return r.title="Positive rate",r.noun="test positive rate",r.normalized=!0,r.overallValueForSnapshot=Ar.quotientValueForSnapshot(),r.valueFormatter=Z(".1%"),r.reportingVerbFormatter=function(t){return t.measureDelta?"came back positive":"have come back positive"},r.descriptionTemplate="<Token:TimePreposition> <Token:ShortDate>, <Token:DataQuantity> of <Token:CumulativeSignifier>COVID-19 tests <Token:RegionPreposition> <Token:Region> <Token:ReportingVerb>. On average, the <Token:FullyQualifiedNoun> has <Token:ChangeVerbWeek> <Token:AmountChangeWeek> when compared to last week, and <Token:ChangeVerbMonth> <Token:AmountChangeMonth> when compared to last month.",t&&(r=Er.smoothedCopy(r)),e&&(r.benchmarkEvaluator=Br.nationalNewTestPercentPositiveEvaluator(),r.benchmarkRegionType=w),r}static nationalNewTestPercentPositiveEvaluator(){let t=Br.newTestPercentPositiveEvaluator(!0,!1),e=t.metricEvaluators[0];return e.metricEvaluators[0].title="national new positive",e.title="National Positive Rate",e.baseRGB="201,79,150",e.wantsFill=!1,e.annotation="<tspan x='0'>National</tspan><tspan x='0'dy='14'>average</tspan>",e.annotationPlacement=Tr,t}static nationalCaseSliderEvaluator(){let t=Br.confirmedCaseEvaluator();return t.maxPowerOfTen=6,t.minAlpha=0,t}static newConfirmedCaseEvaluator(){let t=Br.confirmedCaseEvaluator();return t.title="New cases",t.measureDelta=!0,t}static _newStatTrendEvaluator(t,e=7,n=0){let i=Er.from(t);return i.setBaseStat((function(n,i){let r=i.timeSeries.snapshotPrecedingSnapshot(i,e);if(null===r)return 0;let a=t.baseStatForSnapshot(t,r),o=t.baseStatForSnapshot(t,i);if(null===a||null===o)return 0;let s=Er.dataIndexForParameters(t.measureDelta,!0),u=a.rawdata[s],l=o.rawdata[s];return 0===u?0:l/u-1})),i.source=t.source,i.title=e+"-day change",i.displayAsPercent=!0,i.valueFormatter=function(t){let e=Math.abs(t),i="";return t>0&&(i="+ "),t<0&&(i="- "),i+Z("."+n+"%")(e)},i.HTMLFormatter=function(t,e,n){let i=t.valueFormatter(n);if(0===n)return i;let r=n>0;return t.upIsBetter&&(r=!r),"<span style='color:rgb("+(r?Ir:kr)+")'>"+i+"</span>"},i}static dailyPercentPositiveTrendEvaluator(t=7){let e=Br._newStatTrendEvaluator(Br.newTestPositiveEvaluator(),t,1);return e.setBaseStat((function(e,n){let i=n.timeSeries.snapshotPrecedingSnapshot(n,t),r=Er.dataIndexForParameters(!0,!0),a=i.infection.testedPositive,o=i.infection.totalTests;if(null===a||null===o)return null;let s=a.rawdata[r],u=o.rawdata[r],l=n.infection.testedPositive.rawdata[r],h=n.infection.totalTests.rawdata[r];return(0===h?0:l/h)-(0===u?0:s/u)})),e}static dailyPercentPositiveGraphicEvaluator(t=null){return Br.graphicEvaluator(this.dailyPercentPositiveTrendEvaluator(),this.newTestPercentPositiveEvaluator(!0),t)}static newCaseTrendEvaluator(t=7){return Br._newStatTrendEvaluator(Br.newConfirmedCaseEvaluator(),t)}static graphicEvaluator(t,e,n=null){let i=null;null!==n&&(i=n.map(t=>Object(B.d)(t)));let r=Er.from(t);return r.title="Trend",r.HTMLFormatter=function(t,r,a){let o=Object(D.a)("body").append("div").attr("class","mini-chart-sizing"),s=new wr(o,e,mr),u=r.timeSeries;null!==n&&(u=u.timeSeriesFrom(i[0],i[1]),s.fixTimeDomain(n[0],n[1]));let l=u.dataSliceForRegionID(r.region.ID);s.updateForData(l,!1);let h=o.node().innerHTML;return o.remove(),h},r}static newCaseGraphicEvaluator(t=null){return this.graphicEvaluator(this.newCaseTrendEvaluator(),this.newConfirmedCaseEvaluator(),t)}static newDeathTrendEvaluator(t=7){return Br._newStatTrendEvaluator(Br.newDeathEvaluator(),t)}static newDeathGraphicEvaluator(t=null){return this.graphicEvaluator(this.newDeathTrendEvaluator(),this.newDeathEvaluator(),t)}static currentlyHospitalizedTrendEvaluator(t=7){return Br._newStatTrendEvaluator(Br.currentlyHospitalizedEvaluator(),t)}static currentlyHospitalizedGraphicEvaluator(t=null){return this.graphicEvaluator(this.currentlyHospitalizedTrendEvaluator(),this.currentlyHospitalizedEvaluator(),t)}static newTestTrendEvaluator(t=7){let e=Br._newStatTrendEvaluator(Br.newTestEvaluator(),t);return e.upIsBetter=!0,e}static newTestGraphicEvaluator(t=null){return this.graphicEvaluator(this.newTestTrendEvaluator(),this.newTestEvaluator(),t)}static caseGrowthRate(){let t=Br.newConfirmedCaseEvaluator();return t.title="Case growth rate",t.noun="growth",t.setBaseStat((function(t,e){return e.infection.cases.rateOfChange})),t._intensityForSnapshot=function(t,e){return t.valueForSnapshot(e)/2},t}static deathGrowthRate(){let t=Br.newDeathEvaluator();return t.title="Death growth rate",t.noun="growth",t.setBaseStat((function(t,e){return e.infection.deaths.rateOfChange})),t._intensityForSnapshot=function(t,e){return t.valueForSnapshot(e)/2},t}static newDeathEvaluator(){let t=Br.deathEvaluator();return t.title="New deaths",t.measureDelta=!0,t}static deathEvaluator(){let t=Br.baseLogHeatMapEvaluator("Deaths","deaths");return t.setBaseStat((function(t,e){return e.infection.deaths})),t.baseRGB=Mr,t.maxPowerOfTen=3,t.supportedRegionLevel=F,t.source="The New York Times",t}}class Nr{constructor(t){this.regionAtlas=new C,this.dataByDay=Nr.aggregateTimeSeriesData(t,this.regionAtlas),this._precedingDateCache=new Map}static fromJSONObject(t,e=null){let n=new Nr(null);return n.regionAtlas=C.fromJSONObject(t.regionAtlas,e),n.dataByDay=Nr.dataByDayFromJSONObject(t.dataByDay,n.regionAtlas,n),n}updateForMobilityJSON(t){let e=this;for(const n in t)if(this.regionAtlas.has(n)){let i=t[n].dataByDay;for(const t in i){let r=e.snapshotForDay(t,n);null!==r&&(r.mobilityData=W.fromJSONObject(i[t]))}}}containsRegion(t){return this.regionAtlas.has(t)}regionForID(t){return this.regionAtlas.regionWithID(t)}dayForPercentElapsed(t){let e=this.firstDay.getTime(),n=e+(this.lastDay.getTime()-e)*t,i=Math.round(n/B.a)*B.a;return this._dateStringForTime(i)}snapshotPrecedingSnapshot(t,e=1){let n=t.dateString+"*"+e,i=this._precedingDateCache.get(n);if(void 0===i){let r=t.date.addDays(-e);i=Object(B.d)(r),this._precedingDateCache.set(n,i)}return this.snapshotForDay(i,t.region.ID)}_dateStringForTime(t){let e=Object(B.c)(t);return Object(B.d)(e)}dataSliceForRegionID(t){let e=[];return this.dataByDay.forEach((function(n){let i=n.get(t);i&&e.push(i)})),e}timeSeriesFrom(t,e){let n=new Map;this.dataByDay.forEach((function(i,r){(null===t||r>=t)&&(null===e||r<=e)&&n.set(r,i)}));let i=new Nr;return i.dataByDay=n,i.regionAtlas=this.regionAtlas,i}topRegion(){return this.topRegions(1)[0]}topRegions(t=0,e=null,n=Br.confirmedCaseEvaluator(),i=!1,r=null){let a=null!==r?r:this.lastDay,o=Object(B.d)(a),s=this.dataForDay(o);if(void 0===s)return[];let u=Array.from(s.values());return null!==e&&(u=u.filter(e)),u.sort((function(t,e){let r=n.valueForSnapshot(e),a=n.valueForSnapshot(t),o=0;return Number.isNaN(parseFloat(r))?"string"==typeof r&&(o=r.localeCompare(a)):o=r-a,i&&(o*=-1),o})),u.length>t&&t>0&&(u=u.slice(0,t)),u.map(t=>t.region)}timeSeriesBeginningAt(t){return this.timeSeriesFrom(t,null)}timeSeriesEndingAt(t){return this.timeSeriesFrom(null,t)}percentElapsedForDay(t){let e=new Date(t).getTime(),n=this.firstDay.getTime();return(e-n)/(this.lastDay.getTime()-n)}_didUpdateDataByDay(){let t=Array.from(this.days());t.sort((t,e)=>t>e),t.length>0&&(this.firstDay=new Date(t[0]),this.lastDay=new Date(t[t.length-1]))}get dataByDay(){return this._dataByDay}set dataByDay(t){this._dataByDay=t,this._didUpdateDataByDay()}snapshotForDay(t,e){let n=this.dataForDay(t);if(void 0===n)return null;let i=n.get(e);return void 0===i?null:i}dataForDay(t,e=null){let n=this._dataByDay.get(t);if(null!==e){let t=new Map(n);t.forEach((function(n,i){e(n)||t.delete(i)})),n=t}return n}dataForRegionOnDay(t,e){let n=this.regionAtlas.regionWithID(t);if(void 0===n)return null;let i=this.dataForDay(e);return void 0===i?null:i.get(n.ID)}days(){return this._dataByDay.keys()}static dataByDayFromJSONObject(t,e,n=null){let i=new Map;for(const r in t){let a=new Map,o=t[r];for(const t in o){let i=o[t],s=A.fromJSONObject(i.i),u=new P(r,e.regionWithID(t),s,n);a.set(t,u)}i.set(r,a)}return i=new Map([...i.entries()].sort()),i}static aggregateTimeSeriesData(t,e=null){if(!t)return new Map;let n=new Map;return t.forEach((function(t){const i=t.dateString;let r=n.get(i);r||(r=new Map),null!=e&&e.registerRegion(t.region);const a=t.region.ID;r.set(a,t),n.set(i,r)})),n}}var Pr,Or,Hr=0,zr=0,jr=0,Lr=0,Vr=0,Wr=0,Ur="object"==typeof performance&&performance.now?performance:Date,Yr="object"==typeof window&&window.requestAnimationFrame?window.requestAnimationFrame.bind(window):function(t){setTimeout(t,17)};function Gr(){return Vr||(Yr(Qr),Vr=Ur.now()+Wr)}function Qr(){Vr=0}function qr(){this._call=this._time=this._next=null}function Xr(t,e,n){var i=new qr;return i.restart(t,e,n),i}function Jr(){Vr=(Lr=Ur.now())+Wr,Hr=zr=0;try{!function(){Gr(),++Hr;for(var t,e=Pr;e;)(t=Vr-e._time)>=0&&e._call.call(null,t),e=e._next;--Hr}()}finally{Hr=0,function(){var t,e,n=Pr,i=1/0;for(;n;)n._call?(i>n._time&&(i=n._time),t=n,n=n._next):(e=n._next,n._next=null,n=t?t._next=e:Pr=e);Or=t,$r(i)}(),Vr=0}}function Zr(){var t=Ur.now(),e=t-Lr;e>1e3&&(Wr-=e,Lr=t)}function $r(t){Hr||(zr&&(zr=clearTimeout(zr)),t-Vr>24?(t<1/0&&(zr=setTimeout(Jr,t-Ur.now()-Wr)),jr&&(jr=clearInterval(jr))):(jr||(Lr=Ur.now(),jr=setInterval(Zr,1e3)),Hr=1,Yr(Jr)))}qr.prototype=Xr.prototype={constructor:qr,restart:function(t,e,n){if("function"!=typeof t)throw new TypeError("callback is not a function");n=(null==n?Gr():+n)+(null==e?0:+e),this._next||Or===this||(Or?Or._next=this:Pr=this,Or=this),this._call=t,this._time=n,$r()},stop:function(){this._call&&(this._call=null,this._time=1/0,$r())}};class Kr{constructor(t,e,n,i){this.x=t,this.y=e,this.width=n,this.height=i}unionRect(t){let e=Math.min(this.x,t.x),n=Math.min(this.y,t.y),i=Math.max(this.x+this.width,t.x+t.width),r=Math.max(this.y+this.height,t.y+t.height);this.x=e,this.y=n,this.width=i-e,this.height=r-n}aspectRatio(){return this.width/this.height}left(){return this.x}right(){return this.x+this.width}top(){return this.y}bottom(){return this.y+this.height}toString(){return"(x:"+this.x+" y:"+this.y+" w:"+this.width+" h:"+this.height+")"}static fromSVGRect(t){return new Kr(t.x,t.y,t.width,t.height)}}class ta{constructor(t,e=[],n=null){this.container=t.append("div").attr("class","data-table-container content-column"),this.table=this.container.append("div").attr("class","data-table"),this.tableHeader=this.table.append("div").attr("class","data-table-header"),this.tableHeaderRow=this.tableHeader.append("div").attr("class","data-table-row"),this.tableBody=this.table.append("div").attr("class","data-table-body"),this.attribution=this.table.append("div").attr("class","data-attribution"),this.numDataRows=this._defaultNumRows(),this.descending=!0,this.sortEvaluator=n,this.onRegionClicked=null,this.data=null,this.dataIsIncomplete=!0,this.highlightedRegionID=null,this.aggregateRegionID=null,this.updateForEvaluators(e,n,!1)}updateForData(t,e,n,i=!1){this.aggregateSnapshot=t,this.aggregateRegionID!==t.region.ID&&(this.aggregateRegionID=t.region.ID,this.numDataRows=this._defaultNumRows()),this.data=e,this.highlightedRegionID=null,i||this.render(n)}updateForEvaluators(t,e,n,i=!1){this.evaluators=t,this.sortEvaluator=e,null===this.sortEvaluator&&t.length>0&&(this.sortEvaluator=t.first()),i||this.render(n)}updateForSortEvaluator(t,e){null!==this.sortEvaluator&&this.sortEvaluator.equals(t)?this.descending=!this.descending:(this.sortEvaluator=t,this.descending=!0),this.render(e)}updateForHighlightedRegion(t){this.highlightedRegionID=t,this.render(!1)}render(t){if(null===this.data||0===this.evaluators.length)return;let e=this;this.tableHeaderRow.selectAll("div.data-table-cell").remove(),this.tableHeaderRow.selectAll("div.data-table-cell").data(this.evaluators,(function(t){return t.hashString()})).join((function(t){return t.append("div").attr("class","data-table-cell").html((function(t,n){if(0===n)return e._metadataSummaryHTML();return t.title.replace(" ","<br>")})).on("click",(function(t){e._didClickEvaluator(t)}))}));let n=Array.from(this.data.values()),i=this.descending?1:-1;if(null!==this.sortEvaluator){let t=this.sortEvaluator;n.sort((e,n)=>i*(t.valueForSnapshot(n)-t.valueForSnapshot(e)))}n=n.slice(0,this.numDataRows),n.unshift(this.aggregateSnapshot),n.length>0&&null===this.highlightedRegionID&&(this.highlightedRegionID=n[0].region.ID);let r=n.map(t=>t.region.ID),a=!1;if(!r.includes(this.highlightedRegionID)){let t=this.highlightedRegionID===this.aggregateSnapshot.region.ID?this.aggregateSnapshot:this.data.get(this.highlightedRegionID);void 0===t&&console.log("wtf"),n.push(t),a=!0}let o=this.evaluators;if(this.tableBody.selectAll("div.data-table-row").remove(),this.tableBody.selectAll("div.data-table-row").data(n,(function(t){return t.region.name})).join((function(t){let n=t.append("div").attr("class",(function(t){return e._classNameForRowWithSnapshot(t,a)})).on("click",(function(t){e._didClickRegion(t.region)}));return o.forEach((function(t,e){n=n.append("div").attr("class","data-table-cell").html((function(e){return t.formatValueHTML(e,t.valueForSnapshot(e))})).select((function(){return this.parentNode}))})),n}),(function(t){return t.attr("class",(function(t){return e._classNameForRowWithSnapshot(t,a)}))}),(function(t){t.remove()})),void 0!==this.showButton&&this.showButton.remove(),this._needsShowButton()){let t=this._isTruncatingTable()?"Show more":"Show less";this.showButton=this.tableBody.append("div").attr("class","data-table-button-row").on("click",(function(){e._didClickShowButton()})),this.showButton.append("div").attr("class","data-table-button-cell").text(t)}this.attribution.text(this._sourceString())}aggregateRegionType(){return null===this.aggregateSnapshot||void 0===this.aggregateSnapshot?w:this.aggregateSnapshot.region.type}childRegionType(){return this.aggregateRegionType()+1}_classNameForRowWithSnapshot(t,e=!1){let n="data-table-row";return t.region.ID===this.highlightedRegionID&&(n+=" highlighted",e&&(n+=" data-table-row-after-truncation")),n}_metadataSummaryHTML(){let t=this.aggregateSnapshot.normalizedDate(),e=Object(B.f)(t);return this.dataIsIncomplete&&(e+="<br /><i>Updated hourly</i>"),e}_sourceString(){return"Data from "+this.sortEvaluator.source}_defaultNumRows(){return 5}_needsShowButton(){return this.data.size>this._defaultNumRows()}_isTruncatingTable(){return this.numDataRows<this.data.size&&this.data.size>this._defaultNumRows()}_didClickEvaluator(t){this.updateForSortEvaluator(t,!1)}_didClickRegion(t){null!==this.onRegionClicked&&this.onRegionClicked(t.ID)}_didClickShowButton(){this._isTruncatingTable()?this.numDataRows+=this._defaultNumRows():this.numDataRows=this._defaultNumRows(),this.render(!1)}}var ea=Math.PI,na=ea/2,ia=ea/4,ra=2*ea,aa=180/ea,oa=ea/180,sa=Math.abs,ua=Math.atan,la=Math.atan2,ha=Math.cos,ca=(Math.ceil,Math.exp,Math.floor,Math.log,Math.pow,Math.sin),da=Math.sign||function(t){return t>0?1:t<0?-1:0},fa=Math.sqrt;Math.tan;function pa(t){return t>1?na:t<-1?-na:Math.asin(t)}function ga(){}var va=function(){var t,e=[];return{point:function(e,n){t.push([e,n])},lineStart:function(){e.push(t=[])},lineEnd:ga,rejoin:function(){e.length>1&&e.push(e.pop().concat(e.shift()))},result:function(){var n=e;return e=[],t=null,n}}},ma=function(t,e){return sa(t[0]-e[0])<1e-6&&sa(t[1]-e[1])<1e-6};function ya(t,e,n,i){this.x=t,this.z=e,this.o=n,this.e=i,this.v=!1,this.n=this.p=null}var _a=function(t,e,n,i,r){var a,o,s=[],u=[];if(t.forEach((function(t){if(!((e=t.length-1)<=0)){var e,n,i=t[0],o=t[e];if(ma(i,o)){for(r.lineStart(),a=0;a<e;++a)r.point((i=t[a])[0],i[1]);r.lineEnd()}else s.push(n=new ya(i,t,null,!0)),u.push(n.o=new ya(i,null,n,!1)),s.push(n=new ya(o,t,null,!1)),u.push(n.o=new ya(o,null,n,!0))}})),s.length){for(u.sort(e),Da(s),Da(u),a=0,o=u.length;a<o;++a)u[a].e=n=!n;for(var l,h,c=s[0];;){for(var d=c,f=!0;d.v;)if((d=d.n)===c)return;l=d.z,r.lineStart();do{if(d.v=d.o.v=!0,d.e){if(f)for(a=0,o=l.length;a<o;++a)r.point((h=l[a])[0],h[1]);else i(d.x,d.n.x,1,r);d=d.n}else{if(f)for(l=d.p.z,a=l.length-1;a>=0;--a)r.point((h=l[a])[0],h[1]);else i(d.x,d.p.x,-1,r);d=d.p}l=(d=d.o).z,f=!f}while(!d.v);r.lineEnd()}}};function Da(t){if(e=t.length){for(var e,n,i=0,r=t[0];++i<e;)r.n=n=t[i],n.p=r,r=n;r.n=n=t[0],n.p=r}}var wa=function(){return new ba};function ba(){this.reset()}ba.prototype={constructor:ba,reset:function(){this.s=this.t=0},add:function(t){Fa(Sa,t,this.t),Fa(this,Sa.s,this.s),this.s?this.t+=Sa.t:this.s=Sa.t},valueOf:function(){return this.s}};var Sa=new ba;function Fa(t,e,n){var i=t.s=e+n,r=i-e,a=i-r;t.t=e-a+(n-r)}function xa(t){return[la(t[1],t[0]),pa(t[2])]}function Ca(t){var e=t[0],n=t[1],i=ha(n);return[i*ha(e),i*ca(e),ca(n)]}function Ta(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function Ra(t,e){return[t[1]*e[2]-t[2]*e[1],t[2]*e[0]-t[0]*e[2],t[0]*e[1]-t[1]*e[0]]}function Ia(t,e){t[0]+=e[0],t[1]+=e[1],t[2]+=e[2]}function Ma(t,e){return[t[0]*e,t[1]*e,t[2]*e]}function ka(t){var e=fa(t[0]*t[0]+t[1]*t[1]+t[2]*t[2]);t[0]/=e,t[1]/=e,t[2]/=e}var Ea=wa();function Aa(t){return sa(t[0])<=ea?t[0]:da(t[0])*((sa(t[0])+ea)%ra-ea)}var Ba=function(t,e){return t<e?-1:t>e?1:t>=e?0:NaN};var Na,Pa;1===(Na=Ba).length&&(Pa=Na,Na=function(t,e){return Ba(Pa(t),e)});var Oa=Array.prototype;Oa.slice,Oa.map,Math.sqrt(50),Math.sqrt(10),Math.sqrt(2);var Ha=function(t){for(var e,n,i,r=t.length,a=-1,o=0;++a<r;)o+=t[a].length;for(n=new Array(o);--r>=0;)for(e=(i=t[r]).length;--e>=0;)n[--o]=i[e];return n};var za=function(t,e,n,i){return function(r){var a,o,s,u=e(r),l=va(),h=e(l),c=!1,d={point:f,lineStart:g,lineEnd:v,polygonStart:function(){d.point=m,d.lineStart=y,d.lineEnd=_,o=[],a=[]},polygonEnd:function(){d.point=f,d.lineStart=g,d.lineEnd=v,o=Ha(o);var t=function(t,e){var n=Aa(e),i=e[1],r=ca(i),a=[ca(n),-ha(n),0],o=0,s=0;Ea.reset(),1===r?i=na+1e-6:-1===r&&(i=-na-1e-6);for(var u=0,l=t.length;u<l;++u)if(c=(h=t[u]).length)for(var h,c,d=h[c-1],f=Aa(d),p=d[1]/2+ia,g=ca(p),v=ha(p),m=0;m<c;++m,f=_,g=w,v=b,d=y){var y=h[m],_=Aa(y),D=y[1]/2+ia,w=ca(D),b=ha(D),S=_-f,F=S>=0?1:-1,x=F*S,C=x>ea,T=g*w;if(Ea.add(la(T*F*ca(x),v*b+T*ha(x))),o+=C?S+F*ra:S,C^f>=n^_>=n){var R=Ra(Ca(d),Ca(y));ka(R);var I=Ra(a,R);ka(I);var M=(C^S>=0?-1:1)*pa(I[2]);(i>M||i===M&&(R[0]||R[1]))&&(s+=C^S>=0?1:-1)}}return(o<-1e-6||o<1e-6&&Ea<-1e-6)^1&s}(a,i);o.length?(c||(r.polygonStart(),c=!0),_a(o,La,t,n,r)):t&&(c||(r.polygonStart(),c=!0),r.lineStart(),n(null,null,1,r),r.lineEnd()),c&&(r.polygonEnd(),c=!1),o=a=null},sphere:function(){r.polygonStart(),r.lineStart(),n(null,null,1,r),r.lineEnd(),r.polygonEnd()}};function f(e,n){t(e,n)&&r.point(e,n)}function p(t,e){u.point(t,e)}function g(){d.point=p,u.lineStart()}function v(){d.point=f,u.lineEnd()}function m(t,e){s.push([t,e]),h.point(t,e)}function y(){h.lineStart(),s=[]}function _(){m(s[0][0],s[0][1]),h.lineEnd();var t,e,n,i,u=h.clean(),d=l.result(),f=d.length;if(s.pop(),a.push(s),s=null,f)if(1&u){if((e=(n=d[0]).length-1)>0){for(c||(r.polygonStart(),c=!0),r.lineStart(),t=0;t<e;++t)r.point((i=n[t])[0],i[1]);r.lineEnd()}}else f>1&&2&u&&d.push(d.pop().concat(d.shift())),o.push(d.filter(ja))}return d}};function ja(t){return t.length>1}function La(t,e){return((t=t.x)[0]<0?t[1]-na-1e-6:na-t[1])-((e=e.x)[0]<0?e[1]-na-1e-6:na-e[1])}var Va=za((function(){return!0}),(function(t){var e,n=NaN,i=NaN,r=NaN;return{lineStart:function(){t.lineStart(),e=1},point:function(a,o){var s=a>0?ea:-ea,u=sa(a-n);sa(u-ea)<1e-6?(t.point(n,i=(i+o)/2>0?na:-na),t.point(r,i),t.lineEnd(),t.lineStart(),t.point(s,i),t.point(a,i),e=0):r!==s&&u>=ea&&(sa(n-r)<1e-6&&(n-=1e-6*r),sa(a-s)<1e-6&&(a-=1e-6*s),i=function(t,e,n,i){var r,a,o=ca(t-n);return sa(o)>1e-6?ua((ca(e)*(a=ha(i))*ca(n)-ca(i)*(r=ha(e))*ca(t))/(r*a*o)):(e+i)/2}(n,i,a,o),t.point(r,i),t.lineEnd(),t.lineStart(),t.point(s,i),e=0),t.point(n=a,i=o),r=s},lineEnd:function(){t.lineEnd(),n=i=NaN},clean:function(){return 2-e}}}),(function(t,e,n,i){var r;if(null==t)r=n*na,i.point(-ea,r),i.point(0,r),i.point(ea,r),i.point(ea,0),i.point(ea,-r),i.point(0,-r),i.point(-ea,-r),i.point(-ea,0),i.point(-ea,r);else if(sa(t[0]-e[0])>1e-6){var a=t[0]<e[0]?ea:-ea;r=n*a/2,i.point(-a,r),i.point(0,r),i.point(a,r)}else i.point(e[0],e[1])}),[-ea,-na]);var Wa=function(t,e){function n(n,i){return n=t(n,i),e(n[0],n[1])}return t.invert&&e.invert&&(n.invert=function(n,i){return(n=e.invert(n,i))&&t.invert(n[0],n[1])}),n};function Ua(t,e){return[sa(t)>ea?t+Math.round(-t/ra)*ra:t,e]}function Ya(t,e,n){return(t%=ra)?e||n?Wa(Qa(t),qa(e,n)):Qa(t):e||n?qa(e,n):Ua}function Ga(t){return function(e,n){return[(e+=t)>ea?e-ra:e<-ea?e+ra:e,n]}}function Qa(t){var e=Ga(t);return e.invert=Ga(-t),e}function qa(t,e){var n=ha(t),i=ca(t),r=ha(e),a=ca(e);function o(t,e){var o=ha(e),s=ha(t)*o,u=ca(t)*o,l=ca(e),h=l*n+s*i;return[la(u*r-h*a,s*n-l*i),pa(h*r+u*a)]}return o.invert=function(t,e){var o=ha(e),s=ha(t)*o,u=ca(t)*o,l=ca(e),h=l*r-u*a;return[la(u*r+l*a,s*n+h*i),pa(h*n-s*i)]},o}Ua.invert=Ua;function Xa(t,e,n,i,r,a){if(n){var o=ha(e),s=ca(e),u=i*n;null==r?(r=e+i*ra,a=e-u/2):(r=Ja(o,r),a=Ja(o,a),(i>0?r<a:r>a)&&(r+=i*ra));for(var l,h=r;i>0?h>a:h<a;h-=u)l=xa([o,-s*ha(h),-s*ca(h)]),t.point(l[0],l[1])}}function Ja(t,e){(e=Ca(e))[0]-=t,ka(e);var n,i=(n=-e[1])>1?0:n<-1?ea:Math.acos(n);return((-e[2]<0?-i:i)+ra-1e-6)%ra}var Za=function(t){var e=ha(t),n=6*oa,i=e>0,r=sa(e)>1e-6;function a(t,n){return ha(t)*ha(n)>e}function o(t,n,i){var r=[1,0,0],a=Ra(Ca(t),Ca(n)),o=Ta(a,a),s=a[0],u=o-s*s;if(!u)return!i&&t;var l=e*o/u,h=-e*s/u,c=Ra(r,a),d=Ma(r,l);Ia(d,Ma(a,h));var f=c,p=Ta(d,f),g=Ta(f,f),v=p*p-g*(Ta(d,d)-1);if(!(v<0)){var m=fa(v),y=Ma(f,(-p-m)/g);if(Ia(y,d),y=xa(y),!i)return y;var _,D=t[0],w=n[0],b=t[1],S=n[1];w<D&&(_=D,D=w,w=_);var F=w-D,x=sa(F-ea)<1e-6;if(!x&&S<b&&(_=b,b=S,S=_),x||F<1e-6?x?b+S>0^y[1]<(sa(y[0]-D)<1e-6?b:S):b<=y[1]&&y[1]<=S:F>ea^(D<=y[0]&&y[0]<=w)){var C=Ma(f,(-p+m)/g);return Ia(C,d),[y,xa(C)]}}}function s(e,n){var r=i?t:ea-t,a=0;return e<-r?a|=1:e>r&&(a|=2),n<-r?a|=4:n>r&&(a|=8),a}return za(a,(function(t){var e,n,u,l,h;return{lineStart:function(){l=u=!1,h=1},point:function(c,d){var f,p=[c,d],g=a(c,d),v=i?g?0:s(c,d):g?s(c+(c<0?ea:-ea),d):0;if(!e&&(l=u=g)&&t.lineStart(),g!==u&&(!(f=o(e,p))||ma(e,f)||ma(p,f))&&(p[0]+=1e-6,p[1]+=1e-6,g=a(p[0],p[1])),g!==u)h=0,g?(t.lineStart(),f=o(p,e),t.point(f[0],f[1])):(f=o(e,p),t.point(f[0],f[1]),t.lineEnd()),e=f;else if(r&&e&&i^g){var m;v&n||!(m=o(p,e,!0))||(h=0,i?(t.lineStart(),t.point(m[0][0],m[0][1]),t.point(m[1][0],m[1][1]),t.lineEnd()):(t.point(m[1][0],m[1][1]),t.lineEnd(),t.lineStart(),t.point(m[0][0],m[0][1])))}!g||e&&ma(e,p)||t.point(p[0],p[1]),e=p,u=g,n=v},lineEnd:function(){u&&t.lineEnd(),e=null},clean:function(){return h|(l&&u)<<1}}}),(function(e,i,r,a){Xa(a,t,n,r,e,i)}),i?[0,-t]:[-ea,t-ea])};function $a(t,e,n,i){function r(r,a){return t<=r&&r<=n&&e<=a&&a<=i}function a(r,a,s,l){var h=0,c=0;if(null==r||(h=o(r,s))!==(c=o(a,s))||u(r,a)<0^s>0)do{l.point(0===h||3===h?t:n,h>1?i:e)}while((h=(h+s+4)%4)!==c);else l.point(a[0],a[1])}function o(i,r){return sa(i[0]-t)<1e-6?r>0?0:3:sa(i[0]-n)<1e-6?r>0?2:1:sa(i[1]-e)<1e-6?r>0?1:0:r>0?3:2}function s(t,e){return u(t.x,e.x)}function u(t,e){var n=o(t,1),i=o(e,1);return n!==i?n-i:0===n?e[1]-t[1]:1===n?t[0]-e[0]:2===n?t[1]-e[1]:e[0]-t[0]}return function(o){var u,l,h,c,d,f,p,g,v,m,y,_=o,D=va(),w={point:b,lineStart:function(){w.point=S,l&&l.push(h=[]);m=!0,v=!1,p=g=NaN},lineEnd:function(){u&&(S(c,d),f&&v&&D.rejoin(),u.push(D.result()));w.point=b,v&&_.lineEnd()},polygonStart:function(){_=D,u=[],l=[],y=!0},polygonEnd:function(){var e=function(){for(var e=0,n=0,r=l.length;n<r;++n)for(var a,o,s=l[n],u=1,h=s.length,c=s[0],d=c[0],f=c[1];u<h;++u)a=d,o=f,c=s[u],d=c[0],f=c[1],o<=i?f>i&&(d-a)*(i-o)>(f-o)*(t-a)&&++e:f<=i&&(d-a)*(i-o)<(f-o)*(t-a)&&--e;return e}(),n=y&&e,r=(u=Ha(u)).length;(n||r)&&(o.polygonStart(),n&&(o.lineStart(),a(null,null,1,o),o.lineEnd()),r&&_a(u,s,e,a,o),o.polygonEnd());_=o,u=l=h=null}};function b(t,e){r(t,e)&&_.point(t,e)}function S(a,o){var s=r(a,o);if(l&&h.push([a,o]),m)c=a,d=o,f=s,m=!1,s&&(_.lineStart(),_.point(a,o));else if(s&&v)_.point(a,o);else{var u=[p=Math.max(-1e9,Math.min(1e9,p)),g=Math.max(-1e9,Math.min(1e9,g))],D=[a=Math.max(-1e9,Math.min(1e9,a)),o=Math.max(-1e9,Math.min(1e9,o))];!function(t,e,n,i,r,a){var o,s=t[0],u=t[1],l=0,h=1,c=e[0]-s,d=e[1]-u;if(o=n-s,c||!(o>0)){if(o/=c,c<0){if(o<l)return;o<h&&(h=o)}else if(c>0){if(o>h)return;o>l&&(l=o)}if(o=r-s,c||!(o<0)){if(o/=c,c<0){if(o>h)return;o>l&&(l=o)}else if(c>0){if(o<l)return;o<h&&(h=o)}if(o=i-u,d||!(o>0)){if(o/=d,d<0){if(o<l)return;o<h&&(h=o)}else if(d>0){if(o>h)return;o>l&&(l=o)}if(o=a-u,d||!(o<0)){if(o/=d,d<0){if(o>h)return;o>l&&(l=o)}else if(d>0){if(o<l)return;o<h&&(h=o)}return l>0&&(t[0]=s+l*c,t[1]=u+l*d),h<1&&(e[0]=s+h*c,e[1]=u+h*d),!0}}}}}(u,D,t,e,n,i)?s&&(_.lineStart(),_.point(a,o),y=!1):(v||(_.lineStart(),_.point(u[0],u[1])),_.point(D[0],D[1]),s||_.lineEnd(),y=!1)}p=a,g=o,v=s}return w}}var Ka=function(t){return t};function to(t){return function(e){var n=new eo;for(var i in t)n[i]=t[i];return n.stream=e,n}}function eo(){}function no(t,e){t&&ro.hasOwnProperty(t.type)&&ro[t.type](t,e)}eo.prototype={constructor:eo,point:function(t,e){this.stream.point(t,e)},sphere:function(){this.stream.sphere()},lineStart:function(){this.stream.lineStart()},lineEnd:function(){this.stream.lineEnd()},polygonStart:function(){this.stream.polygonStart()},polygonEnd:function(){this.stream.polygonEnd()}};var io={Feature:function(t,e){no(t.geometry,e)},FeatureCollection:function(t,e){for(var n=t.features,i=-1,r=n.length;++i<r;)no(n[i].geometry,e)}},ro={Sphere:function(t,e){e.sphere()},Point:function(t,e){t=t.coordinates,e.point(t[0],t[1],t[2])},MultiPoint:function(t,e){for(var n=t.coordinates,i=-1,r=n.length;++i<r;)t=n[i],e.point(t[0],t[1],t[2])},LineString:function(t,e){ao(t.coordinates,e,0)},MultiLineString:function(t,e){for(var n=t.coordinates,i=-1,r=n.length;++i<r;)ao(n[i],e,0)},Polygon:function(t,e){oo(t.coordinates,e)},MultiPolygon:function(t,e){for(var n=t.coordinates,i=-1,r=n.length;++i<r;)oo(n[i],e)},GeometryCollection:function(t,e){for(var n=t.geometries,i=-1,r=n.length;++i<r;)no(n[i],e)}};function ao(t,e,n){var i,r=-1,a=t.length-n;for(e.lineStart();++r<a;)i=t[r],e.point(i[0],i[1],i[2]);e.lineEnd()}function oo(t,e){var n=-1,i=t.length;for(e.polygonStart();++n<i;)ao(t[n],e,1);e.polygonEnd()}var so=function(t,e){t&&io.hasOwnProperty(t.type)?io[t.type](t,e):no(t,e)},uo=1/0,lo=uo,ho=-uo,co=ho;var fo={point:function(t,e){t<uo&&(uo=t);t>ho&&(ho=t);e<lo&&(lo=e);e>co&&(co=e)},lineStart:ga,lineEnd:ga,polygonStart:ga,polygonEnd:ga,result:function(){var t=[[uo,lo],[ho,co]];return ho=co=-(lo=uo=1/0),t}};function po(t,e,n){var i=t.clipExtent&&t.clipExtent();return t.scale(150).translate([0,0]),null!=i&&t.clipExtent(null),so(n,t.stream(fo)),e(fo.result()),null!=i&&t.clipExtent(i),t}function go(t,e,n){return po(t,(function(n){var i=e[1][0]-e[0][0],r=e[1][1]-e[0][1],a=Math.min(i/(n[1][0]-n[0][0]),r/(n[1][1]-n[0][1])),o=+e[0][0]+(i-a*(n[1][0]+n[0][0]))/2,s=+e[0][1]+(r-a*(n[1][1]+n[0][1]))/2;t.scale(150*a).translate([o,s])}),n)}var vo=ha(30*oa),mo=function(t,e){return+e?function(t,e){function n(i,r,a,o,s,u,l,h,c,d,f,p,g,v){var m=l-i,y=h-r,_=m*m+y*y;if(_>4*e&&g--){var D=o+d,w=s+f,b=u+p,S=fa(D*D+w*w+b*b),F=pa(b/=S),x=sa(sa(b)-1)<1e-6||sa(a-c)<1e-6?(a+c)/2:la(w,D),C=t(x,F),T=C[0],R=C[1],I=T-i,M=R-r,k=y*I-m*M;(k*k/_>e||sa((m*I+y*M)/_-.5)>.3||o*d+s*f+u*p<vo)&&(n(i,r,a,o,s,u,T,R,x,D/=S,w/=S,b,g,v),v.point(T,R),n(T,R,x,D,w,b,l,h,c,d,f,p,g,v))}}return function(e){var i,r,a,o,s,u,l,h,c,d,f,p,g={point:v,lineStart:m,lineEnd:_,polygonStart:function(){e.polygonStart(),g.lineStart=D},polygonEnd:function(){e.polygonEnd(),g.lineStart=m}};function v(n,i){n=t(n,i),e.point(n[0],n[1])}function m(){h=NaN,g.point=y,e.lineStart()}function y(i,r){var a=Ca([i,r]),o=t(i,r);n(h,c,l,d,f,p,h=o[0],c=o[1],l=i,d=a[0],f=a[1],p=a[2],16,e),e.point(h,c)}function _(){g.point=v,e.lineEnd()}function D(){m(),g.point=w,g.lineEnd=b}function w(t,e){y(i=t,e),r=h,a=c,o=d,s=f,u=p,g.point=y}function b(){n(h,c,l,d,f,p,r,a,i,o,s,u,16,e),g.lineEnd=_,_()}return g}}(t,e):function(t){return to({point:function(e,n){e=t(e,n),this.stream.point(e[0],e[1])}})}(t)};var yo=to({point:function(t,e){this.stream.point(t*oa,e*oa)}});function _o(t,e,n,i,r){function a(a,o){return[e+t*(a*=i),n-t*(o*=r)]}return a.invert=function(a,o){return[(a-e)/t*i,(n-o)/t*r]},a}function Do(t,e,n,i,r,a){var o=ha(a),s=ca(a),u=o*t,l=s*t,h=o/t,c=s/t,d=(s*n-o*e)/t,f=(s*e+o*n)/t;function p(t,a){return[u*(t*=i)-l*(a*=r)+e,n-l*t-u*a]}return p.invert=function(t,e){return[i*(h*t-c*e+d),r*(f-c*t-h*e)]},p}function wo(t){var e,n,i,r,a,o,s,u,l,h,c=150,d=480,f=250,p=0,g=0,v=0,m=0,y=0,_=0,D=1,w=1,b=null,S=Va,F=null,x=Ka,C=.5;function T(t){return u(t[0]*oa,t[1]*oa)}function R(t){return(t=u.invert(t[0],t[1]))&&[t[0]*aa,t[1]*aa]}function I(){var t=Do(c,0,0,D,w,_).apply(null,e(p,g)),i=(_?Do:_o)(c,d-t[0],f-t[1],D,w,_);return n=Ya(v,m,y),s=Wa(e,i),u=Wa(n,s),o=mo(s,C),M()}function M(){return l=h=null,T}return T.stream=function(t){return l&&h===t?l:l=yo(function(t){return to({point:function(e,n){var i=t(e,n);return this.stream.point(i[0],i[1])}})}(n)(S(o(x(h=t)))))},T.preclip=function(t){return arguments.length?(S=t,b=void 0,M()):S},T.postclip=function(t){return arguments.length?(x=t,F=i=r=a=null,M()):x},T.clipAngle=function(t){return arguments.length?(S=+t?Za(b=t*oa):(b=null,Va),M()):b*aa},T.clipExtent=function(t){return arguments.length?(x=null==t?(F=i=r=a=null,Ka):$a(F=+t[0][0],i=+t[0][1],r=+t[1][0],a=+t[1][1]),M()):null==F?null:[[F,i],[r,a]]},T.scale=function(t){return arguments.length?(c=+t,I()):c},T.translate=function(t){return arguments.length?(d=+t[0],f=+t[1],I()):[d,f]},T.center=function(t){return arguments.length?(p=t[0]%360*oa,g=t[1]%360*oa,I()):[p*aa,g*aa]},T.rotate=function(t){return arguments.length?(v=t[0]%360*oa,m=t[1]%360*oa,y=t.length>2?t[2]%360*oa:0,I()):[v*aa,m*aa,y*aa]},T.angle=function(t){return arguments.length?(_=t%360*oa,I()):_*aa},T.reflectX=function(t){return arguments.length?(D=t?-1:1,I()):D<0},T.reflectY=function(t){return arguments.length?(w=t?-1:1,I()):w<0},T.precision=function(t){return arguments.length?(o=mo(s,C=t*t),M()):fa(C)},T.fitExtent=function(t,e){return go(T,t,e)},T.fitSize=function(t,e){return function(t,e,n){return go(t,[[0,0],e],n)}(T,t,e)},T.fitWidth=function(t,e){return function(t,e,n){return po(t,(function(n){var i=+e,r=i/(n[1][0]-n[0][0]),a=(i-r*(n[1][0]+n[0][0]))/2,o=-r*n[0][1];t.scale(150*r).translate([a,o])}),n)}(T,t,e)},T.fitHeight=function(t,e){return function(t,e,n){return po(t,(function(n){var i=+e,r=i/(n[1][1]-n[0][1]),a=-r*n[0][0],o=(i-r*(n[1][1]+n[0][1]))/2;t.scale(150*r).translate([a,o])}),n)}(T,t,e)},function(){return e=t.apply(this,arguments),T.invert=e.invert&&R,I()}}function bo(t,e){var n=ca(t),i=(n+ca(e))/2;if(sa(i)<1e-6)return function(t){var e=ha(t);function n(t,n){return[t*e,ca(n)/e]}return n.invert=function(t,n){return[t/e,pa(n*e)]},n}(t);var r=1+n*(2*i-n),a=fa(r)/i;function o(t,e){var n=fa(r-2*i*ca(e))/i;return[n*ca(t*=i),a-n*ha(t)]}return o.invert=function(t,e){var n=a-e,o=la(t,sa(n))*da(n);return n*i<0&&(o-=ea*da(t)*da(n)),[o/i,pa((r-(t*t+n*n)*i*i)/(2*i))]},o}var So,Fo,xo,Co,To=function(){return(t=bo,e=0,n=ea/3,i=wo(t),r=i(e,n),r.parallels=function(t){return arguments.length?i(e=t[0]*oa,n=t[1]*oa):[e*aa,n*aa]},r).scale(155.424).center([0,33.6442]);var t,e,n,i,r},Ro=wa(),Io=wa(),Mo={point:ga,lineStart:ga,lineEnd:ga,polygonStart:function(){Mo.lineStart=ko,Mo.lineEnd=Bo},polygonEnd:function(){Mo.lineStart=Mo.lineEnd=Mo.point=ga,Ro.add(sa(Io)),Io.reset()},result:function(){var t=Ro/2;return Ro.reset(),t}};function ko(){Mo.point=Eo}function Eo(t,e){Mo.point=Ao,So=xo=t,Fo=Co=e}function Ao(t,e){Io.add(Co*t-xo*e),xo=t,Co=e}function Bo(){Ao(So,Fo)}var No,Po,Oo,Ho,zo=Mo,jo=0,Lo=0,Vo=0,Wo=0,Uo=0,Yo=0,Go=0,Qo=0,qo=0,Xo={point:Jo,lineStart:Zo,lineEnd:ts,polygonStart:function(){Xo.lineStart=es,Xo.lineEnd=ns},polygonEnd:function(){Xo.point=Jo,Xo.lineStart=Zo,Xo.lineEnd=ts},result:function(){var t=qo?[Go/qo,Qo/qo]:Yo?[Wo/Yo,Uo/Yo]:Vo?[jo/Vo,Lo/Vo]:[NaN,NaN];return jo=Lo=Vo=Wo=Uo=Yo=Go=Qo=qo=0,t}};function Jo(t,e){jo+=t,Lo+=e,++Vo}function Zo(){Xo.point=$o}function $o(t,e){Xo.point=Ko,Jo(Oo=t,Ho=e)}function Ko(t,e){var n=t-Oo,i=e-Ho,r=fa(n*n+i*i);Wo+=r*(Oo+t)/2,Uo+=r*(Ho+e)/2,Yo+=r,Jo(Oo=t,Ho=e)}function ts(){Xo.point=Jo}function es(){Xo.point=is}function ns(){rs(No,Po)}function is(t,e){Xo.point=rs,Jo(No=Oo=t,Po=Ho=e)}function rs(t,e){var n=t-Oo,i=e-Ho,r=fa(n*n+i*i);Wo+=r*(Oo+t)/2,Uo+=r*(Ho+e)/2,Yo+=r,Go+=(r=Ho*t-Oo*e)*(Oo+t),Qo+=r*(Ho+e),qo+=3*r,Jo(Oo=t,Ho=e)}var as=Xo;function os(t){this._context=t}os.prototype={_radius:4.5,pointRadius:function(t){return this._radius=t,this},polygonStart:function(){this._line=0},polygonEnd:function(){this._line=NaN},lineStart:function(){this._point=0},lineEnd:function(){0===this._line&&this._context.closePath(),this._point=NaN},point:function(t,e){switch(this._point){case 0:this._context.moveTo(t,e),this._point=1;break;case 1:this._context.lineTo(t,e);break;default:this._context.moveTo(t+this._radius,e),this._context.arc(t,e,this._radius,0,ra)}},result:ga};var ss,us,ls,hs,cs,ds=wa(),fs={point:ga,lineStart:function(){fs.point=ps},lineEnd:function(){ss&&gs(us,ls),fs.point=ga},polygonStart:function(){ss=!0},polygonEnd:function(){ss=null},result:function(){var t=+ds;return ds.reset(),t}};function ps(t,e){fs.point=gs,us=hs=t,ls=cs=e}function gs(t,e){hs-=t,cs-=e,ds.add(fa(hs*hs+cs*cs)),hs=t,cs=e}var vs=fs;function ms(){this._string=[]}function ys(t){return"m0,"+t+"a"+t+","+t+" 0 1,1 0,"+-2*t+"a"+t+","+t+" 0 1,1 0,"+2*t+"z"}ms.prototype={_radius:4.5,_circle:ys(4.5),pointRadius:function(t){return(t=+t)!==this._radius&&(this._radius=t,this._circle=null),this},polygonStart:function(){this._line=0},polygonEnd:function(){this._line=NaN},lineStart:function(){this._point=0},lineEnd:function(){0===this._line&&this._string.push("Z"),this._point=NaN},point:function(t,e){switch(this._point){case 0:this._string.push("M",t,",",e),this._point=1;break;case 1:this._string.push("L",t,",",e);break;default:null==this._circle&&(this._circle=ys(this._radius)),this._string.push("M",t,",",e,this._circle)}},result:function(){if(this._string.length){var t=this._string.join("");return this._string=[],t}return null}};var _s={value:function(){}};function Ds(){for(var t,e=0,n=arguments.length,i={};e<n;++e){if(!(t=arguments[e]+"")||t in i||/[\s.]/.test(t))throw new Error("illegal type: "+t);i[t]=[]}return new ws(i)}function ws(t){this._=t}function bs(t,e){return t.trim().split(/^|\s+/).map((function(t){var n="",i=t.indexOf(".");if(i>=0&&(n=t.slice(i+1),t=t.slice(0,i)),t&&!e.hasOwnProperty(t))throw new Error("unknown type: "+t);return{type:t,name:n}}))}function Ss(t,e){for(var n,i=0,r=t.length;i<r;++i)if((n=t[i]).name===e)return n.value}function Fs(t,e,n){for(var i=0,r=t.length;i<r;++i)if(t[i].name===e){t[i]=_s,t=t.slice(0,i).concat(t.slice(i+1));break}return null!=n&&t.push({name:e,value:n}),t}ws.prototype=Ds.prototype={constructor:ws,on:function(t,e){var n,i=this._,r=bs(t+"",i),a=-1,o=r.length;if(!(arguments.length<2)){if(null!=e&&"function"!=typeof e)throw new Error("invalid callback: "+e);for(;++a<o;)if(n=(t=r[a]).type)i[n]=Fs(i[n],t.name,e);else if(null==e)for(n in i)i[n]=Fs(i[n],t.name,null);return this}for(;++a<o;)if((n=(t=r[a]).type)&&(n=Ss(i[n],t.name)))return n},copy:function(){var t={},e=this._;for(var n in e)t[n]=e[n].slice();return new ws(t)},call:function(t,e){if((n=arguments.length-2)>0)for(var n,i,r=new Array(n),a=0;a<n;++a)r[a]=arguments[a+2];if(!this._.hasOwnProperty(t))throw new Error("unknown type: "+t);for(a=0,n=(i=this._[t]).length;a<n;++a)i[a].value.apply(e,r)},apply:function(t,e,n){if(!this._.hasOwnProperty(t))throw new Error("unknown type: "+t);for(var i=this._[t],r=0,a=i.length;r<a;++r)i[r].value.apply(e,n)}};var xs=Ds;var Cs=function(){rr.c.preventDefault(),rr.c.stopImmediatePropagation()},Ts=function(t){var e=t.document.documentElement,n=Object(D.a)(t).on("dragstart.drag",Cs,!0);"onselectstart"in e?n.on("selectstart.drag",Cs,!0):(e.__noselect=e.style.MozUserSelect,e.style.MozUserSelect="none")};function Rs(t,e){var n=t.document.documentElement,i=Object(D.a)(t).on("dragstart.drag",null);e&&(i.on("click.drag",Cs,!0),setTimeout((function(){i.on("click.drag",null)}),0)),"onselectstart"in n?i.on("selectstart.drag",null):(n.style.MozUserSelect=n.__noselect,delete n.__noselect)}var Is=Math.SQRT2;function Ms(t){return((t=Math.exp(t))+1/t)/2}var ks=function(t,e){var n,i,r=t[0],a=t[1],o=t[2],s=e[0],u=e[1],l=e[2],h=s-r,c=u-a,d=h*h+c*c;if(d<1e-12)i=Math.log(l/o)/Is,n=function(t){return[r+t*h,a+t*c,o*Math.exp(Is*t*i)]};else{var f=Math.sqrt(d),p=(l*l-o*o+4*d)/(2*o*2*f),g=(l*l-o*o-4*d)/(2*l*2*f),v=Math.log(Math.sqrt(p*p+1)-p),m=Math.log(Math.sqrt(g*g+1)-g);i=(m-v)/Is,n=function(t){var e,n=t*i,s=Ms(v),u=o/(2*f)*(s*(e=Is*n+v,((e=Math.exp(2*e))-1)/(e+1))-function(t){return((t=Math.exp(t))-1/t)/2}(v));return[r+u*h,a+u*c,o*s/Ms(Is*n+v)]}}return n.duration=1e3*i,n},Es=function(t,e,n){arguments.length<3&&(n=e,e=ar().changedTouches);for(var i,r=0,a=e?e.length:0;r<a;++r)if((i=e[r]).identifier===n)return or(t,i);return null},As=n(3),Bs=function(t,e,n){var i=new qr;return e=null==e?0:+e,i.restart((function(n){i.stop(),t(n+e)}),e,n),i},Ns=xs("start","end","cancel","interrupt"),Ps=[],Os=function(t,e,n,i,r,a){var o=t.__transition;if(o){if(n in o)return}else t.__transition={};!function(t,e,n){var i,r=t.__transition;function a(u){var l,h,c,d;if(1!==n.state)return s();for(l in r)if((d=r[l]).name===n.name){if(3===d.state)return Bs(a);4===d.state?(d.state=6,d.timer.stop(),d.on.call("interrupt",t,t.__data__,d.index,d.group),delete r[l]):+l<e&&(d.state=6,d.timer.stop(),d.on.call("cancel",t,t.__data__,d.index,d.group),delete r[l])}if(Bs((function(){3===n.state&&(n.state=4,n.timer.restart(o,n.delay,n.time),o(u))})),n.state=2,n.on.call("start",t,t.__data__,n.index,n.group),2===n.state){for(n.state=3,i=new Array(c=n.tween.length),l=0,h=-1;l<c;++l)(d=n.tween[l].value.call(t,t.__data__,n.index,n.group))&&(i[++h]=d);i.length=h+1}}function o(e){for(var r=e<n.duration?n.ease.call(null,e/n.duration):(n.timer.restart(s),n.state=5,1),a=-1,o=i.length;++a<o;)i[a].call(t,r);5===n.state&&(n.on.call("end",t,t.__data__,n.index,n.group),s())}function s(){for(var i in n.state=6,n.timer.stop(),delete r[e],r)return;delete t.__transition}r[e]=n,n.timer=Xr((function(t){n.state=1,n.timer.restart(a,n.delay,n.time),n.delay<=t&&a(t-n.delay)}),0,n.time)}(t,n,{name:e,index:i,group:r,on:Ns,tween:Ps,time:a.time,delay:a.delay,duration:a.duration,ease:a.ease,timer:null,state:0})};function Hs(t,e){var n=js(t,e);if(n.state>0)throw new Error("too late; already scheduled");return n}function zs(t,e){var n=js(t,e);if(n.state>3)throw new Error("too late; already running");return n}function js(t,e){var n=t.__transition;if(!n||!(n=n[e]))throw new Error("transition not found");return n}var Ls,Vs,Ws,Us,Ys=function(t,e){var n,i,r,a=t.__transition,o=!0;if(a){for(r in e=null==e?null:e+"",a)(n=a[r]).name===e?(i=n.state>2&&n.state<5,n.state=6,n.timer.stop(),n.on.call(i?"interrupt":"cancel",t,t.__data__,n.index,n.group),delete a[r]):o=!1;o&&delete t.__transition}},Gs=180/Math.PI,Qs={translateX:0,translateY:0,rotate:0,skewX:0,scaleX:1,scaleY:1},qs=function(t,e,n,i,r,a){var o,s,u;return(o=Math.sqrt(t*t+e*e))&&(t/=o,e/=o),(u=t*n+e*i)&&(n-=t*u,i-=e*u),(s=Math.sqrt(n*n+i*i))&&(n/=s,i/=s,u/=s),t*i<e*n&&(t=-t,e=-e,u=-u,o=-o),{translateX:r,translateY:a,rotate:Math.atan2(e,t)*Gs,skewX:Math.atan(u)*Gs,scaleX:o,scaleY:s}};function Xs(t,e,n,i){function r(t){return t.length?t.pop()+" ":""}return function(a,o){var s=[],u=[];return a=t(a),o=t(o),function(t,i,r,a,o,s){if(t!==r||i!==a){var u=o.push("translate(",null,e,null,n);s.push({i:u-4,x:Se(t,r)},{i:u-2,x:Se(i,a)})}else(r||a)&&o.push("translate("+r+e+a+n)}(a.translateX,a.translateY,o.translateX,o.translateY,s,u),function(t,e,n,a){t!==e?(t-e>180?e+=360:e-t>180&&(t+=360),a.push({i:n.push(r(n)+"rotate(",null,i)-2,x:Se(t,e)})):e&&n.push(r(n)+"rotate("+e+i)}(a.rotate,o.rotate,s,u),function(t,e,n,a){t!==e?a.push({i:n.push(r(n)+"skewX(",null,i)-2,x:Se(t,e)}):e&&n.push(r(n)+"skewX("+e+i)}(a.skewX,o.skewX,s,u),function(t,e,n,i,a,o){if(t!==n||e!==i){var s=a.push(r(a)+"scale(",null,",",null,")");o.push({i:s-4,x:Se(t,n)},{i:s-2,x:Se(e,i)})}else 1===n&&1===i||a.push(r(a)+"scale("+n+","+i+")")}(a.scaleX,a.scaleY,o.scaleX,o.scaleY,s,u),a=o=null,function(t){for(var e,n=-1,i=u.length;++n<i;)s[(e=u[n]).i]=e.x(t);return s.join("")}}}var Js=Xs((function(t){return"none"===t?Qs:(Ls||(Ls=document.createElement("DIV"),Vs=document.documentElement,Ws=document.defaultView),Ls.style.transform=t,t=Ws.getComputedStyle(Vs.appendChild(Ls),null).getPropertyValue("transform"),Vs.removeChild(Ls),t=t.slice(7,-1).split(","),qs(+t[0],+t[1],+t[2],+t[3],+t[4],+t[5]))}),"px, ","px)","deg)"),Zs=Xs((function(t){return null==t?Qs:(Us||(Us=document.createElementNS("http://www.w3.org/2000/svg","g")),Us.setAttribute("transform",t),(t=Us.transform.baseVal.consolidate())?(t=t.matrix,qs(t.a,t.b,t.c,t.d,t.e,t.f)):Qs)}),", ",")",")"),$s=n(8);function Ks(t,e){var n,i;return function(){var r=zs(this,t),a=r.tween;if(a!==n)for(var o=0,s=(i=n=a).length;o<s;++o)if(i[o].name===e){(i=i.slice()).splice(o,1);break}r.tween=i}}function tu(t,e,n){var i,r;if("function"!=typeof n)throw new Error;return function(){var a=zs(this,t),o=a.tween;if(o!==i){r=(i=o).slice();for(var s={name:e,value:n},u=0,l=r.length;u<l;++u)if(r[u].name===e){r[u]=s;break}u===l&&r.push(s)}a.tween=r}}function eu(t,e,n){var i=t._id;return t.each((function(){var t=zs(this,i);(t.value||(t.value={}))[e]=n.apply(this,arguments)})),function(t){return js(t,i).value[e]}}var nu=function(t,e){var n;return("number"==typeof e?Se:e instanceof Kt?me:(n=Kt(e))?(e=n,me):Te)(t,e)};function iu(t){return function(){this.removeAttribute(t)}}function ru(t){return function(){this.removeAttributeNS(t.space,t.local)}}function au(t,e,n){var i,r,a=n+"";return function(){var o=this.getAttribute(t);return o===a?null:o===i?r:r=e(i=o,n)}}function ou(t,e,n){var i,r,a=n+"";return function(){var o=this.getAttributeNS(t.space,t.local);return o===a?null:o===i?r:r=e(i=o,n)}}function su(t,e,n){var i,r,a;return function(){var o,s,u=n(this);if(null!=u)return(o=this.getAttribute(t))===(s=u+"")?null:o===i&&s===r?a:(r=s,a=e(i=o,u));this.removeAttribute(t)}}function uu(t,e,n){var i,r,a;return function(){var o,s,u=n(this);if(null!=u)return(o=this.getAttributeNS(t.space,t.local))===(s=u+"")?null:o===i&&s===r?a:(r=s,a=e(i=o,u));this.removeAttributeNS(t.space,t.local)}}function lu(t,e){return function(n){this.setAttribute(t,e.call(this,n))}}function hu(t,e){return function(n){this.setAttributeNS(t.space,t.local,e.call(this,n))}}function cu(t,e){var n,i;function r(){var r=e.apply(this,arguments);return r!==i&&(n=(i=r)&&hu(t,r)),n}return r._value=e,r}function du(t,e){var n,i;function r(){var r=e.apply(this,arguments);return r!==i&&(n=(i=r)&&lu(t,r)),n}return r._value=e,r}function fu(t,e){return function(){Hs(this,t).delay=+e.apply(this,arguments)}}function pu(t,e){return e=+e,function(){Hs(this,t).delay=e}}function gu(t,e){return function(){zs(this,t).duration=+e.apply(this,arguments)}}function vu(t,e){return e=+e,function(){zs(this,t).duration=e}}function mu(t,e){if("function"!=typeof e)throw new Error;return function(){zs(this,t).ease=e}}var yu=n(15);function _u(t,e,n){var i,r,a=function(t){return(t+"").trim().split(/^|\s+/).every((function(t){var e=t.indexOf(".");return e>=0&&(t=t.slice(0,e)),!t||"start"===t}))}(e)?Hs:zs;return function(){var o=a(this,t),s=o.on;s!==i&&(r=(i=s).copy()).on(e,n),o.on=r}}var Du=n(7),wu=n(14),bu=As.b.prototype.constructor,Su=n(16);function Fu(t){return function(){this.style.removeProperty(t)}}function xu(t,e,n){return function(i){this.style.setProperty(t,e.call(this,i),n)}}function Cu(t,e,n){var i,r;function a(){var a=e.apply(this,arguments);return a!==r&&(i=(r=a)&&xu(t,a,n)),i}return a._value=e,a}function Tu(t){return function(e){this.textContent=t.call(this,e)}}function Ru(t){var e,n;function i(){var i=t.apply(this,arguments);return i!==n&&(e=(n=i)&&Tu(i)),e}return i._value=t,i}var Iu=0;function Mu(t,e,n,i){this._groups=t,this._parents=e,this._name=n,this._id=i}function ku(){return++Iu}var Eu=As.b.prototype;Mu.prototype=function(t){return Object(As.b)().transition(t)}.prototype={constructor:Mu,select:function(t){var e=this._name,n=this._id;"function"!=typeof t&&(t=Object(Du.a)(t));for(var i=this._groups,r=i.length,a=new Array(r),o=0;o<r;++o)for(var s,u,l=i[o],h=l.length,c=a[o]=new Array(h),d=0;d<h;++d)(s=l[d])&&(u=t.call(s,s.__data__,d,l))&&("__data__"in s&&(u.__data__=s.__data__),c[d]=u,Os(c[d],e,n,d,c,js(s,n)));return new Mu(a,this._parents,e,n)},selectAll:function(t){var e=this._name,n=this._id;"function"!=typeof t&&(t=Object(wu.a)(t));for(var i=this._groups,r=i.length,a=[],o=[],s=0;s<r;++s)for(var u,l=i[s],h=l.length,c=0;c<h;++c)if(u=l[c]){for(var d,f=t.call(u,u.__data__,c,l),p=js(u,n),g=0,v=f.length;g<v;++g)(d=f[g])&&Os(d,e,n,g,f,p);a.push(f),o.push(u)}return new Mu(a,o,e,n)},filter:function(t){"function"!=typeof t&&(t=Object(yu.a)(t));for(var e=this._groups,n=e.length,i=new Array(n),r=0;r<n;++r)for(var a,o=e[r],s=o.length,u=i[r]=[],l=0;l<s;++l)(a=o[l])&&t.call(a,a.__data__,l,o)&&u.push(a);return new Mu(i,this._parents,this._name,this._id)},merge:function(t){if(t._id!==this._id)throw new Error;for(var e=this._groups,n=t._groups,i=e.length,r=n.length,a=Math.min(i,r),o=new Array(i),s=0;s<a;++s)for(var u,l=e[s],h=n[s],c=l.length,d=o[s]=new Array(c),f=0;f<c;++f)(u=l[f]||h[f])&&(d[f]=u);for(;s<i;++s)o[s]=e[s];return new Mu(o,this._parents,this._name,this._id)},selection:function(){return new bu(this._groups,this._parents)},transition:function(){for(var t=this._name,e=this._id,n=ku(),i=this._groups,r=i.length,a=0;a<r;++a)for(var o,s=i[a],u=s.length,l=0;l<u;++l)if(o=s[l]){var h=js(o,e);Os(o,t,n,l,s,{time:h.time+h.delay+h.duration,delay:0,duration:h.duration,ease:h.ease})}return new Mu(i,this._parents,t,n)},call:Eu.call,nodes:Eu.nodes,node:Eu.node,size:Eu.size,empty:Eu.empty,each:Eu.each,on:function(t,e){var n=this._id;return arguments.length<2?js(this.node(),n).on.on(t):this.each(_u(n,t,e))},attr:function(t,e){var n=Object($s.a)(t),i="transform"===n?Zs:nu;return this.attrTween(t,"function"==typeof e?(n.local?uu:su)(n,i,eu(this,"attr."+t,e)):null==e?(n.local?ru:iu)(n):(n.local?ou:au)(n,i,e))},attrTween:function(t,e){var n="attr."+t;if(arguments.length<2)return(n=this.tween(n))&&n._value;if(null==e)return this.tween(n,null);if("function"!=typeof e)throw new Error;var i=Object($s.a)(t);return this.tween(n,(i.local?cu:du)(i,e))},style:function(t,e,n){var i="transform"==(t+="")?Js:nu;return null==e?this.styleTween(t,function(t,e){var n,i,r;return function(){var a=Object(Su.b)(this,t),o=(this.style.removeProperty(t),Object(Su.b)(this,t));return a===o?null:a===n&&o===i?r:r=e(n=a,i=o)}}(t,i)).on("end.style."+t,Fu(t)):"function"==typeof e?this.styleTween(t,function(t,e,n){var i,r,a;return function(){var o=Object(Su.b)(this,t),s=n(this),u=s+"";return null==s&&(this.style.removeProperty(t),u=s=Object(Su.b)(this,t)),o===u?null:o===i&&u===r?a:(r=u,a=e(i=o,s))}}(t,i,eu(this,"style."+t,e))).each(function(t,e){var n,i,r,a,o="style."+e,s="end."+o;return function(){var u=zs(this,t),l=u.on,h=null==u.value[o]?a||(a=Fu(e)):void 0;l===n&&r===h||(i=(n=l).copy()).on(s,r=h),u.on=i}}(this._id,t)):this.styleTween(t,function(t,e,n){var i,r,a=n+"";return function(){var o=Object(Su.b)(this,t);return o===a?null:o===i?r:r=e(i=o,n)}}(t,i,e),n).on("end.style."+t,null)},styleTween:function(t,e,n){var i="style."+(t+="");if(arguments.length<2)return(i=this.tween(i))&&i._value;if(null==e)return this.tween(i,null);if("function"!=typeof e)throw new Error;return this.tween(i,Cu(t,e,null==n?"":n))},text:function(t){return this.tween("text","function"==typeof t?function(t){return function(){var e=t(this);this.textContent=null==e?"":e}}(eu(this,"text",t)):function(t){return function(){this.textContent=t}}(null==t?"":t+""))},textTween:function(t){var e="text";if(arguments.length<1)return(e=this.tween(e))&&e._value;if(null==t)return this.tween(e,null);if("function"!=typeof t)throw new Error;return this.tween(e,Ru(t))},remove:function(){return this.on("end.remove",(t=this._id,function(){var e=this.parentNode;for(var n in this.__transition)if(+n!==t)return;e&&e.removeChild(this)}));var t},tween:function(t,e){var n=this._id;if(t+="",arguments.length<2){for(var i,r=js(this.node(),n).tween,a=0,o=r.length;a<o;++a)if((i=r[a]).name===t)return i.value;return null}return this.each((null==e?Ks:tu)(n,t,e))},delay:function(t){var e=this._id;return arguments.length?this.each(("function"==typeof t?fu:pu)(e,t)):js(this.node(),e).delay},duration:function(t){var e=this._id;return arguments.length?this.each(("function"==typeof t?gu:vu)(e,t)):js(this.node(),e).duration},ease:function(t){var e=this._id;return arguments.length?this.each(mu(e,t)):js(this.node(),e).ease},end:function(){var t,e,n=this,i=n._id,r=n.size();return new Promise((function(a,o){var s={value:o},u={value:function(){0==--r&&a()}};n.each((function(){var n=zs(this,i),r=n.on;r!==t&&((e=(t=r).copy())._.cancel.push(s),e._.interrupt.push(s),e._.end.push(u)),n.on=e}))}))}};var Au={time:null,delay:0,duration:250,ease:function(t){return((t*=2)<=1?t*t*t:(t-=2)*t*t+2)/2}};function Bu(t,e){for(var n;!(n=t.__transition)||!(n=n[e]);)if(!(t=t.parentNode))return Au.time=Gr(),Au;return n}As.b.prototype.interrupt=function(t){return this.each((function(){Ys(this,t)}))},As.b.prototype.transition=function(t){var e,n;t instanceof Mu?(e=t._id,t=t._name):(e=ku(),(n=Au).time=Gr(),t=null==t?null:t+"");for(var i=this._groups,r=i.length,a=0;a<r;++a)for(var o,s=i[a],u=s.length,l=0;l<u;++l)(o=s[l])&&Os(o,t,e,l,s,n||Bu(o,e));return new Mu(i,this._parents,t,e)};var Nu=function(t){return function(){return t}};function Pu(t,e,n){this.target=t,this.type=e,this.transform=n}function Ou(t,e,n){this.k=t,this.x=e,this.y=n}Ou.prototype={constructor:Ou,scale:function(t){return 1===t?this:new Ou(this.k*t,this.x,this.y)},translate:function(t,e){return 0===t&0===e?this:new Ou(this.k,this.x+this.k*t,this.y+this.k*e)},apply:function(t){return[t[0]*this.k+this.x,t[1]*this.k+this.y]},applyX:function(t){return t*this.k+this.x},applyY:function(t){return t*this.k+this.y},invert:function(t){return[(t[0]-this.x)/this.k,(t[1]-this.y)/this.k]},invertX:function(t){return(t-this.x)/this.k},invertY:function(t){return(t-this.y)/this.k},rescaleX:function(t){return t.copy().domain(t.range().map(this.invertX,this).map(t.invert,t))},rescaleY:function(t){return t.copy().domain(t.range().map(this.invertY,this).map(t.invert,t))},toString:function(){return"translate("+this.x+","+this.y+") scale("+this.k+")"}};var Hu=new Ou(1,0,0);function zu(){rr.c.stopImmediatePropagation()}Ou.prototype;var ju=function(){rr.c.preventDefault(),rr.c.stopImmediatePropagation()};function Lu(){return!rr.c.ctrlKey&&!rr.c.button}function Vu(){var t=this;return t instanceof SVGElement?(t=t.ownerSVGElement||t).hasAttribute("viewBox")?[[(t=t.viewBox.baseVal).x,t.y],[t.x+t.width,t.y+t.height]]:[[0,0],[t.width.baseVal.value,t.height.baseVal.value]]:[[0,0],[t.clientWidth,t.clientHeight]]}function Wu(){return this.__zoom||Hu}function Uu(){return-rr.c.deltaY*(1===rr.c.deltaMode?.05:rr.c.deltaMode?1:.002)}function Yu(){return navigator.maxTouchPoints||"ontouchstart"in this}function Gu(t,e,n){var i=t.invertX(e[0][0])-n[0][0],r=t.invertX(e[1][0])-n[1][0],a=t.invertY(e[0][1])-n[0][1],o=t.invertY(e[1][1])-n[1][1];return t.translate(r>i?(i+r)/2:Math.min(0,i)||Math.max(0,r),o>a?(a+o)/2:Math.min(0,a)||Math.max(0,o))}var Qu=function(t){return t},qu=function(t){if(null==t)return Qu;var e,n,i=t.scale[0],r=t.scale[1],a=t.translate[0],o=t.translate[1];return function(t,s){s||(e=n=0);var u=2,l=t.length,h=new Array(l);for(h[0]=(e+=t[0])*i+a,h[1]=(n+=t[1])*r+o;u<l;)h[u]=t[u],++u;return h}},Xu=function(t,e){return"string"==typeof e&&(e=t.objects[e]),"GeometryCollection"===e.type?{type:"FeatureCollection",features:e.geometries.map((function(e){return Ju(t,e)}))}:Ju(t,e)};function Ju(t,e){var n=e.id,i=e.bbox,r=null==e.properties?{}:e.properties,a=Zu(t,e);return null==n&&null==i?{type:"Feature",properties:r,geometry:a}:null==i?{type:"Feature",id:n,properties:r,geometry:a}:{type:"Feature",id:n,bbox:i,properties:r,geometry:a}}function Zu(t,e){var n=qu(t.transform),i=t.arcs;function r(t,e){e.length&&e.pop();for(var r=i[t<0?~t:t],a=0,o=r.length;a<o;++a)e.push(n(r[a],a));t<0&&function(t,e){for(var n,i=t.length,r=i-e;r<--i;)n=t[r],t[r++]=t[i],t[i]=n}(e,o)}function a(t){return n(t)}function o(t){for(var e=[],n=0,i=t.length;n<i;++n)r(t[n],e);return e.length<2&&e.push(e[0]),e}function s(t){for(var e=o(t);e.length<4;)e.push(e[0]);return e}function u(t){return t.map(s)}return function t(e){var n,i=e.type;switch(i){case"GeometryCollection":return{type:i,geometries:e.geometries.map(t)};case"Point":n=a(e.coordinates);break;case"MultiPoint":n=e.coordinates.map(a);break;case"LineString":n=o(e.arcs);break;case"MultiLineString":n=e.arcs.map(o);break;case"Polygon":n=u(e.arcs);break;case"MultiPolygon":n=e.arcs.map(u);break;default:return null}return{type:i,coordinates:n}}(e)}const $u=0,Ku=1,tl=2,el=3;class nl{constructor(t,e,n,i,r){this.desiredWidth=t,this.desiredHeight=e,this.zoomBoxPaddingFactor=.7,this.maxScale=50;let a=i.objects;this.nationFeature=Xu(i,a.nation).features,this.setStateFeatures(Xu(i,a.states).features),void 0!==a.counties?this.setCountyFeatures(Xu(i,a.counties).features):this.setCountyFeatures(null),this._evaluator=r,this.onSliderValueChanged=null,this.onRegionClicked=null,this.onRegionMouseOver=null,this.onRegionMouseOut=null,this.onOceanClicked=null,this.didScrollAwayFromHighlightedState=null,this.currentHighlightState=$u,this._highlightedRegionID=null,this._hoveredRegionID=null,this._zoomedBounds=null,this.apparentWidth=null,this.apparentHeight=null;let o=this;this._updateZoomFunction(.5),this.mapContainer=n,this.svg=this.mapContainer.append("svg").attr("class","map-viz"),this._updateViewboxForNewDimensions(t,e),this.svg.append("rect").attr("width","100%").attr("height","100%").attr("fill","white").on("click",(function(){o._didClickOcean(o)})),this._baseLayer=this.svg.append("g"),this._nationLayer=this._baseLayer.append("g"),this._countyLayer=this._baseLayer.append("g").attr("class","county-layer"),this._stateLayer=this._baseLayer.append("g").attr("class","state-layer");let s=To().parallels([29.5,45.5]).scale(1070).translate([480,250]).rotate([96,0]).center([-.6,38.7]).scale(925).translate([.5*t,.5*e]);this._geoPath=function(t,e){var n,i,r=4.5;function a(t){return t&&("function"==typeof r&&i.pointRadius(+r.apply(this,arguments)),so(t,n(i))),i.result()}return a.area=function(t){return so(t,n(zo)),zo.result()},a.measure=function(t){return so(t,n(vs)),vs.result()},a.bounds=function(t){return so(t,n(fo)),fo.result()},a.centroid=function(t){return so(t,n(as)),as.result()},a.projection=function(e){return arguments.length?(n=null==e?(t=null,Ka):(t=e).stream,a):t},a.context=function(t){return arguments.length?(i=null==t?(e=null,new ms):new os(e=t),"function"!=typeof r&&i.pointRadius(r),a):e},a.pointRadius=function(t){return arguments.length?(r="function"==typeof t?t:(i.pointRadius(+t),+t),a):r},a.projection(t).context(e)}().projection(s),this._initializeFeatures(),this._createNation(this._nationLayer,this.nationFeature,this._geoPath),this._createStates(this._stateLayer,this.stateFeatures,this._geoPath),this._createCounties(this._countyLayer,this.countyFeatures,this._geoPath),this._parseDimensions(),this.resetZoom(!1),window.addEventListener("resize",(function(){o.didResize()}))}windowBounds(){return Kr.fromSVGRect(this.svg.node().getBoundingClientRect())}setEvaluator(t){t.measureDelta&&(t=Evaluator.smoothedCopy(t)),this._evaluator=t,this.updateMapForDay(this._currentDay,this._currentData,!0)}resetZoom(t=!0,e=1e3){let n=new Kr(0,0,this.desiredWidth,this.desiredHeight);this.zoomToBox(n,t,.95,e),this._zoomedBounds=null}zoomToBox(t,e=!0,n=null,i=1e3){const r=t.x,a=t.x+t.width,o=t.y,s=t.y+t.height;this._zoomedBounds=t;let u=[(r+a)/2,(o+s)/2],l=this._scaleForBoundingBox(t,n),h=this,c=this.svg;e&&(c=c.transition().duration(i)),c.call(this._zoom.transform,Hu.translate(this.activeWidth/2,this.activeHeight/2).scale(l).translate(-(r+a)/2,-(o+s)/2),u).on("end",(function(){h._finishedZoomTransition()}))}_updateZoomFunction(t=null){if(null===t){let e=new Kr(0,0,this.desiredWidth,this.desiredHeight);t=this._scaleForBoundingBox(e,.95)}let e=this;this._zoom=function(){var t,e,n=Lu,i=Vu,r=Gu,a=Uu,o=Yu,s=[0,1/0],u=[[-1/0,-1/0],[1/0,1/0]],l=250,h=ks,c=xs("start","zoom","end"),d=0;function f(t){t.property("__zoom",Wu).on("wheel.zoom",w).on("mousedown.zoom",b).on("dblclick.zoom",S).filter(o).on("touchstart.zoom",F).on("touchmove.zoom",x).on("touchend.zoom touchcancel.zoom",C).style("touch-action","none").style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}function p(t,e){return(e=Math.max(s[0],Math.min(s[1],e)))===t.k?t:new Ou(e,t.x,t.y)}function g(t,e,n){var i=e[0]-n[0]*t.k,r=e[1]-n[1]*t.k;return i===t.x&&r===t.y?t:new Ou(t.k,i,r)}function v(t){return[(+t[0][0]+ +t[1][0])/2,(+t[0][1]+ +t[1][1])/2]}function m(t,e,n){t.on("start.zoom",(function(){y(this,arguments).start()})).on("interrupt.zoom end.zoom",(function(){y(this,arguments).end()})).tween("zoom",(function(){var t=this,r=arguments,a=y(t,r),o=i.apply(t,r),s=null==n?v(o):"function"==typeof n?n.apply(t,r):n,u=Math.max(o[1][0]-o[0][0],o[1][1]-o[0][1]),l=t.__zoom,c="function"==typeof e?e.apply(t,r):e,d=h(l.invert(s).concat(u/l.k),c.invert(s).concat(u/c.k));return function(t){if(1===t)t=c;else{var e=d(t),n=u/e[2];t=new Ou(n,s[0]-e[0]*n,s[1]-e[1]*n)}a.zoom(null,t)}}))}function y(t,e,n){return!n&&t.__zooming||new _(t,e)}function _(t,e){this.that=t,this.args=e,this.active=0,this.extent=i.apply(t,e),this.taps=0}function w(){if(n.apply(this,arguments)){var t=y(this,arguments),e=this.__zoom,i=Math.max(s[0],Math.min(s[1],e.k*Math.pow(2,a.apply(this,arguments)))),o=hr(this);if(t.wheel)t.mouse[0][0]===o[0]&&t.mouse[0][1]===o[1]||(t.mouse[1]=e.invert(t.mouse[0]=o)),clearTimeout(t.wheel);else{if(e.k===i)return;t.mouse=[o,e.invert(o)],Ys(this),t.start()}ju(),t.wheel=setTimeout(l,150),t.zoom("mouse",r(g(p(e,i),t.mouse[0],t.mouse[1]),t.extent,u))}function l(){t.wheel=null,t.end()}}function b(){if(!e&&n.apply(this,arguments)){var t=y(this,arguments,!0),i=Object(D.a)(rr.c.view).on("mousemove.zoom",l,!0).on("mouseup.zoom",h,!0),a=hr(this),o=rr.c.clientX,s=rr.c.clientY;Ts(rr.c.view),zu(),t.mouse=[a,this.__zoom.invert(a)],Ys(this),t.start()}function l(){if(ju(),!t.moved){var e=rr.c.clientX-o,n=rr.c.clientY-s;t.moved=e*e+n*n>d}t.zoom("mouse",r(g(t.that.__zoom,t.mouse[0]=hr(t.that),t.mouse[1]),t.extent,u))}function h(){i.on("mousemove.zoom mouseup.zoom",null),Rs(rr.c.view,t.moved),ju(),t.end()}}function S(){if(n.apply(this,arguments)){var t=this.__zoom,e=hr(this),a=t.invert(e),o=t.k*(rr.c.shiftKey?.5:2),s=r(g(p(t,o),e,a),i.apply(this,arguments),u);ju(),l>0?Object(D.a)(this).transition().duration(l).call(m,s,e):Object(D.a)(this).call(f.transform,s)}}function F(){if(n.apply(this,arguments)){var e,i,r,a,o=rr.c.touches,s=o.length,u=y(this,arguments,rr.c.changedTouches.length===s);for(zu(),i=0;i<s;++i)r=o[i],a=[a=Es(this,o,r.identifier),this.__zoom.invert(a),r.identifier],u.touch0?u.touch1||u.touch0[2]===a[2]||(u.touch1=a,u.taps=0):(u.touch0=a,e=!0,u.taps=1+!!t);t&&(t=clearTimeout(t)),e&&(u.taps<2&&(t=setTimeout((function(){t=null}),500)),Ys(this),u.start())}}function x(){if(this.__zooming){var e,n,i,a,o=y(this,arguments),s=rr.c.changedTouches,l=s.length;for(ju(),t&&(t=clearTimeout(t)),o.taps=0,e=0;e<l;++e)n=s[e],i=Es(this,s,n.identifier),o.touch0&&o.touch0[2]===n.identifier?o.touch0[0]=i:o.touch1&&o.touch1[2]===n.identifier&&(o.touch1[0]=i);if(n=o.that.__zoom,o.touch1){var h=o.touch0[0],c=o.touch0[1],d=o.touch1[0],f=o.touch1[1],v=(v=d[0]-h[0])*v+(v=d[1]-h[1])*v,m=(m=f[0]-c[0])*m+(m=f[1]-c[1])*m;n=p(n,Math.sqrt(v/m)),i=[(h[0]+d[0])/2,(h[1]+d[1])/2],a=[(c[0]+f[0])/2,(c[1]+f[1])/2]}else{if(!o.touch0)return;i=o.touch0[0],a=o.touch0[1]}o.zoom("touch",r(g(n,i,a),o.extent,u))}}function C(){if(this.__zooming){var t,n,i=y(this,arguments),r=rr.c.changedTouches,a=r.length;for(zu(),e&&clearTimeout(e),e=setTimeout((function(){e=null}),500),t=0;t<a;++t)n=r[t],i.touch0&&i.touch0[2]===n.identifier?delete i.touch0:i.touch1&&i.touch1[2]===n.identifier&&delete i.touch1;if(i.touch1&&!i.touch0&&(i.touch0=i.touch1,delete i.touch1),i.touch0)i.touch0[1]=this.__zoom.invert(i.touch0[0]);else if(i.end(),2===i.taps){var o=Object(D.a)(this).on("dblclick.zoom");o&&o.apply(this,arguments)}}}return f.transform=function(t,e,n){var i=t.selection?t.selection():t;i.property("__zoom",Wu),t!==i?m(t,e,n):i.interrupt().each((function(){y(this,arguments).start().zoom(null,"function"==typeof e?e.apply(this,arguments):e).end()}))},f.scaleBy=function(t,e,n){f.scaleTo(t,(function(){var t=this.__zoom.k,n="function"==typeof e?e.apply(this,arguments):e;return t*n}),n)},f.scaleTo=function(t,e,n){f.transform(t,(function(){var t=i.apply(this,arguments),a=this.__zoom,o=null==n?v(t):"function"==typeof n?n.apply(this,arguments):n,s=a.invert(o),l="function"==typeof e?e.apply(this,arguments):e;return r(g(p(a,l),o,s),t,u)}),n)},f.translateBy=function(t,e,n){f.transform(t,(function(){return r(this.__zoom.translate("function"==typeof e?e.apply(this,arguments):e,"function"==typeof n?n.apply(this,arguments):n),i.apply(this,arguments),u)}))},f.translateTo=function(t,e,n,a){f.transform(t,(function(){var t=i.apply(this,arguments),o=this.__zoom,s=null==a?v(t):"function"==typeof a?a.apply(this,arguments):a;return r(Hu.translate(s[0],s[1]).scale(o.k).translate("function"==typeof e?-e.apply(this,arguments):-e,"function"==typeof n?-n.apply(this,arguments):-n),t,u)}),a)},_.prototype={start:function(){return 1==++this.active&&(this.that.__zooming=this,this.emit("start")),this},zoom:function(t,e){return this.mouse&&"mouse"!==t&&(this.mouse[1]=e.invert(this.mouse[0])),this.touch0&&"touch"!==t&&(this.touch0[1]=e.invert(this.touch0[0])),this.touch1&&"touch"!==t&&(this.touch1[1]=e.invert(this.touch1[0])),this.that.__zoom=e,this.emit("zoom"),this},end:function(){return 0==--this.active&&(delete this.that.__zooming,this.emit("end")),this},emit:function(t){Object(rr.a)(new Pu(f,t,this.that.__zoom),c.apply,c,[t,this.that,this.args])}},f.wheelDelta=function(t){return arguments.length?(a="function"==typeof t?t:Nu(+t),f):a},f.filter=function(t){return arguments.length?(n="function"==typeof t?t:Nu(!!t),f):n},f.touchable=function(t){return arguments.length?(o="function"==typeof t?t:Nu(!!t),f):o},f.extent=function(t){return arguments.length?(i="function"==typeof t?t:Nu([[+t[0][0],+t[0][1]],[+t[1][0],+t[1][1]]]),f):i},f.scaleExtent=function(t){return arguments.length?(s[0]=+t[0],s[1]=+t[1],f):[s[0],s[1]]},f.translateExtent=function(t){return arguments.length?(u[0][0]=+t[0][0],u[1][0]=+t[1][0],u[0][1]=+t[0][1],u[1][1]=+t[1][1],f):[[u[0][0],u[0][1]],[u[1][0],u[1][1]]]},f.constrain=function(t){return arguments.length?(r=t,f):r},f.duration=function(t){return arguments.length?(l=+t,f):l},f.interpolate=function(t){return arguments.length?(h=t,f):h},f.on=function(){var t=c.on.apply(c,arguments);return t===c?f:t},f.clickDistance=function(t){return arguments.length?(d=(t=+t)*t,f):Math.sqrt(d)},f}().scaleExtent([t,this.maxScale]).interpolate(Re).on("zoom",(function(){e._zoomed(e)})),void 0!==this.svg&&this.svg.call(this._zoom)}_scaleForBoundingBox(t,e=null){null===e&&(e=this.zoomBoxPaddingFactor);let n=Math.max(t.width/this.activeWidth,t.height/this.activeHeight);return Math.min(this.maxScale,e/n)}boundingBoxForRegion(t){const e=this._pathSelectionForRegionID(t).node();return Kr.fromSVGRect(e.getBBox())}boundingBoxForRegions(t){if(0===t.length)return null;let e=this,n=null;return t.forEach((function(t){let i=e.boundingBoxForRegion(t);null===n?n=i:n.unionRect(i)})),n}setCompactView(t){this.isCompact!==t&&(this.isCompact=t,this.svg.attr("compact",t?"":null))}_regionIDsContainState(t){return null!==t&&(0!==t.length&&this._containerLayerForRegionID(t[0])===this._stateLayer)}_regionIDsContainCounty(t){return null!==t&&(0!==t.length&&this._containerLayerForRegionID(t[0])===this._countyLayer)}_regionIDsRepresentNation(t){return null===t||(0===t.length||this._containerLayerForRegionID(t[0])===this._nationLayer)}highlightRegionWithID(t){this.highlightRegionsWithIDs(null===t?[]:[t])}highlightRegionsWithIDs(t){let e=this._regionIDsRepresentNation(t);if(e&&this.currentHighlightState<=Ku)return;let n=this._regionIDsContainState(t),i=this._regionIDsContainCounty(this._highlightedRegionID?[this._highlightedRegionID]:null),r=this._regionIDsContainCounty(t),a=t.length>1,o=a?null:t[0];if(this._setHighlightedRegionWithID(o,!(i&&r)),n||e){let n=this,i=new Set(t);n._stateLayer.style("pointer-events",e?"all":"none"),n.currentHighlightState=e?Ku:tl,this._stateLayer.selectAll("path.statePath").transition().duration(1e3).attr("fill",(function(t){return e||i.has(t.id)?"rgba(0, 0, 0, 0.0)":"rgba(235, 235, 235, 0.85)"})).attr("stroke",t=>this._strokeForRegionID(t.id)).attr("stroke-width",t=>this._strokeWidthForRegionID(t.id)).style("pointer-events",(function(t){return i.has(t.id)&&!a?"none":"all"})).on("end",(function(){n.currentHighlightState=e?$u:el}))}}_containerLayerForRegionID(t){return this._stateRegions.has(t)?this._stateLayer:this._countyRegions.has(t)?this._countyLayer:this._nationRegions.has(t)?this._nationLayer:null}_pathSelectionForRegionID(t){return this._containerLayerForRegionID(t).select("path[regionID="+nl.pathRegionID(t)+"]")}_updateStrokeForRegionID(t,e=!1,n=!1){if(t){let i=this._pathSelectionForRegionID(t);e&&i.moveToFront(),n&&(i=i.transition().duration(1e3));let r=this._strokeForRegionID(t),a="none"===r?"rgba(0,0,0,0)":r;i.attr("stroke",a).attr("stroke-width",this._strokeWidthForRegionID(t))}}_setHighlightedRegionWithID(t,e=!1){let n=this._highlightedRegionID;this._highlightedRegionID=t,this._hoveredRegionID===t&&(this._hoveredRegionID=null),this._updateStrokeForRegionID(n,!1,e),this._updateStrokeForRegionID(t,!0,e)}hoverRegionWithID(t,e=!1){if(this.currentHighlightState>$u&&this.currentHighlightState<el&&this._containerLayerForRegionID(t)===this._countyLayer)return;let n=this._hoveredRegionID;if(this._hoveredRegionID=t,this._updateStrokeForRegionID(n,!1,e),this._updateStrokeForRegionID(t,!0,e),t&&this._highlightedRegionID){this._containerLayerForRegionID(t)===this._containerLayerForRegionID(this._highlightedRegionID)&&this._pathSelectionForRegionID(this._highlightedRegionID).moveToFront()}this._registerInteraction()}_strokeWidthForRegionID(t){let e=this._containerLayerForRegionID(t)===this._stateLayer,n=this._containerLayerForRegionID(t)===this._countyLayer,i=t===this._hoveredRegionID,r=t===this._highlightedRegionID;return e?r||i?2:1:n?2:0}_strokeForRegionID(t){let e=this._containerLayerForRegionID(t)===this._stateLayer,n=this._containerLayerForRegionID(t)===this._countyLayer,i=t===this._hoveredRegionID,r=t===this._highlightedRegionID;return e?r?"rgb(255, 255, 255)":i?"rgba(255, 255, 255, 1.0)":"rgba(0, 0, 0, 0.15)":n?r?"rgb(255, 255, 255)":i?"rgba(255, 255, 255, 1.0)":"none":"none"}_impliedBoundsFromTransform(t){let e=-t.x/t.k,n=e+this.activeWidth/t.k,i=-t.y/t.k,r=i+this.activeHeight/t.k;return new Kr(e,i,n-e,r-i)}_parseDimensions(){let t=this.apparentWidth;if(this.apparentWidth=parseInt(this.mapContainer.style("width")),this.apparentWidth===t)return;let e=this.apparentWidth*(this.desiredHeight/this.desiredWidth);this.apparentHeight=Math.min(e,150);let n=this.desiredWidth/this.desiredHeight,i=this.apparentWidth/this.apparentHeight;if(i>n){let t=this.desiredWidth/i;this._updateViewboxForNewDimensions(this.desiredWidth,t)}else this.activeHeight!==this.desiredHeight&&this._updateViewboxForNewDimensions(this.desiredWidth,this.desiredHeight);this._updateZoomFunction()}_updateViewboxForNewDimensions(t,e){this.svg.attr("viewBox",[0,0,t,e]),this.activeWidth=t,this.activeHeight=e}didResize(){this._parseDimensions()}_mapDimensionFromApparentDimension(t,e){return t*(1/e.k)*(this.activeWidth/this.apparentWidth)}_zoomed(t){const{transform:e}=rr.c;if(t._baseLayer.attr("transform",e),null===t.apparentWidth&&t._parseDimensions(),t.currentHighlightState===el&&null!=t.didScrollAwayFromHighlightedState&&null!=t._zoomedBounds){let n=t._zoomedBounds,i=t._impliedBoundsFromTransform(e),r=(n.aspectRatio()>i.aspectRatio()?i.width/n.width:i.height/n.height)>2.5,a=.25*t.apparentWidth,o=.25*t.apparentHeight,s=t._mapDimensionFromApparentDimension(a,e),u=t._mapDimensionFromApparentDimension(o,e),l=i.top()+u>n.bottom(),h=i.bottom()-u<n.top(),c=i.left()+s>n.right(),d=i.right()-s<n.left();(l||h||c||d||r)&&(t._zoomedBounds=null,t.didScrollAwayFromHighlightedState(),t._resetZoomAfterDelay())}this._registerInteraction()}_registerInteraction(){this.currentHighlightState===$u&&(this.lastInteractionTime=performance.now())}_resetZoomIfNecessary(){if(this.currentHighlightState===$u){if(null!==this._hoveredRegionID)return void this._resetZoomAfterDelay(7e3);let t=7e3-(performance.now()-this.lastInteractionTime);t>100?this._resetZoomAfterDelay(t):this.resetZoom(!0,1500)}}_resetZoomAfterDelay(t=7e3){let e=this;setTimeout((function(){e._resetZoomIfNecessary()}),t)}_finishedZoomTransition(){}_initializeFeatures(){this._nationRegions=new Set,this._nationRegions.add("0000")}setStateFeatures(t){if(this.stateFeatures=t,this._stateRegions=new Set,null!==t){let e=this;t.forEach((function(t){e._stateRegions.add(t.id)}))}}setCountyFeatures(t){if(this.countyFeatures=t,this._countyRegions=new Set,null!==t){let e=this;t.forEach((function(t){e._countyRegions.add(t.id)}))}}updateForCountryGeometry(t){let e=t.objects;if(void 0!==e.counties){let n=null===this.countyFeatures;this.setCountyFeatures(Xu(t,e.counties).features),n&&this._createCounties(this._countyLayer,this.countyFeatures,this._geoPath)}else this.setCountyFeatures(null)}_createNation(t,e,n){t.selectAll("path").data(e).enter().append("path").attr("fill","#ccc").attr("stroke-width",0).attr("stroke","none").attr("vector-effect","non-scaling-stroke").attr("regionID",(function(t){return nl.pathRegionID(t.id)})).attr("d",n)}_createStates(t,e,n){if(null===e)return;let i=this;t.selectAll("path").data(e).enter().append("path").attr("class","statePath").attr("fill","rgba(0, 0, 0, 0.0)").attr("stroke",t=>i._strokeForRegionID(t.id)).attr("stroke-width",t=>i._strokeWidthForRegionID(t.id)).attr("vector-effect","non-scaling-stroke").attr("regionID",(function(t){return nl.pathRegionID(t.id)})).attr("d",n).on("mouseenter touchstart",(function(t){i._touchDidMove=!1,i._didMouseOverRegion(i,this,t)})).on("mouseleave touchmove",(function(t){i._touchDidMove=!0,i._didMouseOutRegion(i,this,t)})).on("touchend",(function(t){i._touchDidMove||(i._didClickRegion(i,this,t),rr.c.preventDefault())})).on("click",(function(t){i._didClickRegion(i,this,t),this._touchDidMove=!1,rr.c.preventDefault()}))}_createCounties(t,e,n){if(null===e)return;let i=this;t.selectAll("path").data(e).enter().append("path").attr("class","countyPath").attr("fill","rgba(255, 0, 0, 0)").attr("stroke","none").attr("stroke-width",2).attr("vector-effect","non-scaling-stroke").attr("regionID",(function(t){return nl.pathRegionID(t.id)})).attr("d",n).on("mouseover",(function(t){i._didMouseOverRegion(i,this,t)})).on("mouseout",(function(t){i._didMouseOutRegion(i,this,t)})).on("click",(function(t){i._didClickRegion(i,this,t)}))}_createOverlays(t,e,n){let i=this;e.selectAll("circle").data(n).enter().append("circle").attr("display","none").attr("regionID",(function(t){return nl.pathRegionID(t.id)})).attr("cx",(function(t){let e=i.boundingBoxForRegion(t.id);return(e.x+.5*e.width).toString()})).attr("cy",(function(t){let e=i.boundingBoxForRegion(t.id);return(e.y+.5*e.height).toString()})).attr("stroke","red").attr("stroke-width","1.0").attr("fill","rgba(255, 0, 0, 0.05)").attr("r","1.0")}updateMapForDay(t,e,n){this._currentDay=t,this._currentData=e,this._updateCountiesForDay(t,e,n)}_updateCountiesForDay(t,e,n){let i=this._countyLayer.selectAll("path.countyPath");n&&(i=i.transition().duration(1e3));let r=this;i.attr("fill",(function(n){let i=e.dataForRegionOnDay(n.id,t);if(null!=i){let t=r._evaluator.intensityForSnapshot(i);if(0!==t)return r._evaluator.colorForIntensity(t)}return"rgba(255, 0, 0, 0)"}))}_updateOverlaysForDay(t,e,n){let i=this._overlayLayer.selectAll("circle");n&&(i=i.transition().duration(300));let r=this;i.attr("r",(function(t){let n=t.id,i=e.get(n);if(i){let t=r._evaluator.intensityForSnapshot(i);if(t>=0){let e=1;return(e+(20-e)*t).toString()}}return this.attributes.r.value})).attr("display",(function(t){let n=t.id,i=e.get(n);if(i){if(r._evaluator.valueForSnapshot(i)>=0)return"initial"}return"none"}))}_didMouseOverRegion(t,e,n){t.onRegionMouseOver&&t.onRegionMouseOver(n.id)}_didMouseOutRegion(t,e,n){t.onRegionMouseOut&&t.onRegionMouseOut(n.id)}_didClickRegion(t,e,n){t.onRegionClicked&&t.onRegionClicked(n.id)}_didClickOcean(t){t.onOceanClicked&&t.onOceanClicked()}static pathRegionID(t){return"region"+t}}class il{static MobilityTypeForToggleCount(t){return t%V}static MobilityStatFromSnapshot(t,e){if(null===e.mobilityData)return null;switch(il.MobilityTypeForToggleCount(t.toggleCount)){case O:return e.mobilityData.retailAndRecreation;case L:return e.mobilityData.residential;case H:return e.mobilityData.workplace;case j:return e.mobilityData.parks;case z:return e.mobilityData.transit}return null}static MobilityAdjectiveForEvaluator(t){switch(il.MobilityTypeForToggleCount(t.toggleCount)){case O:return"Retail";case L:return"Residential";case H:return"Workplace";case j:return"Park";case z:return"Transit"}return null}static NounForEvaluator(t){return il.MobilityAdjectiveForEvaluator(t).toLowerCase()+" visits"}static DescriptionTemplateForEvaluator(t){return"<Token:FullyQualifiedNoun> <Token:RegionPreposition> <Token:Region> are <Token:DataQuantityDirection> <Token:DataQuantity> <Token:TimePreposition> <Token:ShortDate>."+il.CategoryDescriptionForEvaluator(t)+" On average, visits <Token:ChangeVerbWeekProgressive>: this metric has <Token:ChangeVerbWeek> <Token:AmountChangeWeek> when compared to a week ago, and <Token:ChangeVerbMonth> <Token:AmountChangeMonth> when compared to a month ago."}static CategoryDescriptionForEvaluator(t){switch(il.MobilityTypeForToggleCount(t.toggleCount)){case O:return" This metric includes places like restaurants, shopping centers, theme parks, and movie theaters.";case z:return" This metric includes places like public transit hubs, such as subway, bus, and train stations.";case j:return" This metric includes places like national parks, public beaches, plazas, and public gardens."}return""}static mobilityDataEvaluator(t=!0){let e=Br.baseLogHeatMapEvaluator("Mobility","cases");return e.setBaseStat((function(t,e){return il.MobilityStatFromSnapshot(t,e)})),e.statDescriptionFunction=function(t){return il.MobilityAdjectiveForEvaluator(t)},e.toggleFunction=function(t){let e=Er.from(t);return e.descriptionTemplate=il.DescriptionTemplateForEvaluator(t),e},e.allowNegative=!0,e.displayAsPercent=!0,e.valueFormatter=Z(".0%"),e.nounWithNumber="change",e.noun="visitation",e.baseRGB="131,182,146",e.supportedRegionLevel=F,e.maxPowerOfTen=0,e.descriptionTemplate=il.DescriptionTemplateForEvaluator(e),e.nounQualifier=function(t){return il.NounForEvaluator(t)},e.source="Google Mobility",t&&(e.benchmarkEvaluator=il.nationalMobilityDataEvaluator(),e.benchmarkRegionType=w),e}static nationalMobilityDataEvaluator(){let t=il.mobilityDataEvaluator(!1);return t.title="National Mobility Data",t.baseRGB="49,84,71",t.smoothed=!0,t.wantsFill=!1,t.annotation="<tspan x='0'>National</tspan><tspan x='0'dy='14'>average</tspan>",t}}var rl=function(t,e,n){t=+t,e=+e,n=(r=arguments.length)<2?(e=t,t=0,1):r<3?1:+n;for(var i=-1,r=0|Math.max(0,Math.ceil((e-t)/n)),a=new Array(r);++i<r;)a[i]=t+i*n;return a};const al=Symbol("implicit");function ol(){var t=new Map,e=[],n=[],i=al;function r(r){var a=r+"",o=t.get(a);if(!o){if(i!==al)return i;t.set(a,o=e.push(r))}return n[(o-1)%n.length]}return r.domain=function(n){if(!arguments.length)return e.slice();e=[],t=new Map;for(const i of n){const n=i+"";t.has(n)||t.set(n,e.push(i))}return r},r.range=function(t){return arguments.length?(n=Array.from(t),r):n.slice()},r.unknown=function(t){return arguments.length?(i=t,r):i},r.copy=function(){return ol(e,n).unknown(i)},ze.apply(r,arguments),r}function sl(){var t,e,n=ol().unknown(void 0),i=n.domain,r=n.range,a=0,o=1,s=!1,u=0,l=0,h=.5;function c(){var n=i().length,c=o<a,d=c?o:a,f=c?a:o;t=(f-d)/Math.max(1,n-u+2*l),s&&(t=Math.floor(t)),d+=(f-d-t*(n-u))*h,e=t*(1-u),s&&(d=Math.round(d),e=Math.round(e));var p=rl(n).map((function(e){return d+t*e}));return r(c?p.reverse():p)}return delete n.unknown,n.domain=function(t){return arguments.length?(i(t),c()):i()},n.range=function(t){return arguments.length?([a,o]=t,a=+a,o=+o,c()):[a,o]},n.rangeRound=function(t){return[a,o]=t,a=+a,o=+o,s=!0,c()},n.bandwidth=function(){return e},n.step=function(){return t},n.round=function(t){return arguments.length?(s=!!t,c()):s},n.padding=function(t){return arguments.length?(u=Math.min(1,l=+t),c()):u},n.paddingInner=function(t){return arguments.length?(u=Math.min(1,t),c()):u},n.paddingOuter=function(t){return arguments.length?(l=+t,c()):l},n.align=function(t){return arguments.length?(h=Math.max(0,Math.min(1,t)),c()):h},n.copy=function(){return sl(i(),[a,o]).round(s).paddingInner(u).paddingOuter(l).align(h)},ze.apply(c(),arguments)}class ul{constructor(t,e,n,i){this.numBars=10,this.labelBarPadding=6,this.labelFontSize=7,this.margin={top:12,left:110,bottom:10,right:10},this.onRegionMouseOver=null,this.onRegionMouseOut=null,this.onRegionClicked=null,this.evaluator=i,this._highlightedRegionID=null,this._currentHighlightedData=null,this._currentData=null,this.title=new lr(n),this.container=n.append("div").attr("class","base-chart-container content-column").append("div").attr("class","ranked-chart-container"),this.svg=this.container.append("svg").attr("width","100%").attr("height","100%"),this.svg.append("rect").attr("width","100%").attr("height","100%").attr("fill","white").attr("stroke-width","2px").attr("stroke","none"),this.yAxisContainer=this.svg.append("g").attr("class","y-axis"),this.xAxisContainer=this.svg.append("g").attr("transform",`translate(0,${this.margin.top})`).attr("class","x-axis"),this.barContainer=this.svg.append("g"),this._summaryText=this.svg.append("text").attr("x",10).attr("y",e-10).attr("class","medium");let r=this;window.addEventListener("resize",(function(){r.didResize()})),this.title.didTapStatAdjective=function(t){r._didToggleStatAdjective()}}barHeight(){return 15}_workingHeight(){return this.height-(this.margin.bottom+this.margin.top)}_rescaleAxes(){this.viewY=sl().range([this.margin.top,this.height-this.margin.bottom]).paddingOuter(.25).align(.75),this.viewX=Ve().range([this.margin.left,this.width-this.margin.right])}_didToggleStatAdjective(){let t=this.evaluator.toggledEvaluator();this.setEvaluator(t)}didResize(){this._parseDimensions()&&this.updateForData(this._currentData,this._currentHighlightedData,!1)}_parseDimensions(){let t=this.width,e=this.height;return this.width=parseInt(this.svg.style("width")),this.height=parseInt(this.svg.style("height")),(this.width!==t||this.height!==e)&&(this._rescaleAxes(),!0)}setEvaluator(t){this.evaluator=t,this.title.updateForContextChange(t,this.title.region,this.title.groupByUnit),this.updateForData(this._currentData,this._currentHighlightedData,!0)}_stringForNumber(t){return t<1e3?t.toString():Z(",.2r")(t)}hoverRegionWithID(t){!t&&this._currentHighlightedData&&(t=this._currentHighlightedData.region.ID),this._highlightedRegionID&&this.barContainer.select("rect[regionID="+ul.rectRegionID(this._highlightedRegionID)+"]").attr("stroke","none").attr("stroke-width",0),this._highlightedRegionID=t,t&&this.barContainer.select("rect[regionID="+ul.rectRegionID(t)+"]").attr("stroke","rgba(0, 0, 0, 1.0)").attr("stroke-width",2)}_strokeWidthForRegionID(t){return t===this._highlightedRegionID?2:0}_strokeForRegionID(t){return t===this._highlightedRegionID?"rgba(0, 0, 0, 1.0)":"none"}updateAxesForData(t,e){let n=this;this.xDomain=[0,1.1*xt(t,t=>n.evaluator.valueForSnapshot(t))],this.viewX.domain(this.xDomain).nice(),this.viewY.domain(t.map(t=>t.region.name));let i=this.xAxisContainer.attr("dummy","marker");e&&(i=i.transition().duration(1e3));let r=this.viewX.ticks(4);0===r[0]&&this.xDomain[1]>=1e3&&(r[1]>1e4?r[0]=5e3:r[1]>1e3?r[0]=500:r[0]=100);let a=(o=this.viewX,dt(1,o)).ticks(4).tickSize(-this._workingHeight()).tickValues(r);var o;i.call(a).selectAll("text").attr("class","ranked-bar-tick-label");let s=this.yAxisContainer.attr("transform","translate(4,0)");e&&(s=s.transition().duration(1e3)),s.call(ft(this.viewY).tickSize(0)).attr("text-anchor","begin").selectAll("text").attr("class","ranked-bar-label unselectable"),this.xAxisContainer.selectAll("g.tick line").attr("class","ranked-bar-line"),this.yAxisContainer.selectAll("path.domain").style("display","none"),this.xAxisContainer.selectAll("path.domain").style("display","none")}updateForData(t,e,n){void 0===this.width&&this._parseDimensions(),this._currentData=t,this._currentHighlightedData=e;let i=this,r=Array.from(t.values());r.sort((t,e)=>i.evaluator.valueForSnapshot(e)-i.evaluator.valueForSnapshot(t)),r=r.slice(0,this.numBars),r=r.filter((function(t){return i.evaluator.valueForSnapshot(t)>0}));let a=r.map(t=>t.region.ID);null===e||a.includes(e.region.ID)||r.push(e),this.updateAxesForData(r,n);let o=this.barContainer.selectAll("rect").data(r,(function(t){return t.region.ID})).join((function(t){return t.append("rect").attr("regionID",t=>ul.rectRegionID(t.region.ID)).attr("width",0).attr("x",i.viewX(0)).attr("height",i.barHeight()).attr("y",(function(t){return i.viewY(t.region.name)+.5*(i.viewY.bandwidth()-i.barHeight())})).on("mouseenter touchstart",(function(t){i._touchDidMove=!1,i._didMouseOverRegion(i,this,t)})).on("mouseleave touchmove",(function(t){i._touchDidMove=!0,i._didMouseOutRegion(i,this,t)})).on("touchend",(function(t){i._touchDidMove||(i._didClickRegion(i,this,t),rr.c.preventDefault())})).on("click",(function(t){i._didClickRegion(i,this,t),this._touchDidMove=!1,rr.c.preventDefault()}))}),(function(t){return t}),(function(t){return n&&(t=t.transition().duration(1e3)),t.attr("width",0).attr("transform","translate(0,"+i._workingHeight()+")").remove()}));n&&(o=o.transition().duration(1e3)),o.attr("fill","rgb(252, 185, 163)").attr("transform","translate(0, 0)").attr("stroke",t=>i._strokeForRegionID(t.region.ID)).attr("stroke-width",t=>i._strokeWidthForRegionID(t.region.ID)).attr("y",(function(t){return i.viewY(t.region.name)+.5*(i.viewY.bandwidth()-i.barHeight())})).attr("height",i.barHeight()).attr("width",t=>i.viewX(i.evaluator.valueForSnapshot(t))-i.viewX(0)),null!==e&&this.hoverRegionWithID(e.region.ID)}_didMouseOverRegion(t,e,n){t.onRegionMouseOver&&t.onRegionMouseOver(n.region.ID)}_didMouseOutRegion(t,e,n){t.onRegionMouseOut&&t.onRegionMouseOut(n.region.ID)}_didClickRegion(t,e,n){t.onRegionClicked&&t.onRegionClicked(n.region.ID)}static rectRegionID(t){return void 0===t?"regionUndefined":"region"+Object(rt.HashString)(t)}}class ll{constructor(t,e){this.name=t,this.regions=e,this.ID=Object(rt.HashString)(t)}}class hl{constructor(t,e){this.percent=t,this.snapshot=e}}class cl{constructor(t,e){this.label=t,this.value=e}}class dl{constructor(t,e){this.stats=e,this.container=t.append("div").attr("class","stat-column"),this.labelDivs=new Map,this.valueDivs=new Map;let n=this;e.forEach((function(t){n.valueDivs.set(t.label,n.container.append("div").attr("class","stat-value").text(t.value)),n.labelDivs.set(t.label,n.container.append("div").attr("class","stat-label").text(t.label))}))}updateStat(t){this.valueDivs.get(t.label).text(t.value)}}class fl{constructor(t,e){this.container=t.append("div").attr("class","stat-dashboard content-column"),this.numColumns=2,this.columnStats=new Array;let n=this;e.forEach((function(t,e){let i=e%n.numColumns;for(;n.columnStats.length<=i;)n.columnStats.push([]);n.columnStats[i].push(t)})),n.columns=[],this.columnStats.forEach((function(t){n.columns.push(new dl(n.container,t))}))}updateForStats(t){let e=this;t.forEach((function(t,n){let i=n%e.numColumns;e.columns[i].updateStat(t)}))}}class pl{constructor(t,e=!1){this.standalone=e;let n=e?" standalone":"",i=this;this.parent=t,this.form=t.append("form").attr("id","resizingForm").attr("class","region-select-text"+n),this.select=this.form.append("select").attr("id","resizingSelect").attr("class","title").on("change",(function(){i._didChange(this)})),this.onRegionSelected=null,this.selectedRegionID=null}elementSelection(){return this.form}_resize(t){let e=t.options[t.selectedIndex];if(void 0!==e){let t=this.form.append("select").attr("class","title sizing-only"),n=(t.append("option").text(e.text),t.style("width"));t.remove(),this.select.style("width",n)}}_didChange(t){this._resize(t);let e=t.options[t.selectedIndex];void 0!==e&&null!==this.onRegionSelected&&(this.selectedRegionID=e.value,this.onRegionSelected(this.selectedRegionID))}_currentlySelectedIndex(){return this.select.node().selectedIndex}setSelectedRegionWithID(t){let e=this.select.select("option[value='"+t+"']").node();null!==e?e.index!=this._currentlySelectedIndex()&&(this.select.node().selectedIndex=e.index,this._didChange(this.select.node())):console.log("No region in drop-down with ID: "+t)}updateForOptions(t){this.options=t,this.select.selectAll("optgroup").remove();let e=this;this.options.forEach((function(t,n){let i=e.select.append("optgroup").attr("label",n);t.forEach((function(t){i.append("option").attr("value",t.ID).text(e.standalone?t.fullyQualifiedName():t.qualifiedNameWithArticle())}))})),this._resize(this.select.node())}}class gl{constructor(t,e="center",n=!1){let i=this;this.container=t.append("h2").attr("class","date-subtitle header-subtitle-element"+(n?" standalone":"")).style("text-align",e);let r=this.container.append("span").attr("class","date-intro").text("Update for: ");n&&r.style("display","none"),this.yesterdayButton=this.container.append("span").attr("class","date-unselected").text("Yesterday").on("click",(function(){i._didClickDate(this)}));this.container.append("span").attr("class","date-divider").text(" | ");this.todayButton=this.container.append("span").attr("class","date-selected").text("Now").on("click",(function(){i._didClickDate(this)})),this.selectedButton=this.todayButton,this.dateFormatter=kn("%B %e"),this.today=null,this.onDateChanged=null}_didClickDate(t){t===this.yesterdayButton.node()?this._setLatest(!1):t===this.todayButton.node()&&this._setLatest(!0)}isLatest(){return this.selectedButton===this.todayButton}mostRecentDataIsFromToday(){let t=new Date,e=Object(B.e)(t.addHours(-3));return Object(B.i)(e)==Object(B.i)(this.today)}yesterday(){return this.today.addDays(-1)}_setLatest(t,e=!1){let n=t?this.todayButton:this.yesterdayButton;if(n!==this.selectedButton&&(this.selectedButton=n,this.todayButton.attr("class",t?"date-selected":"date-unselected"),this.yesterdayButton.attr("class",t?"date-unselected":"date-selected"),null!==this.onDateChanged&&!e)){let e=t?this.today:this.yesterday(),n=Object(B.d)(e);this.onDateChanged(n)}}setDate(t){null===this.today?this.setToday(t):this._setLatest(t.getTime()===this.today.getTime(),!0)}setToday(t){this.today=t,this.todayButton.text(this.dateFormatter(t)),this.yesterdayButton.text(this.mostRecentDataIsFromToday()?"Yesterday":this.dateFormatter(this.yesterday()))}}class vl{constructor(t,e=!1){let n=this,i=e?" standalone":"";this.container=e?t:t.append("div").attr("class","nav-control"+i),this.backButton=this.container.append("div").attr("class","back-button"+i).on("click",(function(){n._backButtonClicked()})),this.titleSelection=null,this.didClickBackButton=null,this._backButtonVisible=!0,this.setBackButtonVisible(!1,!1)}setBackButtonVisible(t,e=!0){t!==this._backButtonVisible&&(this.backButton.style("display",t?"flex":"none"),this._backButtonVisible=t)}_backButtonClicked(){null!==this.didClickBackButton&&this.didClickBackButton()}}class ml{constructor(t,e,n){this.allRegions=e,this.parentElement=t,this.container=t.append("div").attr("class","header-container"),this.collapsedFeatureElement=null;this.titleContainer=this.container.append("div").attr("class","title title-container header-title-element content-column").style("text-align","left"),this.titleNav=new vl(this.titleContainer),this.titleTextContainer=this.titleNav.container.append("div").attr("class","title-text-container"),this.virusName=this.titleTextContainer.append("div").attr("class","robo-text").text("Coronavirus "),this.regionPreposition=this.titleTextContainer.append("div").attr("class","robo-text"),this.regionSelect=new pl(this.titleTextContainer),this.dataByline=this.titleContainer.append("h3").attr("class","subtitle header-subtitle-element").style("text-align","left").html("Data from the New&nbsp;York&nbsp;Times and the COVID&nbsp;Tracking&nbsp;Project"),this.dateSelector=new gl(this.titleContainer,"left"),this.expandedElements=[this.titleContainer,this.dataByline,this.dateSelector.container],this.compactTitleContainer=this.container.append("div").attr("class","title title-container standalone").style("transform","translateY(-100%)"),this.compactTitleContent=this.compactTitleContainer.append("div").attr("class","standalone-title-content"),this.compactTitleNav=new vl(this.compactTitleContent,!0),this.compactRegionSelect=new pl(this.compactTitleContent,!0),this.compactDateSelector=new gl(this.compactTitleContent,"right",!0),this.updateForOptions(e);let i=this;this.titleNav.didClickBackButton=function(){i._didClickBackButton()},this.compactTitleNav.didClickBackButton=this.titleNav.didClickBackButton,this._computeCollapsedLayout(),this.setCollapsed(!1,!1),this.didClickBackButton=null}_didClickBackButton(){null!==this.didClickBackButton&&this.didClickBackButton()}_computeCollapsedLayout(){this.minHeaderHeight;let t=this.compactTitleContainer.node();if(this.minHeaderHeight=t.offsetTop+t.offsetHeight,this.maxHeaderHeight=this._currentHeaderNodeHeight(),null!==this.collapsedFeatureElement){let t=this.parentElement.node().offsetHeight,e=this.isCollapsed?t+(this.maxHeaderHeight-this.minHeaderHeight):t;this.parentElement.style("height",e+"px")}}_currentHeaderNodeHeight(){let t=this.container.node(),e=parseInt(this.container.style("padding-bottom").replace("px",""));return t.offsetTop+t.offsetHeight-e}setBackButtonVisible(t,e=!0){this.titleNav.setBackButtonVisible(t,e),this.compactTitleNav.setBackButtonVisible(t,e)}setFeaturedCollapseElement(t){this.collapsedFeatureElement=t,this._computeCollapsedLayout()}resetHeaderHeight(){this.parentElement.style("height","unset"),this._updateForResize(),this._computeCollapsedLayout()}_updateFeaturedElementPosition(t=!0){let e=this.isCollapsed?this.minHeaderHeight-this.maxHeaderHeight-2:0,n=this.container;t&&(n=n.transition().duration(500)),n.style("margin-bottom",e+"px")}setCollapsed(t,e){if(this.isCollapsed===t)return;this.isCollapsed=t;let n=t?1:0,i=1-n;this.expandedElements.forEach((function(t){let n=t;e&&(n=t.transition().duration(500)),n.style("opacity",i)})),this._updateFeaturedElementPosition(e);let r="translateY(-"+100*i+"%)";if(e){let t=Te("translateY(-"+100*n+"%)",r);this.compactTitleContainer.transition().duration(500).styleTween("transform",(function(e){return t}))}else this.compactTitleContainer.style("transform",r)}updateForRegion(t,e){this.regionPreposition.text(t.prepositionString()),this.setDate(e)}setDate(t){let e=new Date(t);e=Object(B.g)(e),this.dateSelector.setDate(e),void 0!==this.compactDateSelector&&this.compactDateSelector.setDate(e)}set onRegionSelected(t){this.regionSelect.onRegionSelected=t,this.compactRegionSelect.onRegionSelected=t}get onRegionSelected(){return this.regionSelect.onRegionSelected}_updateForResize(){let t=this._currentHeaderNodeHeight();t!==this.maxHeaderHeight&&(this.maxHeaderHeight=t,this._updateFeaturedElementPosition(!1))}setSelectedRegionWithID(t){this.regionSelect.setSelectedRegionWithID(t),this.compactRegionSelect.setSelectedRegionWithID(t),this._updateForResize()}updateForOptions(t){this.regionSelect.updateForOptions(t),this.compactRegionSelect.updateForOptions(t)}set onDateChanged(t){this.dateSelector.onDateChanged=t,this.compactDateSelector.onDateChanged=t}get onDateChanged(){return this.dateSelector.onDateChanged}}const yl=0,_l=1,Dl=2,wl=3,bl=4;class Sl{constructor(t,e=null){this.baseStat=-1,this.dateRange=e,this.recentDateRange=[e[1].addDays(-30),e[1]],this.didUpdateEvaluators=null;let n=this;this.baseStatToggle=t.append("div").attr("class","layer-toggles content-column"),this.caseButton=this.baseStatToggle.append("button").attr("class","toggle-button").text("Cases").on("click",(function(){n._didClickStatButton(this)})),this.deathButton=this.baseStatToggle.append("button").attr("class","toggle-button").text("Deaths").on("click",(function(){n._didClickStatButton(this)})),this.hospitalizationButton=this.baseStatToggle.append("button").attr("class","toggle-button").text("Hospitalizations").on("click",(function(){n._didClickStatButton(this)})),this.percentPositiveButton=this.baseStatToggle.append("button").attr("class","toggle-button").text("% Positive").on("click",(function(){n._didClickStatButton(this)})),this._setBaseStat(yl)}currentEvaluators(){return Sl.evaluatorsForConfiguration(this)}sortEvaluator(){let t=this.currentEvaluators();return t.length>1?t[1]:null}_didClickStatButton(t){let e=this._baseStatForButton(t);this._setBaseStat(e)}static activeClassName(){return"active"}_setBaseStat(t){if(this.baseStat===t)return;this.baseStat=t;const e=Sl.activeClassName();this.baseStatToggle.selectAll("button").each((function(){this.classList.remove(e)})),this._buttonForBaseStat(t).classList.add(e),this._didUpdate()}_didUpdate(){this.didUpdateEvaluators&&this.didUpdateEvaluators(this.currentEvaluators())}_baseStatForButton(t){return t===this.caseButton.node()?yl:t===this.deathButton.node()?_l:t===this.hospitalizationButton.node()?Dl:t===this.percentPositiveButton.node()?bl:t===this.testButton.node()?wl:void 0}_buttonForBaseStat(t){return t===yl?this.caseButton.node():t===_l?this.deathButton.node():t===Dl?this.hospitalizationButton.node():t===bl?this.percentPositiveButton.node():t===wl?this.testButton.node():void 0}static evaluatorsForConfiguration(t){let e=[];return t.baseStat===yl?e=[Br.newConfirmedCaseEvaluator(),Br.newCaseTrendEvaluator(),Br.newCaseGraphicEvaluator(t.dateRange)]:t.baseStat===_l?e=[Br.newDeathEvaluator(),Br.newDeathTrendEvaluator(),Br.newDeathGraphicEvaluator(t.dateRange)]:t.baseStat===wl?e=[Br.newTestEvaluator(),Br.newTestTrendEvaluator(),Br.newTestGraphicEvaluator(t.dateRange)]:t.baseStat===Dl?e=[Br.currentlyHospitalizedEvaluator(),Br.currentlyHospitalizedTrendEvaluator(),Br.currentlyHospitalizedGraphicEvaluator(t.dateRange)]:t.baseStat===bl&&(e=[Br.newTestPercentPositiveEvaluator(!0),Br.dailyPercentPositiveTrendEvaluator(),Br.dailyPercentPositiveGraphicEvaluator(t.recentDateRange)]),[Br.regionNameEvaluator()].concat(e)}}class Fl{constructor(t,e,n,i,r,a,o){this.firstDay="2020-03-04",this.baseRegion=a,this._nextRegionQueue=[],this.didSelectCounty=null;const s=this;this.setNationData(i),this.setCoalitionData(r),this.setStateData(n),this.setCountyData(e);let u=[this.nationInfectionData.firstDay,this.nationInfectionData.lastDay];this.headerSpacer=t.append("div").attr("class","header-spacer"),this.slider=null,this.statDashboard=new fl(t,this._coreStatsForSnapshot(null)),this.tableConfiguration=new Sl(t,u),this.tableConfiguration.didUpdateEvaluators=function(t){let e=s.tableConfiguration.sortEvaluator(),n=e.supportsRegionType(s.dataTable.childRegionType()),i=s.dataTable.highlightedRegionID===s.selectedRegionID,r=!n||!i;s.dataTable.updateForEvaluators(t,e,!1,r),r&&s.updateDataTable(!1)},this.dataTable=new ta(t,this.tableConfiguration.currentEvaluators(),this.tableConfiguration.sortEvaluator());let l=this._overTimeEvaluators();this.overTimeCharts=[],l.forEach((function(e){let n=new wr(t,e);n.fixTimeDomain(u[0],u[1]),s.overTimeCharts.push(n)}));let h=this._rankedBarChartEvaluators();this.rankedBarCharts=[],h.forEach((function(e){let n=new ul(600,400,t,e);s.rankedBarCharts.push(n)})),this.interactiveElements=[this.dataTable].concat(this.overTimeCharts).concat(this.rankedBarCharts),this.attributionDetails=this._pageAttribution(t),this.footerSpacer=t.append("div").attr("class","footer-spacer"),this._regionPickerActive=!1,this.headerContainer=t.append("div").attr("class","fixed-header-summary"),this.header=new ml(this.headerContainer,this._regionMenuGroups(),u),void 0!==this.header.compactTrendLine&&this.overTimeCharts.unshift(this.header.compactTrendLine),this.map=new nl(900,450,this.headerContainer,o,Br.confirmedCaseEvaluator()),this.header.setFeaturedCollapseElement(this.map),this.footerContainer=t.append("div").attr("class","fixed-control"),this.regionPicker=null,this._updateFixedRegionSpacing(),this.selectedRegionID=a.ID,this.hoveredRegionID=null,this.lastWindowWidthUpdate=window.outerWidth,this.updateSlider(),window.addEventListener("resize",(function(){s.didResize()})),window.addEventListener("scroll",(function(){s.didScroll(this)})),null!==this.slider&&(this.slider.onSliderValueChanged=function(t){s.pause();const e=s.nationInfectionData.dayForPercentElapsed(t);s.setDay(e,!1)}),this.map.onRegionClicked=function(t){s._vizClickedRegionID(t,s.map)},this.header.onRegionSelected=function(t){s._vizClickedRegionID(t,s.header)},this.header.onDateChanged=function(t){s.setDay(t,!0)},this.header.didClickBackButton=function(){let t=s._currentRegion(),e=null!==t.parentRegion?t.parentRegion:s.baseRegion;s._vizClickedRegionID(e.ID,s.header)},this.dataTable.onRegionClicked=function(t){s._vizClickedRegionID(t,s.dataTable)},this.overTimeCharts.forEach((function(t){null!==t.title&&(t.title.didTapRegionDescription=function(e){s._vizClickedRegionID(e.ID,t)}),t.hoverBoundsEvaluator=function(){return s.currentHoverBounds()}})),this.rankedBarCharts.forEach((function(t){null!==t.title&&(t.title.didTapRegionDescription=function(e){s._vizClickedRegionID(e.ID,t)}),t.onRegionClicked=function(e){s._vizClickedRegionID(e,t)},t.onRegionMouseOver=function(t){s.setHoveredRegion(t)},t.onRegionMouseOut=function(t){s.setHoveredRegion(null)}})),this.map.onRegionMouseOver=function(t){s.setHoveredRegion(t)},this.map.onRegionMouseOut=function(t){s.setHoveredRegion(null)},this.map.onOceanClicked=function(){s.unsetRegion(!0)},this.map.didScrollAwayFromHighlightedState=function(){console.log("Did scroll away from highlighted state"),s.unsetRegion(!1)},this.collapsed=!1,this.lastScrollOffset=0,this.didScroll(window,!1)}floatingHeaderBottomY(){let t=this.map.windowBounds();return t.y+t.height}currentHoverBounds(){let t=new Kr(0,0,window.innerWidth,window.innerHeight),e=this.floatingHeaderBottomY()+8;return new Kr(t.x,e,t.width,t.height-e)}currentlyFocusedChartElement(){let t=this.floatingHeaderBottomY();for(let e=0;e<this.interactiveElements.length;e++){let n=this.interactiveElements[e].container.node();if(n.getBoundingClientRect().y>=t)return n}return null}chartIsVisible(t){let e=t.container.node(),n=Kr.fromSVGRect(e.getBoundingClientRect()),i=this.currentHoverBounds(),r=n.top()>i.top()&&n.top()<i.bottom(),a=n.bottom()>i.top()&&n.bottom()<i.bottom();return r||a}setNationData(t){this.nationInfectionData=t?t.timeSeriesBeginningAt(this.firstDay):null}setCoalitionData(t){t?(this.coalitionInfectionData=t.timeSeriesBeginningAt(this.firstDay),this.enqueueTopRegions()):this.coalitionInfectionData=null}setStateData(t){t?(this.stateInfectionData=t.timeSeriesBeginningAt(this.firstDay),void 0!==this.currentDay&&(void 0!==this.header&&this.header.updateForOptions(this._regionMenuGroups()),void 0!==this.regionPicker&&null!==this.regionPicker&&this.regionPicker.updateForRegionSections(this._regionSections()),this.updateRankedChartForDay(this.currentDay,!1),this.updateDashboard(!1),this.updateDataTable(!1))):this.stateInfectionData=null}setCountyData(t){t?(this.countyInfectionData=t.timeSeriesBeginningAt(this.firstDay),void 0!==this.map&&this.updateMapForDay(this.currentDay,!0)):this.countyInfectionData=null}updateCountryGeometry(t){this.map.updateForCountryGeometry(t)}updateMobilityChart(){let t=this.overTimeCharts.last(),e=this.currentOverTimeDataSlice(this.currentDay);this.updateOverTimeChart(t,this.currentDay,this._currentRegion(),e,!0)}didResize(){let t=window.innerWidth;t!==this.lastWindowWidthUpdate&&(this.header.resetHeaderHeight(),this._updateFixedRegionSpacing(),this.lastWindowWidthUpdate=t)}didScroll(t,e=!0){let n=t.scrollY;this.lastScrollOffset<20&&!(n<20)?this.setHeaderCollapsed(!0,e):this.collapsed&&n<=0&&this.setHeaderCollapsed(!1,e),this.lastScrollOffset=n}enqueueTopRegions(){null!==this.coalitionInfectionData&&(this._nextRegionQueue=this.coalitionInfectionData.topRegions())}resetRegionQueue(){this._nextRegionQueue=[]}popNextRegion(){return this._nextRegionQueue.shift()}setHeaderCollapsed(t,e){this.collapsed!==t&&(this.collapsed=t,this.headerContainer.attr("compact",t?"":null),this.header.setCollapsed(t,e),this.map.setCompactView(t))}_overTimeEvaluators(){return[Br.newConfirmedCaseEvaluator(),Br.newDeathEvaluator(),Br.currentlyHospitalizedEvaluator(),Br.newTestBreakdownEvaluator(),Br.newTestPercentPositiveEvaluator(),il.mobilityDataEvaluator()]}_rankedBarChartEvaluators(){return[Br.newConfirmedCaseEvaluator(),Br.newDeathEvaluator()]}_setRegionPickerActive(t){this._regionPickerActive!==t&&null!==this.regionPicker&&(this._regionPickerActive=t,this.footerContainer.attr("active",t?"":null),this._updateFixedRegionSpacing())}_updateFixedRegionSpacing(){let t=this.headerContainer.node().offsetHeight;this.headerSpacer.style("height",t+"px");let e=this._regionPickerActive?this.footerContainer.node().offsetHeight:0;this.footerSpacer.style("height",e+"px")}_regionMenuGroups(){let t=new Map;t.set("Country",[this.baseRegion]),null!==this.coalitionInfectionData&&t.set("Regions",this.coalitionInfectionData.topRegions()),null!==this.stateInfectionData&&t.set("States",this.stateInfectionData.topRegions(0,null,Br.regionNameEvaluator(),!0));let e=this._currentRegion();if(null!==e&&null!==this.countyInfectionData){let n=this._regionIsState(e.ID),i=this._regionIsCounty(e.ID);if(n||i){let i=n?e:e.parentRegion,r=this.countyInfectionData.topRegions(0,(function(t){return null!==t.region.parentRegion&&t.region.parentRegion.ID===i.ID}),Br.regionNameEvaluator(),!0);t.set(i.name+" Counties",r)}}return t}_regionSections(){let t=[],e=[this.baseRegion];if(null!==this.coalitionInfectionData){let t=this.coalitionInfectionData.topRegions();e=e.concat(t)}if(t.push(new ll("Regions",e)),null!==this.stateInfectionData){let e=function(t){return t.region.ID<="56"},n=this.stateInfectionData.topRegions(8,e);t.push(new ll("Top states, by confirmed cases",n));let i=this.stateInfectionData.topRegions(8,e,Br.confirmedCaseEvaluator(),!0);t.push(new ll("States with fewest cases",i))}return t}_currentInfectionSnapshot(){let t=this._currentDataset(),e=this.currentDay,n=t.dataForDay(e),i=this.selectedRegionID?this.selectedRegionID:this.baseRegion.ID;return n.get(i)}_coreStatsForSnapshot(t){let e=t?t.infection:A.NullInfection(),n=Z(","),i=[];return i.push(new cl("Total Cases",e.cases?n(e.cases.value):"N/A")),i.push(new cl("Deaths",e.deaths?n(e.deaths.value):"N/A")),i}_elementSupportsRepeatedSelection(t,e){return t===this.dataTable&&(e!==this.dataTable.aggregateRegionID&&e===this.dataTable.highlightedRegionID&&!this._regionIsCounty(e))}_elementRequiresUpdateForRegion(t,e){return t!==this.dataTable||e===this.dataTable.highlightedRegionID}_vizClickedRegionID(t,e){if(this._inSelectionCallback||this._inRegionSet)return;this._inSelectionCallback=!0;let n=this.regionForRegionID(t),i=t=n.ID,r=this.selectedRegionID===t;r&&this.selectedRegionID===this.baseRegion.ID&&this.enqueueTopRegions(),r?this._elementSupportsRepeatedSelection(e,t)||(i=this._nextRegionQueue.length>0?this.popNextRegion().ID:(n.parentRegion?n.parentRegion:this.baseRegion).ID):this.resetRegionQueue(),this.setRegion(i,this._shouldZoomToRegion(i),e,t),this.selectedRegionID===this.baseRegion.ID&&this.map.resetZoom(),this._inSelectionCallback=!1}setHoveredRegion(t){if(this.hoveredRegionID===t)return;this.hoveredRegionID=t;let e=this._mapRegionIDsForRegionID(t);this.map.hoverRegionWithID(e[0]),this.rankedBarCharts.forEach((function(e){e.hoverRegionWithID(t)}))}setEvaluator(t){this._inEvaluatorCallback||(this._inEvaluatorCallback=!0,this.map.setEvaluator(t),this.updateTitles(),this._inEvaluatorCallback=!1)}_mapRegionIDsForRegionID(t){if(this._regionIsCoalition(t)){return this.regionForRegionID(t).subregionIDs}{let e=this._regionAliasesForRegion(t);if(void 0!==e&&e.length>0)return e}return[t]}zoomToRegion(t){let e=this._mapRegionIDsForRegionID(t);if(t){let t=this.map.boundingBoxForRegions(e);this.map.zoomToBox(t)}}setRegion(t,e=!0,n=null,i=null){if(this.selectedRegionID===t&&!this._elementSupportsRepeatedSelection(n,i))return;if(this._inRegionSet)return;this._inRegionSet=!0,console.log("Setting region ID: "+t),this.previouslySelectedRegionID=this.selectedRegionID,this.selectedRegionID=t,this._regionIsCounty(t)&&null!==this.didSelectCounty&&this.didSelectCounty(this.countyInfectionData),e&&this.zoomToRegion(t);let r=-1,a=this.currentlyFocusedChartElement();null!==a&&(r=a.getBoundingClientRect().y);if(this.header.setBackButtonVisible(this.selectedRegionID!==this.baseRegion.ID,!0),this.updateHeader(!0),this.map.highlightRegionsWithIDs(this._mapRegionIDsForRegionID(t)),this.updateDashboard(!0),this.updateDataTable(!0,n,i),this.updateTitles(!0),this.updateOverTimeChartsForDay(this.currentDay,!0),this.updateRankedChartForDay(this.currentDay,!0),this.updateSlider(),this.updateRegionPicker(),null!==a){let t=a.getBoundingClientRect().y;t!=r&&window.scrollBy(0,t-r)}this._inRegionSet=!1}regionForRegionID(t){if(void 0===t)return null;let e=this._datasetForRegionID(t);return null===e?null:e.regionForID(t)}unsetRegion(t){this.setRegion(this.baseRegion.ID,!1),t&&this.map.resetZoom()}_regionIsState(t){return this._datasetForRegionID(t)===this.stateInfectionData}_regionIsCounty(t){return this._datasetForRegionID(t)===this.countyInfectionData}_regionIsCoalition(t){return this._datasetForRegionID(t)===this.coalitionInfectionData}_regionIsNation(t){return this._datasetForRegionID(t)===this.nationInfectionData}_regionAliasesForRegion(t){let e=this._datasetForRegionID(t);if(null!==e)return e.regionAtlas.aliasesForRegion(t)}_shouldZoomToRegion(t){return this._regionIsState(t)||this._regionIsCoalition(t)}updateSlider(){if(null!==this.slider){let t=this.selectedRegionID?this.selectedRegionID:"0000",e=this._datasetForRegionID(t);this._updateSliderForTimeSeries(e,t)}}_datasetForRegionID(t){return void 0===t?null:null===t?this.nationInfectionData:null!==this.stateInfectionData&&this.stateInfectionData.containsRegion(t)?this.stateInfectionData:null!==this.nationInfectionData&&this.nationInfectionData.containsRegion(t)?this.nationInfectionData:null!==this.countyInfectionData&&this.countyInfectionData.containsRegion(t)?this.countyInfectionData:null!==this.coalitionInfectionData&&this.coalitionInfectionData.containsRegion(t)?this.coalitionInfectionData:null}_datasetForRegionType(t){switch(t){case w:return this.nationInfectionData;case b:return this.coalitionInfectionData;case S:return this.stateInfectionData;case F:return this.countyInfectionData}return null}_currentDataset(){return this._datasetForRegionID(this.selectedRegionID)}_currentDaysData(){return this._currentDataset().dataForDay(this.currentDay)}_currentRegion(){return this.regionForRegionID(this.selectedRegionID)}_updateSliderForTimeSeries(t,e){let n=[],i=0;for(;i<=1.000001;){let r=t.dayForPercentElapsed(i),a=t.snapshotForDay(r,e);"undefined"!==a&&n.push(new hl(i,a)),i+=.1}this.slider.updateSliderForStops(n)}updateDashboard(t){let e=this._currentInfectionSnapshot(),n=this._coreStatsForSnapshot(e);this.statDashboard.updateForStats(n)}updateDataTable(t,e=null,n=null){let i=this._currentRegion(),r=i,a=this.dataTable.sortEvaluator,o=a.supportsRegionType(i.type);if(o||(i=i.parentRegion,r=i.topParent()),this.dataTable.dataIsIncomplete=this.header.dateSelector.isLatest()&&this.header.dateSelector.mostRecentDataIsFromToday(),this._elementRequiresUpdateForRegion(e,n)){!a.supportsRegionType(i.type+1)&&o&&(r=i.type===S?i.topParent():i.parentRegion);let e=this._datasetForRegionID(r.ID),n=this._childDataSetForRegionOnDay(r.ID,this.currentDay),s=e.snapshotForDay(this.currentDay,r.ID);this.dataTable.updateForData(s,n,t,!0)}this.dataTable.updateForHighlightedRegion(i.ID)}updateTitles(t){let e=this.regionForRegionID(this.selectedRegionID),n=this;if(document.title="Coronavirus "+e.preposition+" "+e.qualifiedNameWithArticle(),this.overTimeCharts.forEach((function(i){if(null!==i.title){let r=n.chartIsVisible(i);i.title.updateForContextChange(i.evaluator,e,"day",t&&r)}})),!this._regionIsCounty(e.ID)){let i=this._regionIsState(e.ID)?"county":"state";this.rankedBarCharts.forEach((function(r){if(null!==r.title){let a=n.chartIsVisible(r);r.title.updateForContextChange(r.evaluator,e,i,t&&a)}}))}}updateHeader(t){this.updateHeaderDay(t),this.header.updateForOptions(this._regionMenuGroups()),this.header.setSelectedRegionWithID(this.selectedRegionID)}updateHeaderDay(t){this.header.updateForRegion(this._currentRegion(),this.currentDay)}updateMapForDay(t,e){null!==this.countyInfectionData&&this.map.updateMapForDay(t,this.countyInfectionData,e)}_currentChildDataSetForDay(t){return this._childDataSetForRegionOnDay(this._currentRegion().ID,t)}_childDataSetForRegionOnDay(t,e){let n=this._datasetForRegionID(t),i=n===this.stateInfectionData,r=n===this.coalitionInfectionData,a=n===this.countyInfectionData,o=null;if((i||r)&&t){let n=i?this.countyInfectionData:this.stateInfectionData;null!==n&&(o=n.dataForDay(e,(function(e){const n=e.region.parentRegion;return null!==n?n.ID===t:(console.log("missing parent region for: "+e.region.name+", ID: "+e.region.ID),!1)})))}else a||null===this.stateInfectionData||(o=this.stateInfectionData.dataForDay(e));return o}updateRankedChartForDay(t,e){if(null===this.stateInfectionData)return;this._currentDataset();let n=this._currentRegion(),i=n,r=null,a=null;n.type===F&&(i=n.parentRegion,r=n);let o=this._childDataSetForRegionOnDay(i.ID,t);if(null===o&&(o=this.stateInfectionData.dataForDay(t)),null!==r&&(a=o.get(r.ID)),null!==o){let t=this;this.rankedBarCharts.forEach((function(n){let i=t.chartIsVisible(n);n.updateForData(o,a,e&&i)}))}}updateOverTimeChart(t,e,n,i,r){let a=t.evaluator;if(!a.supportsRegionType(n.type))return void t.hide(r);if(t.show(r),null!==a.benchmarkEvaluator)if("0000"===n.ID)t.benchmarkSeries=null;else if(null===t.benchmarkSeries){let n=this._datasetForRegionType(a.benchmarkRegionType).timeSeriesEndingAt(e).dataSliceForRegionID("0000");t.benchmarkSeries=new gr(n,a.benchmarkEvaluator)}let o=this.chartIsVisible(t);t.updateForData(i,r&&o),t.updateDescriptionForRegion(n)}currentOverTimeDataSlice(t){let e=this._currentDataset().timeSeriesEndingAt(t),n=this.selectedRegionID?this.selectedRegionID:"0000";return e.dataSliceForRegionID(n)}updateOverTimeChartsForDay(t,e){let n=this.currentOverTimeDataSlice(t);if(n){let i=this,r=this._currentRegion(),a=this.overTimeCharts.length;for(let o=0;o<a;o++){let s=i.overTimeCharts[a-1-o];i.updateOverTimeChart(s,t,r,n,e)}}}updateRegionPicker(){this._regionPickerActive&&null!==this.regionPicker&&this.regionPicker.selectRegionWithID(this.selectedRegionID)}setDay(t,e=!1){if(this.currentDay===t)return;let n=void 0===this.currentDay;this.currentDay=t,n&&(this.updateMapForDay(t,e),this.updateTitles(e)),this.updateHeaderDay(e),this.updateDashboard(e),this.updateDataTable(e),this.updateRankedChartForDay(t,e),this.updateOverTimeChartsForDay(t,e),null===this.slider||this.slider.isBeingDragged||this.slider.updateSliderForPercentComplete(this.nationInfectionData.percentElapsedForDay(t))}play(){this.timer&&this.timer.stop();let t=this.nationInfectionData.days(),e=0,n=this;this.timer=Xr((function(i){if(Math.floor(i/400)>e){e++;const i=t.next();i.done?n.timer.stop():n.setDay(i.value,!0)}}),150)}pause(){this.timer&&this.timer.stop()}_pageAttribution(t){return t.append("div").attr("class","attribution-footer content-column").html('<p>Data is updated and aggregated every hour according to the following open-source datasets:</p><p>Case and death data is reported via the <a href="https://www.nytimes.com/interactive/2020/us/coronavirus-us-cases.html">New York Times</a>. Testing and hospitalization data is reported via the <a href="https://covidtracking.com/">COVID Tracking Project</a>. Visitation data is calculated via <a href="https://www.google.com/covid19/mobility/">Google Community Mobility Reports</a>.</p><p>Site is developed and maintained by <a href="https://www.twitter.com/codeblue87">Ben Cunningham</a>. Front-end code is available on <a href="https://github.com/bcunning/CoronaViz">github</a>.</p>')}}var xl=!1;function Cl(t,e,n){console.time("Process top-level Data");let i=new C,r=Nr.fromJSONObject(e.nationData,i),a=null,o=null,s=null;i.addAll(r.regionAtlas),r.updateForMobilityJSON(n);let u=r.topRegion();void 0!==e.coalitionData&&(a=Nr.fromJSONObject(e.coalitionData,i),i.addAll(a.regionAtlas)),void 0!==e.stateData&&(o=Nr.fromJSONObject(e.stateData,i),i.addAll(o.regionAtlas)),console.timeEnd("Process top-level Data");let l=null;var h;console.log("Begin County CSV Load"),console.time("Load County CSVs"),Promise.all([y("processed-data/data-county.json?d=LastUpdateToken"),y("topo/counties-10m.json"),y("processed-data/mobility-coalition.json?d=LastUpdateToken")]).then((function(t){console.timeEnd("Load County CSVs");let e=t[0],n=t[1],r=t[2];console.time("Process remaining region data"),a.updateForMobilityJSON(r),void 0!==e.countyData&&(console.time("Parse county JSON"),s=Nr.fromJSONObject(e.countyData,i),console.timeEnd("Parse county JSON")),console.timeEnd("Process remaining region data"),void 0!==n&&(console.time("Create county paths"),l.updateCountryGeometry(n),console.timeEnd("Create county paths")),null!==s&&(console.time("Update county fill"),l.setCountyData(s),console.timeEnd("Update county fill")),console.timeEnd("Full Site Load")})),h=o,console.time("Load State mobility data"),Promise.all([y("processed-data/mobility-state.json?d=LastUpdateToken")]).then((function(t){console.timeEnd("Load State mobility data"),console.time("Process State mobility data");let e=t[0];h.updateForMobilityJSON(e),console.timeEnd("Process State mobility data")})),console.log("Begin building initial view"),console.time("Build initial view"),l=new Fl(Object(D.a)("body"),s,o,r,a,u,t),l.setDay(l.nationInfectionData.dayForPercentElapsed(1),!1),l.didSelectCounty=function(t){xl||(xl=!0,function(t,e){console.time("Load county mobility data"),Promise.all([y("processed-data/mobility-county.json?d=LastUpdateToken")]).then((function(n){console.timeEnd("Load county mobility data"),console.time("Process county mobility data");let i=n[0];e.updateForMobilityJSON(i),t.updateMobilityChart(),console.timeEnd("Process county mobility data")}))}(l,t))},console.timeEnd("Build initial view"),console.timeEnd("First site load")}console.time("Full Site Load"),console.time("First site load"),console.time("Load top-level CSVs"),Promise.all([y("topo/states-10m.json"),y("processed-data/data-nation-state.json?d=LastUpdateToken"),y("processed-data/mobility-nation.json?d=LastUpdateToken")]).then((function(t){console.timeEnd("Load top-level CSVs"),Cl(t[0],t[1],t[2])}))},3:function(t,e,n){"use strict";n.d(e,"c",(function(){return Z})),n.d(e,"a",(function(){return $}));var i=n(7),r=n(14),a=n(15),o=function(t){return new Array(t.length)};function s(t,e){this.ownerDocument=t.ownerDocument,this.namespaceURI=t.namespaceURI,this._next=null,this._parent=t,this.__data__=e}s.prototype={constructor:s,appendChild:function(t){return this._parent.insertBefore(t,this._next)},insertBefore:function(t,e){return this._parent.insertBefore(t,e)},querySelector:function(t){return this._parent.querySelector(t)},querySelectorAll:function(t){return this._parent.querySelectorAll(t)}};function u(t,e,n,i,r,a){for(var o,u=0,l=e.length,h=a.length;u<h;++u)(o=e[u])?(o.__data__=a[u],i[u]=o):n[u]=new s(t,a[u]);for(;u<l;++u)(o=e[u])&&(r[u]=o)}function l(t,e,n,i,r,a,o){var u,l,h,c={},d=e.length,f=a.length,p=new Array(d);for(u=0;u<d;++u)(l=e[u])&&(p[u]=h="$"+o.call(l,l.__data__,u,e),h in c?r[u]=l:c[h]=l);for(u=0;u<f;++u)(l=c[h="$"+o.call(t,a[u],u,a)])?(i[u]=l,l.__data__=a[u],c[h]=null):n[u]=new s(t,a[u]);for(u=0;u<d;++u)(l=e[u])&&c[p[u]]===l&&(r[u]=l)}function h(t,e){return t<e?-1:t>e?1:t>=e?0:NaN}var c=n(8);function d(t){return function(){this.removeAttribute(t)}}function f(t){return function(){this.removeAttributeNS(t.space,t.local)}}function p(t,e){return function(){this.setAttribute(t,e)}}function g(t,e){return function(){this.setAttributeNS(t.space,t.local,e)}}function v(t,e){return function(){var n=e.apply(this,arguments);null==n?this.removeAttribute(t):this.setAttribute(t,n)}}function m(t,e){return function(){var n=e.apply(this,arguments);null==n?this.removeAttributeNS(t.space,t.local):this.setAttributeNS(t.space,t.local,n)}}var y=n(16);function _(t){return function(){delete this[t]}}function D(t,e){return function(){this[t]=e}}function w(t,e){return function(){var n=e.apply(this,arguments);null==n?delete this[t]:this[t]=n}}function b(t){return t.trim().split(/^|\s+/)}function S(t){return t.classList||new F(t)}function F(t){this._node=t,this._names=b(t.getAttribute("class")||"")}function x(t,e){for(var n=S(t),i=-1,r=e.length;++i<r;)n.add(e[i])}function C(t,e){for(var n=S(t),i=-1,r=e.length;++i<r;)n.remove(e[i])}function T(t){return function(){x(this,t)}}function R(t){return function(){C(this,t)}}function I(t,e){return function(){(e.apply(this,arguments)?x:C)(this,t)}}F.prototype={add:function(t){this._names.indexOf(t)<0&&(this._names.push(t),this._node.setAttribute("class",this._names.join(" ")))},remove:function(t){var e=this._names.indexOf(t);e>=0&&(this._names.splice(e,1),this._node.setAttribute("class",this._names.join(" ")))},contains:function(t){return this._names.indexOf(t)>=0}};function M(){this.textContent=""}function k(t){return function(){this.textContent=t}}function E(t){return function(){var e=t.apply(this,arguments);this.textContent=null==e?"":e}}function A(){this.innerHTML=""}function B(t){return function(){this.innerHTML=t}}function N(t){return function(){var e=t.apply(this,arguments);this.innerHTML=null==e?"":e}}function P(){this.nextSibling&&this.parentNode.appendChild(this)}function O(){this.previousSibling&&this.parentNode.insertBefore(this,this.parentNode.firstChild)}var H=n(6);function z(t){return function(){var e=this.ownerDocument,n=this.namespaceURI;return n===H.b&&e.documentElement.namespaceURI===H.b?e.createElement(t):e.createElementNS(n,t)}}function j(t){return function(){return this.ownerDocument.createElementNS(t.space,t.local)}}var L=function(t){var e=Object(c.a)(t);return(e.local?j:z)(e)};function V(){return null}function W(){var t=this.parentNode;t&&t.removeChild(this)}function U(){var t=this.cloneNode(!1),e=this.parentNode;return e?e.insertBefore(t,this.nextSibling):t}function Y(){var t=this.cloneNode(!0),e=this.parentNode;return e?e.insertBefore(t,this.nextSibling):t}var G=n(10),Q=n(9);function q(t,e,n){var i=Object(Q.a)(t),r=i.CustomEvent;"function"==typeof r?r=new r(e,n):(r=i.document.createEvent("Event"),n?(r.initEvent(e,n.bubbles,n.cancelable),r.detail=n.detail):r.initEvent(e,!1,!1)),t.dispatchEvent(r)}function X(t,e){return function(){return q(this,t,e)}}function J(t,e){return function(){return q(this,t,e.apply(this,arguments))}}var Z=[null];function $(t,e){this._groups=t,this._parents=e}function K(){return new $([[document.documentElement]],Z)}$.prototype=K.prototype={constructor:$,select:function(t){"function"!=typeof t&&(t=Object(i.a)(t));for(var e=this._groups,n=e.length,r=new Array(n),a=0;a<n;++a)for(var o,s,u=e[a],l=u.length,h=r[a]=new Array(l),c=0;c<l;++c)(o=u[c])&&(s=t.call(o,o.__data__,c,u))&&("__data__"in o&&(s.__data__=o.__data__),h[c]=s);return new $(r,this._parents)},selectAll:function(t){"function"!=typeof t&&(t=Object(r.a)(t));for(var e=this._groups,n=e.length,i=[],a=[],o=0;o<n;++o)for(var s,u=e[o],l=u.length,h=0;h<l;++h)(s=u[h])&&(i.push(t.call(s,s.__data__,h,u)),a.push(s));return new $(i,a)},filter:function(t){"function"!=typeof t&&(t=Object(a.a)(t));for(var e=this._groups,n=e.length,i=new Array(n),r=0;r<n;++r)for(var o,s=e[r],u=s.length,l=i[r]=[],h=0;h<u;++h)(o=s[h])&&t.call(o,o.__data__,h,s)&&l.push(o);return new $(i,this._parents)},data:function(t,e){if(!t)return v=new Array(this.size()),d=-1,this.each((function(t){v[++d]=t})),v;var n,i=e?l:u,r=this._parents,a=this._groups;"function"!=typeof t&&(n=t,t=function(){return n});for(var o=a.length,s=new Array(o),h=new Array(o),c=new Array(o),d=0;d<o;++d){var f=r[d],p=a[d],g=p.length,v=t.call(f,f&&f.__data__,d,r),m=v.length,y=h[d]=new Array(m),_=s[d]=new Array(m);i(f,p,y,_,c[d]=new Array(g),v,e);for(var D,w,b=0,S=0;b<m;++b)if(D=y[b]){for(b>=S&&(S=b+1);!(w=_[S])&&++S<m;);D._next=w||null}}return(s=new $(s,r))._enter=h,s._exit=c,s},enter:function(){return new $(this._enter||this._groups.map(o),this._parents)},exit:function(){return new $(this._exit||this._groups.map(o),this._parents)},join:function(t,e,n){var i=this.enter(),r=this,a=this.exit();return i="function"==typeof t?t(i):i.append(t+""),null!=e&&(r=e(r)),null==n?a.remove():n(a),i&&r?i.merge(r).order():r},merge:function(t){for(var e=this._groups,n=t._groups,i=e.length,r=n.length,a=Math.min(i,r),o=new Array(i),s=0;s<a;++s)for(var u,l=e[s],h=n[s],c=l.length,d=o[s]=new Array(c),f=0;f<c;++f)(u=l[f]||h[f])&&(d[f]=u);for(;s<i;++s)o[s]=e[s];return new $(o,this._parents)},order:function(){for(var t=this._groups,e=-1,n=t.length;++e<n;)for(var i,r=t[e],a=r.length-1,o=r[a];--a>=0;)(i=r[a])&&(o&&4^i.compareDocumentPosition(o)&&o.parentNode.insertBefore(i,o),o=i);return this},sort:function(t){function e(e,n){return e&&n?t(e.__data__,n.__data__):!e-!n}t||(t=h);for(var n=this._groups,i=n.length,r=new Array(i),a=0;a<i;++a){for(var o,s=n[a],u=s.length,l=r[a]=new Array(u),c=0;c<u;++c)(o=s[c])&&(l[c]=o);l.sort(e)}return new $(r,this._parents).order()},call:function(){var t=arguments[0];return arguments[0]=this,t.apply(null,arguments),this},nodes:function(){var t=new Array(this.size()),e=-1;return this.each((function(){t[++e]=this})),t},node:function(){for(var t=this._groups,e=0,n=t.length;e<n;++e)for(var i=t[e],r=0,a=i.length;r<a;++r){var o=i[r];if(o)return o}return null},size:function(){var t=0;return this.each((function(){++t})),t},empty:function(){return!this.node()},each:function(t){for(var e=this._groups,n=0,i=e.length;n<i;++n)for(var r,a=e[n],o=0,s=a.length;o<s;++o)(r=a[o])&&t.call(r,r.__data__,o,a);return this},attr:function(t,e){var n=Object(c.a)(t);if(arguments.length<2){var i=this.node();return n.local?i.getAttributeNS(n.space,n.local):i.getAttribute(n)}return this.each((null==e?n.local?f:d:"function"==typeof e?n.local?m:v:n.local?g:p)(n,e))},style:y.a,property:function(t,e){return arguments.length>1?this.each((null==e?_:"function"==typeof e?w:D)(t,e)):this.node()[t]},classed:function(t,e){var n=b(t+"");if(arguments.length<2){for(var i=S(this.node()),r=-1,a=n.length;++r<a;)if(!i.contains(n[r]))return!1;return!0}return this.each(("function"==typeof e?I:e?T:R)(n,e))},text:function(t){return arguments.length?this.each(null==t?M:("function"==typeof t?E:k)(t)):this.node().textContent},html:function(t){return arguments.length?this.each(null==t?A:("function"==typeof t?N:B)(t)):this.node().innerHTML},raise:function(){return this.each(P)},lower:function(){return this.each(O)},append:function(t){var e="function"==typeof t?t:L(t);return this.select((function(){return this.appendChild(e.apply(this,arguments))}))},insert:function(t,e){var n="function"==typeof t?t:L(t),r=null==e?V:"function"==typeof e?e:Object(i.a)(e);return this.select((function(){return this.insertBefore(n.apply(this,arguments),r.apply(this,arguments)||null)}))},remove:function(){return this.each(W)},clone:function(t){return this.select(t?Y:U)},datum:function(t){return arguments.length?this.property("__data__",t):this.node().__data__},on:G.b,dispatch:function(t,e){return this.each(("function"==typeof e?J:X)(t,e))}};e.b=K},5:function(t,e,n){"use strict";n.r(e),n.d(e,"HashString",(function(){return r}));var i=n(175);function r(t){var e=0,n=t.length,i=0;if(n>0)for(;i<n;)e=(e<<5)-e+t.charCodeAt(i++)|0;return"hash"+e.toString()}String.prototype.capitalize=function(){return this.charAt(0).toUpperCase()+this.slice(1)},Date.prototype.addHours=function(t){return Object(i.g)(new Date(this.getTime()+t*i.b))},Date.prototype.addDays=function(t){return Object(i.g)(new Date(this.getTime()+t*i.a))},Array.prototype.last=function(){return this[this.length-1]},Array.prototype.first=function(){return this[0]}},6:function(t,e,n){"use strict";n.d(e,"b",(function(){return i}));var i="http://www.w3.org/1999/xhtml";e.a={svg:"http://www.w3.org/2000/svg",xhtml:i,xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"}},7:function(t,e,n){"use strict";function i(){}e.a=function(t){return null==t?i:function(){return this.querySelector(t)}}},8:function(t,e,n){"use strict";var i=n(6);e.a=function(t){var e=t+="",n=e.indexOf(":");return n>=0&&"xmlns"!==(e=t.slice(0,n))&&(t=t.slice(n+1)),i.a.hasOwnProperty(e)?{space:i.a[e],local:t}:t}},9:function(t,e,n){"use strict";e.a=function(t){return t.ownerDocument&&t.ownerDocument.defaultView||t.document&&t||t.defaultView}}})}));
//# sourceMappingURL=CoronaBundle.js.map